"use strict";window.cr={},cr.plugins_={},cr.behaviors={},"function"!=typeof Object.getPrototypeOf&&(Object.getPrototypeOf="object"==typeof"test".__proto__?function(t){return t.__proto__}:function(t){return t.constructor.prototype}),function(){function t(t,e){this.x=t,this.y=e,cr.seal(this)}function e(t,e,i,r){this.set(t,e,i,r),cr.seal(this)}function i(){this.tlx=0,this.tly=0,this.trx=0,this.try_=0,this.brx=0,this.bry=0,this.blx=0,this.bly=0,cr.seal(this)}cr.logexport=function(t){window.console&&window.console.log&&window.console.log(t)},cr.logerror=function(t){window.console&&window.console.error&&window.console.error(t)},cr.seal=function(t){return t},cr.freeze=function(t){return t},cr.is_undefined=function(t){return void 0===t},cr.is_number=function(t){return"number"==typeof t},cr.is_string=function(t){return"string"==typeof t},cr.isPOT=function(t){return 0<t&&0==(t-1&t)},cr.nextHighestPowerOfTwo=function(t){--t;for(var e=1;e<32;e<<=1)t|=t>>e;return t+1},cr.abs=function(t){return t<0?-t:t},cr.max=function(t,e){return e<t?t:e},cr.min=function(t,e){return t<e?t:e},cr.PI=Math.PI,cr.round=function(t){return t+.5|0},cr.floor=function(t){return 0<=t?0|t:(0|t)-1},cr.ceil=function(t){var e=0|t;return e===t?e:1+e},t.prototype.offset=function(t,e){return this.x+=t,this.y+=e,this},t.prototype.mul=function(t,e){return this.x*=t,this.y*=e,this},cr.vector2=t,cr.segments_intersect=function(t,e,i,r,s,n,o,a){var h,c,l,u,p,d=t<i?(h=t,i):(h=i,t),g=s<o?(l=s,o):(l=o,s);if(d<l||g<h)return!1;if(u=n<a?(p=n,a):(p=a,n),(e<r?(c=e,r):(c=r,e))<p||u<c)return!1;var f=s-t+o-i,y=n-e+a-r,m=i-t,_=r-e,v=o-s,b=a-n,w=cr.abs(_*v-b*m),x=v*y-b*f;if(cr.abs(x)>w)return!1;var T=m*y-_*f;return cr.abs(T)<=w},e.prototype.set=function(t,e,i,r){this.left=t,this.top=e,this.right=i,this.bottom=r},e.prototype.copy=function(t){this.left=t.left,this.top=t.top,this.right=t.right,this.bottom=t.bottom},e.prototype.width=function(){return this.right-this.left},e.prototype.height=function(){return this.bottom-this.top},e.prototype.offset=function(t,e){return this.left+=t,this.top+=e,this.right+=t,this.bottom+=e,this},e.prototype.normalize=function(){var t=0;this.left>this.right&&(t=this.left,this.left=this.right,this.right=t),this.top>this.bottom&&(t=this.top,this.top=this.bottom,this.bottom=t)},e.prototype.intersects_rect=function(t){return!(t.right<this.left||t.bottom<this.top||t.left>this.right||t.top>this.bottom)},e.prototype.intersects_rect_off=function(t,e,i){return!(t.right+e<this.left||t.bottom+i<this.top||t.left+e>this.right||t.top+i>this.bottom)},e.prototype.contains_pt=function(t,e){return t>=this.left&&t<=this.right&&e>=this.top&&e<=this.bottom},e.prototype.equals=function(t){return this.left===t.left&&this.top===t.top&&this.right===t.right&&this.bottom===t.bottom},cr.rect=e,i.prototype.set_from_rect=function(t){this.tlx=t.left,this.tly=t.top,this.trx=t.right,this.try_=t.top,this.brx=t.right,this.bry=t.bottom,this.blx=t.left,this.bly=t.bottom},i.prototype.set_from_rotated_rect=function(t,e){var i,r,s,n,o,a,h,c,l,u;0===e?this.set_from_rect(t):(i=Math.sin(e),r=Math.cos(e),s=t.left*i,n=t.top*i,o=t.right*i,a=t.bottom*i,h=t.left*r,c=t.top*r,l=t.right*r,u=t.bottom*r,this.tlx=h-n,this.tly=c+s,this.trx=l-n,this.try_=c+o,this.brx=l-a,this.bry=u+o,this.blx=h-a,this.bly=u+s)},i.prototype.offset=function(t,e){return this.tlx+=t,this.tly+=e,this.trx+=t,this.try_+=e,this.brx+=t,this.bry+=e,this.blx+=t,this.bly+=e,this};var s=0,n=0;function r(t,e,i,r){n=t<e?i<r?(s=t<i?t:i,r<e?e:r):(s=t<r?t:r,i<e?e:i):i<r?(s=e<i?e:i,r<t?t:r):(s=e<r?e:r,i<t?t:i)}i.prototype.bounding_box=function(t){r(this.tlx,this.trx,this.brx,this.blx),t.left=s,t.right=n,r(this.tly,this.try_,this.bry,this.bly),t.top=s,t.bottom=n},i.prototype.contains_pt=function(t,e){var i=this.tlx,r=this.tly,s=this.trx-i,n=this.try_-r,o=this.brx-i,a=this.bry-r,h=t-i,c=e-r,l=s*s+n*n,u=s*o+n*a,p=s*h+n*c,d=o*o+a*a,g=o*h+a*c,f=1/(l*d-u*u),y=(d*p-u*g)*f,m=(l*g-u*p)*f;if(0<=y&&0<m&&y+m<1)return!0;m=((l=(s=this.blx-i)*s+(n=this.bly-r)*n)*g-(u=s*o+n*a)*(p=s*h+n*c))*(f=1/(l*d-u*u));return 0<=(y=(d*p-u*g)*f)&&0<m&&y+m<1},i.prototype.at=function(t,e){if(e)switch(t){case 0:return this.tlx;case 1:return this.trx;case 2:return this.brx;case 3:return this.blx;case 4:default:return this.tlx}else switch(t){case 0:return this.tly;case 1:return this.try_;case 2:return this.bry;case 3:return this.bly;case 4:default:return this.tly}},i.prototype.midX=function(){return(this.tlx+this.trx+this.brx+this.blx)/4},i.prototype.midY=function(){return(this.tly+this.try_+this.bry+this.bly)/4},i.prototype.intersects_segment=function(t,e,i,r){if(this.contains_pt(t,e)||this.contains_pt(i,r))return!0;for(var s,n,o,a,h=0;h<4;h++)if(s=this.at(h,!0),n=this.at(h,!1),o=this.at(h+1,!0),a=this.at(h+1,!1),cr.segments_intersect(t,e,i,r,s,n,o,a))return!0;return!1},i.prototype.intersects_quad=function(t){var e,i,r,s,n,o,a,h,c,l,u=t.midX(),p=t.midY();if(this.contains_pt(u,p))return!0;if(u=this.midX(),p=this.midY(),t.contains_pt(u,p))return!0;for(c=0;c<4;c++)for(l=0;l<4;l++)if(e=this.at(c,!0),i=this.at(c,!1),r=this.at(c+1,!0),s=this.at(c+1,!1),n=t.at(l,!0),o=t.at(l,!1),a=t.at(l+1,!0),h=t.at(l+1,!1),cr.segments_intersect(e,i,r,s,n,o,a,h))return!0;return!1},cr.quad=i,cr.RGB=function(t,e,i){return Math.max(Math.min(t,255),0)|Math.max(Math.min(e,255),0)<<8|Math.max(Math.min(i,255),0)<<16};var o=1024,a=16384,h=8191,c=-8192;cr.RGBAEx=function(t,e,i,r){return t=cr.clamp(Math.floor(1024*t),c,h),e=cr.clamp(Math.floor(1024*e),c,h),i=cr.clamp(Math.floor(1024*i),c,h),r=cr.clamp(Math.floor(1024*r),0,1024),t<0&&(t+=a),e<0&&(e+=a),i<0&&(i+=a),-(t*a*a*o+e*a*o+i*o+r)},cr.RGBEx=function(t,e,i){return cr.RGBAEx(t,e,i,1)},cr.GetRValue=function(t){if(0<=t)return(255&t)/255;var e=Math.floor(-t/(a*a*o));return h<e&&(e-=a),e/1024},cr.GetGValue=function(t){if(0<=t)return((65280&t)>>8)/255;var e=Math.floor(-t%(a*a*o)/(a*o));return h<e&&(e-=a),e/1024},cr.GetBValue=function(t){if(0<=t)return((16711680&t)>>16)/255;var e=Math.floor(-t%(a*o)/o);return h<e&&(e-=a),e/1024},cr.GetAValue=function(t){return 0===(e=t)&&1/e<0?0:0<=t?1:Math.floor(-t%o)/1024;var e},cr.shallowCopy=function(t,e,i){var r;for(r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);return t},cr.arrayRemove=function(t,e){var i,r;if(!((e=cr.floor(e))<0||e>=t.length)){for(i=e,r=t.length-1;i<r;i++)t[i]=t[i+1];cr.truncateArray(t,r)}},cr.truncateArray=function(t,e){t.length=e},cr.clearArray=function(t){cr.truncateArray(t,0)},cr.shallowAssignArray=function(t,e){var i,r;for(cr.clearArray(t),i=0,r=e.length;i<r;++i)t[i]=e[i]},cr.appendArray=function(t,e){t.push.apply(t,e)},cr.fastIndexOf=function(t,e){for(var i=0,r=t.length;i<r;++i)if(t[i]===e)return i;return-1},cr.arrayFindRemove=function(t,e){var i=cr.fastIndexOf(t,e);-1!==i&&cr.arrayRemove(t,i)},cr.clamp=function(t,e,i){return t<e?e:i<t?i:t},cr.to_radians=function(t){return t/(180/cr.PI)},cr.to_degrees=function(t){return t*(180/cr.PI)},cr.clamp_angle_degrees=function(t){return(t%=360)<0&&(t+=360),t},cr.clamp_angle=function(t){return(t%=2*cr.PI)<0&&(t+=2*cr.PI),t},cr.to_clamped_degrees=function(t){return cr.clamp_angle_degrees(cr.to_degrees(t))},cr.to_clamped_radians=function(t){return cr.clamp_angle(cr.to_radians(t))},cr.angleTo=function(t,e,i,r){var s=i-t,n=r-e;return Math.atan2(n,s)},cr.angleDiff=function(t,e){if(t===e)return 0;var i=Math.sin(t),r=Math.cos(t),s=i*Math.sin(e)+r*Math.cos(e);return 1<=s?0:s<=-1?cr.PI:Math.acos(s)},cr.angleRotate=function(t,e,i){var r=Math.sin(t),s=Math.cos(t),n=Math.sin(e),o=Math.cos(e);return Math.acos(r*n+s*o)>i?0<s*n-r*o?cr.clamp_angle(t+i):cr.clamp_angle(t-i):cr.clamp_angle(e)},cr.angleClockwise=function(t,e){var i=Math.sin(t);return Math.cos(t)*Math.sin(e)-i*Math.cos(e)<=0},cr.rotatePtAround=function(t,e,i,r,s,n){if(0===i)return n?t:e;var o=Math.sin(i),a=Math.cos(i),h=(t-=r)*o;return t=t*a-(e-=s)*o,e=e*a+h,t+=r,e+=s,n?t:e},cr.distanceTo=function(t,e,i,r){var s=i-t,n=r-e;return Math.sqrt(s*s+n*n)},cr.xor=function(t,e){return!t!=!e},cr.lerp=function(t,e,i){return t+(e-t)*i},cr.unlerp=function(t,e,i){return t===e?0:(i-t)/(e-t)},cr.anglelerp=function(t,e,i){var r=cr.angleDiff(t,e);return cr.angleClockwise(e,t)?t+r*i:t-r*i},cr.qarp=function(t,e,i,r){return cr.lerp(cr.lerp(t,e,r),cr.lerp(e,i,r),r)},cr.cubic=function(t,e,i,r,s){return cr.lerp(cr.qarp(t,e,i,s),cr.qarp(e,i,r,s),s)},cr.cosp=function(t,e,i){return(t+e+(t-e)*Math.cos(i*Math.PI))/2},cr.hasAnyOwnProperty=function(t){var e;for(e in t)if(t.hasOwnProperty(e))return!0;return!1},cr.wipe=function(t){var e;for(e in t)t.hasOwnProperty(e)&&delete t[e]};var l=+new Date;cr.performance_now=function(){if(void 0!==window.performance){var t=window.performance;if(void 0!==t.now)return t.now();if(void 0!==t.webkitNow)return t.webkitNow();if(void 0!==t.mozNow)return t.mozNow();if(void 0!==t.msNow)return t.msNow()}return Date.now()-l};"undefined"!=typeof window&&(/chrome/i.test(navigator.userAgent)||/chromium/i.test(navigator.userAgent)||/safari/i.test(navigator.userAgent),/(iphone|ipod|ipad)/i.test(navigator.userAgent));var u="undefined"!=typeof Set&&void 0!==Set.prototype.forEach;function p(){this.s=null,this.items=null,this.item_count=0,u&&(this.s=new Set),this.values_cache=[],this.cache_valid=!0,cr.seal(this)}p.prototype.contains=function(t){return!this.isEmpty()&&(u?this.s.has(t):this.items&&this.items.hasOwnProperty(t))},p.prototype.add=function(t){var e,i;u?this.s.has(t)||(this.s.add(t),this.cache_valid=!1):(e=t.toString(),(i=this.items)?i.hasOwnProperty(e)||(i[e]=t,this.item_count++,this.cache_valid=!1):(this.items={},this.items[e]=t,this.item_count=1,this.cache_valid=!1))},p.prototype.remove=function(t){var e,i;this.isEmpty()||(u?this.s.has(t)&&(this.s.delete(t),this.cache_valid=!1):this.items&&(e=t.toString(),(i=this.items).hasOwnProperty(e)&&(delete i[e],this.item_count--,this.cache_valid=!1)))},p.prototype.clear=function(){this.isEmpty()||(u?this.s.clear():(this.items=null,this.item_count=0),cr.clearArray(this.values_cache),this.cache_valid=!0)},p.prototype.isEmpty=function(){return 0===this.count()},p.prototype.count=function(){return u?this.s.size:this.item_count};var d=null,g=0;function f(t){d[g++]=t}p.prototype.update_cache=function(){if(!this.cache_valid){if(u)cr.clearArray(this.values_cache),d=this.values_cache,g=0,this.s.forEach(f),d=null,g=0;else{var t=this.values_cache;cr.clearArray(t);var e,i=0,r=this.items;if(r)for(e in r)r.hasOwnProperty(e)&&(t[i++]=r[e])}this.cache_valid=!0}},p.prototype.valuesRef=function(){return this.update_cache(),this.values_cache},cr.ObjectSet=p;var y=new cr.ObjectSet;function m(){this.c=0,this.y=0,this.t=0,this.sum=0,cr.seal(this)}function _(t){this.pts_cache=[],this.bboxLeft=0,this.bboxTop=0,this.bboxRight=0,this.bboxBottom=0,this.convexpolys=null,this.set_pts(t),cr.seal(this)}function v(t,e){this.cellwidth=t,this.cellheight=e,this.cells={}}function b(t,e){this.cellwidth=t,this.cellheight=e,this.cells={}}cr.removeArrayDuplicates=function(t){for(var e=0,i=t.length;e<i;++e)y.add(t[e]);cr.shallowAssignArray(t,y.valuesRef()),y.clear()},cr.arrayRemoveAllFromObjectSet=function(t,e){u?cr.arrayRemoveAll_set(t,e.s):cr.arrayRemoveAll_arr(t,e.valuesRef())},cr.arrayRemoveAll_set=function(t,e){for(var i,r=0,s=0,n=t.length;r<n;++r)i=t[r],e.has(i)||(t[s++]=i);cr.truncateArray(t,s)},cr.arrayRemoveAll_arr=function(t,e){for(var i,r=0,s=0,n=t.length;r<n;++r)i=t[r],-1===cr.fastIndexOf(e,i)&&(t[s++]=i);cr.truncateArray(t,s)},m.prototype.add=function(t){this.y=t-this.c,this.t=this.sum+this.y,this.c=this.t-this.sum-this.y,this.sum=this.t},m.prototype.reset=function(){this.c=0,this.y=0,this.t=0,this.sum=0},cr.KahanAdder=m,cr.regexp_escape=function(t){return t.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")},_.prototype.set_pts=function(t){this.pts_array=t,this.pts_count=t.length/2,this.pts_cache.length=t.length,this.cache_width=-1,this.cache_height=-1,this.cache_angle=0},_.prototype.is_empty=function(){return!this.pts_array.length},_.prototype.update_bbox=function(){for(var t,e,i,r=this.pts_cache,s=r[0],n=s,o=r[1],a=o,h=1,c=this.pts_count;h<c;++h)(t=r[i=2*h])<s&&(s=t),n<t&&(n=t),(e=r[1+i])<o&&(o=e),a<e&&(a=e);this.bboxLeft=s,this.bboxRight=n,this.bboxTop=o,this.bboxBottom=a},_.prototype.set_from_rect=function(t,e,i){this.pts_cache.length=8,this.pts_count=4;var r=this.pts_cache;r[0]=t.left-e,r[1]=t.top-i,r[2]=t.right-e,r[3]=t.top-i,r[4]=t.right-e,r[5]=t.bottom-i,r[6]=t.left-e,r[7]=t.bottom-i,this.cache_width=t.right-t.left,this.cache_height=t.bottom-t.top,this.update_bbox()},_.prototype.set_from_quad=function(t,e,i,r,s){this.pts_cache.length=8,this.pts_count=4;var n=this.pts_cache;n[0]=t.tlx-e,n[1]=t.tly-i,n[2]=t.trx-e,n[3]=t.try_-i,n[4]=t.brx-e,n[5]=t.bry-i,n[6]=t.blx-e,n[7]=t.bly-i,this.cache_width=r,this.cache_height=s,this.update_bbox()},_.prototype.set_from_poly=function(t){this.pts_count=t.pts_count,cr.shallowAssignArray(this.pts_cache,t.pts_cache),this.bboxLeft=t.bboxLeft,this.bboxTop,t.bboxTop,this.bboxRight=t.bboxRight,this.bboxBottom=t.bboxBottom},_.prototype.cache_poly=function(t,e,i){if(this.cache_width!==t||this.cache_height!==e||this.cache_angle!==i){var r,s,n,o,a,h;this.cache_width=t,this.cache_height=e,this.cache_angle=i;var c=0,l=1,u=this.pts_array,p=this.pts_cache;for(0!==i&&(c=Math.sin(i),l=Math.cos(i)),r=0,o=this.pts_count;r<o;r++)n=1+(s=2*r),a=u[s]*t,h=u[n]*e,p[s]=a*l-h*c,p[n]=h*l+a*c;this.update_bbox()}},_.prototype.contains_pt=function(t,e){var i=this.pts_cache;if(t===i[0]&&e===i[1])return!0;for(var r,s,n,o,a,h,c=this.pts_count,l=this.bboxLeft-110,u=this.bboxTop-101,p=this.bboxRight+131,d=this.bboxBottom+120,g=0,f=0,y=0;y<c;y++)s=(y+1)%c*2,n=i[r=2*y],o=i[1+r],a=i[s],h=i[1+s],cr.segments_intersect(l,u,t,e,n,o,a,h)&&g++,cr.segments_intersect(p,d,t,e,n,o,a,h)&&f++;return g%2==1||f%2==1},_.prototype.intersects_poly=function(t,e,i){var r,s,n,o,a,h,c,l,u,p,d,g,f,y,m,_,v=t.pts_cache,b=this.pts_cache;if(this.contains_pt(v[0]+e,v[1]+i))return!0;if(t.contains_pt(b[0]-e,b[1]-i))return!0;for(r=0,o=this.pts_count;r<o;r++)for(n=(r+1)%o*2,u=b[s=2*r],p=b[1+s],d=b[n],g=b[1+n],a=0,l=t.pts_count;a<l;a++)if(c=(a+1)%l*2,f=v[h=2*a]+e,y=v[1+h]+i,m=v[c]+e,_=v[1+c]+i,cr.segments_intersect(u,p,d,g,f,y,m,_))return!0;return!1},_.prototype.intersects_segment=function(t,e,i,r,s,n){var o,a,h,c,l,u,p,d,g=this.pts_cache;if(this.contains_pt(i-t,r-e))return!0;for(o=0,a=this.pts_count;o<a;o++)if(c=(o+1)%a*2,l=g[h=2*o]+t,u=g[1+h]+e,p=g[c]+t,d=g[1+c]+e,cr.segments_intersect(i,r,s,n,l,u,p,d))return!0;return!1},_.prototype.mirror=function(t){for(var e,i=0,r=this.pts_count;i<r;++i)e=2*i,this.pts_cache[e]=2*t-this.pts_cache[e]},_.prototype.flip=function(t){for(var e,i=0,r=this.pts_count;i<r;++i)e=2*i+1,this.pts_cache[e]=2*t-this.pts_cache[e]},_.prototype.diag=function(){for(var t,e,i,r=0,s=this.pts_count;r<s;++r)e=1+(t=2*r),i=this.pts_cache[t],this.pts_cache[t]=this.pts_cache[e],this.pts_cache[e]=i},cr.CollisionPoly=_,v.prototype.totalCellCount=0,v.prototype.getCell=function(t,e,i){var r,s=this.cells[t];return s?(r=s[e])||(i?(r=x(this,t,e),this.cells[t][e]=r):null):i?(r=x(this,t,e),this.cells[t]={},this.cells[t][e]=r):null},v.prototype.XToCell=function(t){return cr.floor(t/this.cellwidth)},v.prototype.YToCell=function(t){return cr.floor(t/this.cellheight)},v.prototype.update=function(t,e,i){var r,s,n,o,a,h;if(e)for(r=e.left,s=e.right;r<=s;++r)for(n=e.top,o=e.bottom;n<=o;++n)i&&i.contains_pt(r,n)||(a=this.getCell(r,n,!1))&&(a.remove(t),a.isEmpty()&&(h=a,v.prototype.totalCellCount--,h.objects.clear(),w.length<1e3&&w.push(h),this.cells[r][n]=null));if(i)for(r=i.left,s=i.right;r<=s;++r)for(n=i.top,o=i.bottom;n<=o;++n)e&&e.contains_pt(r,n)||this.getCell(r,n,!0).insert(t)},v.prototype.queryRange=function(t,e){for(var i,r,s=this.XToCell(t.left),n=this.YToCell(t.top),o=this.XToCell(t.right),a=this.YToCell(t.bottom);s<=o;++s)for(i=n;i<=a;++i)(r=this.getCell(s,i,!1))&&r.dump(e)},cr.SparseGrid=v,b.prototype.totalCellCount=0,b.prototype.getCell=function(t,e,i){var r,s=this.cells[t];return s?(r=s[e])||(i?(r=S(this,t,e),this.cells[t][e]=r):null):i?(r=S(this,t,e),this.cells[t]={},this.cells[t][e]=r):null},b.prototype.XToCell=function(t){return cr.floor(t/this.cellwidth)},b.prototype.YToCell=function(t){return cr.floor(t/this.cellheight)},b.prototype.update=function(t,e,i){var r,s,n,o,a,h;if(e)for(r=e.left,s=e.right;r<=s;++r)for(n=e.top,o=e.bottom;n<=o;++n)i&&i.contains_pt(r,n)||(a=this.getCell(r,n,!1))&&(a.remove(t),a.isEmpty()&&(h=a,b.prototype.totalCellCount--,h.reset(),M.length<1e3&&M.push(h),this.cells[r][n]=null));if(i)for(r=i.left,s=i.right;r<=s;++r)for(n=i.top,o=i.bottom;n<=o;++n)e&&e.contains_pt(r,n)||this.getCell(r,n,!0).insert(t)},b.prototype.queryRange=function(t,e,i,r,s){for(var n,o,a=this.XToCell(t),h=this.YToCell(e),c=this.XToCell(i),l=this.YToCell(r);a<=c;++a)for(n=h;n<=l;++n)(o=this.getCell(a,n,!1))&&o.dump(s)},b.prototype.markRangeChanged=function(t){for(var e,i,r=t.left,s=t.top,n=t.right,o=t.bottom;r<=n;++r)for(e=s;e<=o;++e)(i=this.getCell(r,e,!1))&&(i.is_sorted=!1)},cr.RenderGrid=b;var w=[];function x(t,e,i){var r;return v.prototype.totalCellCount++,w.length?((r=w.pop()).grid=t,r.x=e,r.y=i,r):new cr.GridCell(t,e,i)}function T(t,e,i){this.grid=t,this.x=e,this.y=i,this.objects=new cr.ObjectSet}T.prototype.isEmpty=function(){return this.objects.isEmpty()},T.prototype.insert=function(t){this.objects.add(t)},T.prototype.remove=function(t){this.objects.remove(t)},T.prototype.dump=function(t){cr.appendArray(t,this.objects.valuesRef())},cr.GridCell=T;var M=[];function S(t,e,i){var r;return b.prototype.totalCellCount++,M.length?((r=M.pop()).grid=t,r.x=e,r.y=i,r):new cr.RenderCell(t,e,i)}function A(t,e,i){this.grid=t,this.x=e,this.y=i,this.objects=[],this.is_sorted=!0,this.pending_removal=new cr.ObjectSet,this.any_pending_removal=!1}function C(t,e){return t.zindex-e.zindex}A.prototype.isEmpty=function(){return!this.objects.length||!(this.objects.length>this.pending_removal.count())&&(this.flush_pending(),!0)},A.prototype.insert=function(t){if(this.pending_removal.contains(t))return this.pending_removal.remove(t),void(this.pending_removal.isEmpty()&&(this.any_pending_removal=!1));this.objects.length?(this.objects[this.objects.length-1].get_zindex()>t.get_zindex()&&(this.is_sorted=!1),this.objects.push(t)):(this.objects.push(t),this.is_sorted=!0)},A.prototype.remove=function(t){this.pending_removal.add(t),this.any_pending_removal=!0,30<=this.pending_removal.count()&&this.flush_pending()},A.prototype.flush_pending=function(){this.any_pending_removal&&(this.pending_removal.count()!==this.objects.length?(cr.arrayRemoveAllFromObjectSet(this.objects,this.pending_removal),this.pending_removal.clear(),this.any_pending_removal=!1):this.reset())},A.prototype.ensure_sorted=function(){this.is_sorted||(this.objects.sort(C),this.is_sorted=!0)},A.prototype.reset=function(){cr.clearArray(this.objects),this.is_sorted=!0,this.pending_removal.clear(),this.any_pending_removal=!1},A.prototype.dump=function(t){this.flush_pending(),this.ensure_sorted(),this.objects.length&&t.push(this.objects)},cr.RenderCell=A;var L=["lighter","xor","copy","destination-over","source-in","destination-in","source-out","destination-out","source-atop","destination-atop"];cr.effectToCompositeOp=function(t){return t<=0||11<=t?"source-over":L[t-1]},cr.setGLBlend=function(t,e,i){if(i)switch(t.srcBlend=i.ONE,t.destBlend=i.ONE_MINUS_SRC_ALPHA,e){case 1:t.srcBlend=i.ONE,t.destBlend=i.ONE;break;case 2:break;case 3:t.srcBlend=i.ONE,t.destBlend=i.ZERO;break;case 4:t.srcBlend=i.ONE_MINUS_DST_ALPHA,t.destBlend=i.ONE;break;case 5:t.srcBlend=i.DST_ALPHA,t.destBlend=i.ZERO;break;case 6:t.srcBlend=i.ZERO,t.destBlend=i.SRC_ALPHA;break;case 7:t.srcBlend=i.ONE_MINUS_DST_ALPHA,t.destBlend=i.ZERO;break;case 8:t.srcBlend=i.ZERO,t.destBlend=i.ONE_MINUS_SRC_ALPHA;break;case 9:t.srcBlend=i.DST_ALPHA,t.destBlend=i.ONE_MINUS_SRC_ALPHA;break;case 10:t.srcBlend=i.ONE_MINUS_DST_ALPHA,t.destBlend=i.SRC_ALPHA}},cr.round6dp=function(t){return Math.round(1e6*t)/1e6},cr.equals_nocase=function(t,e){return"string"==typeof t&&"string"==typeof e&&(t.length===e.length&&(t===e||t.toLowerCase()===e.toLowerCase()))},cr.cssToCamelCase=function(t){for(var e,i="",r=!1,s=0,n=t.length;s<n;++s)"-"===(e=t.charAt(s))?r=!0:r?(i+=e.toUpperCase(),r=!1):i+=e;return i},cr.isCanvasInputEvent=function(t){var e=t.target;return!e||(e===document||e===window||(!(!document||!document.body||e!==document.body)||!!cr.equals_nocase(e.tagName,"canvas")))}}();var MatrixArray="undefined"!=typeof Float32Array?Float32Array:Array,glMatrixArrayType=MatrixArray,vec3={},mat3={},mat4={},quat4={};vec3.create=function(t){var e=new MatrixArray(3);return t&&(e[0]=t[0],e[1]=t[1],e[2]=t[2]),e},vec3.set=function(t,e){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},vec3.add=function(t,e,i){return i&&t!==i?(i[0]=t[0]+e[0],i[1]=t[1]+e[1],i[2]=t[2]+e[2],i):(t[0]+=e[0],t[1]+=e[1],t[2]+=e[2],t)},vec3.subtract=function(t,e,i){return i&&t!==i?(i[0]=t[0]-e[0],i[1]=t[1]-e[1],i[2]=t[2]-e[2],i):(t[0]-=e[0],t[1]-=e[1],t[2]-=e[2],t)},vec3.negate=function(t,e){return(e=e||t)[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e},vec3.scale=function(t,e,i){return i&&t!==i?(i[0]=t[0]*e,i[1]=t[1]*e,i[2]=t[2]*e,i):(t[0]*=e,t[1]*=e,t[2]*=e,t)},vec3.normalize=function(t,e){e=e||t;var i=t[0],r=t[1],s=t[2],n=Math.sqrt(i*i+r*r+s*s);return n?1===n?(e[0]=i,e[1]=r,e[2]=s):(n=1/n,e[0]=i*n,e[1]=r*n,e[2]=s*n):(e[0]=0,e[1]=0,e[2]=0),e},vec3.cross=function(t,e,i){i=i||t;var r=t[0],s=t[1],t=t[2],n=e[0],o=e[1],e=e[2];return i[0]=s*e-t*o,i[1]=t*n-r*e,i[2]=r*o-s*n,i},vec3.length=function(t){var e=t[0],i=t[1],t=t[2];return Math.sqrt(e*e+i*i+t*t)},vec3.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]},vec3.direction=function(t,e,i){i=i||t;var r=t[0]-e[0],s=t[1]-e[1],t=t[2]-e[2];return(e=Math.sqrt(r*r+s*s+t*t))?(e=1/e,i[0]=r*e,i[1]=s*e,i[2]=t*e):(i[0]=0,i[1]=0,i[2]=0),i},vec3.lerp=function(t,e,i,r){return(r=r||t)[0]=t[0]+i*(e[0]-t[0]),r[1]=t[1]+i*(e[1]-t[1]),r[2]=t[2]+i*(e[2]-t[2]),r},vec3.str=function(t){return"["+t[0]+", "+t[1]+", "+t[2]+"]"},mat3.create=function(t){var e=new MatrixArray(9);return t&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8]),e},mat3.set=function(t,e){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},mat3.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},mat3.transpose=function(t,e){if(e&&t!==e)return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],e;var i=t[1],r=t[2],s=t[5];return t[1]=t[3],t[2]=t[6],t[3]=i,t[5]=t[7],t[6]=r,t[7]=s,t},mat3.toMat4=function(t,e){return(e=e||mat4.create())[15]=1,e[14]=0,e[13]=0,e[12]=0,e[11]=0,e[10]=t[8],e[9]=t[7],e[8]=t[6],e[7]=0,e[6]=t[5],e[5]=t[4],e[4]=t[3],e[3]=0,e[2]=t[2],e[1]=t[1],e[0]=t[0],e},mat3.str=function(t){return"["+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+"]"},mat4.create=function(t){var e=new MatrixArray(16);return t&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e},mat4.set=function(t,e){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},mat4.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},mat4.transpose=function(t,e){if(e&&t!==e)return e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15],e;var i=t[1],r=t[2],s=t[3],n=t[6],o=t[7],a=t[11];return t[1]=t[4],t[2]=t[8],t[3]=t[12],t[4]=i,t[6]=t[9],t[7]=t[13],t[8]=r,t[9]=n,t[11]=t[14],t[12]=s,t[13]=o,t[14]=a,t},mat4.determinant=function(t){var e=t[0],i=t[1],r=t[2],s=t[3],n=t[4],o=t[5],a=t[6],h=t[7],c=t[8],l=t[9],u=t[10],p=t[11],d=t[12],g=t[13],f=t[14];return d*l*a*s-c*g*a*s-d*o*u*s+n*g*u*s+c*o*f*s-n*l*f*s-d*l*r*h+c*g*r*h+d*i*u*h-e*g*u*h-c*i*f*h+e*l*f*h+d*o*r*p-n*g*r*p-d*i*a*p+e*g*a*p+n*i*f*p-e*o*f*p-c*o*r*(t=t[15])+n*l*r*t+c*i*a*t-e*l*a*t-n*i*u*t+e*o*u*t},mat4.inverse=function(t,e){e=e||t;var i=t[0],r=t[1],s=t[2],n=t[3],o=t[4],a=t[5],h=t[6],c=t[7],l=t[8],u=t[9],p=t[10],d=t[11],g=t[12],f=t[13],y=t[14],m=t[15],_=i*a-r*o,v=i*h-s*o,b=i*c-n*o,w=r*h-s*a,x=r*c-n*a,T=s*c-n*h,M=l*f-u*g,S=l*y-p*g,A=l*m-d*g,C=u*y-p*f,L=u*m-d*f,E=p*m-d*y,O=1/(_*E-v*L+b*C+w*A-x*S+T*M);return e[0]=(a*E-h*L+c*C)*O,e[1]=(-r*E+s*L-n*C)*O,e[2]=(f*T-y*x+m*w)*O,e[3]=(-u*T+p*x-d*w)*O,e[4]=(-o*E+h*A-c*S)*O,e[5]=(i*E-s*A+n*S)*O,e[6]=(-g*T+y*b-m*v)*O,e[7]=(l*T-p*b+d*v)*O,e[8]=(o*L-a*A+c*M)*O,e[9]=(-i*L+r*A-n*M)*O,e[10]=(g*x-f*b+m*_)*O,e[11]=(-l*x+u*b-d*_)*O,e[12]=(-o*C+a*S-h*M)*O,e[13]=(i*C-r*S+s*M)*O,e[14]=(-g*w+f*v-y*_)*O,e[15]=(l*w-u*v+p*_)*O,e},mat4.toRotationMat=function(t,e){return(e=e||mat4.create())[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},mat4.toMat3=function(t,e){return(e=e||mat3.create())[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e},mat4.toInverseMat3=function(t,e){var i=t[0],r=t[1],s=t[2],n=t[4],o=t[5],a=t[6],h=t[8],c=t[9],l=t[10],u=l*o-a*c,p=-l*n+a*h,d=c*n-o*h,g=i*u+r*p+s*d;return g?(g=1/g,(e=e||mat3.create())[0]=u*g,e[1]=(-l*r+s*c)*g,e[2]=(a*r-s*o)*g,e[3]=p*g,e[4]=(l*i-s*h)*g,e[5]=(-a*i+s*n)*g,e[6]=d*g,e[7]=(-c*i+r*h)*g,e[8]=(o*i-r*n)*g,e):null},mat4.multiply=function(t,e,i){i=i||t;var r=t[0],s=t[1],n=t[2],o=t[3],a=t[4],h=t[5],c=t[6],l=t[7],u=t[8],p=t[9],d=t[10],g=t[11],f=t[12],y=t[13],m=t[14],t=t[15],_=e[0],v=e[1],b=e[2],w=e[3],x=e[4],T=e[5],M=e[6],S=e[7],A=e[8],C=e[9],L=e[10],E=e[11],O=e[12],I=e[13],N=e[14],e=e[15];return i[0]=_*r+v*a+b*u+w*f,i[1]=_*s+v*h+b*p+w*y,i[2]=_*n+v*c+b*d+w*m,i[3]=_*o+v*l+b*g+w*t,i[4]=x*r+T*a+M*u+S*f,i[5]=x*s+T*h+M*p+S*y,i[6]=x*n+T*c+M*d+S*m,i[7]=x*o+T*l+M*g+S*t,i[8]=A*r+C*a+L*u+E*f,i[9]=A*s+C*h+L*p+E*y,i[10]=A*n+C*c+L*d+E*m,i[11]=A*o+C*l+L*g+E*t,i[12]=O*r+I*a+N*u+e*f,i[13]=O*s+I*h+N*p+e*y,i[14]=O*n+I*c+N*d+e*m,i[15]=O*o+I*l+N*g+e*t,i},mat4.multiplyVec3=function(t,e,i){i=i||e;var r=e[0],s=e[1],e=e[2];return i[0]=t[0]*r+t[4]*s+t[8]*e+t[12],i[1]=t[1]*r+t[5]*s+t[9]*e+t[13],i[2]=t[2]*r+t[6]*s+t[10]*e+t[14],i},mat4.multiplyVec4=function(t,e,i){i=i||e;var r=e[0],s=e[1],n=e[2],e=e[3];return i[0]=t[0]*r+t[4]*s+t[8]*n+t[12]*e,i[1]=t[1]*r+t[5]*s+t[9]*n+t[13]*e,i[2]=t[2]*r+t[6]*s+t[10]*n+t[14]*e,i[3]=t[3]*r+t[7]*s+t[11]*n+t[15]*e,i},mat4.translate=function(t,e,i){var r,s,n,o,a,h,c,l,u,p,d,g,f=e[0],y=e[1],e=e[2];return i&&t!==i?(r=t[0],s=t[1],n=t[2],o=t[3],a=t[4],h=t[5],c=t[6],l=t[7],u=t[8],p=t[9],d=t[10],g=t[11],i[0]=r,i[1]=s,i[2]=n,i[3]=o,i[4]=a,i[5]=h,i[6]=c,i[7]=l,i[8]=u,i[9]=p,i[10]=d,i[11]=g,i[12]=r*f+a*y+u*e+t[12],i[13]=s*f+h*y+p*e+t[13],i[14]=n*f+c*y+d*e+t[14],i[15]=o*f+l*y+g*e+t[15],i):(t[12]=t[0]*f+t[4]*y+t[8]*e+t[12],t[13]=t[1]*f+t[5]*y+t[9]*e+t[13],t[14]=t[2]*f+t[6]*y+t[10]*e+t[14],t[15]=t[3]*f+t[7]*y+t[11]*e+t[15],t)},mat4.scale=function(t,e,i){var r=e[0],s=e[1],e=e[2];return i&&t!==i?(i[0]=t[0]*r,i[1]=t[1]*r,i[2]=t[2]*r,i[3]=t[3]*r,i[4]=t[4]*s,i[5]=t[5]*s,i[6]=t[6]*s,i[7]=t[7]*s,i[8]=t[8]*e,i[9]=t[9]*e,i[10]=t[10]*e,i[11]=t[11]*e,i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15],i):(t[0]*=r,t[1]*=r,t[2]*=r,t[3]*=r,t[4]*=s,t[5]*=s,t[6]*=s,t[7]*=s,t[8]*=e,t[9]*=e,t[10]*=e,t[11]*=e,t)},mat4.rotate=function(t,e,i,r){var s,n,o,a,h,c,l,u,p,d,g,f,y,m,_,v,b,w,x,T,M=i[0],S=i[1],i=i[2],A=Math.sqrt(M*M+S*S+i*i);return A?(1!==A&&(M*=A=1/A,S*=A,i*=A),s=Math.sin(e),o=1-(n=Math.cos(e)),e=t[0],A=t[1],a=t[2],h=t[3],c=t[4],l=t[5],u=t[6],p=t[7],d=t[8],g=t[9],f=t[10],y=t[11],m=M*M*o+n,_=S*M*o+i*s,v=i*M*o-S*s,b=M*S*o-i*s,w=S*S*o+n,x=i*S*o+M*s,T=M*i*o+S*s,M=S*i*o-M*s,S=i*i*o+n,r?t!==r&&(r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15]):r=t,r[0]=e*m+c*_+d*v,r[1]=A*m+l*_+g*v,r[2]=a*m+u*_+f*v,r[3]=h*m+p*_+y*v,r[4]=e*b+c*w+d*x,r[5]=A*b+l*w+g*x,r[6]=a*b+u*w+f*x,r[7]=h*b+p*w+y*x,r[8]=e*T+c*M+d*S,r[9]=A*T+l*M+g*S,r[10]=a*T+u*M+f*S,r[11]=h*T+p*M+y*S,r):null},mat4.rotateX=function(t,e,i){var r=Math.sin(e),e=Math.cos(e),s=t[4],n=t[5],o=t[6],a=t[7],h=t[8],c=t[9],l=t[10],u=t[11];return i?t!==i&&(i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]):i=t,i[4]=s*e+h*r,i[5]=n*e+c*r,i[6]=o*e+l*r,i[7]=a*e+u*r,i[8]=s*-r+h*e,i[9]=n*-r+c*e,i[10]=o*-r+l*e,i[11]=a*-r+u*e,i},mat4.rotateY=function(t,e,i){var r=Math.sin(e),e=Math.cos(e),s=t[0],n=t[1],o=t[2],a=t[3],h=t[8],c=t[9],l=t[10],u=t[11];return i?t!==i&&(i[4]=t[4],i[5]=t[5],i[6]=t[6],i[7]=t[7],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]):i=t,i[0]=s*e+h*-r,i[1]=n*e+c*-r,i[2]=o*e+l*-r,i[3]=a*e+u*-r,i[8]=s*r+h*e,i[9]=n*r+c*e,i[10]=o*r+l*e,i[11]=a*r+u*e,i},mat4.rotateZ=function(t,e,i){var r=Math.sin(e),e=Math.cos(e),s=t[0],n=t[1],o=t[2],a=t[3],h=t[4],c=t[5],l=t[6],u=t[7];return i?t!==i&&(i[8]=t[8],i[9]=t[9],i[10]=t[10],i[11]=t[11],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]):i=t,i[0]=s*e+h*r,i[1]=n*e+c*r,i[2]=o*e+l*r,i[3]=a*e+u*r,i[4]=s*-r+h*e,i[5]=n*-r+c*e,i[6]=o*-r+l*e,i[7]=a*-r+u*e,i},mat4.frustum=function(t,e,i,r,s,n,o){var a=e-t,h=r-i,c=n-s;return(o=o||mat4.create())[0]=2*s/a,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=2*s/h,o[6]=0,o[7]=0,o[8]=(e+t)/a,o[9]=(r+i)/h,o[10]=-(n+s)/c,o[11]=-1,o[12]=0,o[13]=0,o[14]=-n*s*2/c,o[15]=0,o},mat4.perspective=function(t,e,i,r,s){return e*=t=i*Math.tan(t*Math.PI/360),mat4.frustum(-e,e,-t,t,i,r,s)},mat4.ortho=function(t,e,i,r,s,n,o){var a=e-t,h=r-i,c=n-s;return(o=o||mat4.create())[0]=2/a,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=2/h,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=-2/c,o[11]=0,o[12]=-(t+e)/a,o[13]=-(r+i)/h,o[14]=-(n+s)/c,o[15]=1,o},mat4.lookAt=function(t,e,i,r){r=r||mat4.create();var s,n,o,a,h,c=t[0],l=t[1],t=t[2],u=i[0],p=i[1],d=i[2];return i=e[1],o=e[2],c===e[0]&&l===i&&t===o?mat4.identity(r):(i=c-e[0],o=l-e[1],a=t-e[2],e=p*(a*=h=1/Math.sqrt(i*i+o*o+a*a))-d*(o*=h),d=d*(i*=h)-u*a,u=u*o-p*i,(h=Math.sqrt(e*e+d*d+u*u))?(e*=h=1/h,d*=h,u*=h):u=d=e=0,p=o*u-a*d,s=a*e-i*u,n=i*d-o*e,(h=Math.sqrt(p*p+s*s+n*n))?(p*=h=1/h,s*=h,n*=h):n=s=p=0,r[0]=e,r[1]=p,r[2]=i,r[3]=0,r[4]=d,r[5]=s,r[6]=o,r[7]=0,r[8]=u,r[9]=n,r[10]=a,r[11]=0,r[12]=-(e*c+d*l+u*t),r[13]=-(p*c+s*l+n*t),r[14]=-(i*c+o*l+a*t),r[15]=1,r)},mat4.fromRotationTranslation=function(t,e,i){i=i||mat4.create();var r=t[0],s=t[1],n=t[2],o=t[3],a=r+r,h=s+s,c=n+n,t=r*a,l=r*h;r*=c;var u=s*h;return s*=c,n*=c,a*=o,h*=o,o*=c,i[0]=1-(u+n),i[1]=l+o,i[2]=r-h,i[3]=0,i[4]=l-o,i[5]=1-(t+n),i[6]=s+a,i[7]=0,i[8]=r+h,i[9]=s-a,i[10]=1-(t+u),i[11]=0,i[12]=e[0],i[13]=e[1],i[14]=e[2],i[15]=1,i},mat4.str=function(t){return"["+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+"]"},quat4.create=function(t){var e=new MatrixArray(4);return t&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3]),e},quat4.set=function(t,e){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},quat4.calculateW=function(t,e){var i=t[0],r=t[1],s=t[2];return e&&t!==e?(e[0]=i,e[1]=r,e[2]=s,e[3]=-Math.sqrt(Math.abs(1-i*i-r*r-s*s)),e):(t[3]=-Math.sqrt(Math.abs(1-i*i-r*r-s*s)),t)},quat4.inverse=function(t,e){return e&&t!==e?(e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e):(t[0]*=-1,t[1]*=-1,t[2]*=-1,t)},quat4.length=function(t){var e=t[0],i=t[1],r=t[2],t=t[3];return Math.sqrt(e*e+i*i+r*r+t*t)},quat4.normalize=function(t,e){e=e||t;var i=t[0],r=t[1],s=t[2],n=t[3],o=Math.sqrt(i*i+r*r+s*s+n*n);return 0===o?(e[0]=0,e[1]=0,e[2]=0,e[3]=0):(o=1/o,e[0]=i*o,e[1]=r*o,e[2]=s*o,e[3]=n*o),e},quat4.multiply=function(t,e,i){i=i||t;var r=t[0],s=t[1],n=t[2],t=t[3],o=e[0],a=e[1],h=e[2],e=e[3];return i[0]=r*e+t*o+s*h-n*a,i[1]=s*e+t*a+n*o-r*h,i[2]=n*e+t*h+r*a-s*o,i[3]=t*e-r*o-s*a-n*h,i},quat4.multiplyVec3=function(t,e,i){i=i||e;var r=e[0],s=e[1],n=e[2],e=t[0],o=t[1],a=t[2],h=(t=t[3])*r+o*n-a*s,c=t*s+a*r-e*n,l=t*n+e*s-o*r,r=-e*r-o*s-a*n;return i[0]=h*t+r*-e+c*-a-l*-o,i[1]=c*t+r*-o+l*-e-h*-a,i[2]=l*t+r*-a+h*-o-c*-e,i},quat4.toMat3=function(t,e){e=e||mat3.create();var i=t[0],r=t[1],s=t[2],n=t[3],o=i+i,a=r+r,h=s+s,c=i*o,l=i*a;i*=h;var u=r*a;return r*=h,s*=h,o*=n,a*=n,n*=h,e[0]=1-(u+s),e[1]=l+n,e[2]=i-a,e[3]=l-n,e[4]=1-(c+s),e[5]=r+o,e[6]=i+a,e[7]=r-o,e[8]=1-(c+u),e},quat4.toMat4=function(t,e){e=e||mat4.create();var i=t[0],r=t[1],s=t[2],n=t[3],o=i+i,a=r+r,h=s+s,c=i*o,l=i*a;i*=h;var u=r*a;return r*=h,s*=h,o*=n,a*=n,n*=h,e[0]=1-(u+s),e[1]=l+n,e[2]=i-a,e[3]=0,e[4]=l-n,e[5]=1-(c+s),e[6]=r+o,e[7]=0,e[8]=i+a,e[9]=r-o,e[10]=1-(c+u),e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},quat4.slerp=function(t,e,i,r){r=r||t;var s,n,o=t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3];return 1<=Math.abs(o)?(r!==t&&(r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3]),r):(s=Math.acos(o),n=Math.sqrt(1-o*o),Math.abs(n)<.001?(r[0]=.5*t[0]+.5*e[0],r[1]=.5*t[1]+.5*e[1],r[2]=.5*t[2]+.5*e[2],r[3]=.5*t[3]+.5*e[3]):(o=Math.sin((1-i)*s)/n,i=Math.sin(i*s)/n,r[0]=t[0]*o+e[0]*i,r[1]=t[1]*o+e[1]*i,r[2]=t[2]*o+e[2]*i,r[3]=t[3]*o+e[3]*i),r)},quat4.str=function(t){return"["+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+"]"},function(){var i=mat4.create();function t(t,e,i){this.isIE=/msie/i.test(navigator.userAgent)||/trident/i.test(navigator.userAgent),this.width=0,this.height=0,this.enableFrontToBack=!!i,this.isEarlyZPass=!1,this.isBatchInEarlyZPass=!1,this.currentZ=0,this.zNear=1,this.zFar=1e3,this.zIncrement=(this.zFar-this.zNear)/32768,this.zA=this.zFar/(this.zFar-this.zNear),this.zB=this.zFar*this.zNear/(this.zNear-this.zFar),this.kzA=65536*this.zA,this.kzB=65536*this.zB,this.cam=vec3.create([0,0,100]),this.look=vec3.create([0,0,0]),this.up=vec3.create([0,1,0]),this.worldScale=vec3.create([1,1,1]),this.enable_mipmaps=!0,this.matP=mat4.create(),this.matMV=mat4.create(),this.lastMV=mat4.create(),this.currentMV=mat4.create(),this.gl=t,this.version=0===this.gl.getParameter(this.gl.VERSION).indexOf("WebGL 2")?2:1,this.timerExt=null,this.isTiming=!1,2===this.version?this.timerExt=this.gl.getExtension("EXT_disjoint_timer_query_webgl2")||this.gl.getExtension("EXT_disjoint_timer_query"):this.timerExt=this.gl.getExtension("EXT_disjoint_timer_query"),this.frameNumber=0,this.timerResults=[],this.initState()}function u(t,e,i){this.gl=t,this.shaderProgram=e,this.name=i,this.locAPos=t.getAttribLocation(e,"aPos"),this.locATex=t.getAttribLocation(e,"aTex"),this.locMatP=t.getUniformLocation(e,"matP"),this.locMatMV=t.getUniformLocation(e,"matMV"),this.locOpacity=t.getUniformLocation(e,"opacity"),this.locColorFill=t.getUniformLocation(e,"colorFill"),this.locSamplerFront=t.getUniformLocation(e,"samplerFront"),this.locSamplerBack=t.getUniformLocation(e,"samplerBack"),this.locSrcStart=t.getUniformLocation(e,"srcStart"),this.locSrcEnd=t.getUniformLocation(e,"srcEnd"),this.locSrcOriginStart=t.getUniformLocation(e,"srcOriginStart"),this.locSrcOriginEnd=t.getUniformLocation(e,"srcOriginEnd"),this.locLayoutStart=t.getUniformLocation(e,"layoutStart"),this.locLayoutEnd=t.getUniformLocation(e,"layoutEnd"),this.locDestStart=t.getUniformLocation(e,"destStart"),this.locDestEnd=t.getUniformLocation(e,"destEnd"),this.locSeconds=t.getUniformLocation(e,"seconds"),this.locPixelSize=t.getUniformLocation(e,"pixelSize"),this.locLayerScale=t.getUniformLocation(e,"layerScale"),this.locLayerAngle=t.getUniformLocation(e,"layerAngle"),this.hasAnyOptionalUniforms=!!(this.locPixelSize||this.locSeconds||this.locSamplerBack||this.locSrcStart||this.locSrcEnd||this.locSrcOriginStart||this.locSrcOriginEnd||this.locLayoutStart||this.locLayoutEnd||this.locDestStart||this.locDestEnd||this.locLayerScale||this.locLayerAngle),this.lpPixelWidth=-999,this.lpPixelHeight=-999,this.lpOpacity=1,this.lpSrcStartX=0,this.lpSrcStartY=0,this.lpSrcEndX=0,this.lpSrcEndY=0,this.lpSrcOriginStartX=0,this.lpSrcOriginStartY=0,this.lpSrcOriginEndX=0,this.lpSrcOriginEndY=0,this.lpLayoutStartX=0,this.lpLayoutStartY=0,this.lpLayoutEndX=0,this.lpLayoutEndY=0,this.lpDestStartX=0,this.lpDestStartY=0,this.lpDestEndX=1,this.lpDestEndY=1,this.lpLayerScale=1,this.lpLayerAngle=0,this.lpSeconds=0,this.lastCustomParams=[],this.lpMatMV=mat4.create(),this.locOpacity&&t.uniform1f(this.locOpacity,1),this.locColorFill&&t.uniform4f(this.locColorFill,1,1,1,1),this.locSamplerFront&&t.uniform1i(this.locSamplerFront,0),this.locSamplerBack&&t.uniform1i(this.locSamplerBack,1),this.locSrcStart&&t.uniform2f(this.locSrcStart,0,0),this.locSrcEnd&&t.uniform2f(this.locSrcEnd,1,1),this.locSrcOriginStart&&t.uniform2f(this.locSrcOriginStart,0,0),this.locSrcOriginEnd&&t.uniform2f(this.locSrcOriginEnd,0,0),this.locLayoutStart&&t.uniform2f(this.locLayoutStart,0,0),this.locLayoutEnd&&t.uniform2f(this.locLayoutEnd,0,0),this.locDestStart&&t.uniform2f(this.locDestStart,0,0),this.locDestEnd&&t.uniform2f(this.locDestEnd,1,1),this.locLayerScale&&t.uniform1f(this.locLayerScale,1),this.locLayerAngle&&t.uniform1f(this.locLayerAngle,0),this.locSeconds&&t.uniform1f(this.locSeconds,0),this.hasCurrentMatMV=!1}function e(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]}function r(t,e){this.type=t,this.glwrap=e,this.gl=e.gl,this.opacityParam=0,this.startIndex=0,this.indexCount=0,this.texParam=null,this.mat4param=null,this.layoutRect=quat4.create(),this.srcOriginRect=quat4.create(),this.shaderParams=[],cr.seal(this)}t.prototype.initState=function(){var t=this.gl;for(this.lastOpacity=1,this.lastTexture0=null,this.lastTexture1=null,this.currentOpacity=1,t.clearColor(0,0,0,0),t.clear(t.COLOR_BUFFER_BIT),t.enable(t.BLEND),t.blendFunc(t.ONE,t.ONE_MINUS_SRC_ALPHA),t.disable(t.CULL_FACE),t.disable(t.STENCIL_TEST),t.disable(t.DITHER),this.enableFrontToBack?(t.enable(t.DEPTH_TEST),t.depthFunc(t.LEQUAL)):t.disable(t.DEPTH_TEST),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),this.lastSrcBlend=t.ONE,this.lastDestBlend=t.ONE_MINUS_SRC_ALPHA,this.vertexData=new Float32Array(8e3*(this.enableFrontToBack?3:2)),this.texcoordData=new Float32Array(16e3),this.pointData=new Float32Array(32e3),this.pointBuffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.pointBuffer),t.bufferData(t.ARRAY_BUFFER,this.pointData.byteLength,t.DYNAMIC_DRAW),this.vertexBuffers=new Array(4),this.texcoordBuffers=new Array(4),s=0;s<4;s++)this.vertexBuffers[s]=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffers[s]),t.bufferData(t.ARRAY_BUFFER,this.vertexData.byteLength,t.DYNAMIC_DRAW),this.texcoordBuffers[s]=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.texcoordBuffers[s]),t.bufferData(t.ARRAY_BUFFER,this.texcoordData.byteLength,t.DYNAMIC_DRAW);this.curBuffer=0,this.indexBuffer=t.createBuffer(),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer);for(var e,i,r=new Uint16Array(12e3),s=0,n=0;s<12e3;)r[s++]=n,r[s++]=n+1,r[s++]=n+2,r[s++]=n,r[s++]=n+2,r[s++]=n+3,n+=4;t.bufferData(t.ELEMENT_ARRAY_BUFFER,r,t.STATIC_DRAW),this.vertexPtr=0,this.texPtr=0,this.pointPtr=0,this.shaderPrograms=[],e=["varying mediump vec2 vTex;","uniform lowp float opacity;","uniform lowp sampler2D samplerFront;","void main(void) {","\tgl_FragColor = texture2D(samplerFront, vTex);","\tgl_FragColor *= opacity;","}"].join("\n"),i=this.enableFrontToBack?["attribute highp vec3 aPos;","attribute mediump vec2 aTex;","varying mediump vec2 vTex;","uniform highp mat4 matP;","uniform highp mat4 matMV;","void main(void) {","\tgl_Position = matP * matMV * vec4(aPos.x, aPos.y, aPos.z, 1.0);","\tvTex = aTex;","}"].join("\n"):["attribute highp vec2 aPos;","attribute mediump vec2 aTex;","varying mediump vec2 vTex;","uniform highp mat4 matP;","uniform highp mat4 matMV;","void main(void) {","\tgl_Position = matP * matMV * vec4(aPos.x, aPos.y, 0.0, 1.0);","\tvTex = aTex;","}"].join("\n");var o=this.createShaderProgram({src:e},i,"<default>");this.shaderPrograms.push(o),e=["uniform mediump sampler2D samplerFront;","varying lowp float opacity;","void main(void) {","\tgl_FragColor = texture2D(samplerFront, gl_PointCoord);","\tgl_FragColor *= opacity;","}"].join("\n");var a=["attribute vec4 aPos;","varying float opacity;","uniform mat4 matP;","uniform mat4 matMV;","void main(void) {","\tgl_Position = matP * matMV * vec4(aPos.x, aPos.y, 0.0, 1.0);","\tgl_PointSize = aPos.z;","\topacity = aPos.w;","}"].join("\n");o=this.createShaderProgram({src:e},a,"<point>"),this.shaderPrograms.push(o),e=["varying mediump vec2 vTex;","uniform lowp sampler2D samplerFront;","void main(void) {","\tif (texture2D(samplerFront, vTex).a < 1.0)","\t\tdiscard;","}"].join("\n");o=this.createShaderProgram({src:e},i,"<earlyz>");this.shaderPrograms.push(o),e=["uniform lowp vec4 colorFill;","void main(void) {","\tgl_FragColor = colorFill;","}"].join("\n");o=this.createShaderProgram({src:e},i,"<fill>");for(var h in this.shaderPrograms.push(o),cr.shaders)cr.shaders.hasOwnProperty(h)&&this.shaderPrograms.push(this.createShaderProgram(cr.shaders[h],i,h));t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,null),this.batch=[],this.batchPtr=0,this.hasQuadBatchTop=!1,this.hasPointBatchTop=!1,this.lastProgram=-1,this.currentProgram=-1,this.currentShader=null,this.fbo=t.createFramebuffer(),this.renderToTex=null,this.depthBuffer=null,this.attachedDepthBuffer=!1,this.enableFrontToBack&&(this.depthBuffer=t.createRenderbuffer()),this.tmpVec3=vec3.create([0,0,0]);var c=t.getParameter(t.ALIASED_POINT_SIZE_RANGE);this.minPointSize=c[0],this.maxPointSize=c[1],2048<this.maxPointSize&&(this.maxPointSize=2048),this.switchProgram(0),cr.seal(this)},u.prototype.updateMatMV=function(t){e(this.lpMatMV,t)||(mat4.set(t,this.lpMatMV),this.gl.uniformMatrix4fv(this.locMatMV,!1,t))},t.prototype.createShaderProgram=function(t,e,i){var r=this.gl,s=r.createShader(r.FRAGMENT_SHADER);if(r.shaderSource(s,t.src),r.compileShader(s),!r.getShaderParameter(s,r.COMPILE_STATUS)){var n=r.getShaderInfoLog(s);throw r.deleteShader(s),new Error("error compiling fragment shader: "+n)}var o=r.createShader(r.VERTEX_SHADER);if(r.shaderSource(o,e),r.compileShader(o),!r.getShaderParameter(o,r.COMPILE_STATUS)){n=r.getShaderInfoLog(o);throw r.deleteShader(s),r.deleteShader(o),new Error("error compiling vertex shader: "+n)}var a=r.createProgram();if(r.attachShader(a,s),r.attachShader(a,o),r.linkProgram(a),!r.getProgramParameter(a,r.LINK_STATUS)){n=r.getProgramInfoLog(a);throw r.deleteShader(s),r.deleteShader(o),r.deleteProgram(a),new Error("error linking shader program: "+n)}r.useProgram(a),r.deleteShader(s),r.deleteShader(o);var h,c,l=new u(r,a,i);for(l.extendBoxHorizontal=t.extendBoxHorizontal||0,l.extendBoxVertical=t.extendBoxVertical||0,l.crossSampling=!!t.crossSampling,l.preservesOpaqueness=!!t.preservesOpaqueness,l.animated=!!t.animated,l.parameters=t.parameters||[],h=0,c=l.parameters.length;h<c;h++)l.parameters[h][1]=r.getUniformLocation(a,l.parameters[h][0]),l.lastCustomParams.push(0);return cr.seal(l),l},t.prototype.getShaderIndex=function(t){for(var e=0,i=this.shaderPrograms.length;e<i;e++)if(this.shaderPrograms[e].name===t)return e;return-1},t.prototype.project=function(t,e,i){var r=this.matMV,s=this.matP,n=[0,0,0,0,0,0,0,0];n[0]=r[0]*t+r[4]*e+r[12],n[1]=r[1]*t+r[5]*e+r[13],n[2]=r[2]*t+r[6]*e+r[14],n[3]=r[3]*t+r[7]*e+r[15],n[4]=s[0]*n[0]+s[4]*n[1]+s[8]*n[2]+s[12]*n[3],n[5]=s[1]*n[0]+s[5]*n[1]+s[9]*n[2]+s[13]*n[3],n[6]=s[2]*n[0]+s[6]*n[1]+s[10]*n[2]+s[14]*n[3],n[7]=-n[2],0!==n[7]&&(n[7]=1/n[7],n[4]*=n[7],n[5]*=n[7],n[6]*=n[7],i[0]=(.5*n[4]+.5)*this.width,i[1]=(.5*n[5]+.5)*this.height)},t.prototype.setSize=function(t,e,i){if(this.width!==t||this.height!==e||i){this.endBatch();var r,s,n,o,a,h=this.gl;for(this.width=t,this.height=e,h.viewport(0,0,t,e),mat4.lookAt(this.cam,this.look,this.up,this.matMV),this.enableFrontToBack?(mat4.ortho(-t/2,t/2,e/2,-e/2,this.zNear,this.zFar,this.matP),this.worldScale[0]=1,this.worldScale[1]=1):(mat4.perspective(45,t/e,this.zNear,this.zFar,this.matP),r=[0,0],s=[0,0],this.project(0,0,r),this.project(1,1,s),this.worldScale[0]=1/(s[0]-r[0]),this.worldScale[1]=-1/(s[1]-r[1])),n=0,o=this.shaderPrograms.length;n<o;n++)(a=this.shaderPrograms[n]).hasCurrentMatMV=!1,a.locMatP&&(h.useProgram(a.shaderProgram),h.uniformMatrix4fv(a.locMatP,!1,this.matP));h.useProgram(this.shaderPrograms[this.lastProgram].shaderProgram),h.bindTexture(h.TEXTURE_2D,null),h.activeTexture(h.TEXTURE1),h.bindTexture(h.TEXTURE_2D,null),h.activeTexture(h.TEXTURE0),this.lastTexture0=null,this.lastTexture1=null,this.depthBuffer&&(h.bindFramebuffer(h.FRAMEBUFFER,this.fbo),h.bindRenderbuffer(h.RENDERBUFFER,this.depthBuffer),h.renderbufferStorage(h.RENDERBUFFER,h.DEPTH_COMPONENT16,this.width,this.height),this.attachedDepthBuffer||(h.framebufferRenderbuffer(h.FRAMEBUFFER,h.DEPTH_ATTACHMENT,h.RENDERBUFFER,this.depthBuffer),this.attachedDepthBuffer=!0),h.bindRenderbuffer(h.RENDERBUFFER,null),h.bindFramebuffer(h.FRAMEBUFFER,null),this.renderToTex=null)}},t.prototype.resetModelView=function(){mat4.lookAt(this.cam,this.look,this.up,this.matMV),mat4.scale(this.matMV,this.worldScale)},t.prototype.translate=function(t,e){0===t&&0===e||(this.tmpVec3[0]=t,this.tmpVec3[1]=e,this.tmpVec3[2]=0,mat4.translate(this.matMV,this.tmpVec3))},t.prototype.scale=function(t,e){1===t&&1===e||(this.tmpVec3[0]=t,this.tmpVec3[1]=e,this.tmpVec3[2]=1,mat4.scale(this.matMV,this.tmpVec3))},t.prototype.rotateZ=function(t){0!==t&&mat4.rotateZ(this.matMV,t)},t.prototype.updateModelView=function(){var t;e(this.lastMV,this.matMV)||((t=this.pushBatch()).type=5,t.mat4param?mat4.set(this.matMV,t.mat4param):t.mat4param=mat4.create(this.matMV),mat4.set(this.matMV,this.lastMV),this.hasQuadBatchTop=!1,this.hasPointBatchTop=!1)},t.prototype.setEarlyZIndex=function(t){this.enableFrontToBack&&(32760<t&&(t=32760),this.currentZ=this.cam[2]-this.zNear-t*this.zIncrement)},r.prototype.doSetEarlyZPass=function(){var t=this.gl,e=this.glwrap;0!==this.startIndex?(t.depthMask(!0),t.colorMask(!1,!1,!1,!1),t.disable(t.BLEND),t.bindFramebuffer(t.FRAMEBUFFER,e.fbo),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,null,0),t.clear(t.DEPTH_BUFFER_BIT),t.bindFramebuffer(t.FRAMEBUFFER,null),e.isBatchInEarlyZPass=!0):(t.depthMask(!1),t.colorMask(!0,!0,!0,!0),t.enable(t.BLEND),e.isBatchInEarlyZPass=!1)},r.prototype.doSetTexture=function(){this.gl.bindTexture(this.gl.TEXTURE_2D,this.texParam)},r.prototype.doSetTexture1=function(){var t=this.gl;t.activeTexture(t.TEXTURE1),t.bindTexture(t.TEXTURE_2D,this.texParam),t.activeTexture(t.TEXTURE0)},r.prototype.doSetOpacity=function(){var t=this.opacityParam,e=this.glwrap;e.currentOpacity=t;var i=e.currentShader;i.locOpacity&&i.lpOpacity!==t&&(i.lpOpacity=t,this.gl.uniform1f(i.locOpacity,t))},r.prototype.doQuad=function(){this.gl.drawElements(this.gl.TRIANGLES,this.indexCount,this.gl.UNSIGNED_SHORT,this.startIndex)},r.prototype.doSetBlend=function(){this.gl.blendFunc(this.startIndex,this.indexCount)},r.prototype.doUpdateModelView=function(){for(var t,e=this.glwrap.shaderPrograms,i=this.glwrap.currentProgram,r=0,s=e.length;r<s;r++)t=e[r],r===i&&t.locMatMV?(t.updateMatMV(this.mat4param),t.hasCurrentMatMV=!0):t.hasCurrentMatMV=!1;mat4.set(this.mat4param,this.glwrap.currentMV)},r.prototype.doRenderToTexture=function(){var t=this.gl,e=this.glwrap;this.texParam?(e.lastTexture1===this.texParam&&(t.activeTexture(t.TEXTURE1),t.bindTexture(t.TEXTURE_2D,null),e.lastTexture1=null,t.activeTexture(t.TEXTURE0)),t.bindFramebuffer(t.FRAMEBUFFER,e.fbo),e.isBatchInEarlyZPass||t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,this.texParam,0)):(e.enableFrontToBack||t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,null,0),t.bindFramebuffer(t.FRAMEBUFFER,null))},r.prototype.doClear=function(){var t=this.gl,e=this.startIndex;0===e?(t.clearColor(this.mat4param[0],this.mat4param[1],this.mat4param[2],this.mat4param[3]),t.clear(t.COLOR_BUFFER_BIT)):1===e?(t.enable(t.SCISSOR_TEST),t.scissor(this.mat4param[0],this.mat4param[1],this.mat4param[2],this.mat4param[3]),t.clearColor(0,0,0,0),t.clear(t.COLOR_BUFFER_BIT),t.disable(t.SCISSOR_TEST)):t.clear(t.DEPTH_BUFFER_BIT)},r.prototype.doSetDepthTestEnabled=function(){var t=this.gl;0!==this.startIndex?t.enable(t.DEPTH_TEST):t.disable(t.DEPTH_TEST)},r.prototype.doPoints=function(){var t=this.gl,e=this.glwrap;e.enableFrontToBack&&t.disable(t.DEPTH_TEST);var i=e.shaderPrograms[1];t.useProgram(i.shaderProgram),!i.hasCurrentMatMV&&i.locMatMV&&(i.updateMatMV(e.currentMV),i.hasCurrentMatMV=!0),t.enableVertexAttribArray(i.locAPos),t.bindBuffer(t.ARRAY_BUFFER,e.pointBuffer),t.vertexAttribPointer(i.locAPos,4,t.FLOAT,!1,0,0),t.drawArrays(t.POINTS,this.startIndex/4,this.indexCount),i=e.currentShader,t.useProgram(i.shaderProgram),0<=i.locAPos&&(t.enableVertexAttribArray(i.locAPos),t.bindBuffer(t.ARRAY_BUFFER,e.vertexBuffers[e.curBuffer]),t.vertexAttribPointer(i.locAPos,e.enableFrontToBack?3:2,t.FLOAT,!1,0,0)),0<=i.locATex&&(t.enableVertexAttribArray(i.locATex),t.bindBuffer(t.ARRAY_BUFFER,e.texcoordBuffers[e.curBuffer]),t.vertexAttribPointer(i.locATex,2,t.FLOAT,!1,0,0)),e.enableFrontToBack&&t.enable(t.DEPTH_TEST)},r.prototype.doSetProgram=function(){var t=this.gl,e=this.glwrap,i=e.shaderPrograms[this.startIndex];e.currentProgram=this.startIndex,e.currentShader=i,t.useProgram(i.shaderProgram),!i.hasCurrentMatMV&&i.locMatMV&&(i.updateMatMV(e.currentMV),i.hasCurrentMatMV=!0),i.locOpacity&&i.lpOpacity!==e.currentOpacity&&(i.lpOpacity=e.currentOpacity,t.uniform1f(i.locOpacity,e.currentOpacity)),0<=i.locAPos&&(t.enableVertexAttribArray(i.locAPos),t.bindBuffer(t.ARRAY_BUFFER,e.vertexBuffers[e.curBuffer]),t.vertexAttribPointer(i.locAPos,e.enableFrontToBack?3:2,t.FLOAT,!1,0,0)),0<=i.locATex&&(t.enableVertexAttribArray(i.locATex),t.bindBuffer(t.ARRAY_BUFFER,e.texcoordBuffers[e.curBuffer]),t.vertexAttribPointer(i.locATex,2,t.FLOAT,!1,0,0))},r.prototype.doSetColor=function(){var t=this.glwrap.currentShader,e=this.mat4param;this.gl.uniform4f(t.locColorFill,e[0],e[1],e[2],e[3])},r.prototype.doSetProgramParameters=function(){var t,e,i=this.glwrap.currentShader,r=this.gl,s=this.mat4param,n=this.layoutRect,o=this.srcOriginRect;i.locSamplerBack&&this.glwrap.lastTexture1!==this.texParam&&(r.activeTexture(r.TEXTURE1),r.bindTexture(r.TEXTURE_2D,this.texParam),this.glwrap.lastTexture1=this.texParam,r.activeTexture(r.TEXTURE0));var a=s[0],h=s[1];if(!i.locPixelSize||a===i.lpPixelWidth&&h===i.lpPixelHeight||(i.lpPixelWidth=a,i.lpPixelHeight=h,r.uniform2f(i.locPixelSize,a,h)),a=s[2],h=s[3],!i.locDestStart||a===i.lpDestStartX&&h===i.lpDestStartY||(i.lpDestStartX=a,i.lpDestStartY=h,r.uniform2f(i.locDestStart,a,h)),a=s[4],h=s[5],!i.locDestEnd||a===i.lpDestEndX&&h===i.lpDestEndY||(i.lpDestEndX=a,i.lpDestEndY=h,r.uniform2f(i.locDestEnd,a,h)),a=s[6],i.locLayerScale&&a!==i.lpLayerScale&&(i.lpLayerScale=a,r.uniform1f(i.locLayerScale,a)),a=s[7],i.locLayerAngle&&a!==i.lpLayerAngle&&(i.lpLayerAngle=a,r.uniform1f(i.locLayerAngle,a)),a=s[12],h=s[13],!i.locSrcStart||a===i.lpSrcStartX&&h===i.lpSrcStartY||(i.lpSrcStartX=a,i.lpSrcStartY=h,r.uniform2f(i.locSrcStart,a,h)),a=s[14],h=s[15],!i.locSrcEnd||a===i.lpSrcEndX&&h===i.lpSrcEndY||(i.lpSrcEndX=a,i.lpSrcEndY=h,r.uniform2f(i.locSrcEnd,a,h)),a=o[0],h=o[1],!i.locSrcOriginStart||a===i.lpSrcOriginStartX&&h===i.lpSrcOriginStartY||(i.lpSrcOriginStartX=a,i.lpSrcOriginStartY=h,r.uniform2f(i.locSrcOriginStart,a,h)),a=o[2],h=o[3],!i.locSrcOriginEnd||a===i.lpSrcOriginEndX&&h===i.lpSrcOriginEndY||(i.lpSrcOriginEndX=a,i.lpSrcOriginEndY=h,r.uniform2f(i.locSrcOriginEnd,a,h)),a=n[0],h=n[1],!i.locLayoutStart||a===i.lpLayoutStartX&&h===i.lpLayoutStartY||(i.lpLayoutStartX=a,i.lpLayoutStartY=h,r.uniform2f(i.locLayoutStart,a,h)),a=n[2],h=n[3],!i.locLayoutEnd||a===i.lpLayoutEndX&&h===i.lpLayoutEndY||(i.lpLayoutEndX=a,i.lpLayoutEndY=h,r.uniform2f(i.locLayoutEnd,a,h)),a=this.startIndex,i.locSeconds&&a!==i.lpSeconds&&(i.lpSeconds=a,r.uniform1f(i.locSeconds,a)),i.parameters.length)for(t=0,e=i.parameters.length;t<e;t++)a=this.shaderParams[t],Array.isArray(a)?r.uniform3fv(i.parameters[t][1],a):a!==i.lastCustomParams[t]&&(i.lastCustomParams[t]=a,r.uniform1f(i.parameters[t][1],a))},t.prototype.pushBatch=function(){return this.batchPtr===this.batch.length&&this.batch.push(new r(0,this)),this.batch[this.batchPtr++]},t.prototype.endBatch=function(){if(0!==this.batchPtr&&!this.gl.isContextLost()){this.maybeStartTiming();var t,e,i,r,s=this.gl;for(0<this.pointPtr&&(s.bindBuffer(s.ARRAY_BUFFER,this.pointBuffer),s.bufferSubData(s.ARRAY_BUFFER,0,this.pointData.subarray(0,this.pointPtr)),t&&0<=t.locAPos&&"<point>"===t.name&&s.vertexAttribPointer(t.locAPos,4,s.FLOAT,!1,0,0)),0<this.vertexPtr&&(t=this.currentShader,s.bindBuffer(s.ARRAY_BUFFER,this.vertexBuffers[this.curBuffer]),s.bufferSubData(s.ARRAY_BUFFER,0,this.vertexData.subarray(0,this.vertexPtr)),t&&0<=t.locAPos&&"<point>"!==t.name&&s.vertexAttribPointer(t.locAPos,this.enableFrontToBack?3:2,s.FLOAT,!1,0,0),s.bindBuffer(s.ARRAY_BUFFER,this.texcoordBuffers[this.curBuffer]),s.bufferSubData(s.ARRAY_BUFFER,0,this.texcoordData.subarray(0,this.texPtr)),t&&0<=t.locATex&&"<point>"!==t.name&&s.vertexAttribPointer(t.locATex,2,s.FLOAT,!1,0,0)),e=0,i=this.batchPtr;e<i;e++)switch((r=this.batch[e]).type){case 1:r.doQuad();break;case 2:r.doSetTexture();break;case 3:r.doSetOpacity();break;case 4:r.doSetBlend();break;case 5:r.doUpdateModelView();break;case 6:r.doRenderToTexture();break;case 7:r.doClear();break;case 8:r.doPoints();break;case 9:r.doSetProgram();break;case 10:r.doSetProgramParameters();break;case 11:r.doSetTexture1();break;case 12:r.doSetColor();break;case 13:r.doSetDepthTestEnabled();break;case 14:r.doSetEarlyZPass()}this.batchPtr=0,this.vertexPtr=0,this.texPtr=0,this.pointPtr=0,this.hasQuadBatchTop=!1,this.hasPointBatchTop=!1,this.isBatchInEarlyZPass=!1,this.curBuffer++,4<=this.curBuffer&&(this.curBuffer=0)}},t.prototype.maybeStartTiming=function(){var t,e;this.isTiming||this.timerExt&&(this.isTiming=!0,t={frameNumber:this.frameNumber,query:null,result:0},2===this.version?(t.query=this.gl.createQuery(),this.gl.beginQuery(this.timerExt.TIME_ELAPSED_EXT,t.query)):(t.query=this.timerExt.createQueryEXT(),this.timerExt.beginQueryEXT(this.timerExt.TIME_ELAPSED_EXT,t.query)),this.timerResults.push(t),1e3<this.timerResults.length&&((e=this.timerResults.shift()).query&&(2===this.version?this.gl.deleteQuery(e.query):this.timerExt.deleteQueryEXT(e.query))))},t.prototype.maybeFinishTiming=function(){this.isTiming&&this.timerResults.length&&(this.timerResults[this.timerResults.length-1],2===this.version?this.gl.endQuery(this.timerExt.TIME_ELAPSED_EXT):this.timerExt.endQueryEXT(this.timerExt.TIME_ELAPSED_EXT),this.isTiming=!1)},t.prototype.checkForTimerResults=function(t){for(var e,i,r,s=0,n=this.timerResults.length;s<n;++s){if((e=this.timerResults[s]).frameNumber>=t)return;e.query&&(i=2===this.version?this.gl.getQueryParameter(e.query,this.gl.QUERY_RESULT_AVAILABLE):this.timerExt.getQueryObjectEXT(e.query,this.timerExt.QUERY_RESULT_AVAILABLE_EXT),r=this.gl.getParameter(this.timerExt.GPU_DISJOINT_EXT),i&&!r&&(2===this.version?e.result=this.gl.getQueryParameter(e.query,this.gl.QUERY_RESULT):e.result=this.timerExt.getQueryObjectEXT(e.query,this.timerExt.QUERY_RESULT_EXT),e.result/=1e9),(i||r)&&(2===this.version?this.gl.deleteQuery(e.query):this.timerExt.deleteQueryEXT(e.query),e.query=null))}},t.prototype.getFrameRangeTimerResults=function(t,e){if(e<=t)return-1;for(var i,r=0,s=0,n=0,o=this.timerResults.length;n<o&&!((i=this.timerResults[n]).frameNumber>=e);++n)if(i.frameNumber>=t){if(i.query)return-1;r+=i.result,s++}return s<e-t?-1:r},t.prototype.deleteTimerResultsToFrame=function(t){for(var e=0,i=this.timerResults.length;e<i;++e)if(this.timerResults[e].frameNumber>=t)return void(0<e&&this.timerResults.splice(0,e))},t.prototype.setOpacity=function(t){var e;t!==this.lastOpacity&&(this.isEarlyZPass||((e=this.pushBatch()).type=3,e.opacityParam=t,this.lastOpacity=t,this.hasQuadBatchTop=!1,this.hasPointBatchTop=!1))},t.prototype.setTexture=function(t){var e;t!==this.lastTexture0&&((e=this.pushBatch()).type=2,e.texParam=t,this.lastTexture0=t,this.hasQuadBatchTop=!1,this.hasPointBatchTop=!1)},t.prototype.setBlend=function(t,e){var i;t===this.lastSrcBlend&&e===this.lastDestBlend||this.isEarlyZPass||((i=this.pushBatch()).type=4,i.startIndex=t,i.indexCount=e,this.lastSrcBlend=t,this.lastDestBlend=e,this.hasQuadBatchTop=!1,this.hasPointBatchTop=!1)},t.prototype.isPremultipliedAlphaBlend=function(){return this.lastSrcBlend===this.gl.ONE&&this.lastDestBlend===this.gl.ONE_MINUS_SRC_ALPHA},t.prototype.setAlphaBlend=function(){this.setBlend(this.gl.ONE,this.gl.ONE_MINUS_SRC_ALPHA)},t.prototype.setNoPremultiplyAlphaBlend=function(){this.setBlend(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA)};t.prototype.quad=function(t,e,i,r,s,n,o,a){15992<=this.vertexPtr&&this.endBatch();var h,c=this.vertexPtr,l=this.texPtr,u=this.vertexData,p=this.texcoordData,d=this.currentZ;this.hasQuadBatchTop?this.batch[this.batchPtr-1].indexCount+=6:((h=this.pushBatch()).type=1,h.startIndex=this.enableFrontToBack?c:c/2*3,h.indexCount=6,this.hasQuadBatchTop=!0,this.hasPointBatchTop=!1),this.enableFrontToBack?(u[c++]=t,u[c++]=e,u[c++]=d,u[c++]=i,u[c++]=r,u[c++]=d,u[c++]=s,u[c++]=n,u[c++]=d,u[c++]=o,u[c++]=a,u[c++]=d):(u[c++]=t,u[c++]=e,u[c++]=i,u[c++]=r,u[c++]=s,u[c++]=n,u[c++]=o,u[c++]=a),p[l++]=0,p[l++]=0,p[l++]=1,p[l++]=0,p[l++]=1,p[l++]=1,p[l++]=0,p[l++]=1,this.vertexPtr=c,this.texPtr=l},t.prototype.quadTex=function(t,e,i,r,s,n,o,a,h){15992<=this.vertexPtr&&this.endBatch();var c,l=this.vertexPtr,u=this.texPtr,p=this.vertexData,d=this.texcoordData,g=this.currentZ;this.hasQuadBatchTop?this.batch[this.batchPtr-1].indexCount+=6:((c=this.pushBatch()).type=1,c.startIndex=this.enableFrontToBack?l:l/2*3,c.indexCount=6,this.hasQuadBatchTop=!0,this.hasPointBatchTop=!1);var f=h.left,y=h.top,m=h.right,_=h.bottom;this.enableFrontToBack?(p[l++]=t,p[l++]=e,p[l++]=g,p[l++]=i,p[l++]=r,p[l++]=g,p[l++]=s,p[l++]=n,p[l++]=g,p[l++]=o,p[l++]=a,p[l++]=g):(p[l++]=t,p[l++]=e,p[l++]=i,p[l++]=r,p[l++]=s,p[l++]=n,p[l++]=o,p[l++]=a),d[u++]=f,d[u++]=y,d[u++]=m,d[u++]=y,d[u++]=m,d[u++]=_,d[u++]=f,d[u++]=_,this.vertexPtr=l,this.texPtr=u},t.prototype.quadTexUV=function(t,e,i,r,s,n,o,a,h,c,l,u,p,d,g,f){15992<=this.vertexPtr&&this.endBatch();var y,m=this.vertexPtr,_=this.texPtr,v=this.vertexData,b=this.texcoordData,w=this.currentZ;this.hasQuadBatchTop?this.batch[this.batchPtr-1].indexCount+=6:((y=this.pushBatch()).type=1,y.startIndex=this.enableFrontToBack?m:m/2*3,y.indexCount=6,this.hasQuadBatchTop=!0,this.hasPointBatchTop=!1),this.enableFrontToBack?(v[m++]=t,v[m++]=e,v[m++]=w,v[m++]=i,v[m++]=r,v[m++]=w,v[m++]=s,v[m++]=n,v[m++]=w,v[m++]=o,v[m++]=a,v[m++]=w):(v[m++]=t,v[m++]=e,v[m++]=i,v[m++]=r,v[m++]=s,v[m++]=n,v[m++]=o,v[m++]=a),b[_++]=h,b[_++]=c,b[_++]=l,b[_++]=u,b[_++]=p,b[_++]=d,b[_++]=g,b[_++]=f,this.vertexPtr=m,this.texPtr=_},t.prototype.convexPoly=function(t){for(var e,i,r,s,n,o,a,h=t.length/2-2,c=h-1,l=t[0],u=t[1],p=0;p<h;p+=2)i=t[2+(e=2*p)],r=t[3+e],s=t[4+e],n=t[5+e],p===c?this.quad(l,u,i,r,s,n,s,n):(o=t[6+e],a=t[7+e],this.quad(l,u,i,r,s,n,o,a))};t.prototype.point=function(t,e,i,r){7996<=this.pointPtr&&this.endBatch();var s,n=this.pointPtr,o=this.pointData;this.hasPointBatchTop?this.batch[this.batchPtr-1].indexCount++:((s=this.pushBatch()).type=8,s.startIndex=n,s.indexCount=1,this.hasPointBatchTop=!0,this.hasQuadBatchTop=!1),o[n++]=t,o[n++]=e,o[n++]=i,o[n++]=r,this.pointPtr=n},t.prototype.switchProgram=function(t){if(this.lastProgram!==t){var e=this.shaderPrograms[t];if(!e){if(0===this.lastProgram)return;t=0,e=this.shaderPrograms[0]}var i=this.pushBatch();i.type=9,i.startIndex=t,this.lastProgram=t,this.hasQuadBatchTop=!1,this.hasPointBatchTop=!1}},t.prototype.programUsesDest=function(t){var e=this.shaderPrograms[t];return!(!e.locDestStart&&!e.locDestEnd)},t.prototype.programUsesCrossSampling=function(t){var e=this.shaderPrograms[t];return!!(e.locDestStart||e.locDestEnd||e.crossSampling)},t.prototype.programPreservesOpaqueness=function(t){return this.shaderPrograms[t].preservesOpaqueness},t.prototype.programExtendsBox=function(t){var e=this.shaderPrograms[t];return 0!==e.extendBoxHorizontal||0!==e.extendBoxVertical},t.prototype.getProgramBoxExtendHorizontal=function(t){return this.shaderPrograms[t].extendBoxHorizontal},t.prototype.getProgramBoxExtendVertical=function(t){return this.shaderPrograms[t].extendBoxVertical},t.prototype.getProgramParameterType=function(t,e){return this.shaderPrograms[t].parameters[e][2]},t.prototype.programIsAnimated=function(t){return this.shaderPrograms[t].animated},t.prototype.setProgramParameters=function(t,e,i,r,s,n,o,a,h,c,l,u,p,d,g,f,y,m,_,v,b,w,x){var T,M,S,A,C,L,E,O=this.shaderPrograms[this.lastProgram];if(O.hasAnyOptionalUniforms||x.length){if((S=this.pushBatch()).type=10,S.mat4param?mat4.set(this.matMV,S.mat4param):S.mat4param=mat4.create(),(A=S.mat4param)[0]=e,A[1]=i,A[2]=f,A[3]=y,A[4]=m,A[5]=_,A[6]=v,A[7]=b,A[12]=r,A[13]=s,A[14]=n,A[15]=o,(L=S.srcOriginRect)[0]=a,L[1]=h,L[2]=c,L[3]=l,(E=S.layoutRect)[0]=u,E[1]=g,E[2]=d,E[3]=p,S.startIndex=w,O.locSamplerBack?S.texParam=t:S.texParam=null,x.length)for((C=S.shaderParams).length=x.length,T=0,M=x.length;T<M;T++)C[T]=x[T];this.hasQuadBatchTop=!1,this.hasPointBatchTop=!1}},t.prototype.clear=function(t,e,i,r){var s=this.pushBatch();s.type=7,s.startIndex=0,s.mat4param||(s.mat4param=mat4.create()),s.mat4param[0]=t,s.mat4param[1]=e,s.mat4param[2]=i,s.mat4param[3]=r,this.hasQuadBatchTop=!1,this.hasPointBatchTop=!1},t.prototype.clearRect=function(t,e,i,r){var s;i<0||r<0||((s=this.pushBatch()).type=7,s.startIndex=1,s.mat4param||(s.mat4param=mat4.create()),s.mat4param[0]=t,s.mat4param[1]=e,s.mat4param[2]=i,s.mat4param[3]=r,this.hasQuadBatchTop=!1,this.hasPointBatchTop=!1)},t.prototype.clearDepth=function(){var t=this.pushBatch();t.type=7,t.startIndex=2,this.hasQuadBatchTop=!1,this.hasPointBatchTop=!1},t.prototype.setEarlyZPass=function(t){var e;this.enableFrontToBack&&(t=!!t,this.isEarlyZPass!==t&&((e=this.pushBatch()).type=14,e.startIndex=t?1:0,this.hasQuadBatchTop=!1,this.hasPointBatchTop=!1,this.isEarlyZPass=t,this.renderToTex=null,this.isEarlyZPass?this.switchProgram(2):this.switchProgram(0)))},t.prototype.setDepthTestEnabled=function(t){var e;this.enableFrontToBack&&((e=this.pushBatch()).type=13,e.startIndex=t?1:0,this.hasQuadBatchTop=!1,this.hasPointBatchTop=!1)},t.prototype.fullscreenQuad=function(){mat4.set(this.lastMV,i),this.resetModelView(),this.updateModelView();var t=this.width/2,e=this.height/2;this.quad(-t,e,t,e,t,-e,-t,-e),mat4.set(i,this.matMV),this.updateModelView()},t.prototype.setColorFillMode=function(t,e,i,r){this.switchProgram(3);var s=this.pushBatch();s.type=12,s.mat4param||(s.mat4param=mat4.create()),s.mat4param[0]=t,s.mat4param[1]=e,s.mat4param[2]=i,s.mat4param[3]=r,this.hasQuadBatchTop=!1,this.hasPointBatchTop=!1},t.prototype.setTextureFillMode=function(){this.switchProgram(0)},t.prototype.restoreEarlyZMode=function(){this.switchProgram(2)},t.prototype.getFrameNumber=function(){return this.frameNumber},t.prototype.present=function(){this.endBatch(),this.maybeFinishTiming(),this.gl.flush(),this.checkForTimerResults(this.frameNumber),this.frameNumber++},t.prototype.supportsGpuProfiling=function(){return!!this.timerExt};var f=[],y={};t.prototype.contextLost=function(){cr.clearArray(f),y={}};t.prototype.loadTexture=function(t,e,i,r,s,n){e=!!e,i=!!i;var o=t.src+","+e+","+i+(e?","+s:""),a=null;if(void 0!==t.src&&y.hasOwnProperty(o))return(a=y[o]).c2refcount++,a;this.endBatch();var h=this.gl,c=cr.isPOT(t.width)&&cr.isPOT(t.height),a=h.createTexture();h.bindTexture(h.TEXTURE_2D,a),h.pixelStorei(h.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0);var l,u,p=h.RGBA,d=h.RGBA,g=h.UNSIGNED_BYTE;if(r&&!this.isIE)switch(r){case 1:p=h.RGB,d=h.RGB;break;case 2:g=h.UNSIGNED_SHORT_4_4_4_4;break;case 3:g=h.UNSIGNED_SHORT_5_5_5_1;break;case 4:p=h.RGB,d=h.RGB,g=h.UNSIGNED_SHORT_5_6_5}return 1===this.version&&!c&&e?((l=document.createElement("canvas")).width=cr.nextHighestPowerOfTwo(t.width),l.height=cr.nextHighestPowerOfTwo(t.height),(u=l.getContext("2d")).imageSmoothingEnabled=i,u.drawImage(t,0,0,t.width,t.height,0,0,l.width,l.height),h.texImage2D(h.TEXTURE_2D,0,p,d,g,l)):h.texImage2D(h.TEXTURE_2D,0,p,d,g,t),e?"repeat-x"===s?(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,h.REPEAT),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,h.CLAMP_TO_EDGE)):("repeat-y"===s?h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,h.CLAMP_TO_EDGE):h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,h.REPEAT),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,h.REPEAT)):(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,h.CLAMP_TO_EDGE),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,h.CLAMP_TO_EDGE)),i?(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,h.LINEAR),(c||2<=this.version)&&this.enable_mipmaps&&!n?(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,h.LINEAR_MIPMAP_LINEAR),h.generateMipmap(h.TEXTURE_2D)):h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,h.LINEAR)):(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,h.NEAREST),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,h.NEAREST)),h.bindTexture(h.TEXTURE_2D,null),this.lastTexture0=null,a.c2width=t.width,a.c2height=t.height,a.c2refcount=1,a.c2texkey=o,f.push(a),y[o]=a},t.prototype.createEmptyTexture=function(t,e,i,r,s){this.endBatch();var n=this.gl;this.isIE&&(r=!1);var o=n.createTexture();return n.bindTexture(n.TEXTURE_2D,o),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,t,e,0,n.RGBA,r?n.UNSIGNED_SHORT_4_4_4_4:n.UNSIGNED_BYTE,null),s?(n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.REPEAT),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.REPEAT)):(n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE)),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,i?n.LINEAR:n.NEAREST),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,i?n.LINEAR:n.NEAREST),n.bindTexture(n.TEXTURE_2D,null),this.lastTexture0=null,o.c2width=t,o.c2height=e,f.push(o),o},t.prototype.videoToTexture=function(t,e,i){this.endBatch();var r=this.gl;this.isIE&&(i=!1),r.bindTexture(r.TEXTURE_2D,e),r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0);try{r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,i?r.UNSIGNED_SHORT_4_4_4_4:r.UNSIGNED_BYTE,t)}catch(t){console&&console.error&&console.error("Error updating WebGL texture: ",t)}r.bindTexture(r.TEXTURE_2D,null),this.lastTexture0=null},t.prototype.deleteTexture=function(t){t&&(void 0!==t.c2refcount&&1<t.c2refcount?t.c2refcount--:(this.endBatch(),t===this.lastTexture0&&(this.gl.bindTexture(this.gl.TEXTURE_2D,null),this.lastTexture0=null),t===this.lastTexture1&&(this.gl.activeTexture(this.gl.TEXTURE1),this.gl.bindTexture(this.gl.TEXTURE_2D,null),this.gl.activeTexture(this.gl.TEXTURE0),this.lastTexture1=null),cr.arrayFindRemove(f,t),void 0!==t.c2texkey&&delete y[t.c2texkey],this.gl.deleteTexture(t)))},t.prototype.estimateVRAM=function(){for(var t,e=this.width*this.height*4*2,i=0,r=f.length;i<r;i++)e+=(t=f[i]).c2width*t.c2height*4;return e},t.prototype.textureCount=function(){return f.length},t.prototype.setRenderingToTexture=function(t){var e;t!==this.renderToTex&&((e=this.pushBatch()).type=6,e.texParam=t,this.renderToTex=t,this.hasQuadBatchTop=!1,this.hasPointBatchTop=!1)},cr.GLWrap=t}(),function(){var v=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||window.oRequestAnimationFrame,t=new Audio,Y={"audio/webm; codecs=opus":!!t.canPlayType("audio/webm; codecs=opus"),"audio/ogg; codecs=opus":!!t.canPlayType("audio/ogg; codecs=opus"),"audio/webm; codecs=vorbis":!!t.canPlayType("audio/webm; codecs=vorbis"),"audio/ogg; codecs=vorbis":!!t.canPlayType("audio/ogg; codecs=vorbis"),"audio/mp4":!!t.canPlayType("audio/mp4"),"audio/mpeg":!!t.canPlayType("audio/mpeg")};function e(t){var e,i=t.canvas,r=t.projectDataUrl;i||(i=document.createElement("canvas"),document.body.appendChild(i)),i&&i.getContext&&(window.c3runtime=this,window.c3canvas=i,(e=this).exportType=t.exportType,this.isPreview="preview"===this.exportType,this.isRemotePreview=!!t.isRemotePreview,this.isCrosswalk=/crosswalk/i.test(navigator.userAgent)||/xwalk/i.test(navigator.userAgent)||!(void 0===window.c2isCrosswalk||!window.c2isCrosswalk),this.isCordova="cordova"===this.exportType,this.isPhoneGap=this.isCordova,this.isMicrosoftEdge=/edge\//i.test(navigator.userAgent),this.isIE=(/msie/i.test(navigator.userAgent)||/trident/i.test(navigator.userAgent)||/iemobile/i.test(navigator.userAgent))&&!this.isMicrosoftEdge,this.isTizen=/tizen/i.test(navigator.userAgent),this.isAndroid=/android/i.test(navigator.userAgent)&&!this.isTizen&&!this.isIE&&!this.isMicrosoftEdge,this.isiPhone=(/iphone/i.test(navigator.userAgent)||/ipod/i.test(navigator.userAgent))&&!this.isIE&&!this.isMicrosoftEdge,this.isiPad=/ipad/i.test(navigator.userAgent),this.isiOS=this.isiPhone||this.isiPad,this.isChrome=(/chrome/i.test(navigator.userAgent)||/chromium/i.test(navigator.userAgent))&&!this.isIE&&!this.isMicrosoftEdge,this.isAmazonWebApp=/amazonwebappplatform/i.test(navigator.userAgent),this.isFirefox=/firefox/i.test(navigator.userAgent),this.isSafari=/safari/i.test(navigator.userAgent)&&!this.isChrome&&!this.isIE&&!this.isMicrosoftEdge,this.isWindows=/windows/i.test(navigator.userAgent),this.isNWjs="nwjs"===this.exportType||/nodewebkit/i.test(navigator.userAgent)||/nwjs/i.test(navigator.userAgent),this.isNodeWebkit=this.isNWjs,this.isArcade="scirra-arcade"===this.exportType,this.isWindows8App=!(void 0===window.c2isWindows8||!window.c2isWindows8),this.isWindowsPhone8=!(void 0===window.c2isWindowsPhone8||!window.c2isWindowsPhone8),this.isWindowsPhone81=!(void 0===window.c2isWindowsPhone81||!window.c2isWindowsPhone81),this.isWindows10="windows-uwp"===this.exportType,this.isWinJS=this.isWindows8App||this.isWindowsPhone81||this.isWindows10,this.isBlackberry10=!(void 0===window.c2isBlackberry10||!window.c2isBlackberry10),this.isAndroidStockBrowser=this.isAndroid&&!this.isChrome&&!this.isCrosswalk&&!this.isFirefox&&!this.isAmazonWebApp,this.devicePixelRatio=1,this.isMobile=this.isCordova||this.isCrosswalk||this.isAndroid||this.isiOS||this.isWindowsPhone8||this.isWindowsPhone81||this.isBlackberry10||this.isTizen,this.isMobile||(this.isMobile=/(blackberry|bb10|playbook|palm|symbian|nokia|windows\s+ce|phone|mobile|tablet|kindle|silk)/i.test(navigator.userAgent)),this.isWKWebView=!(!this.isiOS||!this.isCordova),this.isPreview&&!this.isNWjs&&("?nw"===window.location.search||/nodewebkit/i.test(navigator.userAgent)||/nwjs/i.test(navigator.userAgent))&&(this.isNWjs=!0),this.isDebug=this.isPreview&&-1<window.location.search.indexOf("debug"),this.useFbInstant="undefined"!=typeof FBInstant&&!this.isPreview&&!this.isCordova,this.hasInitialized=!1,this.canvas=i,this.gl=null,this.glwrap=null,this.glUnmaskedRenderer="(unavailable)",this.enableFrontToBack=!1,this.earlyz_index=0,this.ctx=null,this.firstInFullscreen=!1,this.oldWidth=0,this.oldHeight=0,this.canvas.oncontextmenu=function(t){return t.preventDefault&&t.preventDefault(),!1},this.canvas.onselectstart=function(t){return t.preventDefault&&t.preventDefault(),!1},this.canvas.ontouchstart=function(t){return t.preventDefault&&t.preventDefault(),!1},this.isNWjs&&(window.ondragover=function(t){return t.preventDefault(),!1},window.ondrop=function(t){return t.preventDefault(),!1},window.nwgui&&window.nwgui.App.clearCache&&window.nwgui.App.clearCache()),this.projectDataUrl=r||"",this.width=i.width,this.height=i.height,this.draw_width=this.width,this.draw_height=this.height,this.cssWidth=this.width,this.cssHeight=this.height,this.lastWindowWidth=window.innerWidth,this.lastWindowHeight=window.innerHeight,this.forceCanvasAlpha=!1,this.redraw=!0,this.isSuspended=!1,Date.now||(Date.now=function(){return+new Date}),this.plugins=[],this.types={},this.types_lowercase={},this.types_by_index=[],this.behaviors=[],this.layouts={},this.layouts_by_index=[],this.eventsheets={},this.eventsheets_by_index=[],this.wait_for_textures=[],this.triggers_to_postinit=[],this.all_global_vars=[],this.all_local_vars=[],this.solidBehavior=null,this.jumpthruBehavior=null,this.shadowcasterBehavior=null,this.deathRow={},this.hasPendingInstances=!1,this.isInClearDeathRow=!1,this.isInOnDestroy=0,this.isRunningEvents=!1,this.isEndingLayout=!1,this.createRow=[],this.isLoadingState=!1,this.saveToSlot="",this.loadFromSlot="",this.loadFromJson=null,this.lastSaveJson="",this.signalledContinuousPreview=!1,this.suspendDrawing=!1,this.fireOnCreateAfterLoad=[],this.dt=0,this.dt1=0,this.minimumFramerate=30,this.logictime=0,this.cpuutilisation=0,this.timescale=1,this.kahanTime=new cr.KahanAdder,this.wallTime=new cr.KahanAdder,this.last_tick_time=0,this.fps=0,this.last_fps_time=0,this.tickcount=0,this.tickcount_nosave=0,this.execcount=0,this.framecount=0,this.objectcount=0,this.gpuTimeStartFrame=0,this.gpuTimeEndFrame=0,this.gpuCurUtilisation=-1,this.gpuLastUtilisation=0,this.changelayout=null,this.destroycallbacks=[],this.event_stack=[],this.event_stack_index=-1,this.localvar_stack=[[]],this.localvar_stack_index=0,this.trigger_depth=0,this.pushEventStack(null),this.loop_stack=[],this.loop_stack_index=-1,this.next_uid=0,this.next_puid=0,this.layout_first_tick=!0,this.family_count=0,this.suspend_events=[],this.raf_id=-1,this.timeout_id=-1,this.isloading=!0,this.loadingprogress=0,this.stackLocalCount=0,this.audioInstance=null,this.had_a_click=!1,this.isInUserInputEvent=!1,this.objects_to_pretick=new cr.ObjectSet,this.objects_to_tick=new cr.ObjectSet,this.objects_to_tick2=new cr.ObjectSet,this.registered_collisions=[],this.temp_poly=new cr.CollisionPoly([]),this.temp_poly2=new cr.CollisionPoly([]),this.allGroups=[],this.groups_by_name={},this.cndsBySid={},this.actsBySid={},this.varsBySid={},this.blocksBySid={},this.running_layout=null,this.layer_canvas=null,this.layer_ctx=null,this.layer_tex=null,this.layout_tex=null,this.layout_canvas=null,this.layout_ctx=null,this.is_WebGL_context_lost=!1,this.uses_background_blending=!1,this.fx_tex=[null,null],this.fullscreen_scaling=0,this.files_subfolder="",this.objectsByUid={},this.loaderlogos=null,this.webFontNames=null,this.enhancedAccelerationPrecision=!0,this.snapshotCanvas=null,this.snapshotData="",this.objectRefTable=[],"html5"===this.exportType&&"file"===location.protocol.substr(0,4)&&alert("Exported games won't work until you upload them. (When running on the file: protocol, browsers block many features from working for security reasons.)"),this.useFbInstant?(FBInstant.initializeAsync().then(function(){e.requestProjectData()}).catch(function(t){console.warn("[Instant Games] Unable to load: ",t),e.requestProjectData()}),window.setTimeout(function(){e.hasInitialized||(console.warn("[Instant Games] Initialization timed out after 4 seconds. Continuing with Instant Games disabled."),e.useFbInstant=!1,e.requestProjectData())},4e3)):this.requestProjectData())}t=null,e.prototype.requestProjectData=function(){if(!this.hasInitialized){this.hasInitialized=!0;var e=this;if(this.isWKWebView)this.fetchLocalFileViaCordovaAsText("data.js",function(t){e.loadProject(JSON.parse(t))},function(t){alert("Error fetching data.js")});else{var t=this.isWindowsPhone8?new ActiveXObject("Microsoft.XMLHTTP"):new XMLHttpRequest,i=this.projectDataUrl||"data.js";(this.isWindows8App||this.isWindowsPhone8||this.isWindowsPhone81||this.isWindows10)&&(i="data.json"),t.open("GET",i,!0);var r=!1;if("response"in t&&"responseType"in t)try{t.responseType="json",r="json"===t.responseType}catch(t){r=!1}if(!r&&"responseType"in t)try{t.responseType="text"}catch(t){}if("overrideMimeType"in t)try{t.overrideMimeType("application/json; charset=utf-8")}catch(t){}this.isWindowsPhone8?t.onreadystatechange=function(){4===t.readyState&&e.loadProject(JSON.parse(t.responseText))}:(t.onload=function(){r?e.loadProject(t.response):e.loadProject(JSON.parse(t.responseText))},t.onerror=function(t){cr.logerror("Error requesting "+i+":"),cr.logerror(t)}),t.send()}}},e.prototype.initRendererAndLoader=function(){var t,e,i,r,s,n,o,a,h,c,l=this;this.isRetina=this.useHighDpi&&!this.isAndroidStockBrowser,0===this.fullscreen_mode&&this.isiOS&&(this.isRetina=!1);var u,p=window.devicePixelRatio||window.webkitDevicePixelRatio||window.mozDevicePixelRatio||window.msDevicePixelRatio||1;this.devicePixelRatio=this.isRetina?p:1,"object"==typeof window.StatusBar&&window.StatusBar.hide(),"object"==typeof window.AndroidFullScreen&&window.AndroidFullScreen.immersiveMode(),this.ClearDeathRow(),0<this.fullscreen_mode&&this.setSize(window.innerWidth,window.innerHeight,!0);try{this.enableWebGL&&(u={alpha:!0,depth:!1,antialias:!1,failIfMajorPerformanceCaveat:!0},this.isAndroid||(this.gl=this.canvas.getContext("webgl2",u)),this.gl||(this.gl=this.canvas.getContext("webgl",u)||this.canvas.getContext("experimental-webgl",u)))}catch(t){}if(this.gl){this.gl.getParameter(this.gl.VERSION).indexOf("WebGL 2");var d,g,f=this.gl.getExtension("WEBGL_debug_renderer_info");for(f&&(d=this.gl.getParameter(f.UNMASKED_VENDOR_WEBGL),g=this.gl.getParameter(f.UNMASKED_RENDERER_WEBGL),this.glUnmaskedRenderer=g+" ["+d+"]"),this.enableFrontToBack&&(this.glUnmaskedRenderer+=" [front-to-back enabled]"),this.overlay_canvas=document.createElement("canvas"),this.canvas.parentNode.appendChild(this.overlay_canvas),this.overlay_canvas.oncontextmenu=function(t){return!1},this.overlay_canvas.onselectstart=function(t){return!1},this.overlay_canvas.width=Math.round(this.cssWidth*this.devicePixelRatio),this.overlay_canvas.height=Math.round(this.cssHeight*this.devicePixelRatio),this.overlay_canvas.style.width=this.cssWidth+"px",this.overlay_canvas.style.height=this.cssHeight+"px",this.overlay_canvas.style.position="absolute",this.overlay_ctx=this.overlay_canvas.getContext("2d"),this.glwrap=new cr.GLWrap(this.gl,this.isMobile,this.enableFrontToBack),this.glwrap.setSize(this.canvas.width,this.canvas.height),this.glwrap.enable_mipmaps=0!==this.downscalingQuality,this.ctx=null,this.canvas.addEventListener("webglcontextlost",function(t){t.preventDefault(),l.onContextLost(),cr.logexport("[Construct 2] WebGL context lost"),window.cr_setSuspended(!0)},!1),this.canvas.addEventListener("webglcontextrestored",function(t){l.glwrap.initState(),l.glwrap.setSize(l.glwrap.width,l.glwrap.height,!0),l.layer_tex=null,l.layout_tex=null,l.fx_tex[0]=null,l.fx_tex[1]=null,l.onContextRestored(),l.redraw=!0,cr.logexport("[Construct 2] WebGL context restored"),window.cr_setSuspended(!1)},!1),this.glwrap.supportsGpuProfiling()||(this.gpuLastUtilisation=NaN),t=0,e=this.types_by_index.length;t<e;t++)for(i=0,r=(o=this.types_by_index[t]).effect_types.length;i<r;i++)(a=o.effect_types[i]).shaderindex=this.glwrap.getShaderIndex(a.id),a.preservesOpaqueness=this.glwrap.programPreservesOpaqueness(a.shaderindex),this.uses_background_blending=this.uses_background_blending||this.glwrap.programUsesDest(a.shaderindex);for(t=0,e=this.layouts_by_index.length;t<e;t++){for(i=0,r=(h=this.layouts_by_index[t]).effect_types.length;i<r;i++)(a=h.effect_types[i]).shaderindex=this.glwrap.getShaderIndex(a.id),a.preservesOpaqueness=this.glwrap.programPreservesOpaqueness(a.shaderindex);for(h.updateActiveEffects(),i=0,r=h.layers.length;i<r;i++){for(s=0,n=(c=h.layers[i]).effect_types.length;s<n;s++)(a=c.effect_types[s]).shaderindex=this.glwrap.getShaderIndex(a.id),a.preservesOpaqueness=this.glwrap.programPreservesOpaqueness(a.shaderindex),this.uses_background_blending=this.uses_background_blending||this.glwrap.programUsesDest(a.shaderindex);c.updateActiveEffects()}}}else u={alpha:!0},this.ctx=this.canvas.getContext("2d",u),this.ctx.imageSmoothingEnabled=this.linearSampling,this.overlay_canvas=null,this.overlay_ctx=null,this.gpuLastUtilisation=NaN,this.wantFullscreenScalingQuality=!0,this.fullscreenScalingQuality=!0;this.tickFunc=function(t){l.tick(!1,t)},window==window.top||this.isWinJS||this.isWindowsPhone8||(document.addEventListener("mousedown",function(){window.focus()},!0),document.addEventListener("touchstart",function(){window.focus()},!0)),this.isPreview&&(-1<window.location.search.indexOf("continuous")&&(cr.logexport("Reloading for continuous preview"),this.loadFromSlot="__c2_continuouspreview",this.suspendDrawing=!0),this.pauseOnBlur&&!this.isMobile&&(window.addEventListener("focus",function(){l.setSuspended(!1)}),window.addEventListener("blur",function(){var t=window.parent;t&&t.document.hasFocus()||l.setSuspended(!0)}))),window.addEventListener("blur",function(){l.onWindowBlur()});function y(t){if("mousedown"===t.type&&1===t.button&&t.preventDefault(),cr.isCanvasInputEvent(t)&&document.activeElement&&document.activeElement!==document.getElementsByTagName("body")[0]&&document.activeElement.blur)try{document.activeElement.blur()}catch(t){}}"undefined"!=typeof PointerEvent?document.addEventListener("pointerdown",y):window.navigator.msPointerEnabled?document.addEventListener("MSPointerDown",y):document.addEventListener("touchstart",y),document.addEventListener("mousedown",y),0===this.fullscreen_mode&&this.isRetina&&1<this.devicePixelRatio?this.setSize(this.original_width,this.original_height,!0):this.setSize(window.innerWidth,window.innerHeight,!0),this.tryLockOrientation(),this.getready(),this.go(),this.extra={},cr.seal(this)},e.prototype.setSize=function(t,e,i){var r,s,n,o,a,h,c,l,u,p,d=0,g=0,f=0,y=0,m=0;this.lastWindowWidth===t&&this.lastWindowHeight===e&&!i||(this.isiPhone&&this.isCordova&&window.screen&&(r=document.documentElement.style,s=document.body.style,o=(n=window.innerWidth<window.innerHeight)?window.screen.height:window.screen.width,a=n?window.screen.width:window.screen.height,o&&a&&(s.height=r.height=o+"px",s.width=r.width=a+"px")),this.lastWindowWidth=t,this.lastWindowHeight=e,h=this.fullscreen_mode,((u=(document.mozFullScreen||document.webkitIsFullScreen||!!document.msFullscreenElement||document.fullScreen)&&!this.isCordova)||0!==this.fullscreen_mode||i)&&(u&&(h=this.fullscreen_scaling),p=this.devicePixelRatio,4<=h?(5===h&&1!==p&&(t+=1,e+=1),(c=this.original_width/this.original_height)<(l=t/e)?(f=e*c,5===h?(1<(m=f*p/this.original_width)?m=Math.floor(m):m<1&&(m=1/Math.ceil(1/m)),d=(t-(f=this.original_width*m/p))/2,g=(e-(y=this.original_height*m/p))/2,t=f,e=y):(d=(t-f)/2,t=f)):(y=t/c,e=(5===h?(1<(m=y*p/this.original_height)?m=Math.floor(m):m<1&&(m=1/Math.ceil(1/m)),d=(t-(f=this.original_width*m/p))/2,g=(e-(y=this.original_height*m/p))/2,t=f):g=(e-y)/2,y))):u&&0===h&&(d=Math.floor((t-this.original_width)/2),g=Math.floor((e-this.original_height)/2),t=this.original_width,e=this.original_height),h<2&&(this.aspect_scale=p),this.cssWidth=Math.round(t),this.cssHeight=Math.round(e),this.width=Math.round(t*p),this.height=Math.round(e*p),this.redraw=!0,this.wantFullscreenScalingQuality||this.width<this.original_width&&this.height<this.original_height||1===h?(this.draw_width=this.width,this.draw_height=this.height,this.fullscreenScalingQuality=!0):(this.draw_width=this.original_width,this.draw_height=this.original_height,this.fullscreenScalingQuality=!1,2===h?(c=this.original_width/this.original_height,(l=this.lastWindowWidth/this.lastWindowHeight)<c?this.draw_width=this.draw_height*l:c<l&&(this.draw_height=this.draw_width/l)):3===h&&((c=this.original_width/this.original_height)<(l=this.lastWindowWidth/this.lastWindowHeight)?this.draw_width=this.draw_height*l:l<c&&(this.draw_height=this.draw_width/l))),this.canvas&&(this.canvas.width=Math.round(t*p),this.canvas.height=Math.round(e*p),this.isRetina&&(this.canvas.style.width=Math.round(t)+"px",this.canvas.style.height=Math.round(e)+"px"),this.canvas.style.marginLeft=Math.floor(d)+"px",this.canvas.style.marginTop=Math.floor(g)+"px"),this.overlay_canvas&&(this.overlay_canvas.width=Math.round(t*p),this.overlay_canvas.height=Math.round(e*p),this.overlay_canvas.style.width=this.cssWidth+"px",this.overlay_canvas.style.height=this.cssHeight+"px",this.overlay_canvas.style.left=Math.floor(d)+"px",this.overlay_canvas.style.top=Math.floor(g)+"px"),this.glwrap&&this.glwrap.setSize(Math.round(t*p),Math.round(e*p)),this.ctx&&(this.ctx.imageSmoothingEnabled=this.linearSampling),this.tryLockOrientation(),this.isiPhone&&!this.isCordova&&window.scrollTo(0,0)))},e.prototype.tryLockOrientation=function(){if(this.autoLockOrientation&&0!==this.orientations){var t="portrait";2===this.orientations&&(t="landscape");try{screen.orientation&&screen.orientation.lock?screen.orientation.lock(t).catch(function(){}):screen.lockOrientation?screen.lockOrientation(t):screen.webkitLockOrientation?screen.webkitLockOrientation(t):screen.mozLockOrientation?screen.mozLockOrientation(t):screen.msLockOrientation&&screen.msLockOrientation(t)}catch(t){console&&console.warn&&console.warn("Failed to lock orientation: ",t)}}},e.prototype.onContextLost=function(){var t,e,i;for(this.glwrap.contextLost(),this.is_WebGL_context_lost=!0,t=0,e=this.types_by_index.length;t<e;t++)(i=this.types_by_index[t]).onLostWebGLContext&&i.onLostWebGLContext()},e.prototype.onContextRestored=function(){var t,e,i;for(this.is_WebGL_context_lost=!1,t=0,e=this.types_by_index.length;t<e;t++)(i=this.types_by_index[t]).onRestoreWebGLContext&&i.onRestoreWebGLContext()};var r=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.msCancelAnimationFrame||window.oCancelAnimationFrame;e.prototype.setSuspended=function(t){var e,i;if(t&&!this.isSuspended)for(cr.logexport("[Construct 2] Suspending"),this.isSuspended=!0,-1!==this.raf_id&&r(this.raf_id),-1!==this.timeout_id&&clearTimeout(this.timeout_id),e=0,i=this.suspend_events.length;e<i;e++)this.suspend_events[e](!0);else if(!t&&this.isSuspended){for(cr.logexport("[Construct 2] Resuming"),this.isSuspended=!1,this.last_tick_time=cr.performance_now(),this.last_fps_time=cr.performance_now(),this.framecount=0,e=this.logictime=0,i=this.suspend_events.length;e<i;e++)this.suspend_events[e](!1);this.tick(!1)}},e.prototype.addSuspendCallback=function(t){this.suspend_events.push(t)},e.prototype.GetObjectReference=function(t){return this.objectRefTable[t]};var b=!(e.prototype.loadProject=function(t){t&&t.project||cr.logerror("Project model unavailable");var e,i,r,s,n,o,a,h,c,l,u,p,d,g,f,y,m,_,v,b,w=t.project;for(this.name=w[0],this.first_layout=w[1],this.fullscreen_mode=w[12],this.fullscreen_mode_set=w[12],this.original_width=w[10],this.original_height=w[11],this.parallax_x_origin=this.original_width/2,this.parallax_y_origin=this.original_height/2,this.uses_loader_layout=w[18],this.loaderstyle=w[19],this.iconsFolder=w[28],this.webFontNames=w[29].map(function(t){return t[0]}),0===this.loaderstyle?((e=new Image).crossOrigin="anonymous",this.loaderlogos={logo:e},i=this.loaderlogos,e.addEventListener("error",function(){i.logo=null}),r=this.isPreview?this.getProjectFileUrl("loading-logo.png"):this.iconsFolder+"loading-logo.png",this.setImageSrc(e,r)):4===this.loaderstyle&&((s=new Image).src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4NCjwhLS0gR2VuZXJhdG9yOiBBZG9iZSBJbGx1c3RyYXRvciAxNi4wLjAsIFNWRyBFeHBvcnQgUGx1Zy1JbiAuIFNWRyBWZXJzaW9uOiA2LjAwIEJ1aWxkIDApICAtLT4NCjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+DQo8c3ZnIHZlcnNpb249IjEuMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgeD0iMHB4IiB5PSIwcHgiDQoJIHdpZHRoPSIxNzAwLjc5MDA0cHgiIGhlaWdodD0iMTcwMC43OTAwNHB4IiB2aWV3Qm94PSIyODcgMzE3IDExMjUgMTEyNSINCgkgZW5hYmxlLWJhY2tncm91bmQ9Im5ldyAwIDAgMTcwMC43OTAwNCAxNzAwLjc5MDA0IiB4bWw6c3BhY2U9InByZXNlcnZlIj4NCjxnIGlkPSJsb2dvIj4NCgk8Zz4NCgkJPGc+DQoJCQk8cGF0aCBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGNsaXAtcnVsZT0iZXZlbm9kZCIgZmlsbD0iI0ZGRkZGRiIgZD0iTTM1NC45Nzc1NCwxMTk1LjYyMzA1DQoJCQkJYzExLjM4NDc3LDAsMjIuMDEyNywzLjIzNzMsMzEuMDE3NTgsOC44Mzc4OWMxLjk0NjI5LDEuMjEwOTQsMi41ODQ5NiwzLjc0OTAyLDEuNDM4NDgsNS43MzQzOGwtNC45MzI2Miw4LjU0MTk5DQoJCQkJYy0zLjI3ODMyLDUuNjc5NjktMTAuMDMzMiw4LjM3Njk1LTE2LjMxNzM4LDYuNTAwOThjLTIuNzY0NjUtMC44MjUyLTUuNjkzMzYtMS4yNjg1NS04LjcyNjU2LTEuMjY4NTUNCgkJCQljLTE2LjgyOTEsMC0zMC40NzI2NiwxMy42NDM1NS0zMC40NzI2NiwzMC40NzI2NmMwLDE2LjgyODEzLDEzLjY0MzU1LDMwLjQ3MjY2LDMwLjQ3MjY2LDMwLjQ3MjY2DQoJCQkJYzMuMDMzMiwwLDUuOTYxOTEtMC40NDMzNiw4LjcyNjU2LTEuMjY4NTVjNi4yOTQ5Mi0xLjg3OTg4LDEzLjAzMzIsMC44MTE1MiwxNi4zMTczOCw2LjUwMDk4bDQuOTMxNjQsOC41NDE5OQ0KCQkJCWMxLjE0NzQ2LDEuOTg4MjgsMC41MTA3NCw0LjUyMzQ0LTEuNDM4NDgsNS43MzQzOGMtOS4wMDM5MSw1LjYwMTU2LTE5LjYzMTg0LDguODM3ODktMzEuMDE2Niw4LjgzNzg5DQoJCQkJYy0zMi40ODUzNSwwLTU4LjgxOTM0LTI2LjMzNDk2LTU4LjgxOTM0LTU4LjgxOTM0QzI5Ni4xNTgyLDEyMjEuOTU3MDMsMzIyLjQ5MjE5LDExOTUuNjIzMDUsMzU0Ljk3NzU0LDExOTUuNjIzMDUNCgkJCQlMMzU0Ljk3NzU0LDExOTUuNjIzMDV6IE03MDMuMjE0ODQsMTI1OS4xNzU3OGMtMTQuNTU5NTctOS44MTczOC0yMC4yMDMxMy0yMC4wMzIyMy0yMC4yMDMxMy0zMy4wODAwOA0KCQkJCWMwLTE4LjQ4OTI2LDE1LjcxNDg0LTI5Ljc2MzY3LDM4LjI2NjYtMjkuNzYzNjdjOS42NTcyMywwLDE4LjcyMTY4LDIuNTQyOTcsMjYuNTU5NTcsNi45OTQxNA0KCQkJCWMyLjA0OTgsMS4xNjQwNiwyLjc2MTcyLDMuNzgzMiwxLjU4MzAxLDUuODI0MjJsLTMuNDE3OTcsNS45MTk5MmMtMy4yNDcwNyw1LjYyNDAyLTkuOTA4Miw4LjMzMTA1LTE2LjE1MzMyLDYuNTQ4ODMNCgkJCQljLTIuNzIzNjMtMC43NzYzNy01LjU5ODYzLTEuMTkyMzgtOC41NzEyOS0xLjE5MjM4Yy0xMC40OTAyMywwLTExLjU5ODYzLDkuNTc2MTctNC44NTc0MiwxNC4xMjMwNWwyMy42ODY1MiwxNS45NzY1Ng0KCQkJCWM5Ljk5MDIzLDYuNzM4MjgsMTUuODk1NTEsMTcuMDY2NDEsMTUuODk1NTEsMjguNzE4NzVjMCwxOC43ODYxMy0xNS4wMDY4NCwzMy4zMDc2Mi0zOC4yNjc1OCwzMy4zMDc2Mg0KCQkJCWMtOS41MjI0NiwwLTE4LjU4Nzg5LTEuOTU3MDMtMjYuODE1NDMtNS40OTAyM2MtNy43ODEyNS0zLjMzOTg0LTEwLjkzMzU5LTEyLjc4MjIzLTYuNjk3MjctMjAuMTE4MTZsMy40ODczLTYuMDQxOTkNCgkJCQljMS4yMTM4Ny0yLjA5OTYxLDMuOTMxNjQtMi43NTk3Nyw1Ljk3NDYxLTEuNDU2MDVjNi44NTkzOCw0LjM4MjgxLDE2LjQ5MDIzLDcuNTk0NzMsMjQuNzU4NzksNy41OTQ3Mw0KCQkJCWMxMC41NDU5LDAsMTEuMzI4MTMtOS45NTg5OCwzLjc2NzU4LTE1LjA1NzYyTDcwMy4yMTQ4NCwxMjU5LjE3NTc4TDcwMy4yMTQ4NCwxMjU5LjE3NTc4eiBNOTg0LjYzMDg2LDEyMDIuMDAwOTgNCgkJCQljMC0yLjM0NzY2LDEuOTAzMzItNC4yNTE5NSw0LjI1MTk1LTQuMjUxOTVoOS45MjE4OGM3LjgyNzE1LDAsMTQuMTcyODUsNi4zNDU3LDE0LjE3Mjg1LDE0LjE3MzgzdjU3LjQwMTM3DQoJCQkJYzAsOC42MTAzNSw2Ljk4MDQ3LDE1LjU5MDgyLDE1LjU5MDgyLDE1LjU5MDgyczE1LjU5MDgyLTYuOTgwNDcsMTUuNTkwODItMTUuNTkwODJ2LTU3LjQwMTM3DQoJCQkJYzAtNy44MjgxMyw2LjM0NTctMTQuMTczODMsMTQuMTcyODUtMTQuMTczODNoOS45MjA5YzIuMzQ4NjMsMCw0LjI1MTk1LDEuOTA0Myw0LjI1MTk1LDQuMjUxOTV2NjcuMzIzMjQNCgkJCQljMCwyNC4yNjU2My0xOS42NzA5LDQzLjkzNzUtNDMuOTM2NTIsNDMuOTM3NXMtNDMuOTM3NS0xOS42NzE4OC00My45Mzc1LTQzLjkzNzVWMTIwMi4wMDA5OEw5ODQuNjMwODYsMTIwMi4wMDA5OHoNCgkJCQkgTTQ2Ni44NjkxNCwxMTk1LjYyMzA1YzMyLjQ4NDM4LDAsNTguODE4MzYsMjYuMzMzOTgsNTguODE4MzYsNTguODE5MzRjMCwzMi40ODQzOC0yNi4zMzM5OCw1OC44MTkzNC01OC44MTgzNiw1OC44MTkzNA0KCQkJCWMtMzIuNDg2MzMsMC01OC44MTkzNC0yNi4zMzQ5Ni01OC44MTkzNC01OC44MTkzNEM0MDguMDQ5OCwxMjIxLjk1NzAzLDQzNC4zODI4MSwxMTk1LjYyMzA1LDQ2Ni44NjkxNCwxMTk1LjYyMzA1DQoJCQkJTDQ2Ni44NjkxNCwxMTk1LjYyMzA1eiBNNDY2Ljg2OTE0LDEyMjUuMDMzMmMtMTYuMjQzMTYsMC0yOS40MTAxNiwxMy4xNjY5OS0yOS40MTAxNiwyOS40MDkxOA0KCQkJCXMxMy4xNjY5OSwyOS40MDgyLDI5LjQxMDE2LDI5LjQwODJjMTYuMjQxMjEsMCwyOS40MDgyLTEzLjE2NjAyLDI5LjQwODItMjkuNDA4MlM0ODMuMTEwMzUsMTIyNS4wMzMyLDQ2Ni44NjkxNCwxMjI1LjAzMzINCgkJCQlMNDY2Ljg2OTE0LDEyMjUuMDMzMnogTTU1Ni43MzI0MiwxMzExLjEzNDc3Yy0yLjM0NzY2LDAtNC4yNTE5NS0xLjkwMjM0LTQuMjUxOTUtNC4yNXYtOTQuOTYxOTENCgkJCQljMC03LjgyODEzLDYuMzQ1Ny0xNC4xNzM4MywxNC4xNzM4My0xNC4xNzM4M2gzLjk1ODk4YzQuNjI1LDAsOC45NTg5OCwyLjI1Njg0LDExLjYxMTMzLDYuMDQ1OWw0MS4xMjIwNyw1OC43NDcwN3YtNTAuNjE5MTQNCgkJCQljMC03LjgyODEzLDYuMzQ1Ny0xNC4xNzM4MywxNC4xNzI4NS0xNC4xNzM4M2g5LjkyMTg4YzIuMzQ3NjYsMCw0LjI1MTk1LDEuOTA0Myw0LjI1MTk1LDQuMjUxOTV2OTQuOTYwOTQNCgkJCQljMCw3LjgyOTEtNi4zNDU3LDE0LjE3Mjg1LTE0LjE3MzgzLDE0LjE3Mjg1aC0zLjk1ODk4Yy00LjYyNSwwLTguOTU4OTgtMi4yNTU4Ni0xMS42MTEzMy02LjA0NDkybC00MS4xMjIwNy01OC43NDYwOXY1MC42MTgxNg0KCQkJCWMwLDcuODI5MS02LjM0NTcsMTQuMTcyODUtMTQuMTcyODUsMTQuMTcyODVINTU2LjczMjQyTDU1Ni43MzI0MiwxMzExLjEzNDc3eiBNMTIxNS4wMjA1MSwxMjExLjkyMjg1DQoJCQkJYzAtNy44MjgxMyw2LjM0NTctMTQuMTczODMsMTQuMTcyODUtMTQuMTczODNoNTAuMzE1NDNjMi4zNDg2MywwLDQuMjUxOTUsMS45MDQzLDQuMjUxOTUsNC4yNTE5NXY1LjY2OTkyDQoJCQkJYzAsNy44MjcxNS02LjM0NTcsMTQuMTcyODUtMTQuMTcyODUsMTQuMTcyODVoLTYuMDI0NDF2NzUuMTE4MTZjMCw3LjgyOTEtNi4zNDU3LDE0LjE3Mjg1LTE0LjE3Mjg1LDE0LjE3Mjg1aC05LjkyMTg4DQoJCQkJYy0yLjM0ODYzLDAtNC4yNTE5NS0xLjkwMjM0LTQuMjUxOTUtNC4yNXYtODUuMDQxMDJoLTE1Ljk0NDM0Yy0yLjM0ODYzLDAtNC4yNTE5NS0xLjkwMzMyLTQuMjUxOTUtNC4yNTE5NVYxMjExLjkyMjg1DQoJCQkJTDEyMTUuMDIwNTEsMTIxMS45MjI4NXogTTc3Ni40NDkyMiwxMjExLjkyMjg1YzAtNy44MjgxMyw2LjM0NTctMTQuMTczODMsMTQuMTczODMtMTQuMTczODNoNTAuMzE0NDUNCgkJCQljMi4zNDk2MSwwLDQuMjUxOTUsMS45MDQzLDQuMjUxOTUsNC4yNTE5NXY1LjY2OTkyYzAsNy44MjcxNS02LjM0NTcsMTQuMTcyODUtMTQuMTcxODgsMTQuMTcyODVoLTYuMDI1Mzl2NzUuMTE4MTYNCgkJCQljMCw3LjgyOTEtNi4zNDU3LDE0LjE3Mjg1LTE0LjE3Mjg1LDE0LjE3Mjg1aC05LjkyMDljLTIuMzQ5NjEsMC00LjI1MTk1LTEuOTAyMzQtNC4yNTE5NS00LjI1di04NS4wNDEwMmgtMTUuOTQ1MzENCgkJCQljLTIuMzQ3NjYsMC00LjI1MTk1LTEuOTAzMzItNC4yNTE5NS00LjI1MTk1VjEyMTEuOTIyODVMNzc2LjQ0OTIyLDEyMTEuOTIyODV6IE05MjkuNjA0NDksMTI3Mi4wMjI0NmwyNi45NTgwMSwzMi4xMjc5Mw0KCQkJCWMyLjMxNDQ1LDIuNzU3ODEsMC4zNDM3NSw2Ljk4NDM4LTMuMjU2ODQsNi45ODQzOGgtMTkuNzA1MDhjLTQuMTg5NDUsMC04LjE2NTA0LTEuODUxNTYtMTAuODU3NDItNS4wNjA1NWwtMjIuNjgxNjQtMjcuMDMxMjUNCgkJCQl2MjcuODQxOGMwLDIuMzQ3NjYtMS45MDMzMiw0LjI1LTQuMjUxOTUsNC4yNWgtOS45MjA5Yy03LjgyNzE1LDAtMTQuMTcyODUtNi4zNDM3NS0xNC4xNzI4NS0xNC4xNzI4NXYtODUuMDM5MDYNCgkJCQljMC03LjgyODEzLDYuMzQ1Ny0xNC4xNzM4MywxNC4xNzI4NS0xNC4xNzM4M2gyOS43NjM2N2MyMi43MDAyLDAsNDEuMTAyNTQsMTcuMTMzNzksNDEuMTAyNTQsMzguMjY4NTUNCgkJCQlDOTU2Ljc1NDg4LDEyNTIuNTkwODIsOTQ1LjQzNjUyLDEyNjYuNzAyMTUsOTI5LjYwNDQ5LDEyNzIuMDIyNDZMOTI5LjYwNDQ5LDEyNzIuMDIyNDZ6IE05MDAuMDYxNTIsMTIyMS44NDM3NXYzMi41OTg2M2g4LjUwMzkxDQoJCQkJYzEwLjk1ODk4LDAsMTkuODQyNzctNy4yOTc4NSwxOS44NDI3Ny0xNi4yOTg4M2MwLTkuMDAxOTUtOC44ODM3OS0xNi4yOTk4LTE5Ljg0Mjc3LTE2LjI5OThIOTAwLjA2MTUyTDkwMC4wNjE1MiwxMjIxLjg0Mzc1eg0KCQkJCSBNMTE1OC4zNTkzOCwxMTk1LjYyMzA1YzExLjM4NDc3LDAsMjIuMDEyNywzLjIzNzMsMzEuMDE3NTgsOC44Mzc4OWMxLjk0NzI3LDEuMjEwOTQsMi41ODQ5NiwzLjc0OTAyLDEuNDM4NDgsNS43MzQzOA0KCQkJCWwtNC45MzI2Miw4LjU0MTk5Yy0zLjI3ODMyLDUuNjc5NjktMTAuMDMzMiw4LjM3Njk1LTE2LjMxNzM4LDYuNTAwOThjLTIuNzY0NjUtMC44MjUyLTUuNjkzMzYtMS4yNjg1NS04LjcyNTU5LTEuMjY4NTUNCgkJCQljLTE2LjgyOTEsMC0zMC40NzI2NiwxMy42NDM1NS0zMC40NzI2NiwzMC40NzI2NmMwLDE2LjgyODEzLDEzLjY0MzU1LDMwLjQ3MjY2LDMwLjQ3MjY2LDMwLjQ3MjY2DQoJCQkJYzMuMDMyMjMsMCw1Ljk2MDk0LTAuNDQzMzYsOC43MjU1OS0xLjI2ODU1YzYuMjk1OS0xLjg3OTg4LDEzLjAzMzIsMC44MTE1MiwxNi4zMTgzNiw2LjUwMDk4bDQuOTMwNjYsOC41NDE5OQ0KCQkJCWMxLjE0NzQ2LDEuOTg4MjgsMC41MTA3NCw0LjUyMzQ0LTEuNDM3NSw1LjczNDM4Yy05LjAwNDg4LDUuNjAxNTYtMTkuNjMyODEsOC44Mzc4OS0zMS4wMTc1OCw4LjgzNzg5DQoJCQkJYy0zMi40ODUzNSwwLTU4LjgxOTM0LTI2LjMzNDk2LTU4LjgxOTM0LTU4LjgxOTM0QzEwOTkuNTQwMDQsMTIyMS45NTcwMywxMTI1Ljg3NDAyLDExOTUuNjIzMDUsMTE1OC4zNTkzOCwxMTk1LjYyMzA1eiIvPg0KCQkJPHBhdGggZmlsbC1ydWxlPSJldmVub2RkIiBjbGlwLXJ1bGU9ImV2ZW5vZGQiIGZpbGw9IiMwMEZGREEiIGQ9Ik0xMzE4LjE5NzI3LDEyMDYuMDMyMjMNCgkJCQljMC03LjgyODEzLDYuMzQ1Ny0xNC4xNzM4MywxNC4xNzI4NS0xNC4xNzM4M2MyMC42NTYyNSwwLDQxLjMxMjUsMCw2MS45Njg3NSwwYzMuNDI5NjksMCw1LjQ1MDIsMy44ODA4NiwzLjQ4MzQsNi42OTA0Mw0KCQkJCWwtMTkuMjk2ODgsMjcuNTY3MzhjMTUuNTQyOTcsOC4zNzU5OCwyNi4xMDY0NSwyNC44MDA3OCwyNi4xMDY0NSw0My42OTUzMWMwLDI3LjM5NzQ2LTIyLjIwODk4LDQ5LjYwNjQ1LTQ5LjYwNjQ1LDQ5LjYwNjQ1DQoJCQkJYy0xNi42ODg0OCwwLTMxLjQ1MTE3LTguMjQwMjMtNDAuNDQzMzYtMjAuODc1OThjLTEuNDUwMi0yLjAzOTA2LTAuODMxMDUtNC44OTk0MSwxLjMzNTk0LTYuMTUyMzRsMTAuOTc3NTQtNi4zMzc4OQ0KCQkJCWM0Ljg4MTg0LTIuODE4MzYsMTAuOTc5NDktMi40NzU1OSwxNS41MTQ2NSwwLjg3MzA1YzMuNTI4MzIsMi42MDU0Nyw3Ljg5MTYsNC4xNDY0OCwxMi42MTUyMyw0LjE0NjQ4DQoJCQkJYzExLjc0MjE5LDAsMjEuMjU5NzctOS41MTg1NSwyMS4yNTk3Ny0yMS4yNTk3N3MtOS41MTc1OC0yMS4yNTk3Ny0yMS4yNTk3Ny0yMS4yNTk3N2gtMTUuMjE3NzcNCgkJCQljLTMuNDI5NjksMC01LjQ1MDItMy44ODA4Ni0zLjQ4NDM4LTYuNjkwNDNsMTguMTM1NzQtMjUuOTA4MmgtMzIuMDA5NzdjLTIuMzQ4NjMsMC00LjI1MTk1LTEuOTAzMzItNC4yNTE5NS00LjI1MTk1VjEyMDYuMDMyMjN6DQoJCQkJIi8+DQoJCTwvZz4NCgkJPGc+DQoJCQk8Zz4NCgkJCQk8cGF0aCBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGNsaXAtcnVsZT0iZXZlbm9kZCIgZmlsbD0iI0RBRThGNyIgZD0iTTg1MC4zOTU1MSw4NTcuNTkxOA0KCQkJCQljLTUwLjM1NjQ1LDAtOTQuMzI1Mi0yNy4zNTY0NS0xMTcuODUyNTQtNjguMDIwNTFsLTgwLjAzMDI3LDQ2LjIwNDFjLTQuNjU1MjcsMi42ODk0NS02LjEzMTg0LDguNzE4NzUtMy4yNDkwMiwxMy4yNTU4Ng0KCQkJCQljNDIuMjM3Myw2Ni40ODYzMywxMTYuNTMzMiwxMTAuNjA3NDIsMjAxLjEzMTg0LDExMC42MDc0MmM4OC4xMjU5OCwwLDE2NS4wNzEyOS00Ny44NzUsMjA2LjI0MzE2LTExOS4wMzYxM2wtODAuNDg3My00Ni40Njk3Mw0KCQkJCQljLTQuMzEzNDgtMi40OTAyMy05LjgwMTc2LTEuMjA1MDgtMTIuNTcwMzEsMi45MzU1NUM5MzkuMTc1NzgsODMzLjU2MjUsODk3LjU5MTgsODU3LjU5MTgsODUwLjM5NTUxLDg1Ny41OTE4DQoJCQkJCUw4NTAuMzk1NTEsODU3LjU5MTh6IE0xMTM2LjcyMTY4LDU1Ni4yMTc3N2M0LjYxNDI2LTIuNjYzMDksNi4xMTAzNS04LjYxOTE0LDMuMzEyNS0xMy4xNTEzNw0KCQkJCQljLTU5LjkxNTA0LTk3LjAzMDI3LTE2Ny4yMjQ2MS0xNjEuNjk0MzQtMjg5LjYzODY3LTE2MS42OTQzNGMtMTI1Ljg5MzU1LDAtMjM1LjgxMzQ4LDY4LjM5MjU4LTI5NC42MzM3OSwxNzAuMDQ5OA0KCQkJCQlsODAuMzc2OTUsNDYuNDA2MjVjNC4zOTc0NiwyLjUzOTA2LDEwLjAwMTk1LDEuMTQ5NDEsMTIuNzEwOTQtMy4xNDU1MQ0KCQkJCQljNDIuMTY0MDYtNjYuODUxNTYsMTE2LjY2ODk1LTExMS4yNjM2NywyMDEuNTQ1OS0xMTEuMjYzNjdjODguMTI1OTgsMCwxNjUuMDcxMjksNDcuODc1OTgsMjA2LjI0MzE2LDExOS4wMzYxMw0KCQkJCQlMMTEzNi43MjE2OCw1NTYuMjE3Nzd6Ii8+DQoJCQkJPHBhdGggZmlsbC1ydWxlPSJldmVub2RkIiBjbGlwLXJ1bGU9ImV2ZW5vZGQiIGZpbGw9IiNBNUJBQzgiIGQ9Ik04NTAuMzk1NTEsOTU5LjYzODY3DQoJCQkJCWMtODQuNTk4NjMsMC0xNTguODk0NTMtNDQuMTIxMDktMjAxLjEzMTg0LTExMC42MDc0MmMtMi44NzY5NS00LjUzMDI3LTEuMzk5NDEtMTAuNTcwMzEsMy4yNDkwMi0xMy4yNTU4Nmw4MC4wMzAyNy00Ni4yMDQxDQoJCQkJCWMtMTEuNTgxMDUtMjAuMDE2Ni0xOC4yMDk5Ni00My4yNTQ4OC0xOC4yMDk5Ni02OC4wNDE5OWMwLTc0Ljc4NTE2LDYwLjU1NzYyLTEzNi4wNjI1LDEzNi4wNjI1LTEzNi4wNjI1DQoJCQkJCWM0Ny4xOTYyOSwwLDg4Ljc4MDI3LDI0LjAyOTMsMTEzLjE4NTU1LDYwLjUyMjQ2YzIuNzY0NjUsNC4xMzM3OSw4LjI2MzY3LDUuNDIxODgsMTIuNTcwMzEsMi45MzU1NWw4MC40ODczLTQ2LjQ2OTczDQoJCQkJCWMtNDEuMTcxODgtNzEuMTYwMTYtMTE4LjExNzE5LTExOS4wMzYxMy0yMDYuMjQzMTYtMTE5LjAzNjEzYy04NC44NzY5NSwwLTE1OS4zODE4NCw0NC40MTIxMS0yMDEuNTQ1OSwxMTEuMjYzNjcNCgkJCQkJYy0yLjcwNjA1LDQuMjkxMDItOC4zMTgzNiw1LjY4MTY0LTEyLjcxMDk0LDMuMTQ1NTFsLTgwLjM3Njk1LTQ2LjQwNjI1DQoJCQkJCWMtMjguOTUyMTUsNTAuMDQwMDQtNDUuNTIzNDQsMTA4LjEzOTY1LTQ1LjUyMzQ0LDE3MC4xMDc0MmMwLDE4Ni45NjM4NywxNTEuMzk0NTMsMzQwLjE1NzIzLDM0MC4xNTcyMywzNDAuMTU3MjMNCgkJCQkJYzEyMi40MTQwNiwwLDIyOS43MjM2My02NC42NjQwNiwyODkuNjM4NjctMTYxLjY5NTMxYzIuNzk0OTItNC41MjYzNywxLjI5NDkyLTEwLjQ5MDIzLTMuMzEyNS0xMy4xNTEzN2wtODAuMDgzMDEtNDYuMjM3Mw0KCQkJCQlDMTAxNS40NjY4LDkxMS43NjM2Nyw5MzguNTIxNDgsOTU5LjYzODY3LDg1MC4zOTU1MSw5NTkuNjM4Njd6Ii8+DQoJCQk8L2c+DQoJCQk8cGF0aCBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGNsaXAtcnVsZT0iZXZlbm9kZCIgZmlsbD0iIzAwRkZEQSIgZD0iTTExMzcuMTg1NTUsNzU4LjExMzI4di03My4xNjc5N2wtNjMuMzY1MjMsMzYuNTgzOTgNCgkJCQlMMTEzNy4xODU1NSw3NTguMTEzMjhMMTEzNy4xODU1NSw3NTguMTEzMjh6IE0xMDI2LjU3NjE3LDcwNS4xNjQwNmwxMjAuMDU4NTktNjkuMzE2NDENCgkJCQljMTIuNTY4MzYtNy4yNTU4NiwyOC4zNDQ3MywxLjg1MjU0LDI4LjM0NTcsMTYuMzY2MjF2MTM4LjYzMDg2Yy0wLjAwMDk4LDE0LjUxMjctMTUuNzc3MzQsMjMuNjIyMDctMjguMzQ1NywxNi4zNjYyMQ0KCQkJCWwtMTIwLjA1ODU5LTY5LjMxNjQxQzEwMTQuMDI4MzIsNzMwLjY0OTQxLDEwMTQuMDI4MzIsNzEyLjQwOTE4LDEwMjYuNTc2MTcsNzA1LjE2NDA2eiIvPg0KCQk8L2c+DQoJPC9nPg0KPC9nPg0KPC9zdmc+DQo=",(n=new Image).src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAABABAMAAACekdKMAAAAMFBMVEUAAAByfYZyfYZyfYZyfYZyfYZyfYZyfYZyfYZyfYZyfYZyfYZyfYZyfYZyfYZyfYYgo7vbAAAAD3RSTlMAmd137hFVqjO7zCKIRGZ881JRAAAFY0lEQVR42u2aPW/bVhSGn1iiPizZ8D+QgSJBNglFmiboQA0NUKAD1XotYA0BOspAkZnqx24vnTrIQNCpg4QkQMcYKDoW9j9w5y6qLNqWFDlvh3tJUa6ddHBhAuS7SKBIQffhuee851CQKVOmTJkyZcqUKXmqa8O+uyNlABKsFRmdP0o5AOle2gHoWdoBzFrpBHACwPeetJNmAFSlt6kGwGH0LqUAVqRuqgHkpEaqAVRkfvOWr+Dh9Rc4j6VvwnrhPNAbgK2ezj+yx7Z6GjUuASi4Ch4lHQAGwBeRK1rROQAdUx5K0hE4NUkaAdS02ZEuoms2wkCSgvYSgFJfkn6CobkSPG0mEcAOrHnGFOxAToHNjk/MygLgO/PxL0BN9yRdQKlufMQAoCdJGi8BOJYknXTJ269cu9HtdqNb4Ni6oimUbFb0dAZQ1DmULJ+TFtT0qQHwg73mLlCMfFUMQPR5VWrbmttNHICC1KDiSZ+w3pMOwFPDhP4IYFtv4ZX0nIorbUBNmjWAiqdZg5fmNFd6jvPhJQDjAV9LI0r28IpmycsBZalNWfoRWJcuoKY9c7cCkwpOwdcIqNT1BmrSgQkNbQAvpAGOF+aHOIBpCxhKR/TVBNjVOHkAOgrg2N6aoU7sklmVidtD7bNm/fIrjaBmk+Sxea142iBnTyguAfjZZscNXLOdXFM8EgVgXRpDz/6yonTEts6AXdV1APTVoKigFSXEmj3XN0kSV01WFQwAHC8O4Mhagye8NgHS137SALzsS3dxwhtXkQ4oaw64eqomOFKXbc2xJbFLTX8DOHYnsKsJu2Gdu8IIuTqjrMB8eyM5ACIFXQo2S5t7lNMM6AdFTaCgADqahHW8EQIohBk9rzEdE+JXAtjVmHWpDTmplUAA96Ea/bJDnVKSWjgaFTSHqubgmjVDXQchgFy4wBXNcXV6LYC8RjbEypomcCAyBopRShxqAn21yenM8WawqjOoKVbmLYBFndeImsnyVwJY1RR8NW1FTRiA6UNTCsP6fKwLONQBZTXx1WVbT0KbtwygvAxg81oAZU0xe2QYxkmyrDDx2DzWBXTUZFs7dNQwHUEMwN4VAKb47wOQ1wj8Gx0+/Y8A8powVJtt7XOoxn8A8N4IqCrA8cJUmzgAl3JAUWN8tSjqDX0NwI/XbwugGLe178oBK7bBaBesm0gggOUqwLrOHe8c1jV2NAMOw/XFAFRth2dr/burANS1cSc0C8kDsB7zAZvgKCjoLTiaFqwpmvwLQC7e2b3PB4CrZj48KXkAKktOEPr6VqeAr680udzEWACluK0LreJ1ThBe6+w4HkfJAhD1AtbAu3qgPcDVX2oCK9bqxwFQ1+fRsVW7va/uBZpAWaND652TCGBoM1rHHN6VmQlsq6cdE+4mC75oLAC49prKB1zTDd6NukHIKahbIkkEsGrmAQWZbZqXNLClrg04dTP4KnjnCwBfmgkZT7WD45k94C8BmA3MPGBgeqcbfQBxwwDsRMi3N7Iqc3dzsuVhV5ofkevpJOoGKUn6Ax5L92F49USoayZCls08uQDiM0ETCWPb8k7DMmH02SICGC7ayVhnsABwEpsZQkfxUpI4ALGpsFn4xCbHcVjnwgnvAkBh0U6CbzqrXgzA1E6FB9YOJGcacgUAfl36t0Ro/SIDUDEL/D1WBcJr5q0oRoJ2LQZgZJ4LPIu2RCPJAJafDLm2Yr2OHmQ4H0vzBksA2PKl38L3fY0aLAFYejK0ZpJhelVKzkj8dlRNzkj8dpRP0DTkVjTUXroB9PVnqtefS9I05BZU8NOdAyUl5q8RtwUg6KYcwP1Up8CanpMpU6ZMmTLdgP4BRYsi23xEdOAAAAAASUVORK5CYII=",(o=new Image).src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAAgCAYAAAD9qabkAAAGsElEQVR42u1cLVQcVxSOqKmoqKipqKioQVRUYCoqImoqEBU1EYiIiIT94SQ9O8tw2p0Zcg4VERGImAhERAyiAoGJiEBgEAgEBoGIwCAQ7bvv3fve3TdvZndhQWy+75wR7My+P+797u/sgwcAAAAAAAAAAAAAAAAAMGd0svJ5Z1hsdvPyh7bn6D49RxdODbg39Iblsghe6jL3n6xlW0s4qZuhOyw+dYflf2vD0W9tz9F9eo4unBpwfwKaFc9E8NouQwaHnaz6EScGAgAWkACMq3qV8gC6WfXO3LtmErgECYAAgIX0AIpPjcKZV9+b+2csoEc4NRAA8BkRgH1uo/pdBBQ5ARAA8JkRQKfzz5eeACJhXsv+WupkxVtz74LDiWsTLuzFz0nCkRKLTSRD92m8+N76+suvJCx58aL6Wj7P8/wLGo9yFD5fkRUfU3P0htVjnn+5u1H+YZ474fXupPfjlJf2Zf9uyOQ/zbe+i54/pzH/LIpvbkIAtNfusNoy/5tTOU8KxWjd4azM+u1eqsfNpF0OZL+QdGBuBNAZjlbC96tVyREkr6zYCYq1tSQCTUKesJan/J3XtfkH5a+iXJoUzN8HLYnLPSIIPwaThJn/w9hzRnnHSMjkQxrGu+wPqocxWSjFj/d+KmPNQgAUZiXnN2P1zTnYvWSjR3KWRDQJsvsJHhswNwLo59VDESgSLm/RQ4JwTyzkev7yW2vBgoL1lJKfpRSCkotB2Iuz+jrLHTd3+UZZuPfe4g6rFSEqa+lF8cz+YgIQkiHLHSuN348hLrlP+1JEc05ziPchXoReA33OIdN5k9fUTgCGUIhYeZ7eoPpFz0MeEHtEl24vo9UaYQ6LEXI2wFwIgBTaKMYxK8ZJUGZRimI/6TWwEJIyitsuityN3G5bceBnWdGXxwmC52cl6w7+/tmHG4nKBClQTCbeAzBk1RCv7zM5vEt5QF4JWeFoLbIGIcWY1IRQZiGADlv5epghZ+PcfrOe3abz916ECQMg5cBEAmgqA5KQiaUhYRYX1Fl5tlhGGZvCBm+ljEXUgk4KHQusVRYjsG7caksTUBw6eCIxXkCStMhCivKxC6wIYDNFcsFjSZc6vVdj4nFWwLdtBDjvJCDNqwmsn7uwKA4D2GNxnoep4EDKgSk8gAmXiWd1/KsU+UrH2S1W9ZVK5llSIKWzY9kyo1Mk9jauNUGECkTxr/IIJI4/aOxkZIvZyTlubiGAtUEIcZrGo/klyajX0Na+O08CWAtkfexDDU686jCgZ0IuPvOPkHDgVh4A3U+7ty4JlYrXx59zVnIs0eYVafRIC6y4thJaiOVW8f+TWsJwmou9jzYCCPuZoiuSFdCs4YgV7dl9EIA681P1/3sVeyFdIceWdQHATEnA2vdMGSrOyre7rSF5R4quXWkRWPEI/Jo4fpX4X5fhfAnPuMNt7zI4T8C59G0EIPux3Y4TxhPFClWFkOS8SwLw56YIQJKnEgYoD+pazhMA5k8AnITTipu2Wqy8WUhGPTcJLSEPEVgigfg+KZiK/+OcwUGcK5iENgKgTHtbibJhvL1UQvPOcgCcg+iosxo/49GqvSbkJQDg1gTg+gJYuBtcTV3ai8MIVevetvcjK0pxtnyeUvRQYShOpFx2GwLgpOEVeyarU41nXvUVi5zKg9gyIec7ZiEA3eiUVnSXT/Gfb/h17AspSXgFAHdCAKzE2+I2xwpO7mgo3RWHLdbsOnbvxxJZTDJkoccUxiQOfZKPKhURCXAX3r4mjjYC0LkGq7SJyobrHiyPpVOR1yBNUNuJs319oz6ArHwf7yeQTb1KIUlUdv2vdNkVAO6MALjMp1twd12MbBXpQsZNtfbadlzV+VZTCF8ZcGOkLGyIiV0ykiyji9PLN6o770Bc+kkE4LwA33AT5xcOQ5tztaJIZVPvg58deWs9IwEEL8QmObd5/INU12I6JGoujQLAXAmAQJZGdeTVfkMgpfziHvt3BxoU0pMLJwvTbrHNjF+k5qeuQR3PTyIA77lIbF+7irN+oklHdd3pSgE1KPWECGYggGPak++fGG9Z3m0Kd0LsH5qlAGAi/C8CGRfzNuOQxeaXcjYpe58qHaaU177809CsQvX7aV5msbH2wD3rPJDRatzmKx6DHS8KJybtZ5rvuHCg6MkLOjK/zDntT4JJKdSFUO586Dwn9fM/DYnTy2lzIgAALAjCy0HpEAEAgEUmAA5v+nk9RAEAYEHhqh1SUSlO2tqyAQBYIMRJx/i3CgAAWGwCkN8bOILyAwAAAAAAAAAA1PA/vFyuZA1j3XwAAAAASUVORK5CYII=",(a=new Image).src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIAAAAAQCAYAAADeWHeIAAAD30lEQVRo3u1YW0hUQRi2C4UV0RWCLtBDUVBRPQRFRD1UUBSBiWRhUlBUqHvOqu26c3aqPTNnTSWkwJTIyK5GWQ/dCJKgC0RGBBVdoQtFpEZRdHnIvn/OrnvUVdKXBGdgOGdm/rmc+b75/n9OSopOOumk039PuUExyx9yFsdzASue0pvXa1riqhmKTPTW+S3BTGZnazR7tqGXTSZempasp2ww8RF117ZzPqw3rtdg8ofJ5dS2deKEYYldGs0eEgCburN1Mw0jFURo8FtOWBOgDxJAbaglbJDgpGpn9ibDkm9g90epBDY/n+8dR1KcXls7gGx8lr0KKrIvAYhdgJxF7QCnBON9NZn8gnmclpaWfsreEodRfw/5fqxPFmzeYpzfeJ4LBJyR7vxyNdWj7y/MX6OeSQjgfod4SuuEzSWDl41CuYzGbf3WsNiB9oBGvQsCcM4HYeNu+5iM+EORRdj8JoNH51E93iMA7BneB4IUr/ItOd8dQ55B2/cczoe7oInn8NMLMXYRxr5p8tIxOTw6AX0f+5hYC3XZgvdGg+2ZqexhS66H4pEtnA/B+yn0OxAMirGw+4ZyJhGHnoqISQkgG4wie3we5yPIhaGuAoBvw1rueNTjkWE5aRr1LmIA5Pe0abETVEmnyEOO/ih/IuBhsx+ghwyjLBXvr1F/zAzLjBjQje7pl0/IJh5ggjTVGP8QEYDm8gBYQSTy2PmQX2C8dXGF6I4L8IXkMlpTICBHk2Lk8ugk6qNUCOvVqHdQAFEZ33yTi2mJNnkW2WxrLx9ic9eYlr0cIN0giSZgAepKtJ0GaOuJDDElaCKZ95CrHva72xOA5lGAe+3C8rwRFlsB4JXuEsBkzhx8V7PrzmQd2v0oFyIf0Yj/QwzgAaYUm3c0XqabAUmyPyhm5JSXD1buAXJNJFBlS74DMWpICWJjPzCYk9l+3A4EYKIc5aokAd8KUieSfyrTE+WfnRDATvh6mUFy7xLASVOKxsQtUgaNeDcIQP8EAO5nOj1KVi1xkYK/RLCI04UAj/x2jDDH6YQmAjg7m3w7+m6MKUadGXbS2xOgkEWnxwJF5S4wRjG5GJJrijXIRaB9Cdqr0K8lKQEwD8i2QamT69Ly3VsNjSGa0f6BYheNeMdTVky+trP2vCJ7tjrVTF4nmfX7S4YmCIDTZYmoh0xLYXew7Y3CSUO/CyTlCADzKDZof2tQfpvbc9U8ygWIKMUgSi1CkclELCKeERKb6YaQ7EeQCizhymidBD7FKx6iVhOhNNp9luTirsmjC/RO9LGkglr8z6BrbTyO0KkPJXVdhTuIxyQ66dRr0l+bhK3bGIpz1QAAAABJRU5ErkJggg==",(h=new Image).src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAABABAMAAACekdKMAAAAMFBMVEUAAAByfYZyfYZyfYZyfYZyfYZyfYZyfYZyfYZyfYZyfYZyfYZyfYZyfYZyfYZyfYYgo7vbAAAAD3RSTlMAdxHdu4hmVZnuRMwzqiLYE4y2AAAF2klEQVR42u2Yv28jaRnHP/bG8SVxvA4ncRw6sCVoVlc4R8FJCOHlGkq7olrJy18QFzRUWSqkE1KibZAQOkc6Ua+5htJGW12BEihpHAqKE0XWcZzEcXIfinf8a8zunsTNoZPmW80zfsbvzGfmfX5BqlSpUqVKlSpVqlSpUqVKlSrV/1EHPv4SfN7wMgWQAkgBpABSAF+2HngOsG8PyDpsWwHy3gJU/UHM3o0uyxw4/G44zJf1LQC8INP3ugXAejOcrqn6EIf80puiQwDqHgF8S987nfsAcN+HfEd/M/v34TtwT9WLBABsewXQtAHkHfVtATlHAUsjboer1lX9O8BmV/V9AIf5tnpRATZrqj9aBLBmHMCe6l0lDmD3V6ofABS6YaHkAOTDo7XtADmvwjNuOAlYWnE7XNVXdXgKlFW1BDjcU7UzP/14AUA/DmA7+PwkDuCHqmHFvWih5ABknQAFvQW2fFq1AxxrD+iOK3E72o8+ItP2E8joz8jXHQDqnyj0vYRN/ZBMzdvZ/lYfwRKAA0c93nZSWYoB93VS4q/6GPL6WzJtOwkGwboVyOkAqHqy5jnQ1BJkvSNuE7bC74F/O4BjB0BGj0DvgJwTWHMAvOvFAoAblgHkHR9BsWspDuAEaNqBz7wB3nWQIICyLdiyPQH2LWW8ArpjO5B3QNwGoGYLKDquUA9hoekuhDvPaoWqh0BRK3MApRiAeyH8nPk0BuAuBNxzOIgWGiYI4NgGHLtnBZqeFhxBwUvPIefnxO0QNy6i3NUqGHbFPW9ATwG69jgL+aIbvvQAgBiA/bDr3/AqBuBzgC1vKUYL9e0lB+CeHShPNixBdwK1CWTstAewZWfVBnLRl7BvKUoPZBxNn5G6R+H9wS92Tl8OoGkp4BzEALwAWPOGTLRQ2VJyAHLeQnew7UOyjqBpjy1L/Quo2li1o5cD8M+d1lb4jCk4WQKw5qS3XOSsAujaAyjuvPUyANvRQs98khyAvAOK3uY9D+XOviXO7O1bCdVR3AY2wusNh2FXoEsACjr59msAhBprpRJcABCSn+pJcgCy7TsydrLtS3IewgNPKE944GOaY1bt+S0uHdY8XQTAx+rwnVcCiNxfAeD+DMDDBHuB/pg1G/Tv2PIEtj2kPmLbE7p3rNpfEABvq/756wCgbK9qj71xpWoLMt5mvWXdp1mvWLW/KAD+0jfkxf8FwIuvoBs8s7Q3hKqtfStQdLDuLlmv8p6zagMb8/uahYNYDAhBsub1K2PA6wAsBJsEAWx50h/Btk+aE4Du3bYN6F/nQtaL2/MsAGx5E2WB4SoAMtp7bRZ4BYBpjkkWQM6P2jew7mF7ANAcf+YR7I03Qp6O2/M64JmNeR1wvQRgZyc6LC0DyK7WAZuOXgYg5/VXAKDgtYeQdRBe7LEHY6BqObyhuD2vBMuW5pXg1RKAWvAtxwFMc99CJZh5eSGUj2rLhCdCbX0C1MehfN3Qa2DN9pD/Zs96gWzNWS9QDr3ADMCBT0KLUILmIoCurdB9znqB73k+9YkDoBYx+gByyQHoayt08I0wIomif/R1L9vPhz3Y9w/A9x1Nu8H1qBucATj2Eii07UHZxhxA2Q7wqaEb7EG2bmPq83zYWwawHxqj5rAXiu1ktB8+42rgQF6fhqbuilW7HnpzH5Gp2ZnOA/qOWAKQ039QLHsHPPN3VKY/nnlxxB91Ng9408nMp25nGUBO3yO4bDpuZZMBUA2Y16LtnA3Zm7pPWbVrvphNhCaV+einsQyAg3D6E8I8b3f6Yyac7y5MhOY+NV8sA6A5d6npMKk8eBluLSr0umE/lsNzx+y6u7OZYIPZ8O99YgDW2xptokJ7AUAA9uOD+UxwwafubgxAvjZz+TQxAJlQbhSn445yCNRn06y3ZD8fHkVT4YtvzKfC3yQOgExT/xa6nX9pYwag+Kb+nOZsKvzTBZ/nw6MYAPJl/XW4sJlcFEiVKlWqVKlSpUqVKlWqVKlSpUqV6uuu/wDv59f7eYDABQAAAABJRU5ErkJggg==",(c=new Image).src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAAgCAYAAAD9qabkAAAHF0lEQVR42u1aLXBcVRSuwCAQCAwCgcBUVCBiKhAVGEREBQYRUVFmyP40kzC7m83A+0lngkAgEDURFRE1iIgIDKIiIiYCERETERERE1FRzrn3nPfOve/uJm93szDD983stHnv3f9zvvN3HzwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/pfojvLj3qh43x+VX2I+NTqj7BueB83nD0gJAAIAAQAACAAEAMyN/qh4zpvbGxa/x+96o/zQbfywfGSfb4xffuqf53/Tvxf8f34W9bvi+t0u3jT6pbF8++y7edrTu28nrYv7646KV9p/d1jc0Hxfx2thbG2VH/dG5W5vmJ+5fkXYWPCae+LeX/yY5590/Twu9Rm1ycbj8QeNvof5r7SX57bv7qD42uzzlb6zP96fesz8iudOa/9L9n5/q+R5+3epPaDnbj2dcfl58Jz2rSv9yN6cUn99nftt85lAFjtCFs+6o3KV+ntbt82PUiSysfHyI7vvfEa9YXmgZ0TP11Pz4HVBcxeEWpmL0/hw6Nk7EdidUIDKp5408t9qZSyfhsJHB+vbXnNfgbA4gSveubHnbJ8U/HHxRaWYRCA8fyYDbsNC1h+UX+m3P4x3P6sUn5TCCTKvS5VgWAxiAhAyYfI7EcHfM0SwFym/kEp+aOZxo8oi69mUfi6UjN23qgiqHDxGtZ5ydRYC8GTk2jAh7flx3FocMTEJ3DafaQQge3Lt1umeiRHhczTn5Qm0Hjc+o97g58dsBGR+r9XgyPmsQ3PvwdWzB6RKLiRwkrTgZMXUPYs9CFVSf8DlasJ7eGvdu1nbT1sPWZO1wJUcl09UkIy1O0qRnCMGsdqhtRYrRCSRIB0n6Np3n6yq7GGwNiYgVVzrMUxyuXXMTiT4bQmg2ms6TyanatzuLx9W+2CsfJsQwBDAZWf408PwLFWBi81avvIDS4Lx3liDhBDg/gkgi62wc8VImL01DK2IU05meRIc8RRuggMb7j5Ua+gZPd9veA/b3rLO2z4R0qyIsBxPUIojFWrnUotLGbvuAQkawavcYVp7om9HGEwe8u1eyovQ/aV3R98b0r2NABqhS0sCUGucDG3I4sZrnY0Ayt3mWrM133fxKiLL5Blp+MByAAJYTh5gRSzmgVoEr/zlgTIyWzNrgW1sXgmWHBgrp/5N//5pLV0d/9fu5LztAyuvcSO5uhPDg8HuY3ZB9VsVzHSM6q36bcqYVLhaqa5vc6GXQQBdCWus9Q+8ANoXO/YsBBB7Ul6hXa7nvRJ5TQj5sXf9wx97KP59tgoCWAJYuSTeuwhcRbKA1TuKj61VtK6bJhKrmJYPViy6vnsxKJ+o96DjLKr9XQVxlm81F8DK1pYA3BgUPmisGyS6xnVYsTwPYPLc560CtCEAEy5M/Wk4AgJYRhggcRpb3b4kqjT5Jn8HSbsgXyAuHQv2poud3WFl/E7/5lCi8h6imHje9lGGe3BXAjDfZpP3xSfs1OVvSwA2rGEy85UI32fspdy7ByA5lX+bAO6y7ygDLhlq2cUtvrCbzdbXCyy7bk6oThKK4iyzutVWaHzpKj+vBMEk9RbVvlmh8OFMU1CpREVCykqRivFjpRVFPZstBNh9zL/4O0kwXtmwZxYC0BClBQGcxmPaioXPsGdr908AckaUjwEB/Edgyn4XquxhiMB16KpskzWFzZftfPv8PHDxq2w4lXGMZ7HI9mF5iS1sfsX/j0OdSglIKbwC8bpo3eSFNJNXPgFqS3utCEBKgCkF8rkN6ssQhCa/7koANq6PS6K6tigE2Jt4fnQ3wCrptPnMSwD1GXHfxUqKIINcBIVLIIBleAEilKkaOx+eCmLq0OrSVrNE5qxtfYnjMJmInLG9qyFHtf3KxSQB1sSb1PsP4v7ri1D52YuxzzM4AdXKCJGRTZq1JID16sIUJQQ12eZDAUe2l5bMyNN5477f9gnXulQ5hQDqGvm+ztNXOOqLODofXpfz7nhsmpuO7ZWfiJCSleGdgfR8UnvehgDcs+1iU8uGQfXJeQeumlLtja3W8BpSFRtgIXkAORRJ+KXcMBag1AE468qVA5OwS8eTxfNJichZ2pubfpvR91kyuUTKH8+fw44qLrdJKBqzcYuubRLQZf997B3dZjuPiZTXHXwrdf9pYwYXmYJ10qUm8djsfLhGb5OSM86nsedtCUBJILXvqblUHtOUkAeYEyxMfIBJBfSlwZ2p10HpHX+TIgh24/id1sgX1V6EdDNV2hJX8pneHksl58LQwY/Pv5SXUyn0hAQjj8Hv4rl4Jc3WqlIXVQYmWTGnoPKdKd/tTEtquhIeWc6qjCbeho6Z2psO75uOQ+TeZj6pPWdvwO2b8Qrqcy0f6e3F2/a9k5C9ao2yHhueAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA3Cv+AbbV0PbhRsAiAAAAAElFTkSuQmCC",(l=new Image).src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIAAAAAQCAYAAADeWHeIAAAEfElEQVRo3u1XWYgcRRiOiQohnlGMxFs0IopG8HpQ44WiohhNFI8HBROPuDvd0052J101te50Vc+a7INgYBcERRLFVaKCeEYlICFREqOCiQ+iEAkKEiHgg3is31dd1dNOMrtBfMhA/9B0Vf9HVf3HV3/PmFFSSSWVVFJJJZVUUk5VafbU1Mj8Q8FOKPTL1Ya5ryccF65KTolkujx3QCPte0KpozgOYnNTKE3AN+d9Sh1TbegVXpZ6oUwWT8WP1OqT/FwpdWQYm4erwshImsvyNZVZEAozgLWeHBw0J1jdOL02lHoR5cGrByo929k4PBTpg+ANkW/1hYkx3ofgralrPY/zQOqrscZjQZzeWI2bV7WDg3XC0dlZsJObaScS+q7JycnDOu14nYpKz2RAM3/ooaK9mhg5lza5Fv0GuQeg/xVsvY5vVxzyCcCgYMM/8f2UeuZkHOYvOGRJ5iD9YSB0yHeWHOZe8P/or+t5Tm8PAzUVn+92del34cCEjgdvmw2Aal0OnZ1MJDrRjtXoXBtgob/lXsKGfrQq9PcuSGOQec7bAP+eKG5eA/lfQpnezSDwDJgPByq5tCrTFgNU2MPewcH0eH7Dft/E/AbYeQVz3WknT+QsGffCFxWsfwfPFSpzTkUlCzH+IpDJ7bCzEgm8CWe/CLY2Qq7Zp1qn9gZ8CrPBBrKhH8eBnsez3gZQ6O+Wj48fgYP9EEWr5+D7q+SHsV7GKgB/YunExKyp+H6NlaJ1PoObV6JqXWnRAM6viuShwl7GuA9X4cOF779WlDoO395ipTJAgRi+wCNJEboxnmwHvFsC6J/r9azKOadctysgSwCzKd+7NG/gbHfCxkuwZ8i3/hMsiOYZPXUFZM5NH2FlwlHvrVBqPg61Awe6Hgd9wd1p6wDnt+GAWwnFkHuHQfCBm46fOU0vgnM/OUDyfQzedQWIrtOpLgGG9gsc0CEQ5mkGBLIfsBL/SwLg/ffB9gAZyrX3juBuAEos5t5h50W/Vz68OnouASz0S/M1D+QCOopnM/qBpTm0S72dMOn4m+GQz/tdBU3H970G7O8morhA38rrhXAeiqRWrC7o398tAaCztlYbOdqtE0F/3AXuxwMlQCR1wyNJhlZ6n00kqXdFdX1hvjcEstPOtAkgzRjsi3Yvs+ZE11us76kEcAffxnvMjgHfcOzvAwOtY3OIFPpP3td50yX0Fq87FZ+NIGy/5lBgCGt8BNsp707b/Fnnmx3Qf5aVg+dt2+h1SYDMtvmUQYXel0Qe36/Y6ytunvYvBBDpJewfLMJZ6Da/0U4kW7cQ6YAmTaz5Ge/9/ewIvZt3ercE6Fet0yH/DeTW2kfq95lkbo8b2Yj2TAKgmz2PjnGN4czODpZzNmHZ/T06l/IHw7dV6zr4rJqaZ9kEc504iahAfTq72HnzyZ0OHSaG5zEo/o/B2kUPYu/qMJzNd3FvRCJ+Y0Kz9/B2bCIwuK5yO+3gb+NiyrL3qKxKFuYyQA6v4/fORCs01jO5DpG1/EEvqaSSSiqppJL+D/oHA2Vc/OAUKTgAAAAASUVORK5CYII=",this.loaderlogos={logo:s,powered:[n,o,a],website:[h,c,l]}),this.next_uid=w[21],this.objectRefTable=cr.getObjectRefTable(),this.system=new cr.system_object(this),u=0,p=w[2].length;u<p;u++)d=w[2][u],m=this.GetObjectReference(d[0]),cr.add_common_aces(d,m.prototype),(v=new m(this)).singleglobal=d[1],v.is_world=d[2],v.is_rotatable=d[5],v.must_predraw=d[9],v.onCreate&&v.onCreate(),cr.seal(v),this.plugins.push(v);for(this.objectRefTable=cr.getObjectRefTable(),u=0,p=w[3].length;u<p;u++){for(d=w[3][u],b=this.GetObjectReference(d[1]),v=null,N=0,D=this.plugins.length;N<D;N++)if(this.plugins[N]instanceof b){v=this.plugins[N];break}var x,T=new v.Type(v);for(T.name=d[0],T.is_family=d[2],T.instvar_sids=d[3].slice(0),T.vars_count=d[3].length,T.behs_count=d[4],T.fx_count=d[5],T.sid=d[11],T.is_family?(T.members=[],T.family_index=this.family_count++,T.families=null):(T.members=null,T.family_index=-1,T.families=[]),T.family_var_map=null,T.family_beh_map=null,T.family_fx_map=null,T.is_contained=!1,T.container=null,d[6]?(T.texture_file=d[6][0],T.texture_filesize=d[6][1],T.texture_pixelformat=d[6][2],T.texture_data=d[6]):(T.texture_file=null,T.texture_filesize=0,T.texture_pixelformat=0,T.texture_data=null),d[7]?T.animations=d[7]:T.animations=null,T.index=u,T.instances=[],T.deadCache=[],T.solstack=[new cr.selection(T)],T.cur_sol=0,T.default_instance=null,T.default_layerindex=0,T.stale_iids=!0,T.updateIIDs=cr.type_updateIIDs,T.getFirstPicked=cr.type_getFirstPicked,T.getPairedInstance=cr.type_getPairedInstance,T.getCurrentSol=cr.type_getCurrentSol,T.pushCleanSol=cr.type_pushCleanSol,T.pushCopySol=cr.type_pushCopySol,T.popSol=cr.type_popSol,T.getBehaviorByName=cr.type_getBehaviorByName,T.getBehaviorIndexByName=cr.type_getBehaviorIndexByName,T.getEffectIndexByName=cr.type_getEffectIndexByName,T.applySolToContainer=cr.type_applySolToContainer,T.getInstanceByIID=cr.type_getInstanceByIID,T.collision_grid=new cr.SparseGrid(this.original_width,this.original_height),T.any_cell_changed=!0,T.any_instance_parallaxed=!1,T.extra={},T.toString=cr.type_toString,T.behaviors=[],N=0,D=d[8].length;N<D;N++){g=d[8][N];for(var M=this.GetObjectReference(g[1]),S=null,A=0,C=this.behaviors.length;A<C;A++)if(this.behaviors[A]instanceof M){S=this.behaviors[A];break}S||((S=new M(this)).my_types=[],S.my_instances=new cr.ObjectSet,S.onCreate&&S.onCreate(),cr.seal(S),this.behaviors.push(S),cr.behaviors.solid&&S instanceof cr.behaviors.solid&&(this.solidBehavior=S),cr.behaviors.jumpthru&&S instanceof cr.behaviors.jumpthru&&(this.jumpthruBehavior=S),cr.behaviors.shadowcaster&&S instanceof cr.behaviors.shadowcaster&&(this.shadowcasterBehavior=S)),-1===S.my_types.indexOf(T)&&S.my_types.push(T);var L=new S.Type(S,T);L.name=g[0],L.sid=g[2],L.onCreate(),cr.seal(L),T.behaviors.push(L)}for(T.global=d[9],T.isOnLoaderLayout=d[10],T.effect_types=[],N=0,D=d[12].length;N<D;N++)T.effect_types.push({id:d[12][N][0],name:d[12][N][1],shaderindex:-1,preservesOpaqueness:!1,active:!0,index:N});T.tile_poly_data=d[13],this.uses_loader_layout&&!T.is_family&&!T.isOnLoaderLayout&&v.is_world||(T.onCreate(),cr.seal(T)),T.name&&(this.types[T.name]=T,this.types_lowercase[T.name.toLowerCase()]=T),this.types_by_index.push(T),v.singleglobal&&((x=new v.Instance(T)).uid=this.next_uid++,x.puid=this.next_puid++,x.iid=0,x.get_iid=cr.inst_get_iid,x.toString=cr.inst_toString,x.properties=d[14],x.onCreate(),cr.seal(x),T.instances.push(x),this.objectsByUid[x.uid.toString()]=x)}for(u=0,p=w[4].length;u<p;u++)for(var E,O=w[4][u],I=this.types_by_index[O[0]],N=1,D=O.length;N<D;N++)(E=this.types_by_index[O[N]]).families.push(I),I.members.push(E);for(u=0,p=w[27].length;u<p;u++){var k=w[27][u],P=[];for(N=0,D=k.length;N<D;N++)P.push(this.types_by_index[k[N]]);for(N=0,D=P.length;N<D;N++)P[N].is_contained=!0,P[N].container=P}if(0<this.family_count)for(u=0,p=this.types_by_index.length;u<p;u++)if(!(f=this.types_by_index[u]).is_family&&f.families.length){f.family_var_map=new Array(this.family_count),f.family_beh_map=new Array(this.family_count),f.family_fx_map=new Array(this.family_count);var j=[],B=0,R=0,z=0;for(N=0,D=f.families.length;N<D;N++)for(y=f.families[N],f.family_var_map[y.family_index]=B,B+=y.vars_count,f.family_beh_map[y.family_index]=R,R+=y.behs_count,f.family_fx_map[y.family_index]=z,z+=y.fx_count,A=0,C=y.effect_types.length;A<C;A++)j.push(cr.shallowCopy({},y.effect_types[A]));for(f.effect_types=j.concat(f.effect_types),N=0,D=f.effect_types.length;N<D;N++)f.effect_types[N].index=N}for(u=0,p=w[5].length;u<p;u++){d=w[5][u];var F=new cr.layout(this,d);cr.seal(F),this.layouts[F.name]=F,this.layouts_by_index.push(F)}for(u=0,p=w[6].length;u<p;u++){d=w[6][u];var U=new cr.eventsheet(this,d);cr.seal(U),this.eventsheets[U.name]=U,this.eventsheets_by_index.push(U)}for(u=0,p=this.eventsheets_by_index.length;u<p;u++)this.eventsheets_by_index[u].postInit();for(u=0,p=this.eventsheets_by_index.length;u<p;u++)this.eventsheets_by_index[u].updateDeepIncludes();for(u=0,p=this.triggers_to_postinit.length;u<p;u++)this.triggers_to_postinit[u].postInit();for(cr.clearArray(this.triggers_to_postinit),this.audio_files_info=w[7],this.audio_files_map={},u=0,p=this.audio_files_info.length;u<p;++u)_=this.audio_files_info[u],this.audio_files_map[_[0]]=_[1];this.files_subfolder=w[8],this.pixel_rounding=w[9],this.aspect_scale=1,this.enableWebGL=w[13],this.linearSampling=w[14],this.clearBackground=w[15],this.versionstr=w[16],this.useHighDpi=w[17],this.orientations=w[20],this.autoLockOrientation=0<this.orientations,this.pauseOnBlur=w[22],this.wantFullscreenScalingQuality=w[23],this.fullscreenScalingQuality=this.wantFullscreenScalingQuality,this.downscalingQuality=w[24],this.preloadSounds=w[25],this.enableFrontToBack=w[26]&&!this.isIE,this.enhancedAccelerationPrecision=w[30],this.start_time=Date.now(),cr.clearArray(this.objectRefTable),this.preloadSounds||Y["audio/webm; codecs=opus"]||!window.OpusDecoder||window.OpusDecoder.Initialise(),this.initRendererAndLoader()});e.prototype.waitForImageLoad=function(e,i){window.cr_remotePreviewImageFiles&&i&&"blob:"!==i.substr(0,5)&&(i=window.cr_remotePreviewImageFiles[i]),e.onerror=function(t){e.c2error=!0,b=!0,console&&console.error&&console.error("Error loading image '"+e.src+"': ",t)},e.src||("undefined"!=typeof XAPKReader?XAPKReader.get(i,function(t){e.src=t},function(t){e.c2error=!0,b=!0,console&&console.error&&console.error("Error extracting image '"+i+"' from expansion file: ",t)}):(e.crossOrigin="anonymous",this.setImageSrc(e,i))),this.wait_for_textures.push(e)};var h=0,c=!(e.prototype.findWaitingTexture=function(t){for(var e=0,i=this.wait_for_textures.length;e<i;e++)if(this.wait_for_textures[e].cr_src===t)return this.wait_for_textures[e];return null});e.prototype.getready=function(){if(this.audioInstance&&this.preloadSounds){for(var t,e,i,r,s=[],n=0,o=this.audio_files_info.length;n<o;++n)e=(t=this.audio_files_info[n])[0],r=t[2],(i=this.getPreferredAudioFile(e))&&!r&&s.push({filename:e+i[1],size:i[2],type:i[0]});h=this.audioInstance.setPreloadList(s)}};var w=!(e.prototype.areAllTexturesAndSoundsLoaded=function(){for(var t,e=h,i=0,r=0,s=!0,n=0,o=this.wait_for_textures.length;n<o;n++){var a=(t=this.wait_for_textures[n]).cr_filesize;(!a||a<=0)&&(a=5e4),e+=a,t.src&&t.complete&&!t.c2error?i+=a:s=!1}return s&&this.preloadSounds&&this.audioInstance&&(c||(this.audioInstance.startPreloads(),c=!0),i+=r=this.audioInstance.getPreloadedSize(),r<h&&(s=!1)),this.progress=0==e?1:i/e,s}),m=-1,_=!0,x=!(e.prototype.go=function(){if(this.ctx||this.glwrap){var t,e,i=this.ctx||this.overlay_ctx;0<this.fullscreen_mode&&(t=window.innerWidth,e=window.innerHeight,this.lastWindowWidth===t&&this.lastWindowHeight===e||this.setSize(t,e)),this.progress=0,this.last_progress=-1;var r=this;if(this.areAllTexturesAndSoundsLoaded()&&(4!==this.loaderstyle||w))this.useFbInstant?FBInstant.startGameAsync().then(function(){r.go_loading_finished()}):this.go_loading_finished();else{this.useFbInstant&&FBInstant.setLoadingProgress(100*this.progress);var s=Date.now()-this.start_time;if(i){var n=this.width,o=this.height,a=this.devicePixelRatio;if(this.loaderstyle<3&&500<=s&&this.last_progress!=this.progress){i.clearRect(0,0,n,o);var h,c,l,u,p,d=n/2,g=o/2,f=0===this.loaderstyle&&this.loaderlogos.logo&&this.loaderlogos.logo.complete,y=40*a,m=0,_=80*a;f&&(y=(_=(h=this.loaderlogos.logo).width*a)/2,m=(c=h.height*a)/2,i.drawImage(h,cr.floor(d-y),cr.floor(g-m),_,c)),this.loaderstyle<=1?(g+=m+(f?12*a:0),d-=y,d=cr.floor(d)+.5,g=cr.floor(g)+.5,i.fillStyle=b?"red":"DodgerBlue",i.fillRect(d,g,Math.floor(_*this.progress),6*a),i.strokeStyle="black",i.strokeRect(d,g,_,6*a),i.strokeStyle="white",i.strokeRect(d-a,g-a,_+2*a,8*a)):2===this.loaderstyle&&(i.font="12pt Arial",i.fillStyle=b?"#f00":"#999",i.textBaseLine="middle",l=Math.round(100*this.progress)+"%",p=(u=i.measureText?i.measureText(l):null)?u.width:0,i.fillText(l,d-p/2,g)),this.last_progress=this.progress}else if(4===this.loaderstyle)return this.draw_c3_splash_loader(i),void(v?v(function(){r.go()}):setTimeout(function(){r.go()},16))}setTimeout(function(){r.go()},100)}}}),T=0,M=0,S=null,A=null,C=0;function L(t,e){return e<=128?t[2]:e<=256?t[1]:t[0]}e.prototype.draw_c3_splash_loader=function(t){if(!w){var e=this.isPreview||this.useFbInstant,i=e?0:200,r=e?0:3e3,s=Math.ceil(this.width),n=Math.ceil(this.height),o=(this.devicePixelRatio,this.loaderlogos.logo),a=this.loaderlogos.powered,h=this.loaderlogos.website;if(o.complete){for(var c=0;c<3;++c)if(!a[c].complete||!h[c].complete)return;0===C&&(m=Date.now());var l,u,p,d,g=Date.now(),f=!1,y=t;_||x?(t.clearRect(0,0,s,n),p=s,d=n,S&&S.width===p&&S.height===d||((S=document.createElement("canvas")).width=p,S.height=d,A=S.getContext("2d")),y=A,f=!0,_&&1===C&&(m=Date.now())):t.globalAlpha=1,y.fillStyle="#3B4045",y.fillRect(0,0,s,n);try{256<this.cssHeight?(u=(l=1.5*cr.clamp(.22*n,105,.6*s))/8,y.drawImage(L(a,l),.5*s-l/2,.2*n-u/2,l,u),u=l=Math.min(.395*n,.95*s),y.drawImage(o,.5*s-l/2,.485*n-u/2,l,u),u=(l=1.5*cr.clamp(.22*n,105,.6*s))/8,y.drawImage(L(h,l),.5*s-l/2,.868*n-u/2,l,u),y.fillStyle="#4D565D",l=s,u=Math.max(.005*n,2),y.fillRect(0,.8*n-u/2,l,u),y.fillStyle=b?"red":"#29F3D0",l=s*this.progress,y.fillRect(.5*s-l/2,.8*n-u/2,l,u)):(u=l=.55*n,y.drawImage(o,.5*s-l/2,.45*n-u/2,l,u),y.fillStyle="#4D565D",l=s,u=Math.max(.005*n,2),y.fillRect(0,.85*n-u/2,l,u),y.fillStyle=b?"red":"#29F3D0",l=s*this.progress,y.fillRect(.5*s-l/2,.85*n-u/2,l,u)),f&&(_?t.globalAlpha=0===C?0:Math.min((g-m)/300,1):x&&(t.globalAlpha=Math.max(1-(g-M)/300,0)),t.drawImage(S,0,0,s,n))}catch(t){}_&&300<=g-m&&2<=C&&(_=!1,T=g),!_&&r<=g-T&&!x&&1<=this.progress&&(x=!0,M=g),(x&&300+i<=g-M||e&&1<=this.progress&&Date.now()-m<500)&&(x=_=!(w=!0),A=S=null,this.loaderlogos=null),++C}}},e.prototype.go_loading_finished=function(){var t;this.webFontNames.length&&document.fonts&&document.fonts.load?(t=this,Promise.all(this.webFontNames.map(function(t){return document.fonts.load("1em '"+t+"'")})).then(function(){t.start_first_layout()})):this.start_first_layout()},e.prototype.start_first_layout=function(){var t,e,i,r,s;if(this.overlay_canvas&&(this.canvas.parentNode.removeChild(this.overlay_canvas),this.overlay_ctx=null,this.overlay_canvas=null),this.start_time=Date.now(),this.last_fps_time=cr.performance_now(),this.uses_loader_layout)for(t=0,e=this.types_by_index.length;t<e;t++)(i=this.types_by_index[t]).is_family||i.isOnLoaderLayout||!i.plugin.is_world||(i.onCreate(),cr.seal(i));else this.isloading=!1;for(t=0,e=this.layouts_by_index.length;t<e;t++)this.layouts_by_index[t].createGlobalNonWorlds();for(2<=this.fullscreen_mode&&(r=this.original_width/this.original_height,s=this.width/this.height,2!==this.fullscreen_mode&&r<s||2===this.fullscreen_mode&&s<r?this.aspect_scale=this.height/this.original_height:this.aspect_scale=this.width/this.original_width),t=0,e=this.types_by_index.length;t<e;t++)(i=this.types_by_index[t]).onBeforeAppBegin&&i.onBeforeAppBegin();for(this.first_layout?this.layouts[this.first_layout].startRunning():this.layouts_by_index[0].startRunning(),this.uses_loader_layout||(this.loadingprogress=1,this.trigger(cr.system_object.prototype.cnds.OnLoadFinished,null),window.C3_RegisterSW&&window.C3_RegisterSW()),navigator.splashscreen&&navigator.splashscreen.hide&&navigator.splashscreen.hide(),t=0,e=this.types_by_index.length;t<e;t++)(i=this.types_by_index[t]).onAppBegin&&i.onAppBegin();function n(){document.hidden||document.webkitHidden||document.mozHidden||document.msHidden?window.cr_setSuspended(!0):window.cr_setSuspended(!1)}document.addEventListener("visibilitychange",n,!1),document.addEventListener("mozvisibilitychange",n,!1),document.addEventListener("webkitvisibilitychange",n,!1),document.addEventListener("msvisibilitychange",n,!1),this.isCordova&&(document.addEventListener("pause",function(){window.cr_setSuspended(!0)}),document.addEventListener("resume",function(){window.cr_setSuspended(!1)})),document.hidden||document.webkitHidden||document.mozHidden||document.msHidden?window.cr_setSuspended(!0):this.tick(!1)},e.prototype.tick=function(t,e,i){var r,s,n,o,a,h,c,l;this.running_layout&&(s=r=cr.performance_now(),!i&&this.isSuspended&&!t||(t||(v?this.raf_id=v(this.tickFunc):this.timeout_id=setTimeout(this.tickFunc,this.isMobile?1:16)),n=e||r,o=this.fullscreen_mode,(a=(document.mozFullScreen||document.webkitIsFullScreen||document.fullScreen||!!document.msFullscreenElement)&&!this.isCordova)&&0<this.fullscreen_scaling&&(o=this.fullscreen_scaling),0<o&&(h=window.innerWidth,c=window.innerHeight,this.lastWindowWidth===h&&this.lastWindowHeight===c||this.setSize(h,c)),a?this.firstInFullscreen||(this.firstInFullscreen=!0):this.firstInFullscreen?(this.firstInFullscreen=!1,0===this.fullscreen_mode&&this.setSize(Math.round(this.oldWidth/this.devicePixelRatio),Math.round(this.oldHeight/this.devicePixelRatio),!0)):(this.oldWidth=this.width,this.oldHeight=this.height),this.isloading&&(l=this.areAllTexturesAndSoundsLoaded(),this.loadingprogress=this.progress,l&&(this.isloading=!1,this.progress=1,this.trigger(cr.system_object.prototype.cnds.OnLoadFinished,null),window.C3_RegisterSW&&window.C3_RegisterSW())),this.logic(n),!this.redraw||this.is_WebGL_context_lost||this.suspendDrawing||t||(this.redraw=!1,this.glwrap?this.drawGL():this.draw(),this.snapshotCanvas&&(this.canvas&&this.canvas.toDataURL&&(this.snapshotData=this.canvas.toDataURL(this.snapshotCanvas[0],this.snapshotCanvas[1]),window.cr_onSnapshot&&window.cr_onSnapshot(this.snapshotData),this.trigger(cr.system_object.prototype.cnds.OnCanvasSnapshot,null)),this.snapshotCanvas=null)),this.hit_breakpoint||(this.tickcount++,this.tickcount_nosave++,this.execcount++,this.framecount++),this.logictime+=cr.performance_now()-s))},e.prototype.logic=function(t){var e,i,r,s,n;1e3<=t-this.last_fps_time&&(this.last_fps_time+=1e3,1e3<=t-this.last_fps_time&&(this.last_fps_time=t),this.fps=this.framecount,this.framecount=0,this.cpuutilisation=Math.min(this.logictime,1e3),this.logictime=0,this.glwrap&&0===this.gpuTimeEndFrame&&(this.gpuTimeEndFrame=this.glwrap.getFrameNumber(),this.gpuCurUtilisation=-1)),this.glwrap&&-1===this.gpuCurUtilisation&&this.glwrap.supportsGpuProfiling()&&(this.gpuCurUtilisation=this.glwrap.getFrameRangeTimerResults(this.gpuTimeStartFrame,this.gpuTimeEndFrame),-1!==this.gpuCurUtilisation&&(this.glwrap.deleteTimerResultsToFrame(this.gpuTimeEndFrame),this.gpuLastUtilisation=Math.min(this.gpuCurUtilisation,1),this.gpuTimeStartFrame=this.gpuTimeEndFrame,this.gpuTimeEndFrame=0)),0!==this.last_tick_time&&((n=t-this.last_tick_time)<0&&(n=0),this.dt1=n/1e3,.5<this.dt1?this.dt1=0:this.dt1>1/this.minimumFramerate&&(this.dt1=1/this.minimumFramerate)),this.last_tick_time=t,this.dt=this.dt1*this.timescale,this.kahanTime.add(this.dt),this.wallTime.add(this.dt1);var o,a,h,c=(document.mozFullScreen||document.webkitIsFullScreen||document.fullScreen||!!document.msFullscreenElement)&&!this.isCordova;2<=this.fullscreen_mode||c&&0<this.fullscreen_scaling?(o=this.original_width/this.original_height,a=this.width/this.height,h=this.fullscreen_mode,c&&0<this.fullscreen_scaling&&(h=this.fullscreen_scaling),this.aspect_scale=2!==h&&o<a||2===h&&a<o?this.height/this.original_height:this.width/this.original_width,this.running_layout&&(this.running_layout.scrollToX(this.running_layout.scrollX),this.running_layout.scrollToY(this.running_layout.scrollY))):this.aspect_scale=this.isRetina?this.devicePixelRatio:1,this.ClearDeathRow(),this.isInOnDestroy++,this.system.runWaits(),this.isInOnDestroy--,this.ClearDeathRow(),this.isInOnDestroy++;for(var l=this.objects_to_pretick.valuesRef(),u=0,p=l.length;u<p;u++)l[u].pretick();for(u=0,p=this.types_by_index.length;u<p;u++)if(!(r=this.types_by_index[u]).is_family&&(r.behaviors.length||r.families.length))for(e=0,i=r.instances.length;e<i;e++)for(g=0,f=(d=r.instances[e]).behavior_insts.length;g<f;g++)d.behavior_insts[g].tick();for(u=0,p=this.types_by_index.length;u<p;u++)if(!(r=this.types_by_index[u]).is_family&&(r.behaviors.length||r.families.length))for(e=0,i=r.instances.length;e<i;e++)for(g=0,f=(d=r.instances[e]).behavior_insts.length;g<f;g++)(s=d.behavior_insts[g]).posttick&&s.posttick();for(u=0,p=(l=this.objects_to_tick.valuesRef()).length;u<p;u++)l[u].tick();for(this.isInOnDestroy--,this.handleSaveLoad(),u=0;this.changelayout&&u++<10;)this.doChangeLayout(this.changelayout);for(u=0,p=this.eventsheets_by_index.length;u<p;u++)this.eventsheets_by_index[u].hasRun=!1;for(this.running_layout.event_sheet&&this.running_layout.event_sheet.run(),cr.clearArray(this.registered_collisions),this.layout_first_tick=!1,this.isInOnDestroy++,u=0,p=this.types_by_index.length;u<p;u++)if(!(r=this.types_by_index[u]).is_family&&(r.behaviors.length||r.families.length))for(e=0,i=r.instances.length;e<i;e++)for(var d,g=0,f=(d=r.instances[e]).behavior_insts.length;g<f;g++)(s=d.behavior_insts[g]).tick2&&s.tick2();for(u=0,p=(l=this.objects_to_tick2.valuesRef()).length;u<p;u++)l[u].tick2();this.isInOnDestroy--},e.prototype.onWindowBlur=function(){for(var t,e,i,r,s,n,o,a=0,h=this.types_by_index.length;a<h;a++)if(!(s=this.types_by_index[a]).is_family)for(t=0,e=s.instances.length;t<e;t++)if((n=s.instances[t]).onWindowBlur&&n.onWindowBlur(),n.behavior_insts)for(i=0,r=n.behavior_insts.length;i<r;i++)(o=n.behavior_insts[i]).onWindowBlur&&o.onWindowBlur()},e.prototype.doChangeLayout=function(t){var e,i,r,s=this.running_layout;if(this.running_layout.stopRunning(),this.glwrap)for(e=0,i=this.types_by_index.length;e<i;e++)(r=this.types_by_index[e]).is_family||!r.unloadTextures||r.global&&0!==r.instances.length||-1!==t.initial_types.indexOf(r)||r.unloadTextures();s==t&&cr.clearArray(this.system.waits),cr.clearArray(this.registered_collisions),this.runLayoutChangeMethods(!0),t.startRunning(),this.runLayoutChangeMethods(!1),this.redraw=!0,this.layout_first_tick=!0,this.ClearDeathRow()},e.prototype.runLayoutChangeMethods=function(t){for(var e,i,r,s,n,o,a,h,c=0,l=this.behaviors.length;c<l;c++)e=this.behaviors[c],t?e.onBeforeLayoutChange&&e.onBeforeLayoutChange():e.onLayoutChange&&e.onLayoutChange();for(c=0,l=this.types_by_index.length;c<l;c++)if((i=this.types_by_index[c]).global||i.plugin.singleglobal)for(r=0,s=i.instances.length;r<s;r++)if(n=i.instances[r],t?n.onBeforeLayoutChange&&n.onBeforeLayoutChange():n.onLayoutChange&&n.onLayoutChange(),n.behavior_insts)for(o=0,a=n.behavior_insts.length;o<a;o++)h=n.behavior_insts[o],t?h.onBeforeLayoutChange&&h.onBeforeLayoutChange():h.onLayoutChange&&h.onLayoutChange()},e.prototype.pretickMe=function(t){this.objects_to_pretick.add(t)},e.prototype.unpretickMe=function(t){this.objects_to_pretick.remove(t)},e.prototype.tickMe=function(t){this.objects_to_tick.add(t)},e.prototype.untickMe=function(t){this.objects_to_tick.remove(t)},e.prototype.tick2Me=function(t){this.objects_to_tick2.add(t)},e.prototype.untick2Me=function(t){this.objects_to_tick2.remove(t)},e.prototype.getDt=function(t){return t&&-1!==t.my_timescale?this.dt1*t.my_timescale:this.dt},e.prototype.draw=function(){this.running_layout.draw(this.ctx)},e.prototype.drawGL=function(){this.enableFrontToBack&&(this.earlyz_index=1,this.running_layout.drawGL_earlyZPass(this.glwrap)),this.running_layout.drawGL(this.glwrap),this.glwrap.present()},e.prototype.addDestroyCallback=function(t){t&&this.destroycallbacks.push(t)},e.prototype.removeDestroyCallback=function(t){cr.arrayFindRemove(this.destroycallbacks,t)},e.prototype.getObjectByUID=function(t){var e=t.toString();return this.objectsByUid.hasOwnProperty(e)?this.objectsByUid[e]:null};var d=[];e.prototype.DestroyInstance=function(t){var e,i,r=t.type.name,s=null;if(this.deathRow.hasOwnProperty(r)){if((s=this.deathRow[r]).contains(t))return}else s=d.length?d.pop():new cr.ObjectSet,this.deathRow[r]=s;if(t.isDestroyed=!0,s.add(t),this.hasPendingInstances=!0,t.is_contained)for(e=0,i=t.siblings.length;e<i;e++)this.DestroyInstance(t.siblings[e]);this.isInClearDeathRow&&s.values_cache.push(t),this.isEndingLayout||(this.isInOnDestroy++,this.trigger(Object.getPrototypeOf(t.type.plugin).cnds.OnDestroyed,t),this.isInOnDestroy--)},e.prototype.ClearDeathRow=function(){if(this.hasPendingInstances){var t,e,i,r,s,n;for(this.isInClearDeathRow=!0,i=0,s=this.createRow.length;i<s;++i)for((e=(t=this.createRow[i]).type).instances.push(t),r=0,n=e.families.length;r<n;++r)e.families[r].instances.push(t),e.families[r].stale_iids=!0;cr.clearArray(this.createRow),this.IterateDeathRow(),cr.wipe(this.deathRow),this.isInClearDeathRow=!1,this.hasPendingInstances=!1}},e.prototype.IterateDeathRow=function(){for(var t in this.deathRow)this.deathRow.hasOwnProperty(t)&&this.ClearDeathRowForType(this.deathRow[t])},e.prototype.ClearDeathRowForType=function(t){var e,i,r,s,n,o,a,h,c=t.valuesRef(),l=c[0].type;for(cr.arrayRemoveAllFromObjectSet(l.instances,t),l.stale_iids=!0,0===l.instances.length&&(l.any_instance_parallaxed=!1),e=0,i=l.families.length;e<i;++e)o=l.families[e],cr.arrayRemoveAllFromObjectSet(o.instances,t),o.stale_iids=!0;for(e=0,i=this.system.waits.length;e<i;++e)if((n=this.system.waits[e]).sols.hasOwnProperty(l.index)&&cr.arrayRemoveAllFromObjectSet(n.sols[l.index].insts,t),!l.is_family)for(r=0,s=l.families.length;r<s;++r)o=l.families[r],n.sols.hasOwnProperty(o.index)&&cr.arrayRemoveAllFromObjectSet(n.sols[o.index].insts,t);var u,p=c[0].layer;if(p){if(p.useRenderCells)for(e=0,i=(a=p.instances).length;e<i;++e)h=a[e],t.contains(h)&&(h.update_bbox(),p.render_grid.update(h,h.rendercells,null),h.rendercells.set(0,0,-1,-1));cr.arrayRemoveAllFromObjectSet(p.instances,t),p.setZIndicesStaleFrom(0)}for(e=0;e<c.length;++e)this.ClearDeathRowForSingleInstance(c[e],l);(u=t).clear(),d.push(u),this.redraw=!0},e.prototype.ClearDeathRowForSingleInstance=function(t,e){for(var i,r=0,s=this.destroycallbacks.length;r<s;++r)this.destroycallbacks[r](t);t.collcells&&e.collision_grid.update(t,t.collcells,null);var n=t.layer;if(n&&n.removeFromInstanceList(t,!0),t.behavior_insts)for(r=0,s=t.behavior_insts.length;r<s;++r)(i=t.behavior_insts[r]).onDestroy&&i.onDestroy(),i.behavior.my_instances.remove(t);this.objects_to_pretick.remove(t),this.objects_to_tick.remove(t),this.objects_to_tick2.remove(t),t.onDestroy&&t.onDestroy(),this.objectsByUid.hasOwnProperty(t.uid.toString())&&delete this.objectsByUid[t.uid.toString()],this.objectcount--,e.deadCache.length<100&&e.deadCache.push(t)},e.prototype.createInstance=function(t,e,i,r){if(t.is_family){var s=cr.floor(Math.random()*t.members.length);return this.createInstance(t.members[s],e,i,r)}return t.default_instance?this.createInstanceFromInit(t.default_instance,e,!1,i,r,!1):null};var E=[];e.prototype.createInstanceFromInit=function(t,e,i,r,s,n){var o,a,h,c,l;if(!t)return null;var u=this.types_by_index[t[1]],p=u.plugin.is_world;if(this.isloading&&p&&!u.isOnLoaderLayout)return null;if(p&&!this.glwrap&&11===t[0][11])return null;var d,g=e;for(p||(e=null),u.deadCache.length?((d=u.deadCache.pop()).recycled=!0,u.plugin.Instance.call(d,u)):(d=new u.plugin.Instance(u)).recycled=!1,!i||n||this.objectsByUid.hasOwnProperty(t[2].toString())?d.uid=this.next_uid++:d.uid=t[2],(this.objectsByUid[d.uid.toString()]=d).puid=this.next_puid++,d.iid=u.instances.length,o=0,a=this.createRow.length;o<a;++o)this.createRow[o].type===u&&d.iid++;d.get_iid=cr.inst_get_iid,d.toString=cr.inst_toString,d.isDestroyed=!1;var f,y,m=t[3];if(d.recycled)cr.wipe(d.extra);else{if(d.extra={},this.isPreview)for(d.instance_var_names=[],d.instance_var_names.length=m.length,o=0,a=m.length;o<a;o++)d.instance_var_names[o]=m[o][1];d.instance_vars=[],d.instance_vars.length=m.length}for(o=0,a=m.length;o<a;o++)d.instance_vars[o]=m[o][0];if(p){var _=t[0];if(d.x=cr.is_undefined(r)?_[0]:r,d.y=cr.is_undefined(s)?_[1]:s,d.z=_[2],d.width=_[3],d.height=_[4],d.depth=_[5],d.angle=_[6],d.opacity=_[7],d.hotspotX=_[8],d.hotspotY=_[9],d.blend_mode=_[10],l=_[11],!this.glwrap&&u.effect_types.length&&(d.blend_mode=l),d.compositeOp=cr.effectToCompositeOp(d.blend_mode),this.gl&&cr.setGLBlend(d,d.blend_mode,this.gl),d.recycled){for(o=0,a=_[12].length;o<a;o++)for(h=0,c=_[12][o].length;h<c;h++)d.effect_params[o][h]=_[12][o][h],Array.isArray(d.effect_params[o][h])&&(d.effect_params[o][h]=d.effect_params[o][h].slice(0));d.bbox.set(0,0,0,0),d.collcells.set(0,0,-1,-1),d.rendercells.set(0,0,-1,-1),d.bquad.set_from_rect(d.bbox),cr.clearArray(d.bbox_changed_callbacks)}else{for(d.effect_params=_[12].slice(0),o=0,a=d.effect_params.length;o<a;o++)for(d.effect_params[o]=_[12][o].slice(0),h=0,c=d.effect_params[o].length;h<c;++h)Array.isArray(d.effect_params[o][h])&&(d.effect_params[o][h]=d.effect_params[o][h].slice(0));d.active_effect_types=[],d.active_effect_flags=[],d.active_effect_flags.length=u.effect_types.length,d.bbox=new cr.rect(0,0,0,0),d.collcells=new cr.rect(0,0,-1,-1),d.rendercells=new cr.rect(0,0,-1,-1),d.bquad=new cr.quad,d.bbox_changed_callbacks=[],d.set_bbox_changed=cr.set_bbox_changed,d.add_bbox_changed_callback=cr.add_bbox_changed_callback,d.contains_pt=cr.inst_contains_pt,d.update_bbox=cr.update_bbox,d.update_render_cell=cr.update_render_cell,d.update_collision_cell=cr.update_collision_cell,d.get_zindex=cr.inst_get_zindex}for(d.tilemap_exists=!1,d.tilemap_width=0,d.tilemap_height=0,d.tilemap_data=null,14===_.length&&(d.tilemap_exists=!0,d.tilemap_width=_[13][0],d.tilemap_height=_[13][1],d.tilemap_data=_[13][2]),o=0,a=u.effect_types.length;o<a;o++)d.active_effect_flags[o]=!0;d.shaders_preserve_opaqueness=!0,d.updateActiveEffects=cr.inst_updateActiveEffects,d.updateActiveEffects(),d.uses_shaders=!!d.active_effect_types.length,d.bbox_changed=!0,d.cell_changed=!0,u.any_cell_changed=!0,d.visible=!0,d.my_timescale=-1,d.layer=e,d.zindex=e.instances.length,void(d.earlyz_index=0)===d.collision_poly&&(d.collision_poly=null),d.collisionsEnabled=!0,this.redraw=!0}for(cr.clearArray(E),o=0,a=u.families.length;o<a;o++)E.push.apply(E,u.families[o].behaviors);if(E.push.apply(E,u.behaviors),d.recycled)for(o=0,a=E.length;o<a;o++){var v=E[o];for((y=d.behavior_insts[o]).recycled=!0,v.behavior.Instance.call(y,v,d),h=0,c=(f=t[4][o]).length;h<c;h++)y.properties[h]=f[h];y.onCreate(),v.behavior.my_instances.add(d)}else for(d.behavior_insts=[],o=0,a=E.length;o<a;o++){(y=new(v=E[o]).behavior.Instance(v,d)).recycled=!1,y.properties=t[4][o].slice(0),y.onCreate(),cr.seal(y),d.behavior_insts.push(y),v.behavior.my_instances.add(d)}if(f=t[5],d.recycled)for(o=0,a=f.length;o<a;o++)d.properties[o]=f[o];else d.properties=f.slice(0);if(this.createRow.push(d),this.hasPendingInstances=!0,e&&(e.appendToInstanceList(d,!0),1===e.parallaxX&&1===e.parallaxY||(u.any_instance_parallaxed=!0)),this.objectcount++,u.is_contained){if(d.is_contained=!0,d.recycled?cr.clearArray(d.siblings):d.siblings=[],!i&&!n){for(o=0,a=u.container.length;o<a;o++)if(u.container[o]!==u){if(!u.container[o].default_instance)return null;d.siblings.push(this.createInstanceFromInit(u.container[o].default_instance,g,!1,p?d.x:r,p?d.y:s,!0))}for(o=0,a=d.siblings.length;o<a;o++)for(d.siblings[o].siblings.push(d),h=0;h<a;h++)o!==h&&d.siblings[o].siblings.push(d.siblings[h])}}else d.is_contained=!1,d.siblings=null;for(d.onCreate(),d.recycled||cr.seal(d),o=0,a=d.behavior_insts.length;o<a;o++)d.behavior_insts[o].postCreate&&d.behavior_insts[o].postCreate();return d},e.prototype.getLayerByName=function(t){for(var e=0,i=this.running_layout.layers.length;e<i;e++){var r=this.running_layout.layers[e];if(cr.equals_nocase(r.name,t))return r}return null},e.prototype.getLayerByNumber=function(t){return(t=cr.floor(t))<0&&(t=0),t>=this.running_layout.layers.length&&(t=this.running_layout.layers.length-1),this.running_layout.layers[t]},e.prototype.getLayer=function(t){return cr.is_number(t)?this.getLayerByNumber(t):this.getLayerByName(t.toString())},e.prototype.clearSol=function(t){for(var e=0,i=t.length;e<i;e++)t[e].getCurrentSol().select_all=!0},e.prototype.pushCleanSol=function(t){for(var e=0,i=t.length;e<i;e++)t[e].pushCleanSol()},e.prototype.pushCopySol=function(t){for(var e=0,i=t.length;e<i;e++)t[e].pushCopySol()},e.prototype.popSol=function(t){for(var e=0,i=t.length;e<i;e++)t[e].popSol()},e.prototype.updateAllCells=function(t){if(t.any_cell_changed){for(var e=t.instances,i=0,r=e.length;i<r;++i)e[i].update_collision_cell();var s=this.createRow;for(i=0,r=s.length;i<r;++i)s[i].type===t&&s[i].update_collision_cell();t.any_cell_changed=!1}},e.prototype.getCollisionCandidates=function(t,e,i,r){var s,n,o,a=!!t&&(1!==t.parallaxX||1!==t.parallaxY);if(e.is_family)for(s=0,n=e.members.length;s<n;++s)o=e.members[s],a||o.any_instance_parallaxed?cr.appendArray(r,o.instances):(this.updateAllCells(o),o.collision_grid.queryRange(i,r));else a||e.any_instance_parallaxed?cr.appendArray(r,e.instances):(this.updateAllCells(e),e.collision_grid.queryRange(i,r))},e.prototype.getTypesCollisionCandidates=function(t,e,i,r){for(var s=0,n=e.length;s<n;++s)this.getCollisionCandidates(t,e[s],i,r)},e.prototype.getSolidCollisionCandidates=function(t,e,i){var r=this.getSolidBehavior();if(!r)return null;this.getTypesCollisionCandidates(t,r.my_types,e,i)},e.prototype.getJumpthruCollisionCandidates=function(t,e,i){var r=this.getJumpthruBehavior();if(!r)return null;this.getTypesCollisionCandidates(t,r.my_types,e,i)},e.prototype.testAndSelectCanvasPointOverlap=function(t,e,i,r){var s,n,o,a,h,c,l,u=t.getCurrentSol(),p=this.getCurrentEventStack().current_event.orblock;if(u.select_all)for(r||(u.select_all=!1,cr.clearArray(u.instances)),s=0,a=t.instances.length;s<a;s++)if((o=t.instances[s]).update_bbox(),h=o.layer.canvasToLayer(e,i,!0),c=o.layer.canvasToLayer(e,i,!1),o.contains_pt(h,c)){if(r)return!1;u.instances.push(o)}else p&&u.else_instances.push(o);else{for(s=n=0,a=(l=p?u.else_instances:u.instances).length;s<a;s++)if((o=l[s]).update_bbox(),h=o.layer.canvasToLayer(e,i,!0),c=o.layer.canvasToLayer(e,i,!1),o.contains_pt(h,c)){if(r)return!1;p?u.instances.push(o):(u.instances[n]=u.instances[s],n++)}r||(l.length=n)}return t.applySolToContainer(),!!r||u.hasObjects()},e.prototype.testOverlap=function(t,e){if(!(t&&e&&t!==e&&t.collisionsEnabled&&e.collisionsEnabled))return!1;t.update_bbox(),e.update_bbox();var i,r,s,n,o,a,h,c,l,u,p=t.layer,d=e.layer;if(p===d||p.parallaxX===d.parallaxX&&d.parallaxY==d.parallaxY&&p.scale===d.scale&&p.angle===d.angle&&p.zoomRate===d.zoomRate)return!!t.bbox.intersects_rect(e.bbox)&&(!!t.bquad.intersects_quad(e.bquad)&&((!t.tilemap_exists||!e.tilemap_exists)&&(t.tilemap_exists?this.testTilemapOverlap(t,e):e.tilemap_exists?this.testTilemapOverlap(e,t):(h=t.collision_poly&&!t.collision_poly.is_empty(),c=e.collision_poly&&!e.collision_poly.is_empty(),!h&&!c||(l=h?(t.collision_poly.cache_poly(t.width,t.height,t.angle),t.collision_poly):(this.temp_poly.set_from_quad(t.bquad,t.x,t.y,t.width,t.height),this.temp_poly),u=c?(e.collision_poly.cache_poly(e.width,e.height,e.angle),e.collision_poly):(this.temp_poly.set_from_quad(e.bquad,e.x,e.y,e.width,e.height),this.temp_poly),l.intersects_poly(u,e.x-t.x,e.y-t.y))))));for(h=t.collision_poly&&!t.collision_poly.is_empty(),c=e.collision_poly&&!e.collision_poly.is_empty(),h?(t.collision_poly.cache_poly(t.width,t.height,t.angle),this.temp_poly.set_from_poly(t.collision_poly)):this.temp_poly.set_from_quad(t.bquad,t.x,t.y,t.width,t.height),l=this.temp_poly,c?(e.collision_poly.cache_poly(e.width,e.height,e.angle),this.temp_poly2.set_from_poly(e.collision_poly)):this.temp_poly2.set_from_quad(e.bquad,e.x,e.y,e.width,e.height),u=this.temp_poly2,i=0,r=l.pts_count;i<r;i++)n=(s=2*i)+1,o=l.pts_cache[s],a=l.pts_cache[n],l.pts_cache[s]=p.layerToCanvas(o+t.x,a+t.y,!0),l.pts_cache[n]=p.layerToCanvas(o+t.x,a+t.y,!1);for(l.update_bbox(),i=0,r=u.pts_count;i<r;i++)n=(s=2*i)+1,o=u.pts_cache[s],a=u.pts_cache[n],u.pts_cache[s]=d.layerToCanvas(o+e.x,a+e.y,!0),u.pts_cache[n]=d.layerToCanvas(o+e.x,a+e.y,!1);return u.update_bbox(),l.intersects_poly(u,0,0)};var p=new cr.quad,g=new cr.rect(0,0,0,0),f=[];e.prototype.testTilemapOverlap=function(t,e){var i,r,s=e.bbox,n=t.x,o=t.y;t.getCollisionRectCandidates(s,f);for(var a=f,h=e.collision_poly&&!e.collision_poly.is_empty(),c=0,l=a.length;c<l;++c)if(r=(i=a[c]).rc,s.intersects_rect_off(r,n,o)&&(p.set_from_rect(r),p.offset(n,o),p.intersects_quad(e.bquad)))if(h){if(e.collision_poly.cache_poly(e.width,e.height,e.angle),i.poly){if(i.poly.intersects_poly(e.collision_poly,e.x-(n+r.left),e.y-(o+r.top)))return cr.clearArray(f),!0}else if(this.temp_poly.set_from_quad(p,0,0,r.right-r.left,r.bottom-r.top),this.temp_poly.intersects_poly(e.collision_poly,e.x,e.y))return cr.clearArray(f),!0}else{if(!i.poly)return cr.clearArray(f),!0;if(this.temp_poly.set_from_quad(e.bquad,0,0,e.width,e.height),i.poly.intersects_poly(this.temp_poly,-(n+r.left),-(o+r.top)))return cr.clearArray(f),!0}return cr.clearArray(f),!1},e.prototype.testRectOverlap=function(t,e){if(!e||!e.collisionsEnabled)return!1;e.update_bbox();e.layer;if(!e.bbox.intersects_rect(t))return!1;if(e.tilemap_exists){e.getCollisionRectCandidates(t,f);for(var i,r,s=f,n=e.x,o=e.y,a=0,h=s.length;a<h;++a)if(r=(i=s[a]).rc,t.intersects_rect_off(r,n,o)){if(!i.poly)return cr.clearArray(f),!0;if(this.temp_poly.set_from_rect(t,0,0),i.poly.intersects_poly(this.temp_poly,-(n+r.left),-(o+r.top)))return cr.clearArray(f),!0}return cr.clearArray(f),!1}return p.set_from_rect(t),!!e.bquad.intersects_quad(p)&&(!(e.collision_poly&&!e.collision_poly.is_empty())||(e.collision_poly.cache_poly(e.width,e.height,e.angle),p.offset(-t.left,-t.top),this.temp_poly.set_from_quad(p,0,0,1,1),e.collision_poly.intersects_poly(this.temp_poly,t.left-e.x,t.top-e.y)))},e.prototype.testSegmentOverlap=function(t,e,i,r,s){if(!s||!s.collisionsEnabled)return!1;s.update_bbox();s.layer;if(g.set(cr.min(t,i),cr.min(e,r),cr.max(t,i),cr.max(e,r)),!s.bbox.intersects_rect(g))return!1;if(s.tilemap_exists){s.getCollisionRectCandidates(g,f);for(var n,o,a=f,h=s.x,c=s.y,l=0,u=a.length;l<u;++l)if(o=(n=a[l]).rc,g.intersects_rect_off(o,h,c)&&(p.set_from_rect(o),p.offset(h,c),p.intersects_segment(t,e,i,r))){if(!n.poly)return cr.clearArray(f),!0;if(n.poly.intersects_segment(h+o.left,c+o.top,t,e,i,r))return cr.clearArray(f),!0}return cr.clearArray(f),!1}return!!s.bquad.intersects_segment(t,e,i,r)&&(!(s.collision_poly&&!s.collision_poly.is_empty())||(s.collision_poly.cache_poly(s.width,s.height,s.angle),s.collision_poly.intersects_segment(s.x,s.y,t,e,i,r)))},e.prototype.typeHasBehavior=function(t,e){if(!e)return!1;for(var i,r,s,n=0,o=t.behaviors.length;n<o;n++)if(t.behaviors[n].behavior instanceof e)return!0;if(!t.is_family)for(n=0,o=t.families.length;n<o;n++)for(i=0,r=(s=t.families[n]).behaviors.length;i<r;i++)if(s.behaviors[i].behavior instanceof e)return!0;return!1},e.prototype.typeHasNoSaveBehavior=function(t){return this.typeHasBehavior(t,cr.behaviors.NoSave)},e.prototype.typeHasPersistBehavior=function(t){return this.typeHasBehavior(t,cr.behaviors.Persist)},e.prototype.getSolidBehavior=function(){return this.solidBehavior},e.prototype.getJumpthruBehavior=function(){return this.jumpthruBehavior};var o=[];e.prototype.testOverlapSolid=function(t){var e,i,r;for(t.update_bbox(),this.getSolidCollisionCandidates(t.layer,t.bbox,o),e=0,i=o.length;e<i;++e)if((r=o[e]).extra.solidEnabled&&this.testOverlap(t,r))return cr.clearArray(o),r;return cr.clearArray(o),null},e.prototype.testRectOverlapSolid=function(t){var e,i,r;for(this.getSolidCollisionCandidates(null,t,o),e=0,i=o.length;e<i;++e)if((r=o[e]).extra.solidEnabled&&this.testRectOverlap(t,r))return cr.clearArray(o),r;return cr.clearArray(o),null};var a=[];e.prototype.testOverlapJumpThru=function(t,e){var i,r,s,n=null;for(e&&(n=a,cr.clearArray(n)),t.update_bbox(),this.getJumpthruCollisionCandidates(t.layer,t.bbox,o),i=0,r=o.length;i<r;++i)if((s=o[i]).extra.jumpthruEnabled&&this.testOverlap(t,s)){if(!e)return cr.clearArray(o),s;n.push(s)}return cr.clearArray(o),n},e.prototype.pushOutSolid=function(t,e,i,r,s,n){for(var o=r||50,a=t.x,h=t.y,c=null,l=null,u=0;u<o;u++)if(t.x=a+e*u,t.y=h+i*u,t.set_bbox_changed(),!this.testOverlap(t,c)&&((c=this.testOverlapSolid(t))&&(l=c),!c&&(s&&(c=n?this.testOverlap(t,n)?n:null:this.testOverlapJumpThru(t))&&(l=c),!c)))return l&&this.pushInFractional(t,e,i,l,16),!0;return t.x=a,t.y=h,t.set_bbox_changed(),!1},e.prototype.pushOutSolidAxis=function(t,e,i,r){r=r||50;for(var s,n,o=t.x,a=t.y,h=null,c=null,l=0;l<r;++l)for(s=0;s<2;++s)if(n=2*s-1,t.x=o+e*l*n,t.y=a+i*l*n,t.set_bbox_changed(),!this.testOverlap(t,h)){if(!(h=this.testOverlapSolid(t)))return c&&this.pushInFractional(t,e*n,i*n,c,16),!0;c=h}return t.x=o,t.y=a,t.set_bbox_changed(),!1},e.prototype.pushOut=function(t,e,i,r,s){for(var n=r||50,o=t.x,a=t.y,h=0;h<n;h++)if(t.x=o+e*h,t.y=a+i*h,t.set_bbox_changed(),!this.testOverlap(t,s))return!0;return t.x=o,t.y=a,t.set_bbox_changed(),!1},e.prototype.pushInFractional=function(t,e,i,r,s){for(var n,o=2,a=!1,h=!1,c=t.x,l=t.y;o<=s;)n=1/o,o*=2,t.x+=e*n*(a?1:-1),t.y+=i*n*(a?1:-1),t.set_bbox_changed(),this.testOverlap(t,r)?h=a=!0:(h=a=!1,c=t.x,l=t.y);h&&(t.x=c,t.y=l,t.set_bbox_changed())},e.prototype.pushOutSolidNearest=function(t,e){var i=cr.is_undefined(e)?100:e,r=0,s=t.x,n=t.y,o=0,a=0,h=0,c=this.testOverlapSolid(t);if(!c)return!0;for(;r<=i;){switch(o){case 0:a=0,h=-1,r++;break;case 1:h=-(a=1);break;case 2:a=1,h=0;break;case 3:h=a=1;break;case 4:a=0,h=1;break;case 5:a=-1,h=1;break;case 6:a=-1,h=0;break;case 7:h=a=-1}if(o=(o+1)%8,t.x=cr.floor(s+a*r),t.y=cr.floor(n+h*r),t.set_bbox_changed(),!this.testOverlap(t,c)&&!(c=this.testOverlapSolid(t)))return!0}return t.x=s,t.y=n,t.set_bbox_changed(),!1},e.prototype.registerCollision=function(t,e){t.collisionsEnabled&&e.collisionsEnabled&&this.registered_collisions.push([t,e])},e.prototype.addRegisteredCollisionCandidates=function(t,e,i){for(var r,s,n=0,o=this.registered_collisions.length;n<o;++n){if(s=null,(r=this.registered_collisions[n])[0]===t)s=r[1];else{if(r[1]!==t)continue;s=r[0]}if(e.is_family){if(-1===e.members.indexOf(e))continue}else if(s.type!==e)continue;-1===i.indexOf(s)&&i.push(s)}},e.prototype.checkRegisteredCollision=function(t,e){for(var i,r=0,s=this.registered_collisions.length;r<s;r++)if((i=this.registered_collisions[r])[0]===t&&i[1]===e||i[0]===e&&i[1]===t)return!0;return!1},e.prototype.calculateSolidBounceAngle=function(t,e,i,r){var s=t.x,n=t.y,o=cr.max(10,cr.distanceTo(e,i,s,n)),a=cr.angleTo(e,i,s,n),h=r||this.testOverlapSolid(t);if(!h)return cr.clamp_angle(a+cr.PI);for(var c,l,u,p=h,d=cr.to_radians(5),g=1;g<36;g++)if(c=a-g*d,t.x=e+Math.cos(c)*o,t.y=i+Math.sin(c)*o,t.set_bbox_changed(),!this.testOverlap(t,p)&&!(p=r?null:this.testOverlapSolid(t))){l=c;break}36===g&&(l=cr.clamp_angle(a+cr.PI));p=h;for(g=1;g<36;g++)if(c=a+g*d,t.x=e+Math.cos(c)*o,t.y=i+Math.sin(c)*o,t.set_bbox_changed(),!this.testOverlap(t,p)&&!(p=r?null:this.testOverlapSolid(t))){u=c;break}if(36===g&&(u=cr.clamp_angle(a+cr.PI)),t.x=s,t.y=n,t.set_bbox_changed(),u===l)return u;var f=cr.angleDiff(u,l)/2,y=cr.angleClockwise(u,l)?cr.clamp_angle(l+f+cr.PI):cr.clamp_angle(u+f),m=Math.cos(a),_=Math.sin(a),v=Math.cos(y),b=Math.sin(y),w=m*v+_*b,x=m-2*w*v,T=_-2*w*b;return cr.angleTo(0,0,x,T)};var y=-1;function n(){try{return window.indexedDB}catch(t){return}}function l(t){t.target.result.createObjectStore("saves",{keyPath:"slot"})}function u(){cr.logexport("Reloading for continuous preview"),-1<window.location.search.indexOf("continuous")?window.location.reload(!0):window.location=window.location+"?continuous"}function O(t){var e,i={};for(e in t)if(t.hasOwnProperty(e)){if(t[e]instanceof cr.ObjectSet)continue;if(t[e]&&void 0!==t[e].c2userdata)continue;if("spriteCreatedDestroyCallback"===e)continue;i[e]=t[e]}return i}e.prototype.trigger=function(t,e,i){if(!this.running_layout)return!1;var r=this.running_layout.event_sheet;if(!r)return!1;var s,n=!1;y++;for(var o=r.deep_includes,a=0,h=o.length;a<h;++a)s=this.triggerOnSheet(t,e,o[a],i),n=n||s;return s=this.triggerOnSheet(t,e,r,i),y--,n=n||s},e.prototype.triggerOnSheet=function(t,e,i,r){var s,n,o,a,h=!1;if(e)for(o=this.triggerOnSheetForTypeName(t,e,e.type.name,i,r),h=h||o,s=0,n=(a=e.type.families).length;s<n;++s)o=this.triggerOnSheetForTypeName(t,e,a[s].name,i,r),h=h||o;else o=this.triggerOnSheetForTypeName(t,e,"system",i,r),h=h||o;return h},e.prototype.triggerOnSheetForTypeName=function(t,e,i,r,s){var n,o,a=!1,h=!1,c=void 0!==s,l=(c?r.fasttriggers:r.triggers)[i];if(!l)return a;for(var u,p=null,d=0,g=l.length;d<g;++d)if(l[d].method==t){p=l[d].evs;break}if(!p)return a;if(!(u=c?p[s]:p))return null;for(d=0,g=u.length;d<g;d++)n=u[d][0],o=u[d][1],h=this.executeSingleTrigger(e,i,n,o),a=a||h;return a},e.prototype.executeSingleTrigger=function(t,e,i,r){var s,n,o=!1;this.trigger_depth++;var a=this.getCurrentEventStack().current_event;a&&this.pushCleanSol(a.solModifiersIncludingParents);var h=1<this.trigger_depth;this.pushCleanSol(i.solModifiersIncludingParents),h&&this.pushLocalVarStack();var c,l=this.pushEventStack(i);l.current_event=i,t&&((c=this.types[e].getCurrentSol()).select_all=!1,cr.clearArray(c.instances),c.instances[0]=t,this.types[e].applySolToContainer());var u=!0;if(i.parent){for(var p=l.temp_parents_arr,d=i.parent;d;)p.push(d),d=d.parent;for(p.reverse(),s=0,n=p.length;s<n;s++)if(!p[s].run_pretrigger()){u=!1;break}}return u&&(this.execcount++,i.orblock?i.run_orblocktrigger(r):i.run(),o=o||l.last_event_true),this.popEventStack(),h&&this.popLocalVarStack(),this.popSol(i.solModifiersIncludingParents),a&&this.popSol(a.solModifiersIncludingParents),this.hasPendingInstances&&0===this.isInOnDestroy&&0===y&&!this.isRunningEvents&&this.ClearDeathRow(),this.trigger_depth--,o},e.prototype.getCurrentCondition=function(){var t=this.getCurrentEventStack();return t.current_event.conditions[t.cndindex]},e.prototype.getCurrentConditionObjectType=function(){return this.getCurrentCondition().type},e.prototype.isCurrentConditionFirst=function(){return 0===this.getCurrentEventStack().cndindex},e.prototype.getCurrentAction=function(){var t=this.getCurrentEventStack();return t.current_event.actions[t.actindex]},e.prototype.pushLocalVarStack=function(){this.localvar_stack_index++,this.localvar_stack_index>=this.localvar_stack.length&&this.localvar_stack.push([])},e.prototype.popLocalVarStack=function(){this.localvar_stack_index--},e.prototype.getCurrentLocalVarStack=function(){return this.localvar_stack[this.localvar_stack_index]},e.prototype.pushEventStack=function(t){this.event_stack_index++,this.event_stack_index>=this.event_stack.length&&this.event_stack.push(new cr.eventStackFrame);var e=this.getCurrentEventStack();return e.reset(t),e},e.prototype.popEventStack=function(){this.event_stack_index--},e.prototype.getCurrentEventStack=function(){return this.event_stack[this.event_stack_index]},e.prototype.pushLoopStack=function(t){this.loop_stack_index++,this.loop_stack_index>=this.loop_stack.length&&this.loop_stack.push(cr.seal({name:t,index:0,stopped:!1}));var e=this.getCurrentLoop();return e.name=t,e.index=0,e.stopped=!1,e},e.prototype.popLoopStack=function(){this.loop_stack_index--},e.prototype.getCurrentLoop=function(){return this.loop_stack[this.loop_stack_index]},e.prototype.getEventVariableByName=function(t,e){for(var i,r,s,n,o,a;e;){for(i=0,r=e.subevents.length;i<r;i++)if((a=e.subevents[i])instanceof cr.eventvariable&&cr.equals_nocase(t,a.name))return a;e=e.parent}for(i=0,r=this.eventsheets_by_index.length;i<r;i++)for(s=0,n=(o=this.eventsheets_by_index[i]).events.length;s<n;s++)if((a=o.events[s])instanceof cr.eventvariable&&cr.equals_nocase(t,a.name))return a;return null},e.prototype.getLayoutBySid=function(t){for(var e=0,i=this.layouts_by_index.length;e<i;e++)if(this.layouts_by_index[e].sid===t)return this.layouts_by_index[e];return null},e.prototype.getObjectTypeBySid=function(t){for(var e=0,i=this.types_by_index.length;e<i;e++)if(this.types_by_index[e].sid===t)return this.types_by_index[e];return null},e.prototype.getGroupBySid=function(t){for(var e=0,i=this.allGroups.length;e<i;e++)if(this.allGroups[e].sid===t)return this.allGroups[e];return null},e.prototype.doCanvasSnapshot=function(t,e){this.snapshotCanvas=[t,e],this.redraw=!0},e.prototype.signalContinuousPreview=function(){this.signalledContinuousPreview=!0},e.prototype.handleSaveLoad=function(){var i=this,t=this.saveToSlot,r=this.lastSaveJson,e=this.loadFromSlot,s=!1;if(this.signalledContinuousPreview&&(s=!0,t="__c2_continuouspreview",this.signalledContinuousPreview=!1),t.length){if(this.ClearDeathRow(),r=this.saveToJSONString(),n())!function(i,r,s,n){try{var t=indexedDB.open("_C2SaveStates");t.onupgradeneeded=l,t.onerror=n,t.onsuccess=function(t){var e=t.target.result;e.onerror=n,e.transaction(["saves"],"readwrite").objectStore("saves").put({slot:i,data:r}).onsuccess=s}}catch(t){n(t)}}(t,r,function(){cr.logexport("Saved state to IndexedDB storage ("+r.length+" bytes)"),i.lastSaveJson=r,i.trigger(cr.system_object.prototype.cnds.OnSaveComplete,null),i.lastSaveJson="",s&&u()},function(e){try{localStorage.setItem("__c2save_"+t,r),cr.logexport("Saved state to WebStorage ("+r.length+" bytes)"),i.lastSaveJson=r,i.trigger(cr.system_object.prototype.cnds.OnSaveComplete,null),i.lastSaveJson="",s&&u()}catch(t){cr.logexport("Failed to save game state: "+e+"; "+t),i.trigger(cr.system_object.prototype.cnds.OnSaveFailed,null)}});else try{localStorage.setItem("__c2save_"+t,r),cr.logexport("Saved state to WebStorage ("+r.length+" bytes)"),i.lastSaveJson=r,this.trigger(cr.system_object.prototype.cnds.OnSaveComplete,null),i.lastSaveJson="",s&&u()}catch(t){cr.logexport("Error saving to WebStorage: "+t),i.trigger(cr.system_object.prototype.cnds.OnSaveFailed,null)}this.saveToSlot="",this.loadFromSlot="",this.loadFromJson=null}if(e.length){if(n())!function(r,s,n){try{var t=indexedDB.open("_C2SaveStates");t.onupgradeneeded=l,t.onerror=n,t.onsuccess=function(t){var e=t.target.result;e.onerror=n;var i=e.transaction(["saves"]).objectStore("saves").get(r);i.onsuccess=function(t){i.result?s(i.result.data):s(null)}}}catch(t){n(t)}}(e,function(t){t?(i.loadFromJson=t,cr.logexport("Loaded state from IndexedDB storage ("+i.loadFromJson.length+" bytes)")):(i.loadFromJson=localStorage.getItem("__c2save_"+e)||"",cr.logexport("Loaded state from WebStorage ("+i.loadFromJson.length+" bytes)")),i.suspendDrawing=!1,i.loadFromJson||(i.loadFromJson=null,i.trigger(cr.system_object.prototype.cnds.OnLoadFailed,null))},function(t){i.loadFromJson=localStorage.getItem("__c2save_"+e)||"",cr.logexport("Loaded state from WebStorage ("+i.loadFromJson.length+" bytes)"),i.suspendDrawing=!1,i.loadFromJson||(i.loadFromJson=null,i.trigger(cr.system_object.prototype.cnds.OnLoadFailed,null))});else{try{this.loadFromJson=localStorage.getItem("__c2save_"+e)||"",cr.logexport("Loaded state from WebStorage ("+this.loadFromJson.length+" bytes)")}catch(t){this.loadFromJson=null}this.suspendDrawing=!1,i.loadFromJson||(i.loadFromJson=null,i.trigger(cr.system_object.prototype.cnds.OnLoadFailed,null))}this.loadFromSlot="",this.saveToSlot=""}null!==this.loadFromJson&&(this.ClearDeathRow(),this.loadFromJSONString(this.loadFromJson)?(this.lastSaveJson=this.loadFromJson,this.trigger(cr.system_object.prototype.cnds.OnLoadComplete,null),this.lastSaveJson=""):i.trigger(cr.system_object.prototype.cnds.OnLoadFailed,null),this.loadFromJson=null)},e.prototype.saveToJSONString=function(){for(var t,e,i,r,s,n,o,a,h,c,l={c2save:!0,version:1,rt:{time:this.kahanTime.sum,walltime:this.wallTime.sum,timescale:this.timescale,tickcount:this.tickcount,execcount:this.execcount,next_uid:this.next_uid,running_layout:this.running_layout.sid,start_time_offset:Date.now()-this.start_time},types:{},layouts:{},events:{groups:{},cnds:{},acts:{},vars:{}}},u=0,p=this.types_by_index.length;u<p;u++)if(!(i=this.types_by_index[u]).is_family&&!this.typeHasNoSaveBehavior(i)){for(s={instances:[]},cr.hasAnyOwnProperty(i.extra)&&(s.ex=O(i.extra)),t=0,e=i.instances.length;t<e;t++)s.instances.push(this.saveInstanceToJSON(i.instances[t]));l.types[i.sid.toString()]=s}for(u=0,p=this.layouts_by_index.length;u<p;u++)r=this.layouts_by_index[u],l.layouts[r.sid.toString()]=r.saveToJSON();var d=l.events.groups;for(u=0,p=this.allGroups.length;u<p;u++)d[(n=this.allGroups[u]).sid.toString()]=this.groups_by_name[n.group_name].group_active;var g=l.events.cnds;for(c in this.cndsBySid)this.cndsBySid.hasOwnProperty(c)&&(o=this.cndsBySid[c],cr.hasAnyOwnProperty(o.extra)&&(g[c]={ex:O(o.extra)}));var f=l.events.acts;for(c in this.actsBySid)this.actsBySid.hasOwnProperty(c)&&(a=this.actsBySid[c],cr.hasAnyOwnProperty(a.extra)&&(f[c]={ex:O(a.extra)}));var y=l.events.vars;for(c in this.varsBySid)this.varsBySid.hasOwnProperty(c)&&((h=this.varsBySid[c]).is_constant||h.parent&&!h.is_static||(y[c]=h.data));return l.system=this.system.saveToJSON(),JSON.stringify(l)},e.prototype.refreshUidMap=function(){var t,e,i,r,s,n;for(this.objectsByUid={},t=0,e=this.types_by_index.length;t<e;t++)if(!(i=this.types_by_index[t]).is_family)for(r=0,s=i.instances.length;r<s;r++)n=i.instances[r],this.objectsByUid[n.uid.toString()]=n},e.prototype.loadFromJSONString=function(t){var e;try{e=JSON.parse(t)}catch(t){return!1}if(!e.c2save)return!1;if(1<e.version)return!1;this.isLoadingState=!0;var i=e.rt;this.kahanTime.reset(),this.kahanTime.sum=i.time,this.wallTime.reset(),this.wallTime.sum=i.walltime||0,this.timescale=i.timescale,this.tickcount=i.tickcount,this.execcount=i.execcount,this.start_time=Date.now()-i.start_time_offset;var r,s,n,o,a,h,c,l,u,p,d,g,f,y,m,_,v,b=i.running_layout;if(b!==this.running_layout.sid){var w=this.getLayoutBySid(b);if(!w)return;this.doChangeLayout(w)}var x=e.types;for(c in x)if(x.hasOwnProperty(c)){if(!(l=this.getObjectTypeBySid(parseInt(c,10)))||l.is_family||this.typeHasNoSaveBehavior(l))continue;for(x[c].ex?l.extra=x[c].ex:cr.wipe(l.extra),u=l.instances,p=x[c].instances,r=0,s=cr.min(u.length,p.length);r<s;r++)this.loadInstanceFromJSON(u[r],p[r]);for(r=p.length,s=u.length;r<s;r++)this.DestroyInstance(u[r]);for(r=u.length,s=p.length;r<s;r++)y=null,l.plugin.is_world&&!(y=this.running_layout.getLayerBySid(p[r].w.l))||(d=this.createInstanceFromInit(l.default_instance,y,!1,0,0,!0),this.loadInstanceFromJSON(d,p[r]));l.stale_iids=!0}this.ClearDeathRow(),this.refreshUidMap();var T=e.layouts;for(c in T)if(T.hasOwnProperty(c)){if(!(f=this.getLayoutBySid(parseInt(c,10))))continue;f.loadFromJSON(T[c])}var M=e.events.groups;for(c in M)M.hasOwnProperty(c)&&(m=this.getGroupBySid(parseInt(c,10)))&&this.groups_by_name[m.group_name]&&this.groups_by_name[m.group_name].setGroupActive(M[c]);var S=e.events.cnds;for(c in this.cndsBySid)this.cndsBySid.hasOwnProperty(c)&&(S.hasOwnProperty(c)?this.cndsBySid[c].extra=S[c].ex:this.cndsBySid[c].extra={});var A=e.events.acts;for(c in this.actsBySid)this.actsBySid.hasOwnProperty(c)&&(A.hasOwnProperty(c)?this.actsBySid[c].extra=A[c].ex:this.actsBySid[c].extra={});var C=e.events.vars;for(c in C)C.hasOwnProperty(c)&&this.varsBySid.hasOwnProperty(c)&&(this.varsBySid[c].data=C[c]);for(this.next_uid=i.next_uid,this.isLoadingState=!1,r=0,s=this.fireOnCreateAfterLoad.length;r<s;++r)d=this.fireOnCreateAfterLoad[r],this.trigger(Object.getPrototypeOf(d.type.plugin).cnds.OnCreated,d);for(cr.clearArray(this.fireOnCreateAfterLoad),this.system.loadFromJSON(e.system),r=0,s=this.types_by_index.length;r<s;r++)if(!(l=this.types_by_index[r]).is_family&&!this.typeHasNoSaveBehavior(l))for(n=0,o=l.instances.length;n<o;n++){if(d=l.instances[n],l.is_contained)for(_=d.get_iid(),cr.clearArray(d.siblings),a=0,h=l.container.length;a<h;a++)l!==(v=l.container[a])&&d.siblings.push(v.instances[_]);if(d.afterLoad&&d.afterLoad(),d.behavior_insts)for(a=0,h=d.behavior_insts.length;a<h;a++)(g=d.behavior_insts[a]).afterLoad&&g.afterLoad()}return this.redraw=!0},e.prototype.saveInstanceToJSON=function(t,e){var i,r,s,n,o,a=t.type,h=a.plugin,c={};if(e?c.c2=!0:c.uid=t.uid,cr.hasAnyOwnProperty(t.extra)&&(c.ex=O(t.extra)),t.instance_vars&&t.instance_vars.length)for(c.ivs={},i=0,r=t.instance_vars.length;i<r;i++)c.ivs[t.type.instvar_sids[i].toString()]=t.instance_vars[i];if(h.is_world){if(s={x:t.x,y:t.y,w:t.width,h:t.height,l:t.layer.sid,zi:t.get_zindex()},0!==t.angle&&(s.a=t.angle),1!==t.opacity&&(s.o=t.opacity),.5!==t.hotspotX&&(s.hX=t.hotspotX),.5!==t.hotspotY&&(s.hY=t.hotspotY),0!==t.blend_mode&&(s.bm=t.blend_mode),t.visible||(s.v=t.visible),t.collisionsEnabled||(s.ce=t.collisionsEnabled),-1!==t.my_timescale&&(s.mts=t.my_timescale),a.effect_types.length)for(s.fx=[],i=0,r=a.effect_types.length;i<r;i++)o=a.effect_types[i],s.fx.push({name:o.name,active:t.active_effect_flags[o.index],params:t.effect_params[o.index]});c.w=s}if(t.behavior_insts&&t.behavior_insts.length)for(c.behs={},i=0,r=t.behavior_insts.length;i<r;i++)(n=t.behavior_insts[i]).saveToJSON&&(c.behs[n.type.sid.toString()]=n.saveToJSON());return t.saveToJSON&&(c.data=t.saveToJSON()),c},e.prototype.getInstanceVarIndexBySid=function(t,e){for(var i=0,r=t.instvar_sids.length;i<r;i++)if(t.instvar_sids[i]===e)return i;return-1},e.prototype.getBehaviorIndexBySid=function(t,e){for(var i=0,r=t.behavior_insts.length;i<r;i++)if(t.behavior_insts[i].type.sid===e)return i;return-1},e.prototype.loadInstanceFromJSON=function(t,e,i){var r,s,n,o,a,h,c,l,u,p,d,g=t.type,f=g.plugin;if(i){if(!e.c2)return}else t.uid=e.uid;if(e.ex?t.extra=e.ex:cr.wipe(t.extra),a=e.ivs)for(r in a)if(a.hasOwnProperty(r)){if((o=this.getInstanceVarIndexBySid(g,parseInt(r,10)))<0||o>=t.instance_vars.length)continue;null===(p=a[r])&&(p=NaN),t.instance_vars[o]=p}if(f.is_world){if(h=e.w,t.layer.sid!==h.l&&(d=t.layer,t.layer=this.running_layout.getLayerBySid(h.l),t.layer?(d.removeFromInstanceList(t,!0),t.layer.appendToInstanceList(t,!0),t.set_bbox_changed(),t.layer.setZIndicesStaleFrom(0)):(t.layer=d,i||this.DestroyInstance(t))),t.x=h.x,t.y=h.y,t.width=h.w,t.height=h.h,t.zindex=h.zi,t.angle=h.hasOwnProperty("a")?h.a:0,t.opacity=h.hasOwnProperty("o")?h.o:1,t.hotspotX=h.hasOwnProperty("hX")?h.hX:.5,t.hotspotY=h.hasOwnProperty("hY")?h.hY:.5,t.visible=!h.hasOwnProperty("v")||h.v,t.collisionsEnabled=!h.hasOwnProperty("ce")||h.ce,t.my_timescale=h.hasOwnProperty("mts")?h.mts:-1,t.blend_mode=h.hasOwnProperty("bm")?h.bm:0,t.compositeOp=cr.effectToCompositeOp(t.blend_mode),this.gl&&cr.setGLBlend(t,t.blend_mode,this.gl),t.set_bbox_changed(),h.hasOwnProperty("fx"))for(s=0,n=h.fx.length;s<n;s++)(c=g.getEffectIndexByName(h.fx[s].name))<0||(t.active_effect_flags[c]=h.fx[s].active,t.effect_params[c]=h.fx[s].params);t.updateActiveEffects()}if(l=e.behs)for(r in l)if(l.hasOwnProperty(r)){if((u=this.getBehaviorIndexBySid(t,parseInt(r,10)))<0)continue;t.behavior_insts[u].loadFromJSON(l[r])}e.data&&t.loadFromJSON(e.data)},e.prototype.getProjectFileUrl=function(t){return this.isPreview?window.cr_previewProjectFiles.hasOwnProperty(t.toLowerCase())?window.cr_previewProjectFiles[t.toLowerCase()]:t:this.files_subfolder+t},e.prototype.getProjectFileBlob=function(t){return this.isPreview&&window.cr_previewProjectFileBlobs&&window.cr_previewProjectFiles.hasOwnProperty(t.toLowerCase())?window.cr_previewProjectFileBlobs[t.toLowerCase()]:null},e.prototype.getLocalFileUrl=function(t){return this.isPreview&&window.cr_previewProjectFiles.hasOwnProperty(t.toLowerCase())?window.cr_previewProjectFiles[t.toLowerCase()]:t},e.prototype.fetchLocalFileViaCordova=function(t,e,i){var r=window.cordova.file.applicationDirectory+"www/"+t;window.resolveLocalFileSystemURL(r,function(t){t.file(e,i)},i)},e.prototype.fetchLocalFileViaCordovaAsText=function(t,i,r){this.fetchLocalFileViaCordova(t,function(t){var e=new FileReader;e.onload=function(t){i(t.target.result)},e.onerror=r,e.readAsText(t)},r)};var s=[],I=0;e.prototype.maybeStartNextArrayBufferRead=function(){var t;s.length&&(8<=I||(I++,t=s.shift(),this.doFetchLocalFileViaCordovaAsArrayBuffer(t.filename,t.successCallback,t.errorCallback)))},e.prototype.fetchLocalFileViaCordovaAsArrayBuffer=function(t,e,i){var r=this;s.push({filename:t,successCallback:function(t){I--,r.maybeStartNextArrayBufferRead(),e(t)},errorCallback:function(t){I--,r.maybeStartNextArrayBufferRead(),i(t)}}),this.maybeStartNextArrayBufferRead()},e.prototype.doFetchLocalFileViaCordovaAsArrayBuffer=function(t,i,e){this.fetchLocalFileViaCordova(t,function(t){var e=new FileReader;e.onload=function(t){i(t.target.result)},e.readAsArrayBuffer(t)},e)},e.prototype.fetchLocalFileViaCordovaAsURL=function(t,r,e){var s="",i=t.toLowerCase(),n=i.substr(i.length-4),o=i.substr(i.length-5);".mp4"===n?s="video/mp4":".webm"===o?s="video/webm":".m4a"===n?s="audio/mp4":".mp3"===n&&(s="audio/mpeg"),this.fetchLocalFileViaCordovaAsArrayBuffer(t,function(t){var e=new Blob([t],{type:s}),i=URL.createObjectURL(e);r(i)},e)},e.prototype.isAbsoluteUrl=function(t){return/^(?:[a-z]+:)?\/\//.test(t)||"data:"===t.substr(0,5)||"blob:"===t.substr(0,5)},e.prototype.setImageSrc=function(e,t){this.isWKWebView&&!this.isAbsoluteUrl(t)?this.fetchLocalFileViaCordovaAsURL(t,function(t){e.src=t},function(t){alert("Failed to load image: "+t)}):this.isPreview&&!this.isAbsoluteUrl(t)?e.src=this.getLocalFileUrl(t):(this.isAbsoluteUrl(t)||(t=t.toLowerCase()),e.src=t)},e.prototype.getPreferredAudioFile=function(t){var e=t.toLowerCase();if(!this.audio_files_map.hasOwnProperty(e))return null;for(var i,r,s=this.audio_files_map[e],n=null,o=0,a=s.length;o<a;++o)if(r=(i=s[o])[0],n||"audio/webm; codecs=opus"!==r||(n=i),Y[r])return i;return n},e.prototype.getProjectAudioFileUrl=function(t){var e=t.toLowerCase(),i=this.getPreferredAudioFile(t);if(!i)return null;var r=e+i[1];return{url:this.getProjectFileUrl(r),type:i[0]}},e.prototype.getStatusInfo=function(){return{fps:this.fps,cpu:this.cpuutilisation/1e3,gpu:this.gpuLastUtilisation,layout:this.running_layout?this.running_layout.name:"",renderer:this.glUnmaskedRenderer}},e.prototype.accelerate=function(t,e,i,r,s){if(this.enhancedAccelerationPrecision){var n=e*s,o=i*s;return cr.clamp(t*s+.5*r*s*s,n,o)}return t*s},cr.runtime=e,cr.createRuntime=function(t){return new e(t)},window.cr_createRuntime=cr.createRuntime}(),window.cr_getSnapshot=function(t,e){var i=window.c3runtime;i&&i.doCanvasSnapshot(t,e)},window.cr_sizeCanvas=function(t,e){var i;0===t||0===e||(i=window.c3runtime)&&i.setSize(t,e)},window.cr_setSuspended=function(t){var e=window.c3runtime;e&&e.setSuspended(t)},function(){function a(t,e){return t.zindex-e.zindex}function t(t,e){this.layout=t,this.runtime=t.runtime,this.instances=[],this.scale=1,this.angle=0,this.disableAngle=!1,this.tmprect=new cr.rect(0,0,0,0),this.tmpquad=new cr.quad,this.viewLeft=0,this.viewRight=0,this.viewTop=0,this.viewBottom=0,this.zindices_stale=!1,this.zindices_stale_from=-1,this.clear_earlyz_index=0,this.name=e[0],this.index=e[1],this.sid=e[2],this.visible=e[3],this.background_color=e[4],this.transparent=e[5],this.parallaxX=e[6],this.parallaxY=e[7],this.opacity=e[8],this.forceOwnTexture=e[9],this.useRenderCells=e[10],this.zoomRate=e[11],this.blend_mode=e[12],this.effect_fallback=e[13],this.compositeOp="source-over",this.srcBlend=0,this.destBlend=0,this.render_grid=null,this.last_render_list=h(),this.render_list_stale=!0,this.last_render_cells=new cr.rect(0,0,-1,-1),this.cur_render_cells=new cr.rect(0,0,-1,-1),this.useRenderCells&&(this.render_grid=new cr.RenderGrid(this.runtime.original_width,this.runtime.original_height)),this.render_offscreen=!1;var i,r,s=e[14];for(this.startup_initial_instances=[],this.initial_instances=[],this.created_globals=[],i=0,r=s.length;i<r;i++){var n=s[i],o=this.runtime.types_by_index[n[1]];o.default_instance||(o.default_instance=n,o.default_layerindex=this.index),this.initial_instances.push(n),-1===this.layout.initial_types.indexOf(o)&&this.layout.initial_types.push(o)}for(cr.shallowAssignArray(this.startup_initial_instances,this.initial_instances),this.effect_types=[],this.active_effect_types=[],this.shaders_preserve_opaqueness=!0,this.effect_params=[],i=0,r=e[15].length;i<r;i++)this.effect_types.push({id:e[15][i][0],name:e[15][i][1],shaderindex:-1,preservesOpaqueness:!1,active:!0,index:i}),this.effect_params.push(e[15][i][2].slice(0));this.updateActiveEffects(),this.rcTexBounce=new cr.rect(0,0,1,1),this.rcTexDest=new cr.rect(0,0,1,1),this.rcTexOrigin=new cr.rect(0,0,1,1)}t.prototype.updateActiveEffects=function(){var t,e,i;for(cr.clearArray(this.active_effect_types),this.shaders_preserve_opaqueness=!0,t=0,e=this.effect_types.length;t<e;t++)(i=this.effect_types[t]).active&&(this.active_effect_types.push(i),i.preservesOpaqueness||(this.shaders_preserve_opaqueness=!1))},t.prototype.getEffectByName=function(t){for(var e,i=0,r=this.effect_types.length;i<r;i++)if((e=this.effect_types[i]).name===t)return e;return null},t.prototype.createInitialInstances=function(t){for(var e,i,r,s,n=0,o=0,a=this.initial_instances.length;n<a;n++){if(i=this.initial_instances[n],r=this.runtime.types_by_index[i[1]],s=!0,!this.runtime.typeHasPersistBehavior(r)||this.layout.first_visit){if(!(e=this.runtime.createInstanceFromInit(i,this,!0)))continue;t.push(e),e.type.global&&(s=!1,this.created_globals.push(e.uid))}s&&(this.initial_instances[o]=this.initial_instances[n],o++)}this.initial_instances.length=o,this.runtime.ClearDeathRow(),!this.runtime.glwrap&&this.effect_types.length&&(this.blend_mode=this.effect_fallback),this.compositeOp=cr.effectToCompositeOp(this.blend_mode),this.runtime.gl&&cr.setGLBlend(this,this.blend_mode,this.runtime.gl),this.render_list_stale=!0},t.prototype.recreateInitialObjects=function(t,e){for(var i,r,s,n,o,a,h,c,l,u=this.runtime.types_by_index,p=t.is_family,d=t.members,g=0,f=this.initial_instances.length;g<f;++g)if(n=(s=(i=this.initial_instances[g])[0])[0],o=s[1],e.contains_pt(n,o)){if((r=u[i[1]])!==t){if(!p)continue;if(d.indexOf(r)<0)continue}if(a=this.runtime.createInstanceFromInit(i,this,!1),this.runtime.isInOnDestroy++,this.runtime.trigger(Object.getPrototypeOf(r.plugin).cnds.OnCreated,a),a.is_contained)for(h=0,c=a.siblings.length;h<c;h++)l=a.siblings[g],this.runtime.trigger(Object.getPrototypeOf(l.type.plugin).cnds.OnCreated,l);this.runtime.isInOnDestroy--}},t.prototype.removeFromInstanceList=function(t,e){var i=cr.fastIndexOf(this.instances,t);i<0||(e&&this.useRenderCells&&t.rendercells&&t.rendercells.right>=t.rendercells.left&&(t.update_bbox(),this.render_grid.update(t,t.rendercells,null),t.rendercells.set(0,0,-1,-1)),i===this.instances.length-1?this.instances.pop():(cr.arrayRemove(this.instances,i),this.setZIndicesStaleFrom(i)),this.render_list_stale=!0)},t.prototype.appendToInstanceList=function(t,e){t.zindex=this.instances.length,this.instances.push(t),e&&this.useRenderCells&&t.rendercells&&t.set_bbox_changed(),this.render_list_stale=!0},t.prototype.prependToInstanceList=function(t,e){this.instances.unshift(t),this.setZIndicesStaleFrom(0),e&&this.useRenderCells&&t.rendercells&&t.set_bbox_changed()},t.prototype.moveInstanceAdjacent=function(t,e,i){var r=t.get_zindex(),s=e.get_zindex();cr.arrayRemove(this.instances,r),r<s&&s--,i&&s++,s===this.instances.length?this.instances.push(t):this.instances.splice(s,0,t),this.setZIndicesStaleFrom(r<s?r:s)},t.prototype.setZIndicesStaleFrom=function(t){(-1===this.zindices_stale_from||t<this.zindices_stale_from)&&(this.zindices_stale_from=t),this.zindices_stale=!0,this.render_list_stale=!0},t.prototype.updateZIndices=function(){if(this.zindices_stale){var t,e,i;if(-1===this.zindices_stale_from&&(this.zindices_stale_from=0),this.useRenderCells)for(t=this.zindices_stale_from,e=this.instances.length;t<e;++t)(i=this.instances[t]).zindex=t,this.render_grid.markRangeChanged(i.rendercells);else for(t=this.zindices_stale_from,e=this.instances.length;t<e;++t)this.instances[t].zindex=t;this.zindices_stale=!1,this.zindices_stale_from=-1}},t.prototype.getScale=function(t){return this.getNormalScale()*(this.runtime.fullscreenScalingQuality||t?this.runtime.aspect_scale:1)},t.prototype.getNormalScale=function(){return(this.scale*this.layout.scale-1)*this.zoomRate+1},t.prototype.getAngle=function(){return this.disableAngle?0:cr.clamp_angle(this.layout.angle+this.angle)};var e=[];function h(){return e.length?e.pop():[]}function d(t){cr.clearArray(t),e.push(t)}var c=[];function i(t,e){for(var i,r,s,n=0,o=t.length;n<o-1;n+=2)(function(t,e,i){var r,s,n=0,o=0,a=0,h=t.length,c=e.length;for(i.length=h+c;n<h&&o<c;++a)r=t[n],s=e[o],r.zindex<s.zindex?(i[a]=r,++n):(i[a]=s,++o);for(;n<h;++n,++a)i[a]=t[n];for(;o<c;++o,++a)i[a]=e[o]})(i=t[n],r=t[n+1],s=h()),e||(d(i),d(r)),c.push(s);o%2==1&&(e?(i=h(),cr.shallowAssignArray(i,t[o-1]),c.push(i)):c.push(t[o-1])),cr.shallowAssignArray(t,c),cr.clearArray(c)}var r=[];t.prototype.getRenderCellInstancesToDraw=function(){if(this.updateZIndices(),this.render_grid.queryRange(this.viewLeft,this.viewTop,this.viewRight,this.viewBottom,r),!r.length)return h();if(1===r.length){var t=h();return cr.shallowAssignArray(t,r[0]),cr.clearArray(r),t}var e=function(t){for(var e=!0;1<t.length;)i(t,e),e=!1;return t[0]}(r);return cr.clearArray(r),e},t.prototype.draw=function(t){this.render_offscreen=this.forceOwnTexture||1!==this.opacity||0!==this.blend_mode;var e=this.runtime.canvas,i=t,r=!1;this.render_offscreen&&(this.runtime.layer_canvas||(this.runtime.layer_canvas=document.createElement("canvas"),(e=this.runtime.layer_canvas).width=this.runtime.draw_width,e.height=this.runtime.draw_height,this.runtime.layer_ctx=e.getContext("2d"),r=!0),e=this.runtime.layer_canvas,i=this.runtime.layer_ctx,e.width!==this.runtime.draw_width&&(e.width=this.runtime.draw_width,r=!0),e.height!==this.runtime.draw_height&&(e.height=this.runtime.draw_height,r=!0),r&&(i.imageSmoothingEnabled=this.runtime.linearSampling),this.transparent&&i.clearRect(0,0,this.runtime.draw_width,this.runtime.draw_height)),i.globalAlpha=1,i.globalCompositeOperation="source-over",this.transparent||(i.fillStyle="rgb("+this.background_color[0]+","+this.background_color[1]+","+this.background_color[2]+")",i.fillRect(0,0,this.runtime.draw_width,this.runtime.draw_height)),i.save(),this.disableAngle=!0;var s=this.canvasToLayer(0,0,!0,!0),n=this.canvasToLayer(0,0,!1,!0);this.disableAngle=!1,this.runtime.pixel_rounding&&(s=Math.round(s),n=Math.round(n)),this.rotateViewport(s,n,i);var o,a=this.getScale();i.scale(a,a),i.translate(-s,-n),this.useRenderCells?(this.cur_render_cells.left=this.render_grid.XToCell(this.viewLeft),this.cur_render_cells.top=this.render_grid.YToCell(this.viewTop),this.cur_render_cells.right=this.render_grid.XToCell(this.viewRight),this.cur_render_cells.bottom=this.render_grid.YToCell(this.viewBottom),this.render_list_stale||!this.cur_render_cells.equals(this.last_render_cells)?(d(this.last_render_list),o=this.getRenderCellInstancesToDraw(),this.render_list_stale=!1,this.last_render_cells.copy(this.cur_render_cells)):o=this.last_render_list):o=this.instances;for(var h,c=null,l=0,u=o.length;l<u;++l)(h=o[l])!==c&&(this.drawInstance(h,i),c=h);this.useRenderCells&&(this.last_render_list=o),i.restore(),this.render_offscreen&&(t.globalCompositeOperation=this.compositeOp,t.globalAlpha=this.opacity,t.drawImage(e,0,0))},t.prototype.drawInstance=function(t,e){var i;t.visible&&0!==t.width&&0!==t.height&&(t.update_bbox(),(i=t.bbox).right<this.viewLeft||i.bottom<this.viewTop||i.left>this.viewRight||i.top>this.viewBottom||(e.globalCompositeOperation=t.compositeOp,t.draw(e)))},t.prototype.updateViewport=function(t){this.disableAngle=!0;var e=this.canvasToLayer(0,0,!0,!0),i=this.canvasToLayer(0,0,!1,!0);this.disableAngle=!1,this.runtime.pixel_rounding&&(e=Math.round(e),i=Math.round(i)),this.rotateViewport(e,i,t)},t.prototype.rotateViewport=function(t,e,i){var r=this.getScale();this.viewLeft=t,this.viewTop=e,this.viewRight=t+this.runtime.draw_width*(1/r),this.viewBottom=e+this.runtime.draw_height*(1/r);var s=this.getAngle();0!==s&&(i&&(i.translate(this.runtime.draw_width/2,this.runtime.draw_height/2),i.rotate(-s),i.translate(this.runtime.draw_width/-2,this.runtime.draw_height/-2)),this.tmprect.set(this.viewLeft,this.viewTop,this.viewRight,this.viewBottom),this.tmprect.offset((this.viewLeft+this.viewRight)/-2,(this.viewTop+this.viewBottom)/-2),this.tmpquad.set_from_rotated_rect(this.tmprect,s),this.tmpquad.bounding_box(this.tmprect),this.tmprect.offset((this.viewLeft+this.viewRight)/2,(this.viewTop+this.viewBottom)/2),this.viewLeft=this.tmprect.left,this.viewTop=this.tmprect.top,this.viewRight=this.tmprect.right,this.viewBottom=this.tmprect.bottom)},t.prototype.drawGL_earlyZPass=function(t){this.runtime.draw_width,this.runtime.draw_height;this.render_offscreen=this.forceOwnTexture,this.render_offscreen&&(this.runtime.layer_tex||(this.runtime.layer_tex=t.createEmptyTexture(this.runtime.draw_width,this.runtime.draw_height,this.runtime.linearSampling)),this.runtime.layer_tex.c2width===this.runtime.draw_width&&this.runtime.layer_tex.c2height===this.runtime.draw_height||(t.deleteTexture(this.runtime.layer_tex),this.runtime.layer_tex=t.createEmptyTexture(this.runtime.draw_width,this.runtime.draw_height,this.runtime.linearSampling)),t.setRenderingToTexture(this.runtime.layer_tex)),this.disableAngle=!0;var e=this.canvasToLayer(0,0,!0,!0),i=this.canvasToLayer(0,0,!1,!0);this.disableAngle=!1,this.runtime.pixel_rounding&&(e=Math.round(e),i=Math.round(i)),this.rotateViewport(e,i,null);var r,s=this.getScale();t.resetModelView(),t.scale(s,s),t.rotateZ(-this.getAngle()),t.translate((this.viewLeft+this.viewRight)/-2,(this.viewTop+this.viewBottom)/-2),t.updateModelView(),this.useRenderCells?(this.cur_render_cells.left=this.render_grid.XToCell(this.viewLeft),this.cur_render_cells.top=this.render_grid.YToCell(this.viewTop),this.cur_render_cells.right=this.render_grid.XToCell(this.viewRight),this.cur_render_cells.bottom=this.render_grid.YToCell(this.viewBottom),this.render_list_stale||!this.cur_render_cells.equals(this.last_render_cells)?(d(this.last_render_list),r=this.getRenderCellInstancesToDraw(),this.render_list_stale=!1,this.last_render_cells.copy(this.cur_render_cells)):r=this.last_render_list):r=this.instances;for(var n,o=null,a=r.length-1;0<=a;--a)(n=r[a])!==o&&(this.drawInstanceGL_earlyZPass(r[a],t),o=n);this.useRenderCells&&(this.last_render_list=r),this.transparent||(this.clear_earlyz_index=this.runtime.earlyz_index++,t.setEarlyZIndex(this.clear_earlyz_index),t.setColorFillMode(1,1,1,1),t.fullscreenQuad(),t.restoreEarlyZMode())},t.prototype.drawGL=function(t){this.runtime.draw_width,this.runtime.draw_height;var e=0,i=0;this.render_offscreen=this.forceOwnTexture||1!==this.opacity||0<this.active_effect_types.length||0!==this.blend_mode,this.render_offscreen&&(this.runtime.layer_tex||(this.runtime.layer_tex=t.createEmptyTexture(this.runtime.draw_width,this.runtime.draw_height,this.runtime.linearSampling)),this.runtime.layer_tex.c2width===this.runtime.draw_width&&this.runtime.layer_tex.c2height===this.runtime.draw_height||(t.deleteTexture(this.runtime.layer_tex),this.runtime.layer_tex=t.createEmptyTexture(this.runtime.draw_width,this.runtime.draw_height,this.runtime.linearSampling)),t.setRenderingToTexture(this.runtime.layer_tex),this.transparent&&t.clear(0,0,0,0)),this.transparent||(this.runtime.enableFrontToBack?(t.setEarlyZIndex(this.clear_earlyz_index),t.setColorFillMode(this.background_color[0]/255,this.background_color[1]/255,this.background_color[2]/255,1),t.fullscreenQuad(),t.setTextureFillMode()):t.clear(this.background_color[0]/255,this.background_color[1]/255,this.background_color[2]/255,1)),this.disableAngle=!0;var r=this.canvasToLayer(0,0,!0,!0),s=this.canvasToLayer(0,0,!1,!0);this.disableAngle=!1,this.runtime.pixel_rounding&&(r=Math.round(r),s=Math.round(s)),this.rotateViewport(r,s,null);var n,o=this.getScale();t.resetModelView(),t.scale(o,o),t.rotateZ(-this.getAngle()),t.translate((this.viewLeft+this.viewRight)/-2,(this.viewTop+this.viewBottom)/-2),t.updateModelView(),this.useRenderCells?(this.cur_render_cells.left=this.render_grid.XToCell(this.viewLeft),this.cur_render_cells.top=this.render_grid.YToCell(this.viewTop),this.cur_render_cells.right=this.render_grid.XToCell(this.viewRight),this.cur_render_cells.bottom=this.render_grid.YToCell(this.viewBottom),this.render_list_stale||!this.cur_render_cells.equals(this.last_render_cells)?(d(this.last_render_list),n=this.getRenderCellInstancesToDraw(),this.render_list_stale=!1,this.last_render_cells.copy(this.cur_render_cells)):n=this.last_render_list):n=this.instances;var a,h,c,l,u,p=null;if(2220446049250313e-31<this.getNormalScale())for(a=0,h=n.length;a<h;++a)(c=n[a])!==p&&(this.drawInstanceGL(n[a],t),p=c);this.useRenderCells&&(this.last_render_list=n),this.render_offscreen&&(e=this.active_effect_types.length?this.active_effect_types[0].shaderindex:0,i=this.active_effect_types.length?this.active_effect_types[0].index:0,0===this.active_effect_types.length||1===this.active_effect_types.length&&!t.programUsesCrossSampling(e)&&1===this.opacity?(1===this.active_effect_types.length?(t.switchProgram(e),t.setProgramParameters(this.layout.getRenderTarget(),1/this.runtime.draw_width,1/this.runtime.draw_height,0,0,1,1,0,0,1,1,this.viewLeft,this.viewTop,this.viewRight,this.viewBottom,0,0,1,1,o,this.getAngle(),this.runtime.kahanTime.sum,this.effect_params[i]),t.programIsAnimated(e)&&(this.runtime.redraw=!0)):t.switchProgram(0),t.setRenderingToTexture(this.layout.getRenderTarget()),t.setOpacity(this.opacity),t.setTexture(this.runtime.layer_tex),t.setBlend(this.srcBlend,this.destBlend),t.resetModelView(),t.updateModelView(),l=this.runtime.draw_width/2,u=this.runtime.draw_height/2,t.quad(-l,u,l,u,l,-u,-l,-u),t.setTexture(null)):this.layout.renderEffectChain(t,this,null,this.layout.getRenderTarget()))},t.prototype.drawInstanceGL=function(t,e){var i;t.visible&&0!==t.width&&0!==t.height&&(t.update_bbox(),(i=t.bbox).right<this.viewLeft||i.bottom<this.viewTop||i.left>this.viewRight||i.top>this.viewBottom||(e.setEarlyZIndex(t.earlyz_index),t.uses_shaders?this.drawInstanceWithShadersGL(t,e):(e.switchProgram(0),e.setBlend(t.srcBlend,t.destBlend),t.drawGL(e))))},t.prototype.drawInstanceGL_earlyZPass=function(t,e){var i;t.visible&&0!==t.width&&0!==t.height&&(t.update_bbox(),(i=t.bbox).right<this.viewLeft||i.bottom<this.viewTop||i.left>this.viewRight||i.top>this.viewBottom||(t.earlyz_index=this.runtime.earlyz_index++,0===t.blend_mode&&1===t.opacity&&t.shaders_preserve_opaqueness&&t.drawGL_earlyZPass&&(e.setEarlyZIndex(t.earlyz_index),t.drawGL_earlyZPass(e))))},t.prototype.drawInstanceWithShadersGL=function(t,e){var i,r,s,n,o,a,h,c,l,u,p,d,g,f,y,m=t.active_effect_types[0].shaderindex,_=t.active_effect_types[0].index,v=this.getScale();1!==t.active_effect_types.length||e.programUsesCrossSampling(m)||e.programExtendsBox(m)||(t.angle||t.layer.getAngle())&&e.programUsesDest(m)||1!==t.opacity||t.type.plugin.must_predraw?(this.layout.renderEffectChain(e,this,t,this.render_offscreen?this.runtime.layer_tex:this.layout.getRenderTarget()),e.resetModelView(),e.scale(v,v),e.rotateZ(-this.getAngle()),e.translate((this.viewLeft+this.viewRight)/-2,(this.viewTop+this.viewBottom)/-2),e.updateModelView()):(e.switchProgram(m),e.setBlend(t.srcBlend,t.destBlend),e.programIsAnimated(m)&&(this.runtime.redraw=!0),l=c=h=a=0,e.programUsesDest(m)&&(i=t.bbox,r=this.layerToCanvas(i.left,i.top,!0,!0),s=this.layerToCanvas(i.left,i.top,!1,!0),n=this.layerToCanvas(i.right,i.bottom,!0,!0),o=this.layerToCanvas(i.right,i.bottom,!1,!0),a=r/windowWidth,h=1-s/windowHeight,c=n/windowWidth,l=1-o/windowHeight),p=u=0,f=(g=d=1)/t.width,y=1/t.height,t.curFrame&&t.curFrame.sheetTex&&(u=t.curFrame.sheetTex.left,p=t.curFrame.sheetTex.top,d=t.curFrame.sheetTex.right,g=t.curFrame.sheetTex.bottom,t.curFrame.texture_img&&(f=1/t.curFrame.texture_img.width,y=1/t.curFrame.texture_img.height)),e.setProgramParameters(this.render_offscreen?this.runtime.layer_tex:this.layout.getRenderTarget(),f,y,u,p,d,g,u,p,d,g,t.bbox.left,t.bbox.top,t.bbox.right,t.bbox.bottom,a,h,c,l,v,this.getAngle(),this.runtime.kahanTime.sum,t.effect_params[_]),t.drawGL(e))},t.prototype.canvasToLayer=function(t,e,i,r){var s=this.runtime.devicePixelRatio;this.runtime.isRetina&&(t*=s,e*=s);var n=this.runtime.parallax_x_origin,o=this.runtime.parallax_y_origin,a=(this.layout.scrollX-n)*this.parallaxX+n,h=(this.layout.scrollY-o)*this.parallaxY+o,c=a,l=h,u=1/this.getScale(!r);r?(c-=this.runtime.draw_width*u/2,l-=this.runtime.draw_height*u/2):(c-=this.runtime.width*u/2,l-=this.runtime.height*u/2),c+=t*u,l+=e*u;var p,d,g,f=this.getAngle();return 0!==f&&(l-=h,g=(c-=a)*(p=Math.cos(f))-l*(d=Math.sin(f)),l=l*p+c*d,c=g,c+=a,l+=h),i?c:l},t.prototype.layerToCanvas=function(t,e,i,r){var s,n,o,a=this.runtime.parallax_x_origin,h=this.runtime.parallax_y_origin,c=(this.layout.scrollX-a)*this.parallaxX+a,l=(this.layout.scrollY-h)*this.parallaxY+h,u=c,p=l,d=this.getAngle();0!==d&&(e-=l,o=(t-=c)*(s=Math.cos(-d))-e*(n=Math.sin(-d)),e=e*s+t*n,t=o,t+=c,e+=l);var g=1/this.getScale(!r);r?(u-=this.runtime.draw_width*g/2,p-=this.runtime.draw_height*g/2):(u-=this.runtime.width*g/2,p-=this.runtime.height*g/2),u=(t-u)/g,p=(e-p)/g;var f=this.runtime.devicePixelRatio;return this.runtime.isRetina&&!r&&(u/=f,p/=f),i?u:p},t.prototype.rotatePt=function(t,e,i){if(0===this.getAngle())return i?t:e;var r=this.layerToCanvas(t,e,!0),s=this.layerToCanvas(t,e,!1);this.disableAngle=!0;var n=this.canvasToLayer(r,s,!0),o=this.canvasToLayer(r,s,!0);return this.disableAngle=!1,i?n:o},t.prototype.saveToJSON=function(){for(var t,e={s:this.scale,a:this.angle,vl:this.viewLeft,vt:this.viewTop,vr:this.viewRight,vb:this.viewBottom,v:this.visible,bc:this.background_color,t:this.transparent,px:this.parallaxX,py:this.parallaxY,o:this.opacity,zr:this.zoomRate,fx:[],cg:this.created_globals,instances:[]},i=0,r=this.effect_types.length;i<r;i++)t=this.effect_types[i],e.fx.push({name:t.name,active:t.active,params:this.effect_params[t.index]});return e},t.prototype.loadFromJSON=function(t){var e,i;this.scale=t.s,this.angle=t.a,this.viewLeft=t.vl,this.viewTop=t.vt,this.viewRight=t.vr,this.viewBottom=t.vb,this.visible=t.v,this.background_color=t.bc,this.transparent=t.t,this.parallaxX=t.px,this.parallaxY=t.py,this.opacity=t.o,this.zoomRate=t.zr,this.created_globals=t.cg||[],cr.shallowAssignArray(this.initial_instances,this.startup_initial_instances);for(var r=new cr.ObjectSet,s=0,n=this.created_globals.length;s<n;++s)r.add(this.created_globals[s]);for(e=s=0,n=this.initial_instances.length;s<n;++s)r.contains(this.initial_instances[s][2])||(this.initial_instances[e]=this.initial_instances[s],++e);cr.truncateArray(this.initial_instances,e);var o=t.fx;for(s=0,n=o.length;s<n;s++)(i=this.getEffectByName(o[s].name))&&(i.active=o[s].active,this.effect_params[i.index]=o[s].params);this.updateActiveEffects(),this.instances.sort(a),this.zindices_stale=!0},cr.layer=t}(),function(){function t(t,e){this.runtime=t,this.event_sheet=null,this.scrollX=this.runtime.original_width/2,this.scrollY=this.runtime.original_height/2,this.scale=1,this.angle=0,this.first_visit=!0,this.name=e[0],this.originalWidth=e[1],this.originalHeight=e[2],this.width=e[1],this.height=e[2],this.unbounded_scrolling=e[3],this.sheetname=e[4],this.sid=e[5];var i,r,s=e[6];for(this.layers=[],this.initial_types=[],i=0,r=s.length;i<r;i++){var n=new cr.layer(this,s[i]);n.number=i,cr.seal(n),this.layers.push(n)}var o=e[7];for(this.initial_nonworld=[],i=0,r=o.length;i<r;i++){var a=o[i],h=this.runtime.types_by_index[a[1]];h.default_instance||(h.default_instance=a),this.initial_nonworld.push(a),-1===this.initial_types.indexOf(h)&&this.initial_types.push(h)}for(this.effect_types=[],this.active_effect_types=[],this.shaders_preserve_opaqueness=!0,this.effect_params=[],i=0,r=e[8].length;i<r;i++)this.effect_types.push({id:e[8][i][0],name:e[8][i][1],shaderindex:-1,preservesOpaqueness:!1,active:!0,index:i}),this.effect_params.push(e[8][i][2].slice(0));this.updateActiveEffects(),this.rcTexBounce=new cr.rect(0,0,1,1),this.rcTexDest=new cr.rect(0,0,1,1),this.rcTexOrigin=new cr.rect(0,0,1,1),this.viewRect=new cr.rect(0,0,0,0),this.persist_data={}}t.prototype.saveObjectToPersist=function(t){var e=t.type.sid.toString();this.persist_data.hasOwnProperty(e)||(this.persist_data[e]=[]),this.persist_data[e].push(this.runtime.saveInstanceToJSON(t))},t.prototype.hasOpaqueBottomLayer=function(){var t=this.layers[0];return!t.transparent&&1===t.opacity&&!t.forceOwnTexture&&t.visible},t.prototype.updateActiveEffects=function(){var t,e,i;for(cr.clearArray(this.active_effect_types),this.shaders_preserve_opaqueness=!0,t=0,e=this.effect_types.length;t<e;t++)(i=this.effect_types[t]).active&&(this.active_effect_types.push(i),i.preservesOpaqueness||(this.shaders_preserve_opaqueness=!1))},t.prototype.getEffectByName=function(t){for(var e,i=0,r=this.effect_types.length;i<r;i++)if((e=this.effect_types[i]).name===t)return e;return null};var g=[];function f(t,e){return t.zindex-e.zindex}var y=!0;t.prototype.startRunning=function(){var t,e,i,r,s,n,o,a,h,c,l,u,p;for(this.sheetname&&(this.event_sheet=this.runtime.eventsheets[this.sheetname],this.event_sheet.updateDeepIncludes()),(this.runtime.running_layout=this).width=this.originalWidth,this.height=this.originalHeight,this.scrollX=this.runtime.original_width/2,this.scrollY=this.runtime.original_height/2,t=0,i=this.runtime.types_by_index.length;t<i;t++)if(!(s=this.runtime.types_by_index[t]).is_family)for(e=0,r=(n=s.instances).length;e<r;e++){(u=n[e]).layer&&((l=u.layer.number)>=this.layers.length&&(l=this.layers.length-1),u.layer=this.layers[l],-1===u.layer.instances.indexOf(u)&&u.layer.instances.push(u),u.layer.zindices_stale=!0)}if(!y)for(t=0,i=this.layers.length;t<i;++t)this.layers[t].instances.sort(f);for(cr.clearArray(g),this.boundScrolling(),t=0,i=this.layers.length;t<i;t++)(p=this.layers[t]).createInitialInstances(g),p.updateViewport(null);var d=!1;if(!this.first_visit){for(h in this.persist_data)if(this.persist_data.hasOwnProperty(h)){if(!(s=this.runtime.getObjectTypeBySid(parseInt(h,10)))||s.is_family||!this.runtime.typeHasPersistBehavior(s))continue;for(t=0,i=(c=this.persist_data[h]).length;t<i;t++)p=null,s.plugin.is_world&&!(p=this.getLayerBySid(c[t].w.l))||(u=this.runtime.createInstanceFromInit(s.default_instance,p,!1,0,0,!0),this.runtime.loadInstanceFromJSON(u,c[t]),d=!0,g.push(u));cr.clearArray(c)}for(t=0,i=this.layers.length;t<i;t++)this.layers[t].instances.sort(f),this.layers[t].zindices_stale=!0}for(d&&(this.runtime.ClearDeathRow(),this.runtime.refreshUidMap()),this.createAndLinkContainerInstances(g),t=0,i=this.initial_nonworld.length;t<i;t++)o=this.initial_nonworld[t],(s=this.runtime.types_by_index[o[1]]).is_contained||(u=this.runtime.createInstanceFromInit(this.initial_nonworld[t],null,!0));if(this.runtime.changelayout=null,this.runtime.ClearDeathRow(),this.runtime.ctx)for(t=0,i=this.runtime.types_by_index.length;t<i;t++)!(a=this.runtime.types_by_index[t]).is_family&&a.instances.length&&a.preloadCanvas2D&&a.preloadCanvas2D(this.runtime.ctx);if(this.runtime.isLoadingState)cr.shallowAssignArray(this.runtime.fireOnCreateAfterLoad,g);else for(t=0,i=g.length;t<i;t++)u=g[t],this.runtime.trigger(Object.getPrototypeOf(u.type.plugin).cnds.OnCreated,u);cr.clearArray(g),this.runtime.isLoadingState||this.runtime.trigger(cr.system_object.prototype.cnds.OnLayoutStart,null),this.first_visit=!1},t.prototype.createAndLinkContainerInstances=function(t){for(var e,i,r,s,n,o,a=0;a<t.length;a++)if((e=t[a]).type.is_contained)for(i=e.get_iid(),r=0,s=e.type.container.length;r<s;r++)n=e.type.container[r],e.type!==n&&(n.instances.length>i?e.siblings.push(n.instances[i]):n.default_instance&&(o=this.runtime.createInstanceFromInit(n.default_instance,e.layer,!0,e.x,e.y,!0),this.runtime.ClearDeathRow(),n.updateIIDs(),e.siblings.push(o),t.push(o)))},t.prototype.createGlobalNonWorlds=function(){for(var t,e,i=[],r=0,s=0,n=this.initial_nonworld.length;r<n;r++)t=this.initial_nonworld[r],(e=this.runtime.types_by_index[t[1]]).global?e.is_contained&&e.container.some(function(t){return t.plugin.is_world})||i.push(this.runtime.createInstanceFromInit(t,null,!0)):(this.initial_nonworld[s]=t,s++);cr.truncateArray(this.initial_nonworld,s),this.runtime.ClearDeathRow(),this.createAndLinkContainerInstances(i)},t.prototype.stopRunning=function(){var t,e,i,r,s,n,o;if(this.runtime.isLoadingState||this.runtime.trigger(cr.system_object.prototype.cnds.OnLayoutEnd,null),this.runtime.isEndingLayout=!0,cr.clearArray(this.runtime.system.waits),!this.first_visit)for(t=0,e=this.layers.length;t<e;t++)for(this.layers[t].updateZIndices(),i=0,r=(s=this.layers[t].instances).length;i<r;i++)(n=s[i]).type.global||this.runtime.typeHasPersistBehavior(n.type)&&this.saveObjectToPersist(n);for(t=0,e=this.layers.length;t<e;t++){for(i=0,r=(s=this.layers[t].instances).length;i<r;i++)(n=s[i]).type.global||this.runtime.DestroyInstance(n);this.runtime.ClearDeathRow(),cr.clearArray(s),this.layers[t].zindices_stale=!0}for(t=0,e=this.runtime.types_by_index.length;t<e;t++)if(!((o=this.runtime.types_by_index[t]).global||o.plugin.is_world||o.plugin.singleglobal||o.is_family)){for(i=0,r=o.instances.length;i<r;i++)this.runtime.DestroyInstance(o.instances[i]);this.runtime.ClearDeathRow()}y=!1,this.runtime.isEndingLayout=!1};var a=new cr.rect(0,0,0,0);t.prototype.recreateInitialObjects=function(t,e,i,r,s){var n,o;for(a.set(e,i,r,s),n=0,o=this.layers.length;n<o;n++)this.layers[n].recreateInitialObjects(t,a)},t.prototype.draw=function(t){var e,i,r,s,n=t,o=!1,a=!this.runtime.fullscreenScalingQuality;for(a&&(this.runtime.layout_canvas||(this.runtime.layout_canvas=document.createElement("canvas"),(e=this.runtime.layout_canvas).width=this.runtime.draw_width,e.height=this.runtime.draw_height,this.runtime.layout_ctx=e.getContext("2d"),o=!0),e=this.runtime.layout_canvas,n=this.runtime.layout_ctx,e.width!==this.runtime.draw_width&&(e.width=this.runtime.draw_width,o=!0),e.height!==this.runtime.draw_height&&(e.height=this.runtime.draw_height,o=!0),o&&(n.imageSmoothingEnabled=this.runtime.linearSampling)),n.globalAlpha=1,n.globalCompositeOperation="source-over",this.runtime.clearBackground&&!this.hasOpaqueBottomLayer()&&n.clearRect(0,0,this.runtime.draw_width,this.runtime.draw_height),i=0,r=this.layers.length;i<r;i++)(s=this.layers[i]).visible&&0<s.opacity&&11!==s.blend_mode&&(s.instances.length||!s.transparent)?s.draw(n):s.updateViewport(null);a&&t.drawImage(e,0,0,this.runtime.width,this.runtime.height)},t.prototype.drawGL_earlyZPass=function(t){var e,i;for(t.setEarlyZPass(!0),this.runtime.layout_tex||(this.runtime.layout_tex=t.createEmptyTexture(this.runtime.draw_width,this.runtime.draw_height,this.runtime.linearSampling)),this.runtime.layout_tex.c2width===this.runtime.draw_width&&this.runtime.layout_tex.c2height===this.runtime.draw_height||(t.deleteTexture(this.runtime.layout_tex),this.runtime.layout_tex=t.createEmptyTexture(this.runtime.draw_width,this.runtime.draw_height,this.runtime.linearSampling)),t.setRenderingToTexture(this.runtime.layout_tex),this.runtime.fullscreenScalingQuality||t.setSize(this.runtime.draw_width,this.runtime.draw_height),e=this.layers.length-1;0<=e;--e)(i=this.layers[e]).visible&&1===i.opacity&&i.shaders_preserve_opaqueness&&0===i.blend_mode&&(i.instances.length||!i.transparent)?i.drawGL_earlyZPass(t):i.updateViewport(null);t.setEarlyZPass(!1)},t.prototype.drawGL=function(t){var e,i,r,s,n,o,a,h=0<this.active_effect_types.length||this.runtime.uses_background_blending||!this.runtime.fullscreenScalingQuality||this.runtime.enableFrontToBack;for(h?(this.runtime.layout_tex||(this.runtime.layout_tex=t.createEmptyTexture(this.runtime.draw_width,this.runtime.draw_height,this.runtime.linearSampling)),this.runtime.layout_tex.c2width===this.runtime.draw_width&&this.runtime.layout_tex.c2height===this.runtime.draw_height||(t.deleteTexture(this.runtime.layout_tex),this.runtime.layout_tex=t.createEmptyTexture(this.runtime.draw_width,this.runtime.draw_height,this.runtime.linearSampling)),t.setRenderingToTexture(this.runtime.layout_tex),this.runtime.fullscreenScalingQuality||t.setSize(this.runtime.draw_width,this.runtime.draw_height)):this.runtime.layout_tex&&(t.setRenderingToTexture(null),t.deleteTexture(this.runtime.layout_tex),this.runtime.layout_tex=null),this.runtime.clearBackground&&!this.hasOpaqueBottomLayer()&&t.clear(0,0,0,0),e=0,i=this.layers.length;e<i;e++)(r=this.layers[e]).visible&&0<r.opacity&&(r.instances.length||!r.transparent)?r.drawGL(t):r.updateViewport(null);h&&(0===this.active_effect_types.length||1===this.active_effect_types.length&&this.runtime.fullscreenScalingQuality?(1===this.active_effect_types.length?(s=this.active_effect_types[0].index,n=this.calculateViewRect(),t.switchProgram(this.active_effect_types[0].shaderindex),t.setProgramParameters(null,1/this.runtime.draw_width,1/this.runtime.draw_height,0,0,1,1,0,0,1,1,n.left,n.top,n.right,n.bottom,0,0,1,1,this.scale,this.angle,this.runtime.kahanTime.sum,this.effect_params[s]),t.programIsAnimated(this.active_effect_types[0].shaderindex)&&(this.runtime.redraw=!0)):t.switchProgram(0),this.runtime.fullscreenScalingQuality||t.setSize(this.runtime.width,this.runtime.height),t.setRenderingToTexture(null),t.setDepthTestEnabled(!1),t.setOpacity(1),t.setTexture(this.runtime.layout_tex),t.setAlphaBlend(),t.resetModelView(),t.updateModelView(),o=this.runtime.width/2,a=this.runtime.height/2,t.quad(-o,a,o,a,o,-a,-o,-a),t.setTexture(null),t.setDepthTestEnabled(!0)):this.renderEffectChain(t,null,null,null))},t.prototype.getRenderTarget=function(){return 0<this.active_effect_types.length||this.runtime.uses_background_blending||!this.runtime.fullscreenScalingQuality||this.runtime.enableFrontToBack?this.runtime.layout_tex:null},t.prototype.getMinLayerScale=function(){for(var t,e=this.layers[0].getScale(),i=1,r=this.layers.length;i<r;i++)0===(t=this.layers[i]).parallaxX&&0===t.parallaxY||t.getScale()<e&&(e=t.getScale());return e},t.prototype.scrollToX=function(t){var e;this.unbounded_scrolling||(e=this.runtime.draw_width*(1/this.getMinLayerScale())/2,t>this.width-e&&(t=this.width-e),t<e&&(t=e)),this.scrollX!==t&&(this.scrollX=t,this.runtime.redraw=!0)},t.prototype.scrollToY=function(t){var e;this.unbounded_scrolling||(e=this.runtime.draw_height*(1/this.getMinLayerScale())/2,t>this.height-e&&(t=this.height-e),t<e&&(t=e)),this.scrollY!==t&&(this.scrollY=t,this.runtime.redraw=!0)},t.prototype.boundScrolling=function(){this.scrollToX(this.scrollX),this.scrollToY(this.scrollY)},t.prototype.calculateViewRect=function(){var t=this.scrollX,e=this.scrollY,i=1/(this.scale*this.runtime.aspect_scale);return t-=this.runtime.width*i/2,e-=this.runtime.height*i/2,this.viewRect.set(t,e,t+this.runtime.draw_width*i,e+this.runtime.draw_height*i),this.viewRect},t.prototype.renderEffectChain=function(t,e,i,r){var s,n=i?i.active_effect_types:e?e.active_effect_types:this.active_effect_types,o=1,a=0,h=0,c=0,l=this.runtime.draw_width,u=this.runtime.draw_height;u=i?(o=i.layer.getScale(),a=i.layer.getAngle(),h=i.layer.viewLeft,c=i.layer.viewTop,l=i.layer.viewRight,i.layer.viewBottom):e?(o=e.getScale(),a=e.getAngle(),h=e.viewLeft,c=e.viewTop,l=e.viewRight,e.viewBottom):(o=this.scale,a=this.angle,h=(s=this.calculateViewRect()).left,c=s.top,l=s.right,s.bottom);var p,d,g=this.runtime.fx_tex,f=0,y=1,m=this.runtime.draw_width,_=this.runtime.draw_height,v=m/2,b=_/2,w=e?e.rcTexBounce:this.rcTexBounce,x=e?e.rcTexDest:this.rcTexDest,T=e?e.rcTexOrigin:this.rcTexOrigin,M=0,S=0,A=0,C=0,L=m,E=m,O=_,I=_,N=0,D=0,k=i?i.layer.getAngle():0;if(i){for(K=0,Z=n.length;K<Z;K++)N+=t.getProgramBoxExtendHorizontal(n[K].shaderindex),D+=t.getProgramBoxExtendVertical(n[K].shaderindex);var P,j,B,R,z,F=i.bbox;M=e.layerToCanvas(F.left,F.top,!0,!0),A=e.layerToCanvas(F.left,F.top,!1,!0),L=e.layerToCanvas(F.right,F.bottom,!0,!0),O=e.layerToCanvas(F.right,F.bottom,!1,!0),0!==k&&(P=e.layerToCanvas(F.right,F.top,!0,!0),j=e.layerToCanvas(F.right,F.top,!1,!0),B=e.layerToCanvas(F.left,F.bottom,!0,!0),R=e.layerToCanvas(F.left,F.bottom,!1,!0),z=Math.min(M,L,P,B),L=Math.max(M,L,P,B),M=z,z=Math.min(A,O,j,R),O=Math.max(A,O,j,R),A=z),T.left=M/m,T.top=1-A/_,T.right=L/m,T.bottom=1-O/_,M-=N,A-=D,L+=N,O+=D,x.left=M/m,x.top=1-A/_,x.right=L/m,x.bottom=1-O/_,S=M=cr.floor(M),C=A=cr.floor(A),E=L=cr.ceil(L),I=O=cr.ceil(O),M<0&&(M=0),A<0&&(A=0),m<L&&(L=m),_<O&&(O=_),(S-=N)<0&&(S=0),(C-=D)<0&&(C=0),m<(E+=N)&&(E=m),_<(I+=D)&&(I=_),w.left=M/m,w.top=1-A/_,w.right=L/m,w.bottom=1-O/_}else w.left=x.left=T.left=0,w.top=x.top=T.top=0,w.right=x.right=T.right=1,w.bottom=x.bottom=x.bottom=1;var U=i&&(t.programUsesDest(n[0].shaderindex)||0!==N||0!==D||1!==i.opacity||i.type.plugin.must_predraw)||e&&!i&&1!==e.opacity;t.setAlphaBlend(),U&&(g[f]||(g[f]=t.createEmptyTexture(m,_,this.runtime.linearSampling)),g[f].c2width===m&&g[f].c2height===_||(t.deleteTexture(g[f]),g[f]=t.createEmptyTexture(m,_,this.runtime.linearSampling)),t.switchProgram(0),t.setRenderingToTexture(g[f]),p=_-C-(d=I-C),t.clearRect(S,p,E-S,d),i?i.drawGL(t):(t.setTexture(this.runtime.layer_tex),t.setOpacity(e.opacity),t.resetModelView(),t.translate(-v,-b),t.updateModelView(),t.quadTex(M,O,L,O,L,A,M,A,w)),x.left=x.top=0,x.right=x.bottom=1,i&&(z=w.top,w.top=w.bottom,w.bottom=z),f=1,y=0),t.setOpacity(1);for(var Y,Q,V,G,J,X,W=n.length-1,q=t.programUsesCrossSampling(n[W].shaderindex)||!e&&!i&&!this.runtime.fullscreenScalingQuality,H=0,K=0,Z=n.length;K<Z;K++){g[f]||(g[f]=t.createEmptyTexture(m,_,this.runtime.linearSampling)),g[f].c2width===m&&g[f].c2height===_||(t.deleteTexture(g[f]),g[f]=t.createEmptyTexture(m,_,this.runtime.linearSampling)),t.switchProgram(n[K].shaderindex),H=n[K].index,t.programIsAnimated(n[K].shaderindex)&&(this.runtime.redraw=!0),0!=K||U?(t.setProgramParameters(r,1/m,1/_,0,0,1,1,T.left,T.top,T.right,T.bottom,h,c,l,u,x.left,x.top,x.right,x.bottom,o,a,this.runtime.kahanTime.sum,i?i.effect_params[H]:e?e.effect_params[H]:this.effect_params[H]),t.setTexture(null),K!==W||q?(t.setRenderingToTexture(g[f]),p=_-C-(d=I-C),t.clearRect(S,p,E-S,d)):(i?t.setBlend(i.srcBlend,i.destBlend):e&&t.setBlend(e.srcBlend,e.destBlend),t.setRenderingToTexture(r)),t.setTexture(g[y]),t.resetModelView(),t.translate(-v,-b),t.updateModelView(),t.quadTex(M,O,L,O,L,A,M,A,w),K!==W||q||t.setTexture(null)):(t.setRenderingToTexture(g[f]),p=_-C-(d=I-C),t.clearRect(S,p,E-S,d),i?(Q=Y=0,J=(G=V=1)/i.width,X=1/i.height,i.curFrame&&i.curFrame.sheetTex&&(Y=i.curFrame.sheetTex.left,Q=i.curFrame.sheetTex.top,V=i.curFrame.sheetTex.right,G=i.curFrame.sheetTex.bottom,i.curFrame.texture_img&&(J=1/i.curFrame.texture_img.width,X=1/i.curFrame.texture_img.height)),t.setProgramParameters(r,J,X,Y,Q,V,G,Y,Q,V,G,i.bbox.left,i.bbox.top,i.bbox.right,i.bbox.bottom,x.left,x.top,x.right,x.bottom,o,a,this.runtime.kahanTime.sum,i.effect_params[H]),i.drawGL(t)):(t.setProgramParameters(r,1/m,1/_,0,0,1,1,0,0,1,1,h,c,l,u,0,0,1,1,o,a,this.runtime.kahanTime.sum,e?e.effect_params[H]:this.effect_params[H]),t.setTexture(e?this.runtime.layer_tex:this.runtime.layout_tex),t.resetModelView(),t.translate(-v,-b),t.updateModelView(),t.quadTex(M,O,L,O,L,A,M,A,w)),x.left=x.top=0,x.right=x.bottom=1,i&&!q&&(z=O,O=A,A=z)),y=0===(f=0===f?1:0)?1:0}q&&(t.switchProgram(0),i?t.setBlend(i.srcBlend,i.destBlend):e?t.setBlend(e.srcBlend,e.destBlend):this.runtime.fullscreenScalingQuality||(t.setSize(this.runtime.width,this.runtime.height),v=this.runtime.width/2,b=this.runtime.height/2,A=M=0,L=this.runtime.width,O=this.runtime.height),t.setRenderingToTexture(r),t.setTexture(g[y]),t.resetModelView(),t.translate(-v,-b),t.updateModelView(),i&&1===n.length&&!U?t.quadTex(M,A,L,A,L,O,M,O,w):t.quadTex(M,O,L,O,L,A,M,A,w),t.setTexture(null))},t.prototype.getLayerBySid=function(t){for(var e=0,i=this.layers.length;e<i;e++)if(this.layers[e].sid===t)return this.layers[e];return null},t.prototype.saveToJSON=function(){for(var t,e,i={sx:this.scrollX,sy:this.scrollY,s:this.scale,a:this.angle,w:this.width,h:this.height,fv:this.first_visit,persist:this.persist_data,fx:[],layers:{}},r=0,s=this.effect_types.length;r<s;r++)e=this.effect_types[r],i.fx.push({name:e.name,active:e.active,params:this.effect_params[e.index]});for(r=0,s=this.layers.length;r<s;r++)t=this.layers[r],i.layers[t.sid.toString()]=t.saveToJSON();return i},t.prototype.loadFromJSON=function(t){var e,i,r;this.scrollX=t.sx,this.scrollY=t.sy,this.scale=t.s,this.angle=t.a,this.width=t.w,this.height=t.h,this.persist_data=t.persist,void 0!==t.fv&&(this.first_visit=t.fv);for(var s=t.fx,n=0,o=s.length;n<o;n++)(e=this.getEffectByName(s[n].name))&&(e.active=s[n].active,this.effect_params[e.index]=s[n].params);this.updateActiveEffects();var a=t.layers;for(i in a)if(a.hasOwnProperty(i)){if(!(r=this.getLayerBySid(parseInt(i,10))))continue;r.loadFromJSON(a[i])}},cr.layout=t}(),function(){var o=[];function a(t,e){return t.index-e.index}function n(t){var e,i,r,s,n;for(2===t.length?t[0].index>t[1].index&&(s=t[0],t[0]=t[1],t[1]=s):2<t.length&&t.sort(a),t.length>=o.length&&(o.length=t.length+1),o[t.length]||(o[t.length]=[]),e=0,i=(n=o[t.length]).length;e<i;e++)if(function(t,e){var i,r=t.length;switch(r){case 0:return 1;case 1:return t[0]===e[0];case 2:return t[0]===e[0]&&t[1]===e[1];default:for(i=0;i<r;i++)if(t[i]!==e[i])return;return 1}}(t,r=n[e]))return r;return n.push(t),t}function t(t,e){this.runtime=t,this.triggers={},this.fasttriggers={},this.hasRun=!1,this.includes=new cr.ObjectSet,this.deep_includes=[],this.already_included_sheets=[],this.name=e[0];var i,r,s=e[1];for(this.events=[],i=0,r=s.length;i<r;i++)this.init_event(s[i],null,this.events)}function e(t){this.type=t,this.instances=[],this.else_instances=[],this.select_all=!0}function i(t,e,i){this.sheet=t,this.parent=e,this.runtime=t.runtime,this.solModifiers=[],this.solModifiersIncludingParents=[],this.solWriterAfterCnds=!1,this.group=!1,this.initially_activated=!1,this.toplevelevent=!1,this.toplevelgroup=!1,this.has_else_block=!1,this.conditions=[],this.actions=[],this.subevents=[],this.group_name="",this.group=!1,this.initially_activated=!1,this.group_active=!1,this.contained_includes=null,3===i[0]&&(this.group_name=i[1][1].toLowerCase(),this.group=!0,this.initially_activated=!!i[1][0],this.contained_includes=[],this.group_active=this.initially_activated,this.runtime.allGroups.push(this),this.runtime.groups_by_name[this.group_name]=this),this.orblock=i[2],this.sid=i[4],this.group||(this.runtime.blocksBySid[this.sid.toString()]=this);var r=i[6];for(h=0,c=r.length;h<c;h++){var s=new cr.condition(this,r[h]);s.index=h,cr.seal(s),this.conditions.push(s),this.addSolModifier(s.type)}var n=i[7];for(h=0,c=n.length;h<c;h++){var o=new cr.action(this,n[h]);o.index=h,cr.seal(o),this.actions.push(o)}if(9===i.length)for(var a=i[8],h=0,c=a.length;h<c;h++)this.sheet.init_event(a[h],this,this.subevents);this.is_else_block=!1,this.conditions.length&&(this.is_else_block=null==this.conditions[0].type&&this.conditions[0].func==cr.system_object.prototype.cnds.Else)}function r(t,e){var i,r,s;if(t&&(-1===e.indexOf(t)&&e.push(t),t.is_contained))for(i=0,r=t.container.length;i<r;i++)t!==(s=t.container[i])&&-1===e.indexOf(s)&&e.push(s)}function s(t,e){if(this.block=t,this.sheet=t.sheet,this.runtime=t.runtime,this.parameters=[],this.results=[],this.extra={},this.index=-1,this.anyParamVariesPerInstance=!1,this.func=this.runtime.GetObjectReference(e[1]),this.trigger=0<e[3],this.fasttrigger=2===e[3],this.looping=e[4],this.inverted=e[5],this.isstatic=e[6],this.sid=e[7],this.runtime.cndsBySid[this.sid.toString()]=this,-1===e[0]?(this.type=null,this.run=this.run_system,this.behaviortype=null,this.beh_index=-1):(this.type=this.runtime.types_by_index[e[0]],this.isstatic?this.run=this.run_static:this.run=this.run_object,e[2]?(this.behaviortype=this.type.getBehaviorByName(e[2]),this.beh_index=this.type.getBehaviorIndexByName(e[2])):(this.behaviortype=null,this.beh_index=-1),this.block.parent&&this.block.parent.setSolWriterAfterCnds()),this.fasttrigger&&(this.run=this.run_true),10===e.length){for(var i=e[9],r=0,s=i.length;r<s;r++){var n=new cr.parameter(this,i[r]);cr.seal(n),this.parameters.push(n)}this.results.length=i.length}}function h(t,e){if(this.block=t,this.sheet=t.sheet,this.runtime=t.runtime,this.parameters=[],this.results=[],this.extra={},this.index=-1,this.anyParamVariesPerInstance=!1,this.func=this.runtime.GetObjectReference(e[1]),-1===e[0]?(this.type=null,this.run=this.run_system,this.behaviortype=null,this.beh_index=-1):(this.type=this.runtime.types_by_index[e[0]],this.run=this.run_object,e[2]?(this.behaviortype=this.type.getBehaviorByName(e[2]),this.beh_index=this.type.getBehaviorIndexByName(e[2])):(this.behaviortype=null,this.beh_index=-1)),this.sid=e[3],this.runtime.actsBySid[this.sid.toString()]=this,7===e.length){for(var i=e[6],r=0,s=i.length;r<s;r++){var n=new cr.parameter(this,i[r]);cr.seal(n),this.parameters.push(n)}this.results.length=i.length}}t.prototype.toString=function(){return this.name},t.prototype.init_event=function(t,e,i){switch(t[0]){case 0:case 3:var r,s,n=new cr.eventblock(this,e,t);if(cr.seal(n),n.orblock)for(i.push(n),r=0,s=n.conditions.length;r<s;r++)n.conditions[r].trigger&&this.init_trigger(n,r);else n.is_trigger()?this.init_trigger(n,0):i.push(n);break;case 1:var o=new cr.eventvariable(this,e,t);cr.seal(o),i.push(o);break;case 2:var a=new cr.eventinclude(this,e,t);cr.seal(a),i.push(a)}},t.prototype.postInit=function(){for(var t=0,e=this.events.length;t<e;t++)this.events[t].postInit(t<e-1&&this.events[t+1].is_else_block)},t.prototype.updateDeepIncludes=function(){cr.clearArray(this.deep_includes),cr.clearArray(this.already_included_sheets),this.addDeepIncludes(this),cr.clearArray(this.already_included_sheets)},t.prototype.addDeepIncludes=function(t){for(var e,i,r=t.deep_includes,s=t.already_included_sheets,n=this.includes.valuesRef(),o=0,a=n.length;o<a;++o)i=(e=n[o]).include_sheet,!e.isActive()||t===i||-1<s.indexOf(i)||(s.push(i),i.addDeepIncludes(t),r.push(i))},t.prototype.run=function(t){var e,i;for(this.runtime.resuming_breakpoint||(this.hasRun=!0,t||(this.runtime.isRunningEvents=!0)),e=0,i=this.events.length;e<i;e++){var r=this.events[e];r.run(),this.runtime.clearSol(r.solModifiers),this.runtime.hasPendingInstances&&this.runtime.ClearDeathRow()}t||(this.runtime.isRunningEvents=!1)},t.prototype.init_trigger=function(t,e){t.orblock||this.runtime.triggers_to_postinit.push(t);var i=t.conditions[e],r=i.type?i.type.name:"system",s=i.fasttrigger,n=s?this.fasttriggers:this.triggers;n[r]||(n[r]=[]);var o,a=n[r],h=i.func;if(s){if(!i.parameters.length)return;var c,l=i.parameters[0];if(1!==l.type||2!==l.expression.type)return;var u,p,d=l.expression.value.toLowerCase();for(u=0,p=a.length;u<p;u++)if(a[u].method==h)return void((c=a[u].evs)[d]?c[d].push([t,e]):c[d]=[[t,e]]);(c={})[d]=[[t,e]],a.push({method:h,evs:c})}else{for(u=0,p=a.length;u<p;u++)if(a[u].method==h)return void a[u].evs.push([t,e]);o=h,cr.plugins_.Sprite&&o===cr.plugins_.Sprite.prototype.cnds.OnFrameChanged?a.unshift({method:h,evs:[[t,e]]}):a.push({method:h,evs:[[t,e]]})}},cr.eventsheet=t,e.prototype.hasObjects=function(){return this.select_all?this.type.instances.length:this.instances.length},e.prototype.getObjects=function(){return this.select_all?this.type.instances:this.instances},e.prototype.pick_one=function(t){var e;t&&(t.runtime.getCurrentEventStack().current_event.orblock?(this.select_all&&(cr.clearArray(this.instances),cr.shallowAssignArray(this.else_instances,t.type.instances),this.select_all=!1),-1!==(e=this.else_instances.indexOf(t))&&(this.instances.push(this.else_instances[e]),this.else_instances.splice(e,1))):(this.select_all=!1,cr.clearArray(this.instances),this.instances[0]=t))},cr.selection=e,i.prototype.postInit=function(t){var e=this.parent;if(this.group)for(this.toplevelgroup=!0;e;){if(!e.group){this.toplevelgroup=!1;break}e=e.parent}this.toplevelevent=!this.is_trigger()&&(!this.parent||this.parent.group&&this.parent.toplevelgroup),this.has_else_block=!!t;var i,r,s=this.runtime.types_by_index;if(this.solModifiers===s)this.solModifiersIncludingParents=s;else{for(this.solModifiersIncludingParents=this.solModifiers.slice(0),e=this.parent;e;){for(i=0,r=e.solModifiers.length;i<r;i++)this.addParentSolModifier(e.solModifiers[i]);e=e.parent}this.solModifiers=n(this.solModifiers),this.solModifiersIncludingParents=n(this.solModifiersIncludingParents)}for(i=0,r=this.conditions.length;i<r;i++)this.conditions[i].postInit();for(i=0,r=this.actions.length;i<r;i++)this.actions[i].postInit();for(i=0,r=this.subevents.length;i<r;i++)this.subevents[i].postInit(i<r-1&&this.subevents[i+1].is_else_block)},i.prototype.setGroupActive=function(t){if(this.group_active!==!!t){var e,i;for(this.group_active=!!t,e=0,i=this.contained_includes.length;e<i;++e)this.contained_includes[e].updateActive();0<i&&this.runtime.running_layout.event_sheet&&this.runtime.running_layout.event_sheet.updateDeepIncludes()}},i.prototype.addSolModifier=function(t){r(t,this.solModifiers)},i.prototype.addParentSolModifier=function(t){r(t,this.solModifiersIncludingParents)},i.prototype.setAllSolModifiers=function(){this.solModifiers=this.runtime.types_by_index},i.prototype.setSolWriterAfterCnds=function(){this.solWriterAfterCnds=!0,this.parent&&this.parent.setSolWriterAfterCnds()},i.prototype.is_trigger=function(){return!!this.conditions.length&&this.conditions[0].trigger},i.prototype.run=function(){var t,e,i=!1,r=this.runtime,s=this.runtime.getCurrentEventStack(),n=(s.current_event=this).conditions;if(this.is_else_block||(s.else_branch_ran=!1),this.orblock){for(0===n.length&&(i=!0),s.cndindex=0,t=n.length;s.cndindex<t;s.cndindex++)(e=n[s.cndindex]).trigger||e.run()&&(i=!0);(s.last_event_true=i)&&this.run_actions_and_subevents()}else{for(s.cndindex=0,t=n.length;s.cndindex<t;s.cndindex++)if(!n[s.cndindex].run())return s.last_event_true=!1,void(this.toplevelevent&&r.hasPendingInstances&&r.ClearDeathRow());s.last_event_true=!0,this.run_actions_and_subevents()}this.end_run(s)},i.prototype.end_run=function(t){t.last_event_true&&this.has_else_block&&(t.else_branch_ran=!0),this.toplevelevent&&this.runtime.hasPendingInstances&&this.runtime.ClearDeathRow()},i.prototype.run_orblocktrigger=function(t){(this.runtime.getCurrentEventStack().current_event=this).conditions[t].run()&&(this.run_actions_and_subevents(),this.runtime.getCurrentEventStack().last_event_true=!0)},i.prototype.run_actions_and_subevents=function(){var t,e=this.runtime.getCurrentEventStack();for(e.actindex=0,t=this.actions.length;e.actindex<t;e.actindex++)if(this.actions[e.actindex].run())return;this.run_subevents()},i.prototype.resume_actions_and_subevents=function(){for(var t=this.runtime.getCurrentEventStack(),e=this.actions.length;t.actindex<e;t.actindex++)if(this.actions[t.actindex].run())return;this.run_subevents()},i.prototype.run_subevents=function(){if(this.subevents.length){var t,e,i,r,s=this.subevents.length-1;if(this.runtime.pushEventStack(this),this.solWriterAfterCnds)for(t=0,e=this.subevents.length;t<e;t++)i=this.subevents[t],(r=!this.toplevelgroup||!this.group&&t<s)&&this.runtime.pushCopySol(i.solModifiers),i.run(),r?this.runtime.popSol(i.solModifiers):this.runtime.clearSol(i.solModifiers);else for(t=0,e=this.subevents.length;t<e;t++)this.subevents[t].run();this.runtime.popEventStack()}},i.prototype.run_pretrigger=function(){var t=this.runtime.getCurrentEventStack();t.current_event=this;var e,i=!1;for(t.cndindex=0,e=this.conditions.length;t.cndindex<e;t.cndindex++)if(this.conditions[t.cndindex].run())i=!0;else if(!this.orblock)return!1;return!this.orblock||i},i.prototype.retrigger=function(){this.runtime.execcount++;var t,e=this.runtime.getCurrentEventStack().cndindex,i=this.runtime.pushEventStack(this);if(!this.orblock)for(i.cndindex=e+1,t=this.conditions.length;i.cndindex<t;i.cndindex++)if(!this.conditions[i.cndindex].run())return this.runtime.popEventStack(),!1;return this.run_actions_and_subevents(),this.runtime.popEventStack(),!0},i.prototype.isFirstConditionOfType=function(t){var e=t.index;if(0===e)return!0;for(--e;0<=e;--e)if(this.conditions[e].type===t.type)return!1;return!0},cr.eventblock=i,s.prototype.postInit=function(){for(var t,e=0,i=this.parameters.length;e<i;e++)(t=this.parameters[e]).postInit(),t.variesPerInstance&&(this.anyParamVariesPerInstance=!0)},s.prototype.run_true=function(){return!0},s.prototype.run_system=function(){for(var t=0,e=this.parameters.length;t<e;t++)this.results[t]=this.parameters[t].get();return cr.xor(this.func.apply(this.runtime.system,this.results),this.inverted)},s.prototype.run_static=function(){for(var t=0,e=this.parameters.length;t<e;t++)this.results[t]=this.parameters[t].get();var i=this.func.apply(this.behaviortype?this.behaviortype:this.type,this.results);return this.type.applySolToContainer(),i},s.prototype.run_object=function(){var t,e,i,r,s,n,o,a,h,c=this.type,l=c.getCurrentSol(),u=this.block.orblock&&!this.trigger,p=0,d=c.is_contained,g=c.is_family,f=c.family_index,y=this.beh_index,m=-1<y,_=this.anyParamVariesPerInstance,v=this.parameters,b=this.results,w=this.inverted,x=this.func;if(_)for(t=0,i=v.length;t<i;++t)(r=v[t]).variesPerInstance||(b[t]=r.get(0));else for(t=0,i=v.length;t<i;++t)b[t]=v[t].get(0);if(l.select_all){for(cr.clearArray(l.instances),cr.clearArray(l.else_instances),A=0,C=(T=c.instances).length;A<C;++A){if(n=T[A],_)for(t=0,i=v.length;t<i;++t)(r=v[t]).variesPerInstance&&(b[t]=r.get(A));s=m?(p=0,g&&(p=n.type.family_beh_map[f]),x.apply(n.behavior_insts[y+p],b)):x.apply(n,b),cr.xor(s,w)?l.instances.push(n):u&&l.else_instances.push(n)}return c.finish&&c.finish(!0),l.select_all=!1,c.applySolToContainer(),l.hasObjects()}e=0;for(var T,M=u&&!this.block.isFirstConditionOfType(this),S=!1,A=0,C=(T=M?l.else_instances:l.instances).length;A<C;++A){if(n=T[A],_)for(t=0,i=v.length;t<i;++t)(r=v[t]).variesPerInstance&&(b[t]=r.get(A));if(s=m?(p=0,g&&(p=n.type.family_beh_map[f]),x.apply(n.behavior_insts[y+p],b)):x.apply(n,b),cr.xor(s,w))if(S=!0,M){if(l.instances.push(n),d)for(t=0,i=n.siblings.length;t<i;t++)(o=n.siblings[t]).type.getCurrentSol().instances.push(o)}else{if(T[e]=n,d)for(t=0,i=n.siblings.length;t<i;t++)(o=n.siblings[t]).type.getCurrentSol().instances[e]=o;e++}else if(M){if(T[e]=n,d)for(t=0,i=n.siblings.length;t<i;t++)(o=n.siblings[t]).type.getCurrentSol().else_instances[e]=o;e++}else if(u&&(l.else_instances.push(n),d))for(t=0,i=n.siblings.length;t<i;t++)(o=n.siblings[t]).type.getCurrentSol().else_instances.push(o)}if(cr.truncateArray(T,e),d)for(A=0,C=(h=c.container).length;A<C;A++)a=h[A].getCurrentSol(),M?cr.truncateArray(a.else_instances,e):cr.truncateArray(a.instances,e);var L=S;if(M&&!S)for(A=0,C=l.instances.length;A<C;A++){if(n=l.instances[A],_)for(t=0,i=v.length;t<i;t++)(r=v[t]).variesPerInstance&&(b[t]=r.get(A));if(s=m?x.apply(n.behavior_insts[y],b):x.apply(n,b),cr.xor(s,w)){S=!0;break}}return c.finish&&c.finish(L||u),u?S:l.hasObjects()},cr.condition=s,h.prototype.postInit=function(){for(var t,e=0,i=this.parameters.length;e<i;e++)(t=this.parameters[e]).postInit(),t.variesPerInstance&&(this.anyParamVariesPerInstance=!0)},h.prototype.run_system=function(){for(var t=this.runtime,e=this.parameters,i=this.results,r=0,s=e.length;r<s;++r)i[r]=e[r].get();return this.func.apply(t.system,i)},h.prototype.run_object=function(){var t,e,i,r,s,n,o,a=this.type,h=this.beh_index,c=a.family_index,l=this.anyParamVariesPerInstance,u=this.parameters,p=this.results,d=this.func,g=a.getCurrentSol().getObjects(),f=a.is_family,y=-1<h;if(l)for(e=0,r=u.length;e<r;++e)(s=u[e]).variesPerInstance||(p[e]=s.get(0));else for(e=0,r=u.length;e<r;++e)p[e]=u[e].get(0);for(t=0,i=g.length;t<i;++t){if(n=g[t],l)for(e=0,r=u.length;e<r;++e)(s=u[e]).variesPerInstance&&(p[e]=s.get(t));y?(o=0,f&&(o=n.type.family_beh_map[c]),d.apply(n.behavior_insts[h+o],p)):d.apply(n,p)}return!1},cr.action=h;var c=[],l=-1;function u(){return l++,c.length===l&&c.push(new cr.expvalue),c[l]}function p(){l--}function d(t,e){var i,r,s;switch(this.owner=t,this.block=t.block,this.sheet=t.sheet,this.runtime=t.runtime,this.type=e[0],this.expression=null,this.solindex=0,this.get=null,this.combosel=0,this.layout=null,this.key=0,this.object=null,this.index=0,this.varname=null,this.eventvar=null,this.fileinfo=null,this.subparams=null,this.variadicret=null,this.subparams=null,this.variadicret=null,this.variesPerInstance=!1,this.type){case 0:case 7:this.expression=new cr.expNode(this,e[1]),this.solindex=0,this.get=this.get_exp;break;case 1:case 14:this.expression=new cr.expNode(this,e[1]),this.solindex=0,this.get=this.get_exp_str,14===this.type&&(this.block.setAllSolModifiers(),this.owner instanceof cr.action&&this.block.setSolWriterAfterCnds());break;case 5:this.expression=new cr.expNode(this,e[1]),this.solindex=0,this.get=this.get_layer;break;case 3:case 8:this.combosel=e[1],this.get=this.get_combosel;break;case 16:this.combosel=e[1]?1:0,this.get=this.get_boolean;break;case 6:this.layout=this.runtime.layouts[e[1]],this.get=this.get_layout;break;case 9:this.key=e[1],this.get=this.get_key;break;case 4:this.object=this.runtime.types_by_index[e[1]],this.get=this.get_object,this.block.addSolModifier(this.object),this.owner instanceof cr.action?this.block.setSolWriterAfterCnds():this.block.parent&&this.block.parent.setSolWriterAfterCnds();break;case 10:this.index=e[1],t.type&&t.type.is_family?(this.get=this.get_familyvar,this.variesPerInstance=!0):this.get=this.get_instvar;break;case 11:this.varname=e[1],this.eventvar=null,this.get=this.get_eventvar;break;case 2:case 12:this.fileinfo=e[1],this.get=this.get_audiofile;break;case 13:for(this.get=this.get_variadic,this.subparams=[],this.variadicret=[],i=1,r=e.length;i<r;i++)s=new cr.parameter(this.owner,e[i]),cr.seal(s),this.subparams.push(s),this.variadicret.push(0)}}function g(t,e,i){this.sheet=t,this.parent=e,this.runtime=t.runtime,this.solModifiers=[],this.name=i[1],this.vartype=i[2],this.initial=i[3],this.is_static=!!i[4],this.is_constant=!!i[5],this.sid=i[6],(this.runtime.varsBySid[this.sid.toString()]=this).data=this.initial,this.parent?(this.is_static||this.is_constant?this.localIndex=-1:this.localIndex=this.runtime.stackLocalCount++,this.runtime.all_local_vars.push(this)):(this.localIndex=-1,this.runtime.all_global_vars.push(this))}function f(t,e,i){this.sheet=t,this.parent=e,this.runtime=t.runtime,this.solModifiers=[],this.include_sheet=null,this.include_sheet_name=i[1],this.active=!0}function y(){this.temp_parents_arr=[],this.reset(null),cr.seal(this)}d.prototype.postInit=function(){var t,e;if(11===this.type)this.eventvar=this.runtime.getEventVariableByName(this.varname,this.block.parent);else if(13===this.type)for(t=0,e=this.subparams.length;t<e;t++)this.subparams[t].postInit();this.expression&&this.expression.postInit()},d.prototype.maybeVaryForType=function(t){this.variesPerInstance||t&&(t.plugin.singleglobal||(this.variesPerInstance=!0))},d.prototype.setVaries=function(){this.variesPerInstance=!0},d.prototype.get_exp=function(t){this.solindex=t||0;var e=u();return this.expression.get(e),p(),e.data},d.prototype.get_exp_str=function(t){this.solindex=t||0;var e=u();return this.expression.get(e),p(),cr.is_string(e.data)?e.data:""},d.prototype.get_object=function(){return this.object},d.prototype.get_combosel=function(){return this.combosel},d.prototype.get_boolean=function(){return!!this.combosel},d.prototype.get_layer=function(t){this.solindex=t||0;var e=u();return this.expression.get(e),p(),e.is_number()?this.runtime.getLayerByNumber(e.data):this.runtime.getLayerByName(e.data)},d.prototype.get_layout=function(){return this.layout},d.prototype.get_key=function(){return this.key},d.prototype.get_instvar=function(){return this.index},d.prototype.get_familyvar=function(t){var e=t||0,i=this.owner.type,r=null,s=i.getCurrentSol(),n=s.getObjects();if(n.length)r=n[e%n.length].type;else if(s.else_instances.length)r=s.else_instances[e%s.else_instances.length].type;else{if(!i.instances.length)return 0;r=i.instances[e%i.instances.length].type}return this.index+r.family_var_map[i.family_index]},d.prototype.get_eventvar=function(){return this.eventvar},d.prototype.get_audiofile=function(){return this.fileinfo},d.prototype.get_variadic=function(){for(var t=0,e=this.subparams.length;t<e;t++)this.variadicret[t]=this.subparams[t].get();return this.variadicret},cr.parameter=d,g.prototype.postInit=function(){this.solModifiers=n(this.solModifiers)},g.prototype.setValue=function(t){var e=this.runtime.getCurrentLocalVarStack();this.parent&&!this.is_static&&e?(this.localIndex>=e.length&&(e.length=this.localIndex+1),e[this.localIndex]=t):this.data=t},g.prototype.getValue=function(){var t=this.runtime.getCurrentLocalVarStack();return!this.parent||this.is_static||!t||this.is_constant?this.data:this.localIndex>=t.length||void 0===t[this.localIndex]?this.initial:t[this.localIndex]},g.prototype.run=function(){!this.parent||this.is_static||this.is_constant||this.setValue(this.initial)},cr.eventvariable=g,f.prototype.toString=function(){return"include:"+this.include_sheet.toString()},f.prototype.postInit=function(){this.include_sheet=this.runtime.eventsheets[this.include_sheet_name],this.sheet.includes.add(this),this.solModifiers=n(this.solModifiers);for(var t=this.parent;t;)t.group&&t.contained_includes.push(this),t=t.parent;this.updateActive()},f.prototype.run=function(){this.parent&&this.runtime.pushCleanSol(this.runtime.types_by_index),this.include_sheet.hasRun||this.include_sheet.run(!0),this.parent&&this.runtime.popSol(this.runtime.types_by_index)},f.prototype.updateActive=function(){for(var t=this.parent;t;){if(t.group&&!t.group_active)return void(this.active=!1);t=t.parent}this.active=!0},f.prototype.isActive=function(){return this.active},cr.eventinclude=f,y.prototype.reset=function(t){this.current_event=t,this.cndindex=0,this.actindex=0,cr.clearArray(this.temp_parents_arr),this.last_event_true=!1,this.else_branch_ran=!1,this.any_true_state=!1},y.prototype.isModifierAfterCnds=function(){return!!this.current_event.solWriterAfterCnds||this.cndindex<this.current_event.conditions.length-1&&!!this.current_event.solModifiers.length},cr.eventStackFrame=y}(),function(){function t(t,e){this.owner=t,this.runtime=t.runtime,this.type=e[0],this.get=[this.eval_int,this.eval_float,this.eval_string,this.eval_unaryminus,this.eval_add,this.eval_subtract,this.eval_multiply,this.eval_divide,this.eval_mod,this.eval_power,this.eval_and,this.eval_or,this.eval_equal,this.eval_notequal,this.eval_less,this.eval_lessequal,this.eval_greater,this.eval_greaterequal,this.eval_conditional,this.eval_system_exp,this.eval_object_exp,this.eval_instvar_exp,this.eval_behavior_exp,this.eval_eventvar_exp][this.type];var i=null;switch(this.value=null,this.first=null,this.second=null,this.third=null,this.func=null,this.results=null,this.parameters=null,this.object_type=null,this.beh_index=-1,this.instance_expr=null,this.varindex=-1,this.behavior_type=null,this.varname=null,this.eventvar=null,this.return_string=!1,this.type){case 0:case 1:case 2:this.value=e[1];break;case 3:this.first=new cr.expNode(t,e[1]);break;case 18:this.first=new cr.expNode(t,e[1]),this.second=new cr.expNode(t,e[2]),this.third=new cr.expNode(t,e[3]);break;case 19:this.func=this.runtime.GetObjectReference(e[1]),this.func!==cr.system_object.prototype.exps.random&&this.func!==cr.system_object.prototype.exps.choose||this.owner.setVaries(),this.results=[],this.parameters=[],3===e.length?(i=e[2],this.results.length=i.length+1):this.results.length=1;break;case 20:this.object_type=this.runtime.types_by_index[e[1]],this.beh_index=-1,this.func=this.runtime.GetObjectReference(e[2]),this.return_string=e[3],cr.plugins_.Function&&this.func===cr.plugins_.Function.prototype.exps.Call&&this.owner.setVaries(),e[4]?this.instance_expr=new cr.expNode(t,e[4]):this.instance_expr=null,this.results=[],this.parameters=[],6===e.length?(i=e[5],this.results.length=i.length+1):this.results.length=1;break;case 21:this.object_type=this.runtime.types_by_index[e[1]],this.return_string=e[2],e[3]?this.instance_expr=new cr.expNode(t,e[3]):this.instance_expr=null,this.varindex=e[4];break;case 22:this.object_type=this.runtime.types_by_index[e[1]],this.behavior_type=this.object_type.getBehaviorByName(e[2]),this.beh_index=this.object_type.getBehaviorIndexByName(e[2]),this.func=this.runtime.GetObjectReference(e[3]),this.return_string=e[4],e[5]?this.instance_expr=new cr.expNode(t,e[5]):this.instance_expr=null,this.results=[],this.parameters=[],7===e.length?(i=e[6],this.results.length=i.length+1):this.results.length=1;break;case 23:this.varname=e[1],this.eventvar=null}if(this.owner.maybeVaryForType(this.object_type),4<=this.type&&this.type<=17&&(this.first=new cr.expNode(t,e[1]),this.second=new cr.expNode(t,e[2])),i)for(var r=0,s=i.length;r<s;r++)this.parameters.push(new cr.expNode(t,i[r]));cr.seal(this)}t.prototype.postInit=function(){if(23===this.type&&(this.eventvar=this.owner.runtime.getEventVariableByName(this.varname,this.owner.block.parent)),this.first&&this.first.postInit(),this.second&&this.second.postInit(),this.third&&this.third.postInit(),this.instance_expr&&this.instance_expr.postInit(),this.parameters)for(var t=0,e=this.parameters.length;t<e;t++)this.parameters[t].postInit()};var e=[],i=-1;function g(){return++i,e.length===i&&e.push(new cr.expvalue),e[i]}function f(){--i}function y(t,e,i){for(var r=0,s=t.length;r<s;++r)t[r].get(i),e[r+1]=i.data}function r(t,e){this.type=t||cr.exptype.Integer,this.data=e||0,this.object_class=null,this.type==cr.exptype.Integer&&(this.data=Math.floor(this.data)),cr.seal(this)}t.prototype.eval_system_exp=function(t){var e=this.parameters,i=this.results;i[0]=t,y(e,i,g()),f(),this.func.apply(this.runtime.system,i)},t.prototype.eval_object_exp=function(t){var e=this.object_type,i=this.results,r=this.parameters,s=this.instance_expr,n=this.func,o=this.owner.solindex,a=e.getCurrentSol(),h=a.getObjects();if(!h.length){if(!a.else_instances.length)return void(this.return_string?t.set_string(""):t.set_int(0));h=a.else_instances}(i[0]=t).object_class=e;var c=g();y(r,i,c),s&&(s.get(c),c.is_number()&&(o=c.data,h=e.instances)),f();var l=h.length;(l<=o||o<=-l)&&(o%=l),o<0&&(o+=l);n.apply(h[o],i)},t.prototype.eval_behavior_exp=function(t){var e=this.object_type,i=this.results,r=this.parameters,s=this.instance_expr,n=this.beh_index,o=this.func,a=this.owner.solindex,h=e.getCurrentSol(),c=h.getObjects();if(!c.length){if(!h.else_instances.length)return void(this.return_string?t.set_string(""):t.set_int(0));c=h.else_instances}(i[0]=t).object_class=e;var l=g();y(r,i,l),s&&(s.get(l),l.is_number()&&(a=l.data,c=e.instances)),f();var u=c.length;(u<=a||a<=-u)&&(a%=u),a<0&&(a+=u);var p=c[a],d=0;e.is_family&&(d=p.type.family_beh_map[e.family_index]);o.apply(p.behavior_insts[n+d],i)},t.prototype.eval_instvar_exp=function(t){var e,i=this.instance_expr,r=this.object_type,s=this.varindex,n=this.owner.solindex,o=r.getCurrentSol(),a=o.getObjects();if(!a.length){if(!o.else_instances.length)return void(this.return_string?t.set_string(""):t.set_int(0));a=o.else_instances}if(i){var h=g();if(i.get(h),h.is_number()){n=h.data;var c=r.instances;0!==c.length&&(n%=c.length)<0&&(n+=c.length);var l=(e=r.getInstanceByIID(n)).instance_vars[s];return cr.is_string(l)?t.set_string(l):t.set_float(l),void f()}f()}var u=a.length;(u<=n||n<=-u)&&(n%=u),n<0&&(n+=u),e=a[n];var p=0;r.is_family&&(p=e.type.family_var_map[r.family_index]);l=e.instance_vars[s+p];cr.is_string(l)?t.set_string(l):t.set_float(l)},t.prototype.eval_int=function(t){t.type=cr.exptype.Integer,t.data=this.value},t.prototype.eval_float=function(t){t.type=cr.exptype.Float,t.data=this.value},t.prototype.eval_string=function(t){t.type=cr.exptype.String,t.data=this.value},t.prototype.eval_unaryminus=function(t){this.first.get(t),t.is_number()&&(t.data=-t.data)},t.prototype.eval_add=function(t){this.first.get(t);var e=g();this.second.get(e),t.is_number()&&e.is_number()&&(t.data+=e.data,e.is_float()&&t.make_float()),f()},t.prototype.eval_subtract=function(t){this.first.get(t);var e=g();this.second.get(e),t.is_number()&&e.is_number()&&(t.data-=e.data,e.is_float()&&t.make_float()),f()},t.prototype.eval_multiply=function(t){this.first.get(t);var e=g();this.second.get(e),t.is_number()&&e.is_number()&&(t.data*=e.data,e.is_float()&&t.make_float()),f()},t.prototype.eval_divide=function(t){this.first.get(t);var e=g();this.second.get(e),t.is_number()&&e.is_number()&&(t.data/=e.data,t.make_float()),f()},t.prototype.eval_mod=function(t){this.first.get(t);var e=g();this.second.get(e),t.is_number()&&e.is_number()&&(t.data%=e.data,e.is_float()&&t.make_float()),f()},t.prototype.eval_power=function(t){this.first.get(t);var e=g();this.second.get(e),t.is_number()&&e.is_number()&&(t.data=Math.pow(t.data,e.data),e.is_float()&&t.make_float()),f()},t.prototype.eval_and=function(t){this.first.get(t);var e=g();this.second.get(e),e.is_string()||t.is_string()?this.eval_and_stringconcat(t,e):this.eval_and_logical(t,e),f()},t.prototype.eval_and_stringconcat=function(t,e){t.is_string()&&e.is_string()?this.eval_and_stringconcat_str_str(t,e):this.eval_and_stringconcat_num(t,e)},t.prototype.eval_and_stringconcat_str_str=function(t,e){t.data+=e.data},t.prototype.eval_and_stringconcat_num=function(t,e){t.is_string()?t.data+=(Math.round(1e10*e.data)/1e10).toString():t.set_string(t.data.toString()+e.data)},t.prototype.eval_and_logical=function(t,e){t.set_int(t.data&&e.data?1:0)},t.prototype.eval_or=function(t){this.first.get(t);var e=g();this.second.get(e),t.is_number()&&e.is_number()&&(t.data||e.data?t.set_int(1):t.set_int(0)),f()},t.prototype.eval_conditional=function(t){this.first.get(t),t.data?this.second.get(t):this.third.get(t)},t.prototype.eval_equal=function(t){this.first.get(t);var e=g();this.second.get(e),t.set_int(t.data===e.data?1:0),f()},t.prototype.eval_notequal=function(t){this.first.get(t);var e=g();this.second.get(e),t.set_int(t.data!==e.data?1:0),f()},t.prototype.eval_less=function(t){this.first.get(t);var e=g();this.second.get(e),t.set_int(t.data<e.data?1:0),f()},t.prototype.eval_lessequal=function(t){this.first.get(t);var e=g();this.second.get(e),t.set_int(t.data<=e.data?1:0),f()},t.prototype.eval_greater=function(t){this.first.get(t);var e=g();this.second.get(e),t.set_int(t.data>e.data?1:0),f()},t.prototype.eval_greaterequal=function(t){this.first.get(t);var e=g();this.second.get(e),t.set_int(t.data>=e.data?1:0),f()},t.prototype.eval_eventvar_exp=function(t){var e=this.eventvar.getValue();"number"==typeof e?t.set_float(e):"boolean"==typeof e?t.set_int(e?1:0):t.set_string(e)},cr.expNode=t,r.prototype.is_int=function(){return this.type===cr.exptype.Integer},r.prototype.is_float=function(){return this.type===cr.exptype.Float},r.prototype.is_number=function(){return this.type===cr.exptype.Integer||this.type===cr.exptype.Float},r.prototype.is_string=function(){return this.type===cr.exptype.String},r.prototype.make_int=function(){this.is_int()||(this.is_float()?this.data=Math.floor(this.data):this.is_string()&&(this.data=parseInt(this.data,10)),this.type=cr.exptype.Integer)},r.prototype.make_float=function(){this.is_float()||(this.is_string()&&(this.data=parseFloat(this.data)),this.type=cr.exptype.Float)},r.prototype.make_string=function(){this.is_string()||(this.data=this.data.toString(),this.type=cr.exptype.String)},r.prototype.set_int=function(t){this.type=cr.exptype.Integer,this.data=Math.floor(t)},r.prototype.set_float=function(t){this.type=cr.exptype.Float,this.data=t},r.prototype.set_string=function(t){this.type=cr.exptype.String,this.data=t},r.prototype.set_any=function(t){cr.is_number(t)?(this.type=cr.exptype.Float,this.data=t):cr.is_string(t)?(this.type=cr.exptype.String,this.data=t.toString()):(this.type=cr.exptype.Integer,this.data=0)},cr.expvalue=r,cr.exptype={Integer:0,Float:1,String:2}}(),cr.system_object=function(t){this.runtime=t,this.waits=[]},cr.system_object.prototype.saveToJSON=function(){for(var t,e,i,r,s,n,o,a={waits:[]},h=a.waits,c=0,l=this.waits.length;c<l;c++){for(o={t:(r=this.waits[c]).time,st:r.signaltag,s:r.signalled,ev:r.ev.sid,sm:[],sols:{}},r.ev.actions[r.actindex]&&(o.act=r.ev.actions[r.actindex].sid),t=0,e=r.solModifiers.length;t<e;t++)o.sm.push(r.solModifiers[t].sid);for(i in r.sols)if(r.sols.hasOwnProperty(i)){for(s=this.runtime.types_by_index[parseInt(i,10)],n={sa:r.sols[i].sa,insts:[]},t=0,e=r.sols[i].insts.length;t<e;t++)n.insts.push(r.sols[i].insts[t].uid);o.sols[s.sid.toString()]=n}h.push(o)}return a},cr.system_object.prototype.loadFromJSON=function(t){var e,i,r,s,n,o,a,h,c,l,u,p,d,g=t.waits;for(cr.clearArray(this.waits),e=0,i=g.length;e<i;e++)if(o=g[e],h=this.runtime.blocksBySid[o.ev.toString()]){for(c=-1,r=0,s=h.actions.length;r<s;r++)if(h.actions[r].sid===o.act){c=r;break}if(-1!==c){for((a={sols:{},solModifiers:[],deleteme:!1}).time=o.t,a.signaltag=o.st||"",a.signalled=!!o.s,a.ev=h,a.actindex=c,r=0,s=o.sm.length;r<s;r++)(l=this.runtime.getObjectTypeBySid(o.sm[r]))&&a.solModifiers.push(l);for(n in o.sols)if(o.sols.hasOwnProperty(n)){if(!(l=this.runtime.getObjectTypeBySid(parseInt(n,10))))continue;for(p={sa:(u=o.sols[n]).sa,insts:[]},r=0,s=u.insts.length;r<s;r++)(d=this.runtime.getObjectByUID(u.insts[r]))&&p.insts.push(d);a.sols[l.index.toString()]=p}this.waits.push(a)}}},function(){var t=cr.system_object.prototype;function e(){}e.prototype.EveryTick=function(){return!0},e.prototype.OnLayoutStart=function(){return!0},e.prototype.OnLayoutEnd=function(){return!0},e.prototype.Compare=function(t,e,i){return cr.do_cmp(t,e,i)},e.prototype.CompareTime=function(t,e){var i=this.runtime.kahanTime.sum;if(0!==t)return cr.do_cmp(i,t,e);var r=this.runtime.getCurrentCondition();return!r.extra.CompareTime_executed&&e<=i&&(r.extra.CompareTime_executed=!0)},e.prototype.LayerVisible=function(t){return!!t&&t.visible},e.prototype.LayerEmpty=function(t){return!!t&&!t.instances.length},e.prototype.LayerCmpOpacity=function(t,e,i){return!!t&&cr.do_cmp(100*t.opacity,e,i)},e.prototype.Repeat=function(t){var e,i=this.runtime.getCurrentEventStack(),r=i.current_event,s=i.isModifierAfterCnds(),n=this.runtime.pushLoopStack();if(s)for(e=0;e<t&&!n.stopped;e++)this.runtime.pushCopySol(r.solModifiers),n.index=e,r.retrigger(),this.runtime.popSol(r.solModifiers);else for(e=0;e<t&&!n.stopped;e++)n.index=e,r.retrigger();return this.runtime.popLoopStack(),!1},e.prototype.While=function(t){var e,i=this.runtime.getCurrentEventStack(),r=i.current_event,s=i.isModifierAfterCnds(),n=this.runtime.pushLoopStack();if(s)for(e=0;!n.stopped;e++)this.runtime.pushCopySol(r.solModifiers),n.index=e,r.retrigger()||(n.stopped=!0),this.runtime.popSol(r.solModifiers);else for(e=0;!n.stopped;e++)n.index=e,r.retrigger()||(n.stopped=!0);return this.runtime.popLoopStack(),!1},e.prototype.For=function(t,e,i){var r,s=this.runtime.getCurrentEventStack(),n=s.current_event,o=s.isModifierAfterCnds(),a=this.runtime.pushLoopStack(t);if(i<e)if(o)for(r=e;i<=r&&!a.stopped;--r)this.runtime.pushCopySol(n.solModifiers),a.index=r,n.retrigger(),this.runtime.popSol(n.solModifiers);else for(r=e;i<=r&&!a.stopped;--r)a.index=r,n.retrigger();else if(o)for(r=e;r<=i&&!a.stopped;++r)this.runtime.pushCopySol(n.solModifiers),a.index=r,n.retrigger(),this.runtime.popSol(n.solModifiers);else for(r=e;r<=i&&!a.stopped;++r)a.index=r,n.retrigger();return this.runtime.popLoopStack(),!1};var _=[],v=-1;function b(t,e){var i=t.extra.c2_feo_val,r=e.extra.c2_feo_val;return cr.is_number(i)&&cr.is_number(r)?i-r:(i=""+i)<(r=""+r)?-1:r<i?1:0}e.prototype.ForEach=function(t){var e=t.getCurrentSol();v++,_.length===v&&_.push([]);var i=_[v];cr.shallowAssignArray(i,e.getObjects());var r,s,n,o,a,h,c,l=this.runtime.getCurrentEventStack(),u=l.current_event,p=l.isModifierAfterCnds(),d=this.runtime.pushLoopStack(),g=t.is_contained;if(p)for(r=0,s=i.length;r<s&&!d.stopped;r++){if(this.runtime.pushCopySol(u.solModifiers),a=i[r],(e=t.getCurrentSol()).select_all=!1,cr.clearArray(e.instances),e.instances[0]=a,g)for(n=0,o=a.siblings.length;n<o;n++)(c=(h=a.siblings[n]).type.getCurrentSol()).select_all=!1,cr.clearArray(c.instances),c.instances[0]=h;d.index=r,u.retrigger(),this.runtime.popSol(u.solModifiers)}else for(e.select_all=!1,cr.clearArray(e.instances),r=0,s=i.length;r<s&&!d.stopped;r++){if(a=i[r],e.instances[0]=a,g)for(n=0,o=a.siblings.length;n<o;n++)(c=(h=a.siblings[n]).type.getCurrentSol()).select_all=!1,cr.clearArray(c.instances),c.instances[0]=h;d.index=r,u.retrigger()}return cr.clearArray(i),this.runtime.popLoopStack(),v--,!1},e.prototype.ForEachOrdered=function(t,e,i){var r=t.getCurrentSol();v++,_.length===v&&_.push([]);var s=_[v];cr.shallowAssignArray(s,r.getObjects());for(var n,o,a,h,c,l=this.runtime.getCurrentEventStack(),u=l.current_event,p=this.runtime.getCurrentCondition(),d=l.isModifierAfterCnds(),g=this.runtime.pushLoopStack(),f=0,y=s.length;f<y;f++)s[f].extra.c2_feo_val=p.parameters[1].get(f);s.sort(b),1===i&&s.reverse();var m=t.is_contained;if(d)for(f=0,y=s.length;f<y&&!g.stopped;f++){if(this.runtime.pushCopySol(u.solModifiers),a=s[f],(r=t.getCurrentSol()).select_all=!1,cr.clearArray(r.instances),r.instances[0]=a,m)for(n=0,o=a.siblings.length;n<o;n++)(c=(h=a.siblings[n]).type.getCurrentSol()).select_all=!1,cr.clearArray(c.instances),c.instances[0]=h;g.index=f,u.retrigger(),this.runtime.popSol(u.solModifiers)}else for(r.select_all=!1,cr.clearArray(r.instances),f=0,y=s.length;f<y&&!g.stopped;f++){if(a=s[f],r.instances[0]=a,m)for(n=0,o=a.siblings.length;n<o;n++)(c=(h=a.siblings[n]).type.getCurrentSol()).select_all=!1,cr.clearArray(c.instances),c.instances[0]=h;g.index=f,u.retrigger()}return cr.clearArray(s),this.runtime.popLoopStack(),v--,!1},e.prototype.PickByComparison=function(t,e,i,r){var s;if(t){v++,_.length===v&&_.push([]);var n=_[v],o=t.getCurrentSol();cr.shallowAssignArray(n,o.getObjects()),o.select_all&&cr.clearArray(o.else_instances);for(var a=this.runtime.getCurrentCondition(),h=0,c=0,l=n.length;h<l;h++)s=n[h],n[c]=s,e=a.parameters[1].get(h),r=a.parameters[3].get(h),cr.do_cmp(e,i,r)?c++:o.else_instances.push(s);return cr.truncateArray(n,c),o.select_all=!1,cr.shallowAssignArray(o.instances,n),cr.clearArray(n),v--,t.applySolToContainer(),!!o.instances.length}},e.prototype.PickByEvaluate=function(t,e){var i;if(t){v++,_.length===v&&_.push([]);var r=_[v],s=t.getCurrentSol();cr.shallowAssignArray(r,s.getObjects()),s.select_all&&cr.clearArray(s.else_instances);for(var n=this.runtime.getCurrentCondition(),o=0,a=0,h=r.length;o<h;o++)i=r[o],r[a]=i,n.parameters[1].get(o)?a++:s.else_instances.push(i);return cr.truncateArray(r,a),s.select_all=!1,cr.shallowAssignArray(s.instances,r),cr.clearArray(r),v--,t.applySolToContainer(),!!s.instances.length}},e.prototype.TriggerOnce=function(){var t=this.runtime.getCurrentCondition().extra;void 0===t.TriggerOnce_lastTick&&(t.TriggerOnce_lastTick=-1);var e=t.TriggerOnce_lastTick,i=this.runtime.tickcount;return t.TriggerOnce_lastTick=i,this.runtime.layout_first_tick||e!==i-1},e.prototype.Every=function(t){var e=this.runtime.getCurrentCondition(),i=e.extra.Every_lastTime||0,r=this.runtime.kahanTime.sum;void 0===e.extra.Every_seconds&&(e.extra.Every_seconds=t);var s=e.extra.Every_seconds;return i+s<=r?(e.extra.Every_lastTime=i+s,r>=e.extra.Every_lastTime+.04&&(e.extra.Every_lastTime=r),e.extra.Every_seconds=t,!0):(r<i-.1&&(e.extra.Every_lastTime=r),!1)},e.prototype.PickNth=function(t,e){if(!t)return!1;var i=t.getCurrentSol(),r=i.getObjects();if((e=cr.floor(e))<0||e>=r.length)return!1;var s=r[e];return i.pick_one(s),t.applySolToContainer(),!0},e.prototype.PickRandom=function(t){if(!t)return!1;var e=t.getCurrentSol(),i=e.getObjects(),r=cr.floor(Math.random()*i.length);if(r>=i.length)return!1;var s=i[r];return e.pick_one(s),t.applySolToContainer(),!0},e.prototype.CompareVar=function(t,e,i){return cr.do_cmp(t.getValue(),e,i)},e.prototype.CompareBoolVar=function(t){return t.getValue()},e.prototype.IsGroupActive=function(t){var e=this.runtime.groups_by_name[t.toLowerCase()];return e&&e.group_active},e.prototype.IsPreview=function(){return this.runtime.isPreview},e.prototype.PickAll=function(t){return!!t&&(!!t.instances.length&&(t.getCurrentSol().select_all=!0,t.applySolToContainer(),!0))},e.prototype.IsMobile=function(){return this.runtime.isMobile},e.prototype.CompareBetween=function(t,e,i){return e<=t&&t<=i},e.prototype.Else=function(){var t=this.runtime.getCurrentEventStack();return!t.else_branch_ran&&!t.last_event_true},e.prototype.OnLoadFinished=function(){return!0},e.prototype.OnCanvasSnapshot=function(){return!0},e.prototype.EffectsSupported=function(){return!!this.runtime.glwrap},e.prototype.OnSaveComplete=function(){return!0},e.prototype.OnSaveFailed=function(){return!0},e.prototype.OnLoadComplete=function(){return!0},e.prototype.OnLoadFailed=function(){return!0},e.prototype.ObjectUIDExists=function(t){return!!this.runtime.getObjectByUID(t)},e.prototype.IsOnPlatform=function(t){var e=this.runtime;switch(t){case 0:return!(e.isNodeWebkit||e.isCordova||e.isWinJS||e.isWindowsPhone8||e.isBlackberry10||e.isAmazonWebApp);case 1:return e.isiOS;case 2:return e.isAndroid;case 3:return e.isWindows8App;case 4:return e.isWindowsPhone8;case 5:return e.isBlackberry10;case 6:return e.isTizen;case 7:return!1;case 8:return e.isCordova;case 9:return e.isArcade;case 10:return e.isNodeWebkit;case 11:return e.isCrosswalk;case 12:return e.isAmazonWebApp;case 13:return e.isWindows10;default:return!1}};var i=null,r="",s="";function o(t,e){return i&&t===r&&e===s||(i=new RegExp(t,e),r=t,s=e),i.lastIndex=0,i}e.prototype.RegexTest=function(t,e,i){return o(e,i).test(t)};var l=[];function n(){}e.prototype.PickOverlappingPoint=function(t,e,i){if(!t)return!1;var r,s,n,o=t.getCurrentSol(),a=o.getObjects(),h=this.runtime.getCurrentEventStack().current_event.orblock,c=this.runtime.getCurrentCondition();for(o.select_all?(cr.shallowAssignArray(l,a),cr.clearArray(o.else_instances),o.select_all=!1,cr.clearArray(o.instances)):h?(cr.shallowAssignArray(l,o.else_instances),cr.clearArray(o.else_instances)):(cr.shallowAssignArray(l,a),cr.clearArray(o.instances)),r=0,s=l.length;r<s;++r)(n=l[r]).update_bbox(),cr.xor(n.contains_pt(e,i),c.inverted)?o.instances.push(n):o.else_instances.push(n);return t.applySolToContainer(),cr.xor(!!o.instances.length,c.inverted)},e.prototype.PickLastCreated=function(t){if(!t)return!1;for(var e,i=this.runtime.createRow,r=null,s=t.is_family,n=i.length-1;0<=n;--n)if(e=i[n],s){if(0<=e.type.families.indexOf(t)){r=e;break}}else if(e.type===t){r=e;break}return!r&&t.instances.length&&(r=t.instances[t.instances.length-1]),!!r&&(t.getCurrentSol().pick_one(r),t.applySolToContainer(),!0)},e.prototype.IsNaN=function(t){return!!isNaN(t)},e.prototype.AngleWithin=function(t,e,i){return cr.angleDiff(cr.to_radians(t),cr.to_radians(i))<=cr.to_radians(e)},e.prototype.IsClockwiseFrom=function(t,e){return cr.angleClockwise(cr.to_radians(t),cr.to_radians(e))},e.prototype.IsBetweenAngles=function(t,e,i){var r=cr.to_clamped_radians(t),s=cr.to_clamped_radians(e),n=cr.to_clamped_radians(i);return!cr.angleClockwise(n,s)?!(!cr.angleClockwise(r,s)&&cr.angleClockwise(r,n)):cr.angleClockwise(r,s)&&!cr.angleClockwise(r,n)},e.prototype.IsValueType=function(t,e){return"number"==typeof t?0===e:1===e},t.cnds=new e,n.prototype.GoToLayout=function(t){this.runtime.isloading||this.runtime.changelayout||(this.runtime.changelayout=t)},n.prototype.NextPrevLayout=function(t){var e,i;this.runtime.isloading||this.runtime.changelayout||(e=this.runtime.layouts_by_index.indexOf(this.runtime.running_layout),t&&0===e||!t&&e===this.runtime.layouts_by_index.length-1||(i=this.runtime.layouts_by_index[e+(t?-1:1)],this.runtime.changelayout=i))},n.prototype.CreateObject=function(t,e,i,r){if(e&&t){var s,n,o,a=this.runtime.createInstance(t,e,i,r);if(a){if(this.runtime.isInOnDestroy++,this.runtime.trigger(Object.getPrototypeOf(t.plugin).cnds.OnCreated,a),a.is_contained)for(s=0,n=a.siblings.length;s<n;s++)o=a.siblings[s],this.runtime.trigger(Object.getPrototypeOf(o.type.plugin).cnds.OnCreated,o);this.runtime.isInOnDestroy--;var h=t.getCurrentSol();if(h.select_all=!1,cr.clearArray(h.instances),(h.instances[0]=a).is_contained)for(s=0,n=a.siblings.length;s<n;s++)(h=(o=a.siblings[s]).type.getCurrentSol()).select_all=!1,cr.clearArray(h.instances),h.instances[0]=o}}},n.prototype.CreateObjectByName=function(t,e,i,r){var s;e&&t&&((s=this.runtime.types_lowercase[t.toLowerCase()])&&n.prototype.CreateObject.call(this,s,e,i,r))},n.prototype.SetLayerVisible=function(t,e){t&&t.visible!==e&&(t.visible=e,this.runtime.redraw=!0)},n.prototype.SetLayerOpacity=function(t,e){t&&(e=cr.clamp(e/100,0,1),t.opacity!==e&&(t.opacity=e,this.runtime.redraw=!0))},n.prototype.SetLayerScaleRate=function(t,e){t&&t.zoomRate!==e&&(t.zoomRate=e,this.runtime.redraw=!0)},n.prototype.SetLayerForceOwnTexture=function(t,e){t&&(e=!!e,t.forceOwnTexture!==e&&(t.forceOwnTexture=e,this.runtime.redraw=!0))},n.prototype.SetLayoutScale=function(t){this.runtime.running_layout&&this.runtime.running_layout.scale!==t&&(this.runtime.running_layout.scale=t,this.runtime.running_layout.boundScrolling(),this.runtime.redraw=!0)},n.prototype.ScrollX=function(t){this.runtime.running_layout.scrollToX(t)},n.prototype.ScrollY=function(t){this.runtime.running_layout.scrollToY(t)},n.prototype.Scroll=function(t,e){this.runtime.running_layout.scrollToX(t),this.runtime.running_layout.scrollToY(e)},n.prototype.ScrollToObject=function(t){var e=t.getFirstPicked();e&&(this.runtime.running_layout.scrollToX(e.x),this.runtime.running_layout.scrollToY(e.y))},n.prototype.SetVar=function(t,e){0===t.vartype?cr.is_number(e)?t.setValue(e):t.setValue(parseFloat(e)):1===t.vartype&&t.setValue(e.toString())},n.prototype.AddVar=function(t,e){0===t.vartype?cr.is_number(e)?t.setValue(t.getValue()+e):t.setValue(t.getValue()+parseFloat(e)):1===t.vartype&&t.setValue(t.getValue()+e.toString())},n.prototype.SubVar=function(t,e){0===t.vartype&&(cr.is_number(e)?t.setValue(t.getValue()-e):t.setValue(t.getValue()-parseFloat(e)))},n.prototype.SetBoolVar=function(t,e){t.setValue(0!==e)},n.prototype.ToggleBoolVar=function(t){t.setValue(!t.getValue())},n.prototype.SetGroupActive=function(t,e){var i=this.runtime.groups_by_name[t.toLowerCase()];if(i)switch(e){case 0:i.setGroupActive(!1);break;case 1:i.setGroupActive(!0);break;case 2:i.setGroupActive(!i.group_active)}},n.prototype.SetTimescale=function(t){var e=t;e<0&&(e=0),this.runtime.timescale=e},n.prototype.SetObjectTimescale=function(t,e){var i=e;if(i<0&&(i=0),t)for(var r=t.getCurrentSol().getObjects(),s=0,n=r.length;s<n;s++)r[s].my_timescale=i},n.prototype.RestoreObjectTimescale=function(t){if(!t)return!1;for(var e=t.getCurrentSol().getObjects(),i=0,r=e.length;i<r;i++)e[i].my_timescale=-1};var u=[];function h(){var t=u.length?u.pop():{sols:{},solModifiers:[]};return t.deleteme=!1,t}var p=[];function c(){var t=p.length?p.pop():{insts:[]};return t.sa=!1,t}function f(t,e){var i=t[0]-e[0];return 0!=i?i:t[1]-e[1]}function y(t,e){return t[1]-e[1]}function a(){}n.prototype.Wait=function(t){if(!(t<0)){var e,i,r,s,n,o=this.runtime.getCurrentEventStack(),a=h();for(a.time=this.runtime.kahanTime.sum+t,a.signaltag="",a.signalled=!1,a.ev=o.current_event,a.actindex=o.actindex+1,e=0,i=this.runtime.types_by_index.length;e<i;e++)(r=(s=this.runtime.types_by_index[e]).getCurrentSol()).select_all&&-1===o.current_event.solModifiers.indexOf(s)||(a.solModifiers.push(s),(n=c()).sa=r.select_all,cr.shallowAssignArray(n.insts,r.instances),a.sols[e.toString()]=n);return this.waits.push(a),!0}},n.prototype.WaitForSignal=function(t){var e,i,r,s,n,o=this.runtime.getCurrentEventStack(),a=h();for(a.time=-1,a.signaltag=t.toLowerCase(),a.signalled=!1,a.ev=o.current_event,a.actindex=o.actindex+1,e=0,i=this.runtime.types_by_index.length;e<i;e++)(r=(s=this.runtime.types_by_index[e]).getCurrentSol()).select_all&&-1===o.current_event.solModifiers.indexOf(s)||(a.solModifiers.push(s),(n=c()).sa=r.select_all,cr.shallowAssignArray(n.insts,r.instances),a.sols[e.toString()]=n);return this.waits.push(a),!0},n.prototype.Signal=function(t){for(var e,i=t.toLowerCase(),r=0,s=this.waits.length;r<s;++r)-1===(e=this.waits[r]).time&&e.signaltag===i&&(e.signalled=!0)},n.prototype.SetLayerScale=function(t,e){t&&t.scale!==e&&(t.scale=e,this.runtime.redraw=!0)},n.prototype.ResetGlobals=function(){for(var t,e=0,i=this.runtime.all_global_vars.length;e<i;e++)(t=this.runtime.all_global_vars[e]).data=t.initial},n.prototype.SetLayoutAngle=function(t){t=cr.to_radians(t),t=cr.clamp_angle(t),this.runtime.running_layout&&this.runtime.running_layout.angle!==t&&(this.runtime.running_layout.angle=t,this.runtime.redraw=!0)},n.prototype.SetLayerAngle=function(t,e){t&&(e=cr.to_radians(e),e=cr.clamp_angle(e),t.angle!==e&&(t.angle=e,this.runtime.redraw=!0))},n.prototype.SetLayerParallax=function(t,e,i){if(t&&(t.parallaxX!==e/100||t.parallaxY!==i/100)){if(t.parallaxX=e/100,t.parallaxY=i/100,1!==t.parallaxX||1!==t.parallaxY)for(var r=t.instances,s=0,n=r.length;s<n;++s)r[s].type.any_instance_parallaxed=!0;this.runtime.redraw=!0}},n.prototype.SetLayerBackground=function(t,e){var i,r,s;t&&(i=cr.clamp(Math.floor(255*cr.GetRValue(e)),0,255),r=cr.clamp(Math.floor(255*cr.GetGValue(e)),0,255),s=cr.clamp(Math.floor(255*cr.GetBValue(e)),0,255),t.background_color[0]===i&&t.background_color[1]===r&&t.background_color[2]===s||(t.background_color[0]=i,t.background_color[1]=r,t.background_color[2]=s,this.runtime.redraw=!0))},n.prototype.SetLayerTransparent=function(t,e){t&&!!e!=!!t.transparent&&(t.transparent=!!e,this.runtime.redraw=!0)},n.prototype.SetLayerBlendMode=function(t,e){t&&t.blend_mode!==e&&(t.blend_mode=e,t.compositeOp=cr.effectToCompositeOp(t.blend_mode),this.runtime.gl&&cr.setGLBlend(t,t.blend_mode,this.runtime.gl),this.runtime.redraw=!0)},n.prototype.StopLoop=function(){this.runtime.loop_stack_index<0||(this.runtime.getCurrentLoop().stopped=!0)},n.prototype.GoToLayoutByName=function(t){var e;if(!this.runtime.isloading&&!this.runtime.changelayout)for(e in this.runtime.layouts)if(this.runtime.layouts.hasOwnProperty(e)&&cr.equals_nocase(e,t))return void(this.runtime.changelayout=this.runtime.layouts[e])},n.prototype.RestartLayout=function(t){var e,i,r;if(!this.runtime.isloading&&(!this.runtime.changelayout&&this.runtime.running_layout))for(this.runtime.changelayout=this.runtime.running_layout,e=0,i=this.runtime.allGroups.length;e<i;e++)(r=this.runtime.allGroups[e]).setGroupActive(r.initially_activated)},n.prototype.SnapshotCanvas=function(t,e){this.runtime.doCanvasSnapshot(0===t?"image/png":"image/jpeg",e/100)},n.prototype.SetCanvasSize=function(t,e){var i;t<=0||e<=0||(i=this.runtime.fullscreen_mode,(document.mozFullScreen||document.webkitIsFullScreen||!!document.msFullscreenElement||document.fullScreen)&&0<this.runtime.fullscreen_scaling&&(i=this.runtime.fullscreen_scaling),0===i?this.runtime.setSize(t,e,!0):(this.runtime.original_width=t,this.runtime.original_height=e,this.runtime.setSize(this.runtime.lastWindowWidth,this.runtime.lastWindowHeight,!0)))},n.prototype.SetLayoutEffectEnabled=function(t,e){var i,r;this.runtime.running_layout&&this.runtime.glwrap&&((i=this.runtime.running_layout.getEffectByName(e))&&(r=1===t,i.active!=r&&(i.active=r,this.runtime.running_layout.updateActiveEffects(),this.runtime.redraw=!0)))},n.prototype.SetLayerEffectEnabled=function(t,e,i){var r,s;t&&this.runtime.glwrap&&((r=t.getEffectByName(i))&&(s=1===e,r.active!=s&&(r.active=s,t.updateActiveEffects(),this.runtime.redraw=!0)))},n.prototype.SetLayoutEffectParam=function(t,e,i){var r,s,n;this.runtime.running_layout&&this.runtime.glwrap&&((r=this.runtime.running_layout.getEffectByName(t))&&(s=this.runtime.running_layout.effect_params[r.index],(e=Math.floor(e))<0||e>=s.length||(1===(n=this.runtime.glwrap.getProgramParameterType(r.shaderindex,e))?i/=100:2===n&&(i=[cr.GetRValue(i),cr.GetGValue(i),cr.GetBValue(i)]),s[e]!==i&&(s[e]=i,r.active&&(this.runtime.redraw=!0)))))},n.prototype.SetLayerEffectParam=function(t,e,i,r){var s,n,o;t&&this.runtime.glwrap&&((s=t.getEffectByName(e))&&(n=t.effect_params[s.index],(i=Math.floor(i))<0||i>=n.length||(1===(o=this.runtime.glwrap.getProgramParameterType(s.shaderindex,i))?r/=100:2===o&&(r=[cr.GetRValue(r),cr.GetGValue(r),cr.GetBValue(r)]),n[i]!==r&&(n[i]=r,s.active&&(this.runtime.redraw=!0)))))},n.prototype.SaveState=function(t){this.runtime.saveToSlot=t},n.prototype.LoadState=function(t){this.runtime.loadFromSlot=t},n.prototype.LoadStateJSON=function(t){this.runtime.loadFromJson=t},n.prototype.SetHalfFramerateMode=function(t){this.runtime.halfFramerateMode=0!==t},n.prototype.SetFullscreenQuality=function(t){(document.mozFullScreen||document.webkitIsFullScreen||document.msFullscreenElement||document.fullScreen||0!==this.runtime.fullscreen_mode)&&(this.runtime.wantFullscreenScalingQuality=0!==t,this.runtime.setSize(this.runtime.lastWindowWidth,this.runtime.lastWindowHeight,!0))},n.prototype.ResetPersisted=function(){for(var t=0,e=this.runtime.layouts_by_index.length;t<e;++t)this.runtime.layouts_by_index[t].persist_data={},this.runtime.layouts_by_index[t].first_visit=!0},n.prototype.RecreateInitialObjects=function(t,e,i,r,s){t&&this.runtime.running_layout.recreateInitialObjects(t,e,i,r,s)},n.prototype.SetPixelRounding=function(t){this.runtime.pixel_rounding=0!==t,this.runtime.redraw=!0},n.prototype.SetMinimumFramerate=function(t){t<1&&(t=1),120<t&&(t=120),this.runtime.minimumFramerate=t},n.prototype.SortZOrderByInstVar=function(t,e){if(t){for(var i,r,s,n,o=t.getCurrentSol().getObjects(),a=[],h=[],c=this.runtime.running_layout,l=t.is_family,u=t.family_index,p=!1,d=0,g=o.length;d<g;++d)(i=o[d]).layer&&(r=l?i.instance_vars[e+i.type.family_var_map[u]]:i.instance_vars[e],a.push([i.layer.index,i.get_zindex()]),h.push([i,r]));if(a.length){for(a.sort(f),h.sort(y),d=0,g=a.length;d<g;++d)i=h[d][0],s=c.layers[a[d][0]],n=a[d][1],s.instances[n]!==i&&(((s.instances[n]=i).layer=s).setZIndicesStaleFrom(n),p=!0);p&&(this.runtime.redraw=!0)}}},t.acts=new n,a.prototype.int=function(t,e){cr.is_string(e)?(t.set_int(parseInt(e,10)),isNaN(t.data)&&(t.data=0)):t.set_int(e)},a.prototype.float=function(t,e){cr.is_string(e)?(t.set_float(parseFloat(e)),isNaN(t.data)&&(t.data=0)):t.set_float(e)},a.prototype.str=function(t,e){cr.is_string(e)?t.set_string(e):t.set_string(e.toString())},a.prototype.len=function(t,e){t.set_int(e.length||0)},a.prototype.random=function(t,e,i){void 0===i?t.set_float(Math.random()*e):t.set_float(Math.random()*(i-e)+e)},a.prototype.sqrt=function(t,e){t.set_float(Math.sqrt(e))},a.prototype.abs=function(t,e){t.set_float(Math.abs(e))},a.prototype.round=function(t,e){t.set_int(Math.round(e))},a.prototype.floor=function(t,e){t.set_int(Math.floor(e))},a.prototype.ceil=function(t,e){t.set_int(Math.ceil(e))},a.prototype.sign=function(t,e){t.set_float(Math.sign(e))},a.prototype.sin=function(t,e){t.set_float(Math.sin(cr.to_radians(e)))},a.prototype.cos=function(t,e){t.set_float(Math.cos(cr.to_radians(e)))},a.prototype.tan=function(t,e){t.set_float(Math.tan(cr.to_radians(e)))},a.prototype.asin=function(t,e){t.set_float(cr.to_degrees(Math.asin(e)))},a.prototype.acos=function(t,e){t.set_float(cr.to_degrees(Math.acos(e)))},a.prototype.atan=function(t,e){t.set_float(cr.to_degrees(Math.atan(e)))},a.prototype.exp=function(t,e){t.set_float(Math.exp(e))},a.prototype.ln=function(t,e){t.set_float(Math.log(e))},a.prototype.log10=function(t,e){t.set_float(Math.log(e)/Math.LN10)},a.prototype.max=function(t){var e,i,r,s=arguments[1];for("number"!=typeof s&&(s=0),e=2,i=arguments.length;e<i;e++)"number"==typeof(r=arguments[e])&&s<r&&(s=r);t.set_float(s)},a.prototype.min=function(t){var e,i,r,s=arguments[1];for("number"!=typeof s&&(s=0),e=2,i=arguments.length;e<i;e++)"number"==typeof(r=arguments[e])&&r<s&&(s=r);t.set_float(s)},a.prototype.dt=function(t){t.set_float(this.runtime.dt)},a.prototype.timescale=function(t){t.set_float(this.runtime.timescale)},a.prototype.wallclocktime=function(t){t.set_float((Date.now()-this.runtime.start_time)/1e3)},a.prototype.unixtime=function(t){t.set_float(Date.now())},a.prototype.time=function(t){t.set_float(this.runtime.kahanTime.sum)},a.prototype.tickcount=function(t){t.set_int(this.runtime.tickcount)},a.prototype.objectcount=function(t){t.set_int(this.runtime.objectcount)},a.prototype.fps=function(t){t.set_int(this.runtime.fps)},a.prototype.loopindex=function(t,e){var i,r;if(this.runtime.loop_stack.length)if(e){for(r=this.runtime.loop_stack_index;0<=r;--r)if((i=this.runtime.loop_stack[r]).name===e)return void t.set_int(i.index);t.set_int(0)}else i=this.runtime.getCurrentLoop(),t.set_int(i?i.index:-1);else t.set_int(0)},a.prototype.distance=function(t,e,i,r,s){t.set_float(cr.distanceTo(e,i,r,s))},a.prototype.angle=function(t,e,i,r,s){t.set_float(cr.to_degrees(cr.angleTo(e,i,r,s)))},a.prototype.scrollx=function(t){t.set_float(this.runtime.running_layout.scrollX)},a.prototype.scrolly=function(t){t.set_float(this.runtime.running_layout.scrollY)},a.prototype.newline=function(t){t.set_string("\n")},a.prototype.lerp=function(t,e,i,r){t.set_float(cr.lerp(e,i,r))},a.prototype.qarp=function(t,e,i,r,s){t.set_float(cr.qarp(e,i,r,s))},a.prototype.cubic=function(t,e,i,r,s,n){t.set_float(cr.cubic(e,i,r,s,n))},a.prototype.cosp=function(t,e,i,r){t.set_float(cr.cosp(e,i,r))},a.prototype.windowwidth=function(t){t.set_int(this.runtime.width)},a.prototype.windowheight=function(t){t.set_int(this.runtime.height)},a.prototype.uppercase=function(t,e){t.set_string(cr.is_string(e)?e.toUpperCase():"")},a.prototype.lowercase=function(t,e){t.set_string(cr.is_string(e)?e.toLowerCase():"")},a.prototype.clamp=function(t,e,i,r){e<i?t.set_float(i):r<e?t.set_float(r):t.set_float(e)},a.prototype.layerscale=function(t,e){var i=this.runtime.getLayer(e);i?t.set_float(i.scale):t.set_float(0)},a.prototype.layeropacity=function(t,e){var i=this.runtime.getLayer(e);i?t.set_float(100*i.opacity):t.set_float(0)},a.prototype.layerscalerate=function(t,e){var i=this.runtime.getLayer(e);i?t.set_float(i.zoomRate):t.set_float(0)},a.prototype.layerparallaxx=function(t,e){var i=this.runtime.getLayer(e);i?t.set_float(100*i.parallaxX):t.set_float(0)},a.prototype.layerparallaxy=function(t,e){var i=this.runtime.getLayer(e);i?t.set_float(100*i.parallaxY):t.set_float(0)},a.prototype.layerindex=function(t,e){var i=this.runtime.getLayer(e);i?t.set_int(i.index):t.set_int(-1)},a.prototype.layoutscale=function(t){this.runtime.running_layout?t.set_float(this.runtime.running_layout.scale):t.set_float(0)},a.prototype.layoutangle=function(t){t.set_float(cr.to_degrees(this.runtime.running_layout.angle))},a.prototype.layerangle=function(t,e){var i=this.runtime.getLayer(e);i?t.set_float(cr.to_degrees(i.angle)):t.set_float(0)},a.prototype.layoutwidth=function(t){t.set_int(this.runtime.running_layout.width)},a.prototype.layoutheight=function(t){t.set_int(this.runtime.running_layout.height)},a.prototype.find=function(t,e,i){cr.is_string(e)&&cr.is_string(i)?t.set_int(e.search(new RegExp(cr.regexp_escape(i),"i"))):t.set_int(-1)},a.prototype.findcase=function(t,e,i){cr.is_string(e)&&cr.is_string(i)?t.set_int(e.search(new RegExp(cr.regexp_escape(i),""))):t.set_int(-1)},a.prototype.left=function(t,e,i){t.set_string(cr.is_string(e)?e.substr(0,i):"")},a.prototype.right=function(t,e,i){t.set_string(cr.is_string(e)?e.substr(e.length-i):"")},a.prototype.mid=function(t,e,i,r){t.set_string(cr.is_string(e)?e.substr(i,r):"")},a.prototype.tokenat=function(t,e,i,r){var s,n;cr.is_string(e)&&cr.is_string(r)?(s=e.split(r),(n=cr.floor(i))<0||n>=s.length?t.set_string(""):t.set_string(s[n])):t.set_string("")},a.prototype.tokencount=function(t,e,i){cr.is_string(e)&&e.length?t.set_int(e.split(i).length):t.set_int(0)},a.prototype.replace=function(t,e,i,r){cr.is_string(e)&&cr.is_string(i)&&cr.is_string(r)?t.set_string(e.replace(new RegExp(cr.regexp_escape(i),"gi"),r)):t.set_string(cr.is_string(e)?e:"")},a.prototype.trim=function(t,e){t.set_string(cr.is_string(e)?e.trim():"")},a.prototype.pi=function(t){t.set_float(cr.PI)},a.prototype.layoutname=function(t){this.runtime.running_layout?t.set_string(this.runtime.running_layout.name):t.set_string("")},a.prototype.renderer=function(t){t.set_string(this.runtime.gl?"webgl":"canvas2d")},a.prototype.rendererdetail=function(t){t.set_string(this.runtime.glUnmaskedRenderer)},a.prototype.anglediff=function(t,e,i){t.set_float(cr.to_degrees(cr.angleDiff(cr.to_radians(e),cr.to_radians(i))))},a.prototype.choose=function(t){var e=cr.floor(Math.random()*(arguments.length-1));t.set_any(arguments[e+1])},a.prototype.rgb=function(t,e,i,r){t.set_int(cr.RGB(e,i,r))},a.prototype.rgbex=function(t,e,i,r){t.set_float(cr.RGBEx(e/100,i/100,r/100))},a.prototype.projectversion=function(t){t.set_string(this.runtime.versionstr)},a.prototype.projectname=function(t){t.set_string(this.runtime.name)},a.prototype.anglelerp=function(t,e,i,r){e=cr.to_radians(e),i=cr.to_radians(i);var s=cr.angleDiff(e,i);cr.angleClockwise(i,e)?t.set_float(cr.to_clamped_degrees(e+s*r)):t.set_float(cr.to_clamped_degrees(e-s*r))},a.prototype.anglerotate=function(t,e,i,r){e=cr.to_radians(e),i=cr.to_radians(i),r=cr.to_radians(r),t.set_float(cr.to_clamped_degrees(cr.angleRotate(e,i,r)))},a.prototype.zeropad=function(t,e,i){var r=e<0?"-":"";e<0&&(e=-e);for(var s=i-e.toString().length,n=0;n<s;n++)r+="0";t.set_string(r+e.toString())},a.prototype.cpuutilisation=function(t){t.set_float(this.runtime.cpuutilisation/1e3)},a.prototype.gpuutilisation=function(t){t.set_float(this.runtime.gpuLastUtilisation)},a.prototype.viewportleft=function(t,e){var i=this.runtime.getLayer(e);t.set_float(i?i.viewLeft:0)},a.prototype.viewporttop=function(t,e){var i=this.runtime.getLayer(e);t.set_float(i?i.viewTop:0)},a.prototype.viewportright=function(t,e){var i=this.runtime.getLayer(e);t.set_float(i?i.viewRight:0)},a.prototype.viewportbottom=function(t,e){var i=this.runtime.getLayer(e);t.set_float(i?i.viewBottom:0)},a.prototype.loadingprogress=function(t){t.set_float(this.runtime.loadingprogress)},a.prototype.unlerp=function(t,e,i,r){t.set_float(cr.unlerp(e,i,r))},a.prototype.canvassnapshot=function(t){t.set_string(this.runtime.snapshotData)},a.prototype.urlencode=function(t,e){t.set_string(encodeURIComponent(e))},a.prototype.urldecode=function(t,e){t.set_string(decodeURIComponent(e))},a.prototype.canvastolayerx=function(t,e,i,r){var s=this.runtime.getLayer(e);t.set_float(s?s.canvasToLayer(i,r,!0):0)},a.prototype.canvastolayery=function(t,e,i,r){var s=this.runtime.getLayer(e);t.set_float(s?s.canvasToLayer(i,r,!1):0)},a.prototype.layertocanvasx=function(t,e,i,r){var s=this.runtime.getLayer(e);t.set_float(s?s.layerToCanvas(i,r,!0):0)},a.prototype.layertocanvasy=function(t,e,i,r){var s=this.runtime.getLayer(e);t.set_float(s?s.layerToCanvas(i,r,!1):0)},a.prototype.savestatejson=function(t){t.set_string(this.runtime.lastSaveJson)},a.prototype.imagememoryusage=function(t){this.runtime.glwrap?t.set_float(Math.round(100*this.runtime.glwrap.estimateVRAM()/1048576)/100):t.set_float(0)},a.prototype.regexsearch=function(t,e,i,r){var s=o(i,r);t.set_int(e?e.search(s):-1)},a.prototype.regexreplace=function(t,e,i,r,s){var n=o(i,r);t.set_string(e?e.replace(n,s):"")};var d=[],g="",m="",w="";function x(t,e,i){var r;t===g&&e===m&&i===w||(r=o(e,i),d=t.match(r),g=t,m=e,w=i)}a.prototype.regexmatchcount=function(t,e,i,r){o(i,r);x(e.toString(),i,r),t.set_int(d?d.length:0)},a.prototype.regexmatchat=function(t,e,i,r,s){s=Math.floor(s);o(i,r);x(e.toString(),i,r),!d||s<0||s>=d.length?t.set_string(""):t.set_string(d[s])},a.prototype.infinity=function(t){t.set_float(1/0)},a.prototype.setbit=function(t,e,i,r){e|=0,i|=0,r=0!==r?1:0,t.set_int(e&~(1<<i)|r<<i)},a.prototype.togglebit=function(t,e,i){e|=0,i|=0,t.set_int(e^1<<i)},a.prototype.getbit=function(t,e,i){e|=0,i|=0,t.set_int(e&1<<i?1:0)},a.prototype.originalwindowwidth=function(t){t.set_int(this.runtime.original_width)},a.prototype.originalwindowheight=function(t){t.set_int(this.runtime.original_height)},a.prototype.originalviewportwidth=function(t){t.set_int(this.runtime.original_width)},a.prototype.originalviewportheight=function(t){t.set_int(this.runtime.original_height)},t.exps=new a,t.runWaits=function(){for(var t,e,i,r,s,n,o,a=this.runtime.getCurrentEventStack(),h=0,c=this.waits.length;h<c;h++){if(-1===(e=this.waits[h]).time){if(!e.signalled)continue}else if(e.time>this.runtime.kahanTime.sum)continue;for(i in a.current_event=e.ev,a.actindex=e.actindex,a.cndindex=0,e.sols)e.sols.hasOwnProperty(i)&&(r=this.runtime.types_by_index[parseInt(i,10)].getCurrentSol(),s=e.sols[i],r.select_all=s.sa,cr.shallowAssignArray(r.instances,s.insts),n=s,cr.clearArray(n.insts),p.push(n));e.ev.resume_actions_and_subevents(),this.runtime.clearSol(e.solModifiers),e.deleteme=!0}for(t=h=0,c=this.waits.length;h<c;h++)e=this.waits[h],(this.waits[t]=e).deleteme?(o=e,cr.wipe(o.sols),cr.clearArray(o.solModifiers),u.push(o)):t++;cr.truncateArray(this.waits,t)}}(),function(){cr.add_common_aces=function(t,e){var i=t[1],r=t[3],s=t[4],n=t[5],o=t[6],a=t[7],h=t[8];e.cnds||(e.cnds={}),e.acts||(e.acts={}),e.exps||(e.exps={});var c=e.cnds,l=e.acts,u=e.exps;r&&(c.CompareX=function(t,e){return cr.do_cmp(this.x,t,e)},c.CompareY=function(t,e){return cr.do_cmp(this.y,t,e)},c.IsOnScreen=function(){var t=this.layer;this.update_bbox();var e=this.bbox;return!(e.right<t.viewLeft||e.bottom<t.viewTop||e.left>t.viewRight||e.top>t.viewBottom)},c.IsOutsideLayout=function(){this.update_bbox();var t=this.bbox,e=this.runtime.running_layout;return t.right<0||t.bottom<0||t.left>e.width||t.top>e.height},c.PickDistance=function(t,e,i){var r=this.getCurrentSol(),s=r.getObjects();if(!s.length)return!1;for(var n,o=s[0],a=o,h=cr.distanceTo(o.x,o.y,e,i),c=1,l=s.length;c<l;c++)o=s[c],n=cr.distanceTo(o.x,o.y,e,i),(0===t&&n<h||1===t&&h<n)&&(h=n,a=o);return r.pick_one(a),!0},l.SetX=function(t){this.x!==t&&(this.x=t,this.set_bbox_changed())},l.SetY=function(t){this.y!==t&&(this.y=t,this.set_bbox_changed())},l.SetPos=function(t,e){this.x===t&&this.y===e||(this.x=t,this.y=e,this.set_bbox_changed())},l.SetPosToObject=function(t,e){var i,r,s=t.getPairedInstance(this);s&&(r=s.getImagePoint?(i=s.getImagePoint(e,!0),s.getImagePoint(e,!1)):(i=s.x,s.y),this.x===i&&this.y===r||(this.x=i,this.y=r,this.set_bbox_changed()))},l.MoveForward=function(t){0!==t&&(this.x+=Math.cos(this.angle)*t,this.y+=Math.sin(this.angle)*t,this.set_bbox_changed())},l.MoveAtAngle=function(t,e){0!==e&&(this.x+=Math.cos(cr.to_radians(t))*e,this.y+=Math.sin(cr.to_radians(t))*e,this.set_bbox_changed())},u.X=function(t){t.set_float(this.x)},u.Y=function(t){t.set_float(this.y)},u.dt=function(t){t.set_float(this.runtime.getDt(this))}),s&&(c.CompareWidth=function(t,e){return cr.do_cmp(this.width,t,e)},c.CompareHeight=function(t,e){return cr.do_cmp(this.height,t,e)},l.SetWidth=function(t){this.width!==t&&(this.width=t,this.set_bbox_changed())},l.SetHeight=function(t){this.height!==t&&(this.height=t,this.set_bbox_changed())},l.SetSize=function(t,e){this.width===t&&this.height===e||(this.width=t,this.height=e,this.set_bbox_changed())},u.Width=function(t){t.set_float(this.width)},u.Height=function(t){t.set_float(this.height)},u.BBoxLeft=function(t){this.update_bbox(),t.set_float(this.bbox.left)},u.BBoxTop=function(t){this.update_bbox(),t.set_float(this.bbox.top)},u.BBoxRight=function(t){this.update_bbox(),t.set_float(this.bbox.right)},u.BBoxBottom=function(t){this.update_bbox(),t.set_float(this.bbox.bottom)}),n&&(c.AngleWithin=function(t,e){return cr.angleDiff(this.angle,cr.to_radians(e))<=cr.to_radians(t)},c.IsClockwiseFrom=function(t){return cr.angleClockwise(this.angle,cr.to_radians(t))},c.IsBetweenAngles=function(t,e){var i=cr.to_clamped_radians(t),r=cr.to_clamped_radians(e),s=cr.clamp_angle(this.angle);return!cr.angleClockwise(r,i)?!(!cr.angleClockwise(s,i)&&cr.angleClockwise(s,r)):cr.angleClockwise(s,i)&&!cr.angleClockwise(s,r)},l.SetAngle=function(t){var e=cr.to_radians(cr.clamp_angle_degrees(t));isNaN(e)||this.angle!==e&&(this.angle=e,this.set_bbox_changed())},l.RotateClockwise=function(t){0===t||isNaN(t)||(this.angle+=cr.to_radians(t),this.angle=cr.clamp_angle(this.angle),this.set_bbox_changed())},l.RotateCounterclockwise=function(t){0===t||isNaN(t)||(this.angle-=cr.to_radians(t),this.angle=cr.clamp_angle(this.angle),this.set_bbox_changed())},l.RotateTowardAngle=function(t,e){var i=cr.angleRotate(this.angle,cr.to_radians(e),cr.to_radians(t));isNaN(i)||this.angle!==i&&(this.angle=i,this.set_bbox_changed())},l.RotateTowardPosition=function(t,e,i){var r=e-this.x,s=i-this.y,n=Math.atan2(s,r),o=cr.angleRotate(this.angle,n,cr.to_radians(t));isNaN(o)||this.angle!==o&&(this.angle=o,this.set_bbox_changed())},l.SetTowardPosition=function(t,e){var i=t-this.x,r=e-this.y,s=Math.atan2(r,i);isNaN(s)||this.angle!==s&&(this.angle=s,this.set_bbox_changed())},u.Angle=function(t){t.set_float(cr.to_clamped_degrees(this.angle))}),i||(c.CompareInstanceVar=function(t,e,i){return cr.do_cmp(this.instance_vars[t],e,i)},c.IsBoolInstanceVarSet=function(t){return this.instance_vars[t]},c.PickInstVarHiLow=function(t,e){var i=this.getCurrentSol(),r=i.getObjects();if(!r.length)return!1;for(var s,n=r[0],o=n,a=n.instance_vars[e],h=1,c=r.length;h<c;h++)s=(n=r[h]).instance_vars[e],(0===t&&s<a||1===t&&a<s)&&(a=s,o=n);return i.pick_one(o),!0},c.PickByUID=function(t){var e,i,r,s,n,o,a;if(this.runtime.getCurrentCondition().inverted){if((a=this.getCurrentSol()).select_all){for(a.select_all=!1,cr.clearArray(a.instances),cr.clearArray(a.else_instances),e=0,i=(o=this.instances).length;e<i;e++)(s=o[e]).uid===t?a.else_instances.push(s):a.instances.push(s);return this.applySolToContainer(),!!a.instances.length}for(r=e=0,i=a.instances.length;e<i;e++)s=a.instances[e],(a.instances[r]=s).uid===t?a.else_instances.push(s):r++;return cr.truncateArray(a.instances,r),this.applySolToContainer(),!!a.instances.length}if(!(s=this.runtime.getObjectByUID(t)))return!1;if(!(a=this.getCurrentSol()).select_all&&-1===a.instances.indexOf(s))return!1;if(this.is_family){for(e=0,i=(n=s.type.families).length;e<i;e++)if(n[e]===this)return a.pick_one(s),this.applySolToContainer(),!0}else if(s.type===this)return a.pick_one(s),this.applySolToContainer(),!0;return!1},c.OnCreated=function(){return!0},c.OnDestroyed=function(){return!0},l.SetInstanceVar=function(t,e){var i=this.instance_vars;cr.is_number(i[t])?cr.is_number(e)?i[t]=e:i[t]=parseFloat(e):cr.is_string(i[t])&&(cr.is_string(e)?i[t]=e:i[t]=e.toString())},l.AddInstanceVar=function(t,e){var i=this.instance_vars;cr.is_number(i[t])?cr.is_number(e)?i[t]+=e:i[t]+=parseFloat(e):cr.is_string(i[t])&&(cr.is_string(e)?i[t]+=e:i[t]+=e.toString())},l.SubInstanceVar=function(t,e){var i=this.instance_vars;cr.is_number(i[t])&&(cr.is_number(e)?i[t]-=e:i[t]-=parseFloat(e))},l.SetBoolInstanceVar=function(t,e){this.instance_vars[t]=e?1:0},l.ToggleBoolInstanceVar=function(t){this.instance_vars[t]=1-this.instance_vars[t]},l.Destroy=function(){this.runtime.DestroyInstance(this)},l.LoadFromJsonString||(l.LoadFromJsonString=function(t){var e,i,r,s;try{e=JSON.parse(t)}catch(t){return}if(this.runtime.loadInstanceFromJSON(this,e,!0),this.afterLoad&&this.afterLoad(),this.behavior_insts)for(i=0,r=this.behavior_insts.length;i<r;++i)(s=this.behavior_insts[i]).afterLoad&&s.afterLoad()}),u.Count=function(t){for(var e,i=t.object_class.instances.length,r=0,s=this.runtime.createRow.length;r<s;r++)e=this.runtime.createRow[r],t.object_class.is_family?0<=e.type.families.indexOf(t.object_class)&&i++:e.type===t.object_class&&i++;t.set_int(i)},u.PickedCount=function(t){t.set_int(t.object_class.getCurrentSol().getObjects().length)},u.UID=function(t){t.set_int(this.uid)},u.IID=function(t){t.set_int(this.get_iid())},u.AsJSON||(u.AsJSON=function(t){t.set_string(JSON.stringify(this.runtime.saveInstanceToJSON(this,!0)))})),o&&(c.IsVisible=function(){return this.visible},l.SetVisible=function(t){(t=2===t?!this.visible:0!==t)!==this.visible&&(this.visible=t,this.runtime.redraw=!0)},c.CompareOpacity=function(t,e){return cr.do_cmp(cr.round6dp(100*this.opacity),t,e)},l.SetOpacity=function(t){var e=t/100;e<0?e=0:1<e&&(e=1),e!==this.opacity&&(this.opacity=e,this.runtime.redraw=!0)},u.Opacity=function(t){t.set_float(cr.round6dp(100*this.opacity))}),a&&(c.IsOnLayer=function(t){return!!t&&this.layer===t},c.PickTopBottom=function(t){var e=this.getCurrentSol(),i=e.getObjects();if(!i.length)return!1;for(var r=i[0],s=r,n=1,o=i.length;n<o;n++)r=i[n],0===t?(r.layer.index>s.layer.index||r.layer.index===s.layer.index&&r.get_zindex()>s.get_zindex())&&(s=r):(r.layer.index<s.layer.index||r.layer.index===s.layer.index&&r.get_zindex()<s.get_zindex())&&(s=r);return e.pick_one(s),!0},l.MoveToTop=function(){var t=this.layer,e=t.instances;e.length&&e[e.length-1]===this||(t.removeFromInstanceList(this,!1),t.appendToInstanceList(this,!1),this.runtime.redraw=!0)},l.MoveToBottom=function(){var t=this.layer,e=t.instances;e.length&&e[0]===this||(t.removeFromInstanceList(this,!1),t.prependToInstanceList(this,!1),this.runtime.redraw=!0)},l.MoveToLayer=function(t){t&&t!=this.layer&&(this.layer.removeFromInstanceList(this,!0),(this.layer=t).appendToInstanceList(this,!0),this.runtime.redraw=!0)},l.ZMoveToObject=function(t,e){var i,r=0===t;!e||(i=e.getFirstPicked(this))&&i.uid!==this.uid&&(this.layer.index!==i.layer.index&&(this.layer.removeFromInstanceList(this,!0),this.layer=i.layer,i.layer.appendToInstanceList(this,!0)),this.layer.moveInstanceAdjacent(this,i,r),this.runtime.redraw=!0)},u.LayerNumber=function(t){t.set_int(this.layer.number)},u.LayerName=function(t){t.set_string(this.layer.name)},u.ZIndex=function(t){t.set_int(this.get_zindex())}),h&&(l.SetEffectEnabled=function(t,e){var i,r;this.runtime.glwrap&&((i=this.type.getEffectIndexByName(e))<0||(r=1===t,this.active_effect_flags[i]!==r&&(this.active_effect_flags[i]=r,this.updateActiveEffects(),this.runtime.redraw=!0)))},l.SetEffectParam=function(t,e,i){if(this.runtime.glwrap){var r=this.type.getEffectIndexByName(t);if(!(r<0)){var s,n,o,a=this.type.effect_types[r],h=this.effect_params[r];if(!((e=Math.floor(e))<0||e>=h.length)){var c=this.runtime.glwrap.getProgramParameterType(a.shaderindex,e);if(1===c&&(i/=100),2===c){s=cr.GetRValue(i),n=cr.GetGValue(i),o=cr.GetBValue(i);var l=h[e];if(l[0]===s&&l[1]===n&&l[2]===o)return;l[0]=s,l[1]=n,l[2]=o,a.active&&(this.runtime.redraw=!0)}else{if(h[e]===i)return;h[e]=i,a.active&&(this.runtime.redraw=!0)}}}}})},cr.set_bbox_changed=function(){this.bbox_changed=!0,this.cell_changed=!0,this.type.any_cell_changed=!0,this.runtime.redraw=!0;for(var t=this.bbox_changed_callbacks,e=0,i=t.length;e<i;++e)t[e](this);this.layer.useRenderCells&&this.update_bbox()},cr.add_bbox_changed_callback=function(t){t&&this.bbox_changed_callbacks.push(t)},cr.update_bbox=function(){var t,e;this.bbox_changed&&(t=this.bbox,e=this.bquad,t.set(this.x,this.y,this.x+this.width,this.y+this.height),t.offset(-this.hotspotX*this.width,-this.hotspotY*this.height),this.angle?(t.offset(-this.x,-this.y),e.set_from_rotated_rect(t,this.angle),e.offset(this.x,this.y),e.bounding_box(t)):e.set_from_rect(t),t.normalize(),this.bbox_changed=!1,this.update_render_cell())};var i=new cr.rect(0,0,0,0);cr.update_render_cell=function(){var t,e;this.layer.useRenderCells&&(t=this.layer.render_grid,e=this.bbox,i.set(t.XToCell(e.left),t.YToCell(e.top),t.XToCell(e.right),t.YToCell(e.bottom)),this.rendercells.equals(i)||(this.rendercells.right<this.rendercells.left?t.update(this,null,i):t.update(this,this.rendercells,i),this.rendercells.copy(i),this.layer.render_list_stale=!0))},cr.update_collision_cell=function(){var t,e;this.cell_changed&&this.collisionsEnabled&&(this.update_bbox(),t=this.type.collision_grid,e=this.bbox,i.set(t.XToCell(e.left),t.YToCell(e.top),t.XToCell(e.right),t.YToCell(e.bottom)),this.collcells.equals(i)||(this.collcells.right<this.collcells.left?t.update(this,null,i):t.update(this,this.collcells,i),this.collcells.copy(i),this.cell_changed=!1))},cr.inst_contains_pt=function(t,e){return!!this.bbox.contains_pt(t,e)&&(!!this.bquad.contains_pt(t,e)&&(this.tilemap_exists?this.testPointOverlapTile(t,e):!(this.collision_poly&&!this.collision_poly.is_empty())||(this.collision_poly.cache_poly(this.width,this.height,this.angle),this.collision_poly.contains_pt(t-this.x,e-this.y))))},cr.inst_get_iid=function(){return this.type.updateIIDs(),this.iid},cr.inst_get_zindex=function(){return this.layer.updateZIndices(),this.zindex},cr.inst_updateActiveEffects=function(){var t;cr.clearArray(this.active_effect_types);for(var e=!0,i=0,r=this.active_effect_flags.length;i<r;i++)this.active_effect_flags[i]&&(t=this.type.effect_types[i],this.active_effect_types.push(t),t.preservesOpaqueness||(e=!1));this.uses_shaders=!!this.active_effect_types.length,this.shaders_preserve_opaqueness=e},cr.inst_toString=function(){return"Inst"+this.puid},cr.type_getFirstPicked=function(t){if(t&&t.is_contained&&t.type!=this)for(var e,i=0,r=t.siblings.length;i<r;i++)if((e=t.siblings[i]).type==this)return e;var s=this.getCurrentSol().getObjects();return s.length?s[0]:null},cr.type_getPairedInstance=function(t){var e=this.getCurrentSol().getObjects();return e.length?e[t.get_iid()%e.length]:null},cr.type_updateIIDs=function(){if(this.stale_iids&&!this.is_family){for(var t=0,e=this.instances.length;t<e;t++)this.instances[t].iid=t;var i=t,r=this.runtime.createRow;for(t=0,e=r.length;t<e;++t)r[t].type===this&&(r[t].iid=i++);this.stale_iids=!1}},cr.type_getInstanceByIID=function(t){if(t<this.instances.length)return this.instances[t];t-=this.instances.length;for(var e=this.runtime.createRow,i=0,r=e.length;i<r;++i)if(e[i].type===this){if(0===t)return e[i];--t}return null},cr.type_getCurrentSol=function(){return this.solstack[this.cur_sol]},cr.type_pushCleanSol=function(){this.cur_sol++,this.cur_sol===this.solstack.length?this.solstack.push(new cr.selection(this)):(this.solstack[this.cur_sol].select_all=!0,cr.clearArray(this.solstack[this.cur_sol].else_instances))},cr.type_pushCopySol=function(){this.cur_sol++,this.cur_sol===this.solstack.length&&this.solstack.push(new cr.selection(this));var t=this.solstack[this.cur_sol],e=this.solstack[this.cur_sol-1];e.select_all?t.select_all=!0:(t.select_all=!1,cr.shallowAssignArray(t.instances,e.instances)),cr.clearArray(t.else_instances)},cr.type_popSol=function(){this.cur_sol--},cr.type_getBehaviorByName=function(t){var e,i,r,s,n,o=0;if(!this.is_family)for(e=0,i=this.families.length;e<i;e++)for(r=0,s=(n=this.families[e]).behaviors.length;r<s;r++){if(t===n.behaviors[r].name)return this.extra.lastBehIndex=o,n.behaviors[r];o++}for(e=0,i=this.behaviors.length;e<i;e++){if(t===this.behaviors[e].name)return this.extra.lastBehIndex=o,this.behaviors[e];o++}return null},cr.type_getBehaviorIndexByName=function(t){return this.getBehaviorByName(t)?this.extra.lastBehIndex:-1},cr.type_getEffectIndexByName=function(t){for(var e=0,i=this.effect_types.length;e<i;e++)if(this.effect_types[e].name===t)return e;return-1},cr.type_applySolToContainer=function(){if(this.is_contained&&!this.is_family){var t,e,i,r,s;this.updateIIDs();for(var n=(r=this.getCurrentSol()).select_all,o=this.runtime.getCurrentEventStack(),a=o&&o.current_event&&o.current_event.orblock,h=0,c=this.container.length;h<c;h++)if((i=this.container[h])!==this&&(i.updateIIDs(),!((s=i.getCurrentSol()).select_all=n))){for(cr.clearArray(s.instances),t=0,e=r.instances.length;t<e;++t)s.instances[t]=i.getInstanceByIID(r.instances[t].iid);if(a)for(cr.clearArray(s.else_instances),t=0,e=r.else_instances.length;t<e;++t)s.else_instances[t]=i.getInstanceByIID(r.else_instances[t].iid)}}},cr.type_toString=function(){return"Type"+this.sid},cr.do_cmp=function(t,e,i){if(void 0===t||void 0===i)return!1;switch(e){case 0:return t===i;case 1:return t!==i;case 2:return t<i;case 3:return t<=i;case 4:return i<t;case 5:return i<=t;default:return!1}}}(),cr.shaders={},cr.plugins_.Sprite=function(t){this.runtime=t},function(){var t=cr.plugins_.Sprite.prototype;t.Type=function(t){this.plugin=t,this.runtime=t.runtime};var e=t.Type.prototype;function l(){var t,e;return 0===this.datauri.length&&((t=document.createElement("canvas")).width=this.width,t.height=this.height,e=t.getContext("2d"),this.spritesheeted?e.drawImage(this.texture_img,this.offx,this.offy,this.width,this.height,0,0,this.width,this.height):e.drawImage(this.texture_img,0,0,this.width,this.height),this.datauri=t.toDataURL("image/png")),this.datauri}e.onCreate=function(){var t,e,i,r,s,n,o,a,h,c;if(!this.is_family)for(this.all_frames=[],this.has_loaded_textures=!1,t=0,e=this.animations.length;t<e;t++){for(s=this.animations[t],(o={}).name=s[0],o.speed=s[1],o.loop=s[2],o.repeatcount=s[3],o.repeatto=s[4],o.pingpong=s[5],o.sid=s[6],o.frames=[],i=0,r=s[7].length;i<r;i++)n=s[7][i],(a={}).texture_file=n[0],a.texture_filesize=n[1],a.offx=n[2],a.offy=n[3],a.width=n[4],a.height=n[5],a.duration=n[6],a.hotspotX=n[7],a.hotspotY=n[8],a.image_points=n[9],a.poly_pts=n[10],a.pixelformat=n[11],a.spritesheeted=0!==a.width,a.datauri="",a.getDataUri=l,c={left:0,top:0,right:1,bottom:1},a.sheetTex=c,a.webGL_texture=null,(h=this.runtime.findWaitingTexture(n[0]))?a.texture_img=h:(a.texture_img=new Image,a.texture_img.cr_src=n[0],a.texture_img.cr_filesize=n[1],a.texture_img.c2webGL_texture=null,this.runtime.waitForImageLoad(a.texture_img,n[0])),cr.seal(a),o.frames.push(a),this.all_frames.push(a);cr.seal(o),this.animations[t]=o}},e.updateAllCurrentTexture=function(){for(var t,e=0,i=this.instances.length;e<i;e++)(t=this.instances[e]).curWebGLTexture=t.curFrame.webGL_texture},e.onLostWebGLContext=function(){if(!this.is_family){for(var t,e=0,i=this.all_frames.length;e<i;++e)(t=this.all_frames[e]).texture_img.c2webGL_texture=null,t.webGL_texture=null;this.has_loaded_textures=!1,this.updateAllCurrentTexture()}},e.onRestoreWebGLContext=function(){if(!this.is_family&&this.instances.length){for(var t,e=0,i=this.all_frames.length;e<i;++e)(t=this.all_frames[e]).webGL_texture=this.runtime.glwrap.loadTexture(t.texture_img,!1,this.runtime.linearSampling,t.pixelformat);this.updateAllCurrentTexture()}},e.loadTextures=function(){if(!this.is_family&&!this.has_loaded_textures&&this.runtime.glwrap){for(var t,e=0,i=this.all_frames.length;e<i;++e)(t=this.all_frames[e]).webGL_texture=this.runtime.glwrap.loadTexture(t.texture_img,!1,this.runtime.linearSampling,t.pixelformat);this.has_loaded_textures=!0}},e.unloadTextures=function(){if(!this.is_family&&!this.instances.length&&this.has_loaded_textures){for(var t,e=0,i=this.all_frames.length;e<i;++e)t=this.all_frames[e],this.runtime.glwrap.deleteTexture(t.webGL_texture),t.webGL_texture=null;this.has_loaded_textures=!1}};var s=[];e.preloadCanvas2D=function(t){var e,i,r;for(cr.clearArray(s),e=0,i=this.all_frames.length;e<i;++e)r=this.all_frames[e].texture_img,-1===s.indexOf(r)&&(t.drawImage(r,0,0),s.push(r))},t.Instance=function(t){this.type=t,this.runtime=t.runtime;var e=this.type.animations[0].frames[0].poly_pts;this.recycled?this.collision_poly.set_pts(e):this.collision_poly=new cr.CollisionPoly(e)};var i=t.Instance.prototype;function r(){}i.onCreate=function(){this.visible=this.properties[0],this.isTicking=!1,this.inAnimTrigger=!1,this.collisionsEnabled=this.properties[3],this.cur_animation=this.getAnimationByName(this.properties[1])||this.type.animations[0],this.cur_frame=this.properties[2],this.cur_frame<0&&(this.cur_frame=0),this.cur_frame>=this.cur_animation.frames.length&&(this.cur_frame=this.cur_animation.frames.length-1);var t,e,i,r,s,n,o,a,h=this.cur_animation.frames[this.cur_frame];for(this.collision_poly.set_pts(h.poly_pts),this.hotspotX=h.hotspotX,this.hotspotY=h.hotspotY,this.animForwards=0<=this.cur_animation.speed,this.cur_anim_speed=Math.abs(this.cur_animation.speed),this.cur_anim_repeatto=this.cur_animation.repeatto,1===this.type.animations.length&&1===this.type.animations[0].frames.length||0===this.cur_anim_speed||(this.runtime.tickMe(this),this.isTicking=!0),this.recycled?this.animTimer.reset():this.animTimer=new cr.KahanAdder,this.frameStart=this.getNowTime(),this.animPlaying=!0,this.animRepeats=0,this.animTriggerName="",this.changeAnimName="",this.changeAnimFrom=0,this.changeAnimFrame=-1,this.type.loadTextures(),t=0,e=this.type.animations.length;t<e;t++)for(i=0,r=(s=this.type.animations[t]).frames.length;i<r;i++)0===(n=s.frames[i]).width&&(n.width=n.texture_img.width,n.height=n.texture_img.height),n.spritesheeted&&(a=n.texture_img,(o=n.sheetTex).left=n.offx/a.width,o.top=n.offy/a.height,o.right=(n.offx+n.width)/a.width,o.bottom=(n.offy+n.height)/a.height,0===n.offx&&0===n.offy&&n.width===a.width&&n.height===a.height&&(n.spritesheeted=!1));this.curFrame=this.cur_animation.frames[this.cur_frame],this.curWebGLTexture=this.curFrame.webGL_texture},i.saveToJSON=function(){var t={a:this.cur_animation.sid,f:this.cur_frame,cas:this.cur_anim_speed,fs:this.frameStart,ar:this.animRepeats,at:this.animTimer.sum,rt:this.cur_anim_repeatto};return this.animPlaying||(t.ap=this.animPlaying),this.animForwards||(t.af=this.animForwards),t},i.loadFromJSON=function(t){var e=this.getAnimationBySid(t.a);e&&(this.cur_animation=e),this.cur_frame=t.f,this.cur_frame<0&&(this.cur_frame=0),this.cur_frame>=this.cur_animation.frames.length&&(this.cur_frame=this.cur_animation.frames.length-1),this.cur_anim_speed=t.cas,this.frameStart=t.fs,this.animRepeats=t.ar,this.animTimer.reset(),this.animTimer.sum=t.at,this.animPlaying=!t.hasOwnProperty("ap")||t.ap,this.animForwards=!t.hasOwnProperty("af")||t.af,t.hasOwnProperty("rt")?this.cur_anim_repeatto=t.rt:this.cur_anim_repeatto=this.cur_animation.repeatto,this.curFrame=this.cur_animation.frames[this.cur_frame],this.curWebGLTexture=this.curFrame.webGL_texture,this.collision_poly.set_pts(this.curFrame.poly_pts),this.hotspotX=this.curFrame.hotspotX,this.hotspotY=this.curFrame.hotspotY},i.animationFinish=function(t){this.cur_frame=t?0:this.cur_animation.frames.length-1,this.animPlaying=!1,this.animTriggerName=this.cur_animation.name,this.inAnimTrigger=!0,this.runtime.trigger(cr.plugins_.Sprite.prototype.cnds.OnAnyAnimFinished,this),this.runtime.trigger(cr.plugins_.Sprite.prototype.cnds.OnAnimFinished,this),this.inAnimTrigger=!1,this.animRepeats=0},i.getNowTime=function(){return this.animTimer.sum},i.tick=function(){this.animTimer.add(this.runtime.getDt(this)),this.changeAnimName.length&&this.doChangeAnim(),0<=this.changeAnimFrame&&this.doChangeAnimFrame();var t,e=this.getNowTime(),i=this.cur_animation,r=i.frames[this.cur_frame],s=r.duration/this.cur_anim_speed;this.animPlaying&&e>=this.frameStart+s&&(this.animForwards?this.cur_frame++:this.cur_frame--,this.frameStart+=s,this.cur_frame>=i.frames.length&&(i.pingpong?(this.animForwards=!1,this.cur_frame=i.frames.length-2):i.loop?this.cur_frame=this.cur_anim_repeatto:(this.animRepeats++,this.animRepeats>=i.repeatcount?this.animationFinish(!1):this.cur_frame=this.cur_anim_repeatto)),this.cur_frame<0&&(i.pingpong?(this.cur_frame=1,this.animForwards=!0,i.loop||(this.animRepeats++,this.animRepeats>=i.repeatcount&&this.animationFinish(!0))):i.loop?this.cur_frame=this.cur_anim_repeatto:(this.animRepeats++,this.animRepeats>=i.repeatcount?this.animationFinish(!0):this.cur_frame=this.cur_anim_repeatto)),this.cur_frame<0?this.cur_frame=0:this.cur_frame>=i.frames.length&&(this.cur_frame=i.frames.length-1),e>this.frameStart+i.frames[this.cur_frame].duration/this.cur_anim_speed&&(this.frameStart=e),t=i.frames[this.cur_frame],this.OnFrameChanged(r,t),this.runtime.redraw=!0)},i.getAnimationByName=function(t){for(var e,i=0,r=this.type.animations.length;i<r;i++)if(e=this.type.animations[i],cr.equals_nocase(e.name,t))return e;return null},i.getAnimationBySid=function(t){for(var e,i=0,r=this.type.animations.length;i<r;i++)if((e=this.type.animations[i]).sid===t)return e;return null},i.doChangeAnim=function(){var t=this.cur_animation.frames[this.cur_frame],e=this.getAnimationByName(this.changeAnimName);this.changeAnimName="",e&&(cr.equals_nocase(e.name,this.cur_animation.name)&&this.animPlaying||(this.cur_animation=e,this.animForwards=0<=e.speed,this.cur_anim_speed=Math.abs(e.speed),this.cur_anim_repeatto=e.repeatto,this.cur_frame<0&&(this.cur_frame=0),this.cur_frame>=this.cur_animation.frames.length&&(this.cur_frame=this.cur_animation.frames.length-1),1===this.changeAnimFrom&&(this.cur_frame=0),this.animPlaying=!0,this.frameStart=this.getNowTime(),this.OnFrameChanged(t,this.cur_animation.frames[this.cur_frame]),this.runtime.redraw=!0))},i.doChangeAnimFrame=function(){var t=this.cur_animation.frames[this.cur_frame],e=this.cur_frame;this.cur_frame=cr.floor(this.changeAnimFrame),this.cur_frame<0&&(this.cur_frame=0),this.cur_frame>=this.cur_animation.frames.length&&(this.cur_frame=this.cur_animation.frames.length-1),e!==this.cur_frame&&(this.OnFrameChanged(t,this.cur_animation.frames[this.cur_frame]),this.frameStart=this.getNowTime(),this.runtime.redraw=!0),this.changeAnimFrame=-1},i.OnFrameChanged=function(t,e){var i,r,s,n=t.width,o=t.height,a=e.width,h=e.height;for(n!=a&&(this.width*=a/n),o!=h&&(this.height*=h/o),this.hotspotX=e.hotspotX,this.hotspotY=e.hotspotY,this.collision_poly.set_pts(e.poly_pts),this.set_bbox_changed(),this.curFrame=e,this.curWebGLTexture=e.webGL_texture,i=0,r=this.behavior_insts.length;i<r;i++)(s=this.behavior_insts[i]).onSpriteFrameChanged&&s.onSpriteFrameChanged(t,e);this.runtime.trigger(cr.plugins_.Sprite.prototype.cnds.OnFrameChanged,this)},i.draw=function(t){t.globalAlpha=this.opacity;var e,i,r,s,n=this.curFrame,o=n.spritesheeted,a=n.texture_img,h=this.x,c=this.y,l=this.width,u=this.height;0===this.angle&&0<=l&&0<=u?(h-=this.hotspotX*l,c-=this.hotspotY*u,this.runtime.pixel_rounding&&(h=Math.round(h),c=Math.round(c)),o?t.drawImage(a,n.offx,n.offy,n.width,n.height,h,c,l,u):t.drawImage(a,h,c,l,u)):(this.runtime.pixel_rounding&&(h=Math.round(h),c=Math.round(c)),t.save(),e=0<l?1:-1,i=0<u?1:-1,t.translate(h,c),1==e&&1==i||t.scale(e,i),t.rotate(this.angle*e*i),r=0-this.hotspotX*cr.abs(l),s=0-this.hotspotY*cr.abs(u),o?t.drawImage(a,n.offx,n.offy,n.width,n.height,r,s,cr.abs(l),cr.abs(u)):t.drawImage(a,r,s,cr.abs(l),cr.abs(u)),t.restore())},i.drawGL_earlyZPass=function(t){this.drawGL(t)},i.drawGL=function(t){t.setTexture(this.curWebGLTexture),t.setOpacity(this.opacity);var e,i,r=this.curFrame,s=this.bquad;this.runtime.pixel_rounding?(e=Math.round(this.x)-this.x,i=Math.round(this.y)-this.y,r.spritesheeted?t.quadTex(s.tlx+e,s.tly+i,s.trx+e,s.try_+i,s.brx+e,s.bry+i,s.blx+e,s.bly+i,r.sheetTex):t.quad(s.tlx+e,s.tly+i,s.trx+e,s.try_+i,s.brx+e,s.bry+i,s.blx+e,s.bly+i)):r.spritesheeted?t.quadTex(s.tlx,s.tly,s.trx,s.try_,s.brx,s.bry,s.blx,s.bly,r.sheetTex):t.quad(s.tlx,s.tly,s.trx,s.try_,s.brx,s.bry,s.blx,s.bly)},i.getImagePointIndexByName=function(t){for(var e=this.curFrame,i=0,r=e.image_points.length;i<r;i++)if(cr.equals_nocase(t,e.image_points[i][0]))return i;return-1},i.getImagePoint=function(t,e){var i=this.curFrame,r=i.image_points,s=cr.is_string(t)?this.getImagePointIndexByName(t):t-1;if((s=cr.floor(s))<0||s>=r.length)return e?this.x:this.y;var n=(r[s][1]-i.hotspotX)*this.width,o=((o=r[s][2])-i.hotspotY)*this.height,a=Math.cos(this.angle),h=Math.sin(this.angle),c=n*a-o*h;return o=o*a+n*h,n=c,n+=this.x,o+=this.y,e?n:o};var h=[];function S(t){t[0]=0,t[1]=0,t[2]=0,h.push(t)}function A(t,e){return t<e?t+","+e:e+","+t}function C(t,e,i,r){var s,n=e.uid,o=i.uid,a=A(n,o);t.hasOwnProperty(a)?t[a][2]=r:((s=h.length?h.pop():[0,0,0])[0]=n,s[1]=o,s[2]=r,t[a]=s)}var L=-2;var E=[];r.prototype.OnCollision=function(t){if(!t)return!1;var e=this.runtime,i=e.getCurrentCondition(),r=i.type,s=null;i.extra.collmemory?s=i.extra.collmemory:(s={},i.extra.collmemory=s),i.extra.spriteCreatedDestroyCallback||(i.extra.spriteCreatedDestroyCallback=!0,e.addDestroyCallback(function(t){!function(t,e){var i,r,s=e.uid;for(i in t)t.hasOwnProperty(i)&&((r=t[i])[0]!==s&&r[1]!==s||(S(t[i]),delete t[i]))}(i.extra.collmemory,t)}));for(var n,o,a,h,c,l,u,p,d,g,f,y,m,_=r.getCurrentSol(),v=t.getCurrentSol(),b=_.getObjects(),w=this.runtime.tickcount,x=w-1,T=e.getCurrentEventStack().current_event,M=(T.orblock,0);M<b.length;M++){for(o=b[M],v.select_all?(o.update_bbox(),this.runtime.getCollisionCandidates(o.layer,t,o.bbox,E),n=E,this.runtime.addRegisteredCollisionCandidates(o,t,n)):n=v.getObjects(),a=0;a<n.length;a++)h=n[a],e.testOverlap(o,h)||e.checkRegisteredCollision(o,h)?(f=s,y=h,m=A(o.uid,y.uid),u=!(f.hasOwnProperty(m)?(L=f[m][2],!0):!(L=-2))||L<x,C(s,o,h,w),u&&(e.pushCopySol(T.solModifiers),c=r.getCurrentSol(),l=t.getCurrentSol(),c.select_all=!1,l.select_all=!1,r===t?(c.instances.length=2,c.instances[0]=o,c.instances[1]=h,r.applySolToContainer()):(c.instances.length=1,l.instances.length=1,c.instances[0]=o,l.instances[0]=h,r.applySolToContainer(),t.applySolToContainer()),T.retrigger(),e.popSol(T.solModifiers))):(p=s,d=h,g=A(o.uid,d.uid),p.hasOwnProperty(g)&&(S(p[g]),delete p[g]));cr.clearArray(E)}return!1};var y=null,m=new cr.ObjectSet,_=!1,v=[],b=new cr.rect(0,0,0,0);function n(t,e,i){if(!t)return!1;var r,s,n,o,a,h=0!==e||0!==i,c=!1,l=this.runtime.getCurrentCondition(),u=l.type,p=l.inverted,d=t.getCurrentSol(),g=this.runtime.getCurrentEventStack().current_event.orblock,f=d.select_all?(this.update_bbox(),b.copy(this.bbox),b.offset(e,i),this.runtime.getCollisionCandidates(this.layer,t,b,v),v):!g||this.runtime.isCurrentConditionFirst()&&!d.else_instances.length&&d.instances.length?d.instances:d.else_instances;for(_=u!==(y=t)&&!p,h&&(r=this.x,s=this.y,this.x+=e,this.y+=i,this.set_bbox_changed()),n=0,o=f.length;n<o;n++)if(a=f[n],this.runtime.testOverlap(this,a)){if(c=!0,p)break;u!==t&&m.add(a)}return h&&(this.x=r,this.y=s,this.set_bbox_changed()),cr.clearArray(v),c}function o(){}function a(){}e.finish=function(t){if(_){if(t){var e,i=this.runtime.getCurrentEventStack().current_event.orblock,r=y.getCurrentSol(),s=m.valuesRef();if(r.select_all){for(r.select_all=!1,cr.clearArray(r.instances),o=0,a=s.length;o<a;++o)r.instances[o]=s[o];if(i)for(cr.clearArray(r.else_instances),o=0,a=y.instances.length;o<a;++o)e=y.instances[o],m.contains(e)||r.else_instances.push(e)}else if(i)for(var n=r.instances.length,o=0,a=s.length;o<a;++o)r.instances[n+o]=s[o],cr.arrayFindRemove(r.else_instances,s[o]);else cr.shallowAssignArray(r.instances,s);y.applySolToContainer()}m.clear(),_=!1}},r.prototype.IsOverlapping=function(t){return n.call(this,t,0,0)},r.prototype.IsOverlappingOffset=function(t,e,i){return n.call(this,t,e,i)},r.prototype.IsAnimPlaying=function(t){return this.changeAnimName.length?cr.equals_nocase(this.changeAnimName,t):cr.equals_nocase(this.cur_animation.name,t)},r.prototype.CompareFrame=function(t,e){return cr.do_cmp(this.cur_frame,t,e)},r.prototype.CompareAnimSpeed=function(t,e){var i=this.animForwards?this.cur_anim_speed:-this.cur_anim_speed;return cr.do_cmp(i,t,e)},r.prototype.OnAnimFinished=function(t){return cr.equals_nocase(this.animTriggerName,t)},r.prototype.OnAnyAnimFinished=function(){return!0},r.prototype.OnFrameChanged=function(){return!0},r.prototype.IsMirrored=function(){return this.width<0},r.prototype.IsFlipped=function(){return this.height<0},r.prototype.OnURLLoaded=function(){return!0},r.prototype.IsCollisionEnabled=function(){return this.collisionsEnabled},t.cnds=new r,o.prototype.Spawn=function(t,e,i){if(t&&e){var r,s,n,o=this.runtime.createInstance(t,e,this.getImagePoint(i,!0),this.getImagePoint(i,!1));if(o){if(void 0!==o.angle&&(o.angle=this.angle,o.set_bbox_changed()),this.runtime.isInOnDestroy++,this.runtime.trigger(Object.getPrototypeOf(t.plugin).cnds.OnCreated,o),o.is_contained)for(r=0,s=o.siblings.length;r<s;r++)n=o.siblings[r],this.runtime.trigger(Object.getPrototypeOf(n.type.plugin).cnds.OnCreated,n);this.runtime.isInOnDestroy--;var a,h=this.runtime.getCurrentAction(),c=!1;if((cr.is_undefined(h.extra.Spawn_LastExec)||h.extra.Spawn_LastExec<this.runtime.execcount)&&(c=!0,h.extra.Spawn_LastExec=this.runtime.execcount),t!=this.type&&((a=t.getCurrentSol()).select_all=!1,c?(cr.clearArray(a.instances),a.instances[0]=o):a.instances.push(o),o.is_contained))for(r=0,s=o.siblings.length;r<s;r++)(a=(n=o.siblings[r]).type.getCurrentSol()).select_all=!1,c?(cr.clearArray(a.instances),a.instances[0]=n):a.instances.push(n)}}},o.prototype.SetEffect=function(t){this.blend_mode=t,this.compositeOp=cr.effectToCompositeOp(t),cr.setGLBlend(this,t,this.runtime.gl),this.runtime.redraw=!0},o.prototype.StopAnim=function(){this.animPlaying=!1},o.prototype.StartAnim=function(t){this.animPlaying=!0,this.frameStart=this.getNowTime(),1===t&&0!==this.cur_frame&&(this.changeAnimFrame=0,this.inAnimTrigger||this.doChangeAnimFrame()),this.isTicking||(this.runtime.tickMe(this),this.isTicking=!0)},o.prototype.SetAnim=function(t,e){this.changeAnimName=t,this.changeAnimFrom=e,this.isTicking||(this.runtime.tickMe(this),this.isTicking=!0),this.inAnimTrigger||this.doChangeAnim()},o.prototype.SetAnimFrame=function(t){this.changeAnimFrame=t,this.isTicking||(this.runtime.tickMe(this),this.isTicking=!0),this.inAnimTrigger||this.doChangeAnimFrame()},o.prototype.SetAnimSpeed=function(t){this.cur_anim_speed=cr.abs(t),this.animForwards=0<=t,this.isTicking||(this.runtime.tickMe(this),this.isTicking=!0)},o.prototype.SetAnimRepeatToFrame=function(t){(t=Math.floor(t))<0&&(t=0),t>=this.cur_animation.frames.length&&(t=this.cur_animation.frames.length-1),this.cur_anim_repeatto=t},o.prototype.SetMirrored=function(t){var e=cr.abs(this.width)*(0===t?-1:1);this.width!==e&&(this.width=e,this.set_bbox_changed())},o.prototype.SetFlipped=function(t){var e=cr.abs(this.height)*(0===t?-1:1);this.height!==e&&(this.height=e,this.set_bbox_changed())},o.prototype.SetScale=function(t){var e=this.curFrame,i=this.width<0?-1:1,r=this.height<0?-1:1,s=e.width*t*i,n=e.height*t*r;this.width===s&&this.height===n||(this.width=s,this.height=n,this.set_bbox_changed())},o.prototype.LoadURL=function(t,e,i){var r=new Image,s=this,n=this.curFrame;r.onload=function(){if(n.texture_img.src===r.src)return s.runtime.glwrap&&s.curFrame===n&&(s.curWebGLTexture=n.webGL_texture),0===e&&(s.width=r.width,s.height=r.height,s.set_bbox_changed()),s.runtime.redraw=!0,void s.runtime.trigger(cr.plugins_.Sprite.prototype.cnds.OnURLLoaded,s);n.texture_img=r,n.offx=0,n.offy=0,n.width=r.width,n.height=r.height,n.spritesheeted=!1,n.datauri="",n.pixelformat=0,s.runtime.glwrap&&(n.webGL_texture&&s.runtime.glwrap.deleteTexture(n.webGL_texture),n.webGL_texture=s.runtime.glwrap.loadTexture(r,!1,s.runtime.linearSampling),s.curFrame===n&&(s.curWebGLTexture=n.webGL_texture),s.type.updateAllCurrentTexture()),0===e&&(s.width=r.width,s.height=r.height,s.set_bbox_changed()),s.runtime.redraw=!0,s.runtime.trigger(cr.plugins_.Sprite.prototype.cnds.OnURLLoaded,s)},"data:"!==t.substr(0,5)&&0===i&&(r.crossOrigin="anonymous"),this.runtime.setImageSrc(r,t)},o.prototype.SetCollisions=function(t){this.collisionsEnabled!==(0!==t)&&(this.collisionsEnabled=0!==t,this.collisionsEnabled?this.set_bbox_changed():(this.collcells.right>=this.collcells.left&&this.type.collision_grid.update(this,this.collcells,null),this.collcells.set(0,0,-1,-1)))},t.acts=new o,a.prototype.AnimationFrame=function(t){t.set_int(this.cur_frame)},a.prototype.AnimationFrameCount=function(t){t.set_int(this.cur_animation.frames.length)},a.prototype.AnimationName=function(t){t.set_string(this.cur_animation.name)},a.prototype.AnimationSpeed=function(t){t.set_float(this.animForwards?this.cur_anim_speed:-this.cur_anim_speed)},a.prototype.ImagePointX=function(t,e){t.set_float(this.getImagePoint(e,!0))},a.prototype.ImagePointY=function(t,e){t.set_float(this.getImagePoint(e,!1))},a.prototype.ImagePointCount=function(t){t.set_int(this.curFrame.image_points.length)},a.prototype.ImageWidth=function(t){t.set_float(this.curFrame.width)},a.prototype.ImageHeight=function(t){t.set_float(this.curFrame.height)},t.exps=new a}(),cr.plugins_.Touch=function(t){this.runtime=t},function(){var t=cr.plugins_.Touch.prototype;t.Type=function(t){this.plugin=t,this.runtime=t.runtime},t.Type.prototype.onCreate=function(){},t.Instance=function(t){this.type=t,this.runtime=t.runtime,this.touches=[],this.mouseDown=!1};var e=t.Instance.prototype;e.findTouch=function(t){for(var e=0,i=this.touches.length;e<i;e++)if(this.touches[e].id===t)return e;return-1};var i=0,r=0,s=0;function a(t){i=t.x,r=t.y,s=t.z}var n=[];function h(t,e,i,r){var s=n.length?n.pop():new c;return s.init(t,e,i,r),s}function o(t){n.length<100&&n.push(t)}function c(){this.starttime=0,this.time=0,this.lasttime=0,this.startx=0,this.starty=0,this.x=0,this.y=0,this.lastx=0,this.lasty=0,this.id=0,this.startindex=0,this.triggeredHold=!1,this.tooFarForHold=!1}c.prototype.init=function(t,e,i,r){var s=cr.performance_now();this.time=s,this.lasttime=s,this.starttime=s,this.startx=t,this.starty=e,this.x=t,this.y=e,this.lastx=t,this.lasty=e,this.width=0,this.height=0,this.pressure=0,this.id=i,this.startindex=r,this.triggeredHold=!1,this.tooFarForHold=!1},c.prototype.update=function(t,e,i,r,s,n){this.lasttime=this.time,this.time=t,this.lastx=this.x,this.lasty=this.y,this.x=e,this.y=i,this.width=r,this.height=s,this.pressure=n,!this.tooFarForHold&&15<=cr.distanceTo(this.startx,this.starty,this.x,this.y)&&(this.tooFarForHold=!0)},c.prototype.maybeTriggerHold=function(t,e){this.triggeredHold||500<=cr.performance_now()-this.starttime&&!this.tooFarForHold&&cr.distanceTo(this.startx,this.starty,this.x,this.y)<15&&(this.triggeredHold=!0,t.trigger_index=this.startindex,t.trigger_id=this.id,t.getTouchIndex=e,t.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnHoldGesture,t),t.curTouchX=this.x,t.curTouchY=this.y,t.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnHoldGestureObject,t),t.getTouchIndex=0)};var l=-1e3,u=-1e3,p=-1e4;c.prototype.maybeTriggerTap=function(t,e){var i;this.triggeredHold||(i=cr.performance_now())-this.starttime<=333&&!this.tooFarForHold&&cr.distanceTo(this.startx,this.starty,this.x,this.y)<15&&(t.trigger_index=this.startindex,t.trigger_id=this.id,t.getTouchIndex=e,p=i-p<=666&&cr.distanceTo(l,u,this.x,this.y)<25?(t.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnDoubleTapGesture,t),t.curTouchX=this.x,t.curTouchY=this.y,t.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnDoubleTapGestureObject,t),u=l=-1e3,-1e4):(t.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnTapGesture,t),t.curTouchX=this.x,t.curTouchY=this.y,t.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnTapGestureObject,t),l=this.x,u=this.y,i),t.getTouchIndex=0)},e.onCreate=function(){this.isWindows8=!(void 0===window.c2isWindows8||!window.c2isWindows8),this.orient_alpha=0,this.orient_beta=0,this.orient_gamma=0,this.acc_g_x=0,this.acc_g_y=0,this.acc_g_z=0,this.acc_x=0,this.acc_y=0,this.acc_z=0,this.curTouchX=0,this.curTouchY=0,this.trigger_index=0,this.trigger_id=0,this.getTouchIndex=0,this.useMouseInput=this.properties[0];var e,i,r,s,t=0<this.runtime.fullscreen_mode?document:this.runtime.canvas,n=document,o=this;"undefined"!=typeof PointerEvent?(t.addEventListener("pointerdown",function(t){o.onPointerStart(t)},!1),t.addEventListener("pointermove",function(t){o.onPointerMove(t)},!1),n.addEventListener("pointerup",function(t){o.onPointerEnd(t,!1)},!1),n.addEventListener("pointercancel",function(t){o.onPointerEnd(t,!0)},!1),this.runtime.canvas&&(this.runtime.canvas.addEventListener("MSGestureHold",function(t){t.preventDefault()},!1),document.addEventListener("MSGestureHold",function(t){t.preventDefault()},!1),this.runtime.canvas.addEventListener("gesturehold",function(t){t.preventDefault()},!1),document.addEventListener("gesturehold",function(t){t.preventDefault()},!1))):window.navigator.msPointerEnabled?(t.addEventListener("MSPointerDown",function(t){o.onPointerStart(t)},!1),t.addEventListener("MSPointerMove",function(t){o.onPointerMove(t)},!1),n.addEventListener("MSPointerUp",function(t){o.onPointerEnd(t,!1)},!1),n.addEventListener("MSPointerCancel",function(t){o.onPointerEnd(t,!0)},!1),this.runtime.canvas&&(this.runtime.canvas.addEventListener("MSGestureHold",function(t){t.preventDefault()},!1),document.addEventListener("MSGestureHold",function(t){t.preventDefault()},!1))):(t.addEventListener("touchstart",function(t){o.onTouchStart(t)},!1),t.addEventListener("touchmove",function(t){o.onTouchMove(t)},!1),n.addEventListener("touchend",function(t){o.onTouchEnd(t,!1)},!1),n.addEventListener("touchcancel",function(t){o.onTouchEnd(t,!0)},!1)),this.isWindows8?(e=function(t){var e=t.reading;o.acc_x=e.accelerationX,o.acc_y=e.accelerationY,o.acc_z=e.accelerationZ},i=function(t){var e=t.reading;o.orient_alpha=e.yawDegrees,o.orient_beta=e.pitchDegrees,o.orient_gamma=e.rollDegrees},(r=Windows.Devices.Sensors.Accelerometer.getDefault())&&(r.reportInterval=Math.max(r.minimumReportInterval,16),r.addEventListener("readingchanged",e)),(s=Windows.Devices.Sensors.Inclinometer.getDefault())&&(s.reportInterval=Math.max(s.minimumReportInterval,16),s.addEventListener("readingchanged",i)),document.addEventListener("visibilitychange",function(t){document.hidden||document.msHidden?(r&&r.removeEventListener("readingchanged",e),s&&s.removeEventListener("readingchanged",i)):(r&&r.addEventListener("readingchanged",e),s&&s.addEventListener("readingchanged",i))},!1)):(window.addEventListener("deviceorientation",function(t){o.orient_alpha=t.alpha||0,o.orient_beta=t.beta||0,o.orient_gamma=t.gamma||0},!1),window.addEventListener("devicemotion",function(t){t.accelerationIncludingGravity&&(o.acc_g_x=t.accelerationIncludingGravity.x||0,o.acc_g_y=t.accelerationIncludingGravity.y||0,o.acc_g_z=t.accelerationIncludingGravity.z||0),t.acceleration&&(o.acc_x=t.acceleration.x||0,o.acc_y=t.acceleration.y||0,o.acc_z=t.acceleration.z||0)},!1)),this.useMouseInput&&(document.addEventListener("mousemove",function(t){o.onMouseMove(t)}),document.addEventListener("mousedown",function(t){o.onMouseDown(t)}),document.addEventListener("mouseup",function(t){o.onMouseUp(t)})),!this.runtime.isiOS&&this.runtime.isCordova&&navigator.accelerometer&&navigator.accelerometer.watchAcceleration&&navigator.accelerometer.watchAcceleration(a,null,{frequency:40}),this.runtime.tick2Me(this)},e.onPointerMove=function(t){if(t.pointerType!==t.MSPOINTER_TYPE_MOUSE&&"mouse"!==t.pointerType){t.preventDefault&&t.preventDefault();var e=this.findTouch(t.pointerId),i=cr.performance_now();if(0<=e){var r=this.runtime.canvas.offsetLeft,s=this.runtime.canvas.offsetTop,n=this.touches[e];if(i-n.time<2)return;n.update(i,t.pageX-r,t.pageY-s,t.width||0,t.height||0,t.pressure||0)}}},e.onPointerStart=function(t){var e,i,r,s;t.pointerType!==t.MSPOINTER_TYPE_MOUSE&&"mouse"!==t.pointerType&&-1===this.findTouch(t.pointerId)&&(t.preventDefault&&cr.isCanvasInputEvent(t)&&t.preventDefault(),e=this.runtime.canvas.offsetLeft,i=this.runtime.canvas.offsetTop,r=t.pageX-e,s=t.pageY-i,cr.performance_now(),this.trigger_index=this.touches.length,this.trigger_id=t.pointerId,this.touches.push(h(r,s,t.pointerId,this.trigger_index)),this.runtime.isInUserInputEvent=!0,this.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnNthTouchStart,this),this.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnTouchStart,this),this.curTouchX=r,this.curTouchY=s,this.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnTouchObject,this),this.runtime.isInUserInputEvent=!1)},e.onPointerEnd=function(t,e){var i;t.pointerType!==t.MSPOINTER_TYPE_MOUSE&&"mouse"!==t.pointerType&&(t.preventDefault&&cr.isCanvasInputEvent(t)&&t.preventDefault(),i=this.findTouch(t.pointerId),this.trigger_index=0<=i?this.touches[i].startindex:-1,this.trigger_id=0<=i?this.touches[i].id:-1,this.runtime.isInUserInputEvent=!0,this.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnNthTouchEnd,this),this.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnTouchEnd,this),0<=i&&(e||this.touches[i].maybeTriggerTap(this,i),o(this.touches[i]),this.touches.splice(i,1)),this.runtime.isInUserInputEvent=!1)},e.onTouchMove=function(t){t.preventDefault&&t.preventDefault();for(var e,i=cr.performance_now(),r=0,s=t.changedTouches.length;r<s;r++){e=t.changedTouches[r];var n=this.findTouch(e.identifier);if(0<=n){var o,a=this.runtime.canvas.offsetLeft,h=this.runtime.canvas.offsetTop;if(i-(o=this.touches[n]).time<2)continue;var c=2*(e.radiusX||e.webkitRadiusX||e.mozRadiusX||e.msRadiusX||0),l=2*(e.radiusY||e.webkitRadiusY||e.mozRadiusY||e.msRadiusY||0),u=e.force||e.webkitForce||e.mozForce||e.msForce||0;o.update(i,e.pageX-a,e.pageY-h,c,l,u)}}},e.onTouchStart=function(t){t.preventDefault&&cr.isCanvasInputEvent(t)&&t.preventDefault();var e,i,r=this.runtime.canvas.offsetLeft,s=this.runtime.canvas.offsetTop;cr.performance_now();for(this.runtime.isInUserInputEvent=!0,e=0,i=t.changedTouches.length;e<i;e++){var n,o,a=t.changedTouches[e];-1===this.findTouch(a.identifier)&&(n=a.pageX-r,o=a.pageY-s,this.trigger_index=this.touches.length,this.trigger_id=a.identifier,this.touches.push(h(n,o,a.identifier,this.trigger_index)),this.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnNthTouchStart,this),this.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnTouchStart,this),this.curTouchX=n,this.curTouchY=o,this.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnTouchObject,this))}this.runtime.isInUserInputEvent=!1},e.onTouchEnd=function(t,e){var i,r,s,n;for(t.preventDefault&&cr.isCanvasInputEvent(t)&&t.preventDefault(),this.runtime.isInUserInputEvent=!0,i=0,r=t.changedTouches.length;i<r;i++)s=t.changedTouches[i],0<=(n=this.findTouch(s.identifier))&&(this.trigger_index=this.touches[n].startindex,this.trigger_id=this.touches[n].id,this.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnNthTouchEnd,this),this.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnTouchEnd,this),e||this.touches[n].maybeTriggerTap(this,n),o(this.touches[n]),this.touches.splice(n,1));this.runtime.isInUserInputEvent=!1},e.getAlpha=function(){return this.runtime.isCordova&&0===this.orient_alpha&&0!==s?90*s:this.orient_alpha},e.getBeta=function(){return this.runtime.isCordova&&0===this.orient_beta&&0!==r?90*r:this.orient_beta},e.getGamma=function(){return this.runtime.isCordova&&0===this.orient_gamma&&0!==i?90*i:this.orient_gamma};function d(t){return t.sourceCapabilities&&t.sourceCapabilities.firesTouchEvents||t.originalEvent&&t.originalEvent.sourceCapabilities&&t.originalEvent.sourceCapabilities.firesTouchEvents}function g(){}e.onMouseDown=function(t){var e;d(t)||(e={changedTouches:[{pageX:t.pageX,pageY:t.pageY,identifier:0}]},this.onTouchStart(e),this.mouseDown=!0)},e.onMouseMove=function(t){var e;this.mouseDown&&(d(t)||(e={changedTouches:[{pageX:t.pageX,pageY:t.pageY,identifier:0}]},this.onTouchMove(e)))},e.onMouseUp=function(t){var e;t.preventDefault&&this.runtime.had_a_click&&!this.runtime.isMobile&&t.preventDefault(),this.runtime.had_a_click=!0,d(t)||(e={changedTouches:[{pageX:t.pageX,pageY:t.pageY,identifier:0}]},this.onTouchEnd(e),this.mouseDown=!1)},e.isClientPosOverCanvas=function(t,e){return 0<=t&&0<=e&&t<this.runtime.width&&e<this.runtime.height},e.tick2=function(){for(var t,e=cr.performance_now(),i=0,r=this.touches.length;i<r;++i)(t=this.touches[i]).time<=e-50&&(t.lasttime=e),t.maybeTriggerHold(this,i)},g.prototype.OnTouchStart=function(){return!0},g.prototype.OnTouchEnd=function(){return!0},g.prototype.IsInTouch=function(){return this.touches.length},g.prototype.OnTouchObject=function(t){return!!t&&(!!this.isClientPosOverCanvas(this.curTouchX,this.curTouchY)&&this.runtime.testAndSelectCanvasPointOverlap(t,this.curTouchX,this.curTouchY,!1))};var f=[];function y(){}g.prototype.IsTouchingObject=function(t){if(!t)return!1;for(var e,i,r,s,n=t.getCurrentSol(),o=n.getObjects(),a=0,h=o.length;a<h;a++){var c=o[a];for(c.update_bbox(),r=0,s=this.touches.length;r<s;r++){var l=this.touches[r];if(this.isClientPosOverCanvas(l.x,l.y)&&(e=c.layer.canvasToLayer(l.x,l.y,!0),i=c.layer.canvasToLayer(l.x,l.y,!1),c.contains_pt(e,i))){f.push(c);break}}}return!!f.length&&(n.select_all=!1,cr.shallowAssignArray(n.instances,f),t.applySolToContainer(),cr.clearArray(f),!0)},g.prototype.CompareTouchSpeed=function(t,e,i){if((t=Math.floor(t))<0||t>=this.touches.length)return!1;var r=this.touches[t],s=cr.distanceTo(r.x,r.y,r.lastx,r.lasty),n=(r.time-r.lasttime)/1e3,o=0<n?s/n:0;return cr.do_cmp(o,e,i)},g.prototype.OrientationSupported=function(){return void 0!==window.DeviceOrientationEvent},g.prototype.MotionSupported=function(){return void 0!==window.DeviceMotionEvent},g.prototype.CompareOrientation=function(t,e,i){var r=0,r=0===t?this.getAlpha():1===t?this.getBeta():this.getGamma();return cr.do_cmp(r,e,i)},g.prototype.CompareAcceleration=function(t,e,i){var r=0;return 0===t?r=this.acc_g_x:1===t?r=this.acc_g_y:2===t?r=this.acc_g_z:3===t?r=this.acc_x:4===t?r=this.acc_y:5===t&&(r=this.acc_z),cr.do_cmp(r,e,i)},g.prototype.OnNthTouchStart=function(t){return(t=Math.floor(t))===this.trigger_index},g.prototype.OnNthTouchEnd=function(t){return(t=Math.floor(t))===this.trigger_index},g.prototype.HasNthTouch=function(t){return t=Math.floor(t),this.touches.length>=t+1},g.prototype.OnHoldGesture=function(){return!0},g.prototype.OnTapGesture=function(){return!0},g.prototype.OnDoubleTapGesture=function(){return!0},g.prototype.OnHoldGestureObject=function(t){return!!t&&(!!this.isClientPosOverCanvas(this.curTouchX,this.curTouchY)&&this.runtime.testAndSelectCanvasPointOverlap(t,this.curTouchX,this.curTouchY,!1))},g.prototype.OnTapGestureObject=function(t){return!!t&&(!!this.isClientPosOverCanvas(this.curTouchX,this.curTouchY)&&this.runtime.testAndSelectCanvasPointOverlap(t,this.curTouchX,this.curTouchY,!1))},g.prototype.OnDoubleTapGestureObject=function(t){return!!t&&(!!this.isClientPosOverCanvas(this.curTouchX,this.curTouchY)&&this.runtime.testAndSelectCanvasPointOverlap(t,this.curTouchX,this.curTouchY,!1))},t.cnds=new g,y.prototype.TouchCount=function(t){t.set_int(this.touches.length)},y.prototype.X=function(t,e){var i,r,s,n,o,a=this.getTouchIndex;a<0||a>=this.touches.length?t.set_float(0):cr.is_undefined(e)?(r=(i=this.runtime.getLayerByNumber(0)).scale,s=i.zoomRate,n=i.parallaxX,o=i.angle,i.scale=1,i.zoomRate=1,i.parallaxX=1,i.angle=0,t.set_float(i.canvasToLayer(this.touches[a].x,this.touches[a].y,!0)),i.scale=r,i.zoomRate=s,i.parallaxX=n,i.angle=o):(i=cr.is_number(e)?this.runtime.getLayerByNumber(e):this.runtime.getLayerByName(e))?t.set_float(i.canvasToLayer(this.touches[a].x,this.touches[a].y,!0)):t.set_float(0)},y.prototype.XAt=function(t,e,i){var r,s,n,o,a;(e=Math.floor(e))<0||e>=this.touches.length?t.set_float(0):cr.is_undefined(i)?(s=(r=this.runtime.getLayerByNumber(0)).scale,n=r.zoomRate,o=r.parallaxX,a=r.angle,r.scale=1,r.zoomRate=1,r.parallaxX=1,r.angle=0,t.set_float(r.canvasToLayer(this.touches[e].x,this.touches[e].y,!0)),r.scale=s,r.zoomRate=n,r.parallaxX=o,r.angle=a):(r=cr.is_number(i)?this.runtime.getLayerByNumber(i):this.runtime.getLayerByName(i))?t.set_float(r.canvasToLayer(this.touches[e].x,this.touches[e].y,!0)):t.set_float(0)},y.prototype.XForID=function(t,e,i){var r,s,n,o,a,h,c=this.findTouch(e);c<0?t.set_float(0):(r=this.touches[c],cr.is_undefined(i)?(n=(s=this.runtime.getLayerByNumber(0)).scale,o=s.zoomRate,a=s.parallaxX,h=s.angle,s.scale=1,s.zoomRate=1,s.parallaxX=1,s.angle=0,t.set_float(s.canvasToLayer(r.x,r.y,!0)),s.scale=n,s.zoomRate=o,s.parallaxX=a,s.angle=h):(s=cr.is_number(i)?this.runtime.getLayerByNumber(i):this.runtime.getLayerByName(i))?t.set_float(s.canvasToLayer(r.x,r.y,!0)):t.set_float(0))},y.prototype.Y=function(t,e){var i,r,s,n,o,a=this.getTouchIndex;a<0||a>=this.touches.length?t.set_float(0):cr.is_undefined(e)?(r=(i=this.runtime.getLayerByNumber(0)).scale,s=i.zoomRate,n=i.parallaxY,o=i.angle,i.scale=1,i.zoomRate=1,i.parallaxY=1,i.angle=0,t.set_float(i.canvasToLayer(this.touches[a].x,this.touches[a].y,!1)),i.scale=r,i.zoomRate=s,i.parallaxY=n,i.angle=o):(i=cr.is_number(e)?this.runtime.getLayerByNumber(e):this.runtime.getLayerByName(e))?t.set_float(i.canvasToLayer(this.touches[a].x,this.touches[a].y,!1)):t.set_float(0)},y.prototype.YAt=function(t,e,i){var r,s,n,o,a;(e=Math.floor(e))<0||e>=this.touches.length?t.set_float(0):cr.is_undefined(i)?(s=(r=this.runtime.getLayerByNumber(0)).scale,n=r.zoomRate,o=r.parallaxY,a=r.angle,r.scale=1,r.zoomRate=1,r.parallaxY=1,r.angle=0,t.set_float(r.canvasToLayer(this.touches[e].x,this.touches[e].y,!1)),r.scale=s,r.zoomRate=n,r.parallaxY=o,r.angle=a):(r=cr.is_number(i)?this.runtime.getLayerByNumber(i):this.runtime.getLayerByName(i))?t.set_float(r.canvasToLayer(this.touches[e].x,this.touches[e].y,!1)):t.set_float(0)},y.prototype.YForID=function(t,e,i){var r,s,n,o,a,h,c=this.findTouch(e);c<0?t.set_float(0):(r=this.touches[c],cr.is_undefined(i)?(n=(s=this.runtime.getLayerByNumber(0)).scale,o=s.zoomRate,a=s.parallaxY,h=s.angle,s.scale=1,s.zoomRate=1,s.parallaxY=1,s.angle=0,t.set_float(s.canvasToLayer(r.x,r.y,!1)),s.scale=n,s.zoomRate=o,s.parallaxY=a,s.angle=h):(s=cr.is_number(i)?this.runtime.getLayerByNumber(i):this.runtime.getLayerByName(i))?t.set_float(s.canvasToLayer(r.x,r.y,!1)):t.set_float(0))},y.prototype.AbsoluteX=function(t){this.touches.length?t.set_float(this.touches[0].x):t.set_float(0)},y.prototype.AbsoluteXAt=function(t,e){(e=Math.floor(e))<0||e>=this.touches.length?t.set_float(0):t.set_float(this.touches[e].x)},y.prototype.AbsoluteXForID=function(t,e){var i,r=this.findTouch(e);r<0?t.set_float(0):(i=this.touches[r],t.set_float(i.x))},y.prototype.AbsoluteY=function(t){this.touches.length?t.set_float(this.touches[0].y):t.set_float(0)},y.prototype.AbsoluteYAt=function(t,e){(e=Math.floor(e))<0||e>=this.touches.length?t.set_float(0):t.set_float(this.touches[e].y)},y.prototype.AbsoluteYForID=function(t,e){var i,r=this.findTouch(e);r<0?t.set_float(0):(i=this.touches[r],t.set_float(i.y))},y.prototype.SpeedAt=function(t,e){var i,r,s;(e=Math.floor(e))<0||e>=this.touches.length?t.set_float(0):(i=this.touches[e],r=cr.distanceTo(i.x,i.y,i.lastx,i.lasty),(s=(i.time-i.lasttime)/1e3)<=0?t.set_float(0):t.set_float(r/s))},y.prototype.SpeedForID=function(t,e){var i,r,s,n=this.findTouch(e);n<0?t.set_float(0):(i=this.touches[n],r=cr.distanceTo(i.x,i.y,i.lastx,i.lasty),(s=(i.time-i.lasttime)/1e3)<=0?t.set_float(0):t.set_float(r/s))},y.prototype.AngleAt=function(t,e){var i;(e=Math.floor(e))<0||e>=this.touches.length?t.set_float(0):(i=this.touches[e],t.set_float(cr.to_degrees(cr.angleTo(i.lastx,i.lasty,i.x,i.y))))},y.prototype.AngleForID=function(t,e){var i,r=this.findTouch(e);r<0?t.set_float(0):(i=this.touches[r],t.set_float(cr.to_degrees(cr.angleTo(i.lastx,i.lasty,i.x,i.y))))},y.prototype.Alpha=function(t){t.set_float(this.getAlpha())},y.prototype.Beta=function(t){t.set_float(this.getBeta())},y.prototype.Gamma=function(t){t.set_float(this.getGamma())},y.prototype.AccelerationXWithG=function(t){t.set_float(this.acc_g_x)},y.prototype.AccelerationYWithG=function(t){t.set_float(this.acc_g_y)},y.prototype.AccelerationZWithG=function(t){t.set_float(this.acc_g_z)},y.prototype.AccelerationX=function(t){t.set_float(this.acc_x)},y.prototype.AccelerationY=function(t){t.set_float(this.acc_y)},y.prototype.AccelerationZ=function(t){t.set_float(this.acc_z)},y.prototype.TouchIndex=function(t){t.set_int(this.trigger_index)},y.prototype.TouchID=function(t){t.set_float(this.trigger_id)},y.prototype.WidthForID=function(t,e){var i,r=this.findTouch(e);r<0?t.set_float(0):(i=this.touches[r],t.set_float(i.width))},y.prototype.HeightForID=function(t,e){var i,r=this.findTouch(e);r<0?t.set_float(0):(i=this.touches[r],t.set_float(i.height))},y.prototype.PressureForID=function(t,e){var i,r=this.findTouch(e);r<0?t.set_float(0):(i=this.touches[r],t.set_float(i.pressure))},t.exps=new y}(),cr.plugins_.Browser=function(t){this.runtime=t},function(){var pluginProto=cr.plugins_.Browser.prototype;pluginProto.Type=function(t){this.plugin=t,this.runtime=t.runtime};var typeProto=pluginProto.Type.prototype;typeProto.onCreate=function(){};var offlineScriptReady=!1,browserPluginReady=!1;document.addEventListener("DOMContentLoaded",function(){var t;window.C3_RegisterSW&&navigator.serviceWorker&&((t=document.createElement("script")).onload=function(){offlineScriptReady=!0,checkReady()},t.src="offlineclient.js",document.head.appendChild(t))});var browserInstance=null;function checkReady(){offlineScriptReady&&browserPluginReady&&window.OfflineClientInfo&&window.OfflineClientInfo.SetMessageCallback(function(t){browserInstance.onSWMessage(t)})}typeProto.onAppBegin=function(){browserPluginReady=!0,checkReady()},pluginProto.Instance=function(t){this.type=t,this.runtime=t.runtime};var instanceProto=pluginProto.Instance.prototype;instanceProto.onCreate=function(){var e=this;window.addEventListener("resize",function(){e.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnResize,e)}),browserInstance=this,void 0!==navigator.onLine&&(window.addEventListener("online",function(){e.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnOnline,e)}),window.addEventListener("offline",function(){e.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnOffline,e)})),document.addEventListener("backbutton",function(){e.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnBackButton,e)}),document.addEventListener("menubutton",function(){e.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnMenuButton,e)}),document.addEventListener("searchbutton",function(){e.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnSearchButton,e)}),document.addEventListener("tizenhwkey",function(t){switch(t.keyName){case"back":e.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnBackButton,e)||window.tizen&&window.tizen.application.getCurrentApplication().exit();break;case"menu":e.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnMenuButton,e)||t.preventDefault()}}),this.runtime.isWindows10&&"undefined"!=typeof Windows?Windows.UI.Core.SystemNavigationManager.getForCurrentView().addEventListener("backrequested",function(t){e.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnBackButton,e)&&(t.handled=!0)}):this.runtime.isWinJS&&WinJS.Application&&(WinJS.Application.onbackclick=function(t){return!!e.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnBackButton,e)}),this.runtime.addSuspendCallback(function(t){t?e.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnPageHidden,e):e.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnPageVisible,e)}),this.is_arcade=void 0!==window.is_scirra_arcade},instanceProto.onSWMessage=function(t){var e=t.data.type;"downloading-update"===e?this.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnUpdateFound,this):"update-ready"===e||"update-pending"===e?this.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnUpdateReady,this):"offline-ready"===e&&this.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnOfflineReady,this)};var batteryManager=null,loadedBatteryManager=!1;function maybeLoadBatteryManager(){var t;loadedBatteryManager||navigator.getBattery&&(t=navigator.getBattery(),loadedBatteryManager=!0,t&&t.then(function(t){batteryManager=t}))}function Cnds(){}function Acts(){}Cnds.prototype.CookiesEnabled=function(){return!!navigator&&navigator.cookieEnabled},Cnds.prototype.IsOnline=function(){return!!navigator&&navigator.onLine},Cnds.prototype.HasJava=function(){return!!navigator&&navigator.javaEnabled()},Cnds.prototype.OnOnline=function(){return!0},Cnds.prototype.OnOffline=function(){return!0},Cnds.prototype.IsDownloadingUpdate=function(){return!1},Cnds.prototype.PageVisible=function(){return!this.runtime.isSuspended},Cnds.prototype.OnPageVisible=function(){return!0},Cnds.prototype.OnPageHidden=function(){return!0},Cnds.prototype.OnResize=function(){return!0},Cnds.prototype.IsFullscreen=function(){return!!(document.mozFullScreen||document.webkitIsFullScreen||document.fullScreen)},Cnds.prototype.OnBackButton=function(){return!0},Cnds.prototype.OnMenuButton=function(){return!0},Cnds.prototype.OnSearchButton=function(){return!0},Cnds.prototype.IsMetered=function(){var t=navigator.connection||navigator.mozConnection||navigator.webkitConnection;return!!t&&!!t.metered},Cnds.prototype.IsCharging=function(){var t=navigator.battery||navigator.mozBattery||navigator.webkitBattery;return t?!!t.charging:(maybeLoadBatteryManager(),!batteryManager||!!batteryManager.charging)},Cnds.prototype.IsPortraitLandscape=function(t){return(window.innerWidth<=window.innerHeight?0:1)===t},Cnds.prototype.SupportsFullscreen=function(){if(this.runtime.isNWjs)return!0;var t=this.runtime.canvas;return!!(t.requestFullscreen||t.mozRequestFullScreen||t.msRequestFullscreen||t.webkitRequestFullScreen)},Cnds.prototype.OnUpdateFound=function(){return!0},Cnds.prototype.OnUpdateReady=function(){return!0},Cnds.prototype.OnOfflineReady=function(){return!0},pluginProto.cnds=new Cnds,Acts.prototype.Alert=function(t){alert(t.toString())},Acts.prototype.Close=function(){window.tizen?window.tizen.application.getCurrentApplication().exit():navigator.app&&navigator.app.exitApp?navigator.app.exitApp():navigator.device&&navigator.device.exitApp?navigator.device.exitApp():this.is_arcade||window.close()},Acts.prototype.Focus=function(){this.runtime.isNWjs?nw.Window.get().focus():this.is_arcade||window.focus()},Acts.prototype.Blur=function(){this.runtime.isNWjs?nw.Window.get().blur():this.is_arcade||window.blur()},Acts.prototype.GoBack=function(){navigator.app&&navigator.app.backHistory?navigator.app.backHistory():!this.is_arcade&&window.back&&window.back()},Acts.prototype.GoForward=function(){!this.is_arcade&&window.forward&&window.forward()},Acts.prototype.GoHome=function(){!this.is_arcade&&window.home&&window.home()},Acts.prototype.GoToURL=function(t,e){this.runtime.isWinJS?Windows.System.Launcher.launchUriAsync(new Windows.Foundation.Uri(t)):navigator.app&&navigator.app.loadUrl?navigator.app.loadUrl(t,{openExternal:!0}):this.runtime.isCordova?window.open(t,"_system"):this.runtime.isPreview?window.open(t,"_blank"):this.is_arcade||(2!==e||this.is_arcade?1!==e||this.is_arcade?window.location=t:window.parent.location=t:window.top.location=t)},Acts.prototype.GoToURLWindow=function(t,e){this.runtime.isWinJS?Windows.System.Launcher.launchUriAsync(new Windows.Foundation.Uri(t)):navigator.app&&navigator.app.loadUrl?navigator.app.loadUrl(t,{openExternal:!0}):this.runtime.isCordova?window.open(t,"_system"):this.is_arcade||window.open(t,e)},Acts.prototype.Reload=function(){this.is_arcade||window.location.reload()};var firstRequestFullscreen=!0,crruntime=null;function onFullscreenError(t){console&&console.warn&&console.warn("Fullscreen request failed: ",t),crruntime.setSize(window.innerWidth,window.innerHeight)}Acts.prototype.RequestFullScreen=function(t,e){var i,r;2<=t&&(t+=1),6===t&&(t=2),document.mozFullScreen||document.webkitIsFullScreen||document.msFullscreenElement||document.fullScreen||document.fullScreenElement||(this.runtime.fullscreen_scaling=2<=t?t:0,i={navigationUI:"auto"},1===e?i.navigationUI="hide":2===e&&(i.navigationUI="show"),r=document.documentElement,firstRequestFullscreen&&(firstRequestFullscreen=!1,crruntime=this.runtime,r.addEventListener("mozfullscreenerror",onFullscreenError),r.addEventListener("webkitfullscreenerror",onFullscreenError),r.addEventListener("MSFullscreenError",onFullscreenError),r.addEventListener("fullscreenerror",onFullscreenError)),r.requestFullscreen?r.requestFullscreen(i):r.mozRequestFullScreen?r.mozRequestFullScreen(i):r.msRequestFullscreen?r.msRequestFullscreen(i):r.webkitRequestFullScreen&&("undefined"!=typeof Element&&void 0!==Element.ALLOW_KEYBOARD_INPUT?r.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT):r.webkitRequestFullScreen()))},Acts.prototype.CancelFullScreen=function(){document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.msExitFullscreen?document.msExitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen()},Acts.prototype.Vibrate=function(t){try{for(var e=t.split(","),i=0,r=e.length;i<r;i++)e[i]=parseInt(e[i],10);navigator.vibrate?navigator.vibrate(e):navigator.mozVibrate?navigator.mozVibrate(e):navigator.webkitVibrate?navigator.webkitVibrate(e):navigator.msVibrate&&navigator.msVibrate(e)}catch(t){}},Acts.prototype.InvokeDownload=function(t,e){var i,r,s;e&&(void 0===(i=document.createElement("a")).download?window.open(t):(r=document.getElementsByTagName("body")[0],i.textContent=e,i.href=t,i.download=e,r.appendChild(i),s=new MouseEvent("click"),i.dispatchEvent(s),r.removeChild(i)))},Acts.prototype.InvokeDownloadString=function(t,e,i){var r,s,n,o;i&&(r="data:"+e+","+encodeURIComponent(t),void 0===(s=document.createElement("a")).download?window.open(r):(n=document.getElementsByTagName("body")[0],s.textContent=i,s.href=r,s.download=i,n.appendChild(s),o=new MouseEvent("click"),s.dispatchEvent(o),n.removeChild(s)))},Acts.prototype.ConsoleLog=function(t,e){"undefined"!=typeof console&&(0===t&&console.log&&console.log(e.toString()),1===t&&console.warn&&console.warn(e.toString()),2===t&&console.error&&console.error(e.toString()))},Acts.prototype.ConsoleGroup=function(t){console&&console.group&&console.group(t)},Acts.prototype.ConsoleGroupEnd=function(){console&&console.groupEnd&&console.groupEnd()},Acts.prototype.ExecJs=function(js_){try{eval&&eval(js_)}catch(t){console&&console.error&&console.error("Error executing Javascript: ",t)}};var orientations=["portrait","landscape","portrait-primary","portrait-secondary","landscape-primary","landscape-secondary"];function Exps(){}Acts.prototype.LockOrientation=function(t){var e;(t=Math.floor(t))<0||t>=orientations.length||(this.runtime.autoLockOrientation=!1,e=orientations[t],screen.orientation&&screen.orientation.lock?screen.orientation.lock(e):screen.lockOrientation?screen.lockOrientation(e):screen.webkitLockOrientation?screen.webkitLockOrientation(e):screen.mozLockOrientation?screen.mozLockOrientation(e):screen.msLockOrientation&&screen.msLockOrientation(e))},Acts.prototype.UnlockOrientation=function(){this.runtime.autoLockOrientation=!1,screen.orientation&&screen.orientation.unlock?screen.orientation.unlock():screen.unlockOrientation?screen.unlockOrientation():screen.webkitUnlockOrientation?screen.webkitUnlockOrientation():screen.mozUnlockOrientation?screen.mozUnlockOrientation():screen.msUnlockOrientation&&screen.msUnlockOrientation()},pluginProto.acts=new Acts,Exps.prototype.URL=function(t){t.set_string(window.location.toString())},Exps.prototype.Protocol=function(t){t.set_string(window.location.protocol)},Exps.prototype.Domain=function(t){t.set_string(window.location.hostname)},Exps.prototype.PathName=function(t){t.set_string(window.location.pathname)},Exps.prototype.Hash=function(t){t.set_string(window.location.hash)},Exps.prototype.Referrer=function(t){t.set_string(document.referrer)},Exps.prototype.Title=function(t){t.set_string(document.title)},Exps.prototype.Name=function(t){t.set_string(navigator.appName)},Exps.prototype.Version=function(t){t.set_string(navigator.appVersion)},Exps.prototype.Language=function(t){navigator&&navigator.language?t.set_string(navigator.language):t.set_string("")},Exps.prototype.Platform=function(t){t.set_string(navigator.platform)},Exps.prototype.Product=function(t){navigator&&navigator.product?t.set_string(navigator.product):t.set_string("")},Exps.prototype.Vendor=function(t){navigator&&navigator.vendor?t.set_string(navigator.vendor):t.set_string("")},Exps.prototype.UserAgent=function(t){t.set_string(navigator.userAgent)},Exps.prototype.QueryString=function(t){t.set_string(window.location.search)},Exps.prototype.QueryParam=function(t,e){var i=RegExp("[?&]"+e+"=([^&]*)").exec(window.location.search);i?t.set_string(decodeURIComponent(i[1].replace(/\+/g," "))):t.set_string("")},Exps.prototype.Bandwidth=function(t){var e=navigator.connection||navigator.mozConnection||navigator.webkitConnection;e?void 0!==e.bandwidth?t.set_float(e.bandwidth):void 0!==e.downlinkMax?t.set_float(e.downlinkMax):t.set_float(Number.POSITIVE_INFINITY):t.set_float(Number.POSITIVE_INFINITY)},Exps.prototype.ConnectionType=function(t){var e=navigator.connection||navigator.mozConnection||navigator.webkitConnection;e?t.set_string(e.type||"unknown"):t.set_string("unknown")},Exps.prototype.BatteryLevel=function(t){var e=navigator.battery||navigator.mozBattery||navigator.webkitBattery;e?t.set_float(e.level):(maybeLoadBatteryManager(),batteryManager?t.set_float(batteryManager.level):t.set_float(1))},Exps.prototype.BatteryTimeLeft=function(t){var e=navigator.battery||navigator.mozBattery||navigator.webkitBattery;e?t.set_float(e.dischargingTime):(maybeLoadBatteryManager(),batteryManager?t.set_float(batteryManager.dischargingTime):t.set_float(Number.POSITIVE_INFINITY))},Exps.prototype.ExecJS=function(ret,js_){if(eval){var result=0;try{result=eval(js_)}catch(t){console&&console.error&&console.error("Error executing Javascript: ",t)}"number"==typeof result||"string"==typeof result?ret.set_any(result):"boolean"==typeof result?ret.set_any(result?1:0):ret.set_any(0)}else ret.set_any(0)},Exps.prototype.ScreenWidth=function(t){t.set_int(screen.width)},Exps.prototype.ScreenHeight=function(t){t.set_int(screen.height)},Exps.prototype.DevicePixelRatio=function(t){t.set_float(this.runtime.devicePixelRatio)},Exps.prototype.WindowInnerWidth=function(t){t.set_int(window.innerWidth)},Exps.prototype.WindowInnerHeight=function(t){t.set_int(window.innerHeight)},Exps.prototype.WindowOuterWidth=function(t){t.set_int(window.outerWidth)},Exps.prototype.WindowOuterHeight=function(t){t.set_int(window.outerHeight)},pluginProto.exps=new Exps}(),cr.plugins_.TiledBg=function(t){this.runtime=t},function(){var t=cr.plugins_.TiledBg.prototype;t.Type=function(t){this.plugin=t,this.runtime=t.runtime};var e=t.Type.prototype;e.onCreate=function(){this.is_family||(this.texture_img=this.runtime.findWaitingTexture(this.texture_file),this.texture_img||(this.texture_img=new Image,this.texture_img.cr_src=this.texture_file,this.texture_img.cr_filesize=this.texture_filesize,this.texture_img.c2webGL_texture=null,this.runtime.waitForImageLoad(this.texture_img,this.texture_file)),this.pattern=null,this.webGL_texture=null)},e.onLostWebGLContext=function(){this.is_family||(this.webGL_texture=null)},e.onRestoreWebGLContext=function(){var t,e;if(!this.is_family&&this.instances.length)for(this.webGL_texture||(this.webGL_texture=this.runtime.glwrap.loadTexture(this.texture_img,!0,this.runtime.linearSampling,this.texture_pixelformat)),t=0,e=this.instances.length;t<e;t++)this.instances[t].webGL_texture=this.webGL_texture},e.loadTextures=function(){this.is_family||this.webGL_texture||!this.runtime.glwrap||(this.webGL_texture=this.runtime.glwrap.loadTexture(this.texture_img,!0,this.runtime.linearSampling,this.texture_pixelformat))},e.unloadTextures=function(){this.is_family||this.instances.length||!this.webGL_texture||(this.runtime.glwrap.deleteTexture(this.webGL_texture),this.webGL_texture=null)},e.preloadCanvas2D=function(t){t.drawImage(this.texture_img,0,0)},t.Instance=function(t){this.type=t,this.runtime=t.runtime};var i=t.Instance.prototype;function r(){}function s(){}function n(){}i.onCreate=function(){this.visible=this.properties[0],this.rcTex=new cr.rect(0,0,0,0),this.has_own_texture=!1,this.texture_img=this.type.texture_img,this.runtime.glwrap?(this.type.loadTextures(),this.webGL_texture=this.type.webGL_texture):(this.type.pattern||(this.type.pattern=this.runtime.ctx.createPattern(this.type.texture_img,"repeat")),this.pattern=this.type.pattern)},i.afterLoad=function(){this.has_own_texture=!1,this.texture_img=this.type.texture_img},i.onDestroy=function(){this.runtime.glwrap&&this.has_own_texture&&this.webGL_texture&&(this.runtime.glwrap.deleteTexture(this.webGL_texture),this.webGL_texture=null)},i.draw=function(t){t.globalAlpha=this.opacity,t.save(),t.fillStyle=this.pattern;var e=this.x,i=this.y;this.runtime.pixel_rounding&&(e=Math.round(e),i=Math.round(i));var r=-(this.hotspotX*this.width),s=-(this.hotspotY*this.height),n=r%this.texture_img.width,o=s%this.texture_img.height;n<0&&(n+=this.texture_img.width),o<0&&(o+=this.texture_img.height),t.translate(e,i),t.rotate(this.angle),t.translate(n,o),t.fillRect(r-n,s-o,this.width,this.height),t.restore()},i.drawGL_earlyZPass=function(t){this.drawGL(t)},i.drawGL=function(t){t.setTexture(this.webGL_texture),t.setOpacity(this.opacity);var e=this.rcTex;e.right=this.width/this.texture_img.width,e.bottom=this.height/this.texture_img.height;var i,r,s=this.bquad;this.runtime.pixel_rounding?(i=Math.round(this.x)-this.x,r=Math.round(this.y)-this.y,t.quadTex(s.tlx+i,s.tly+r,s.trx+i,s.try_+r,s.brx+i,s.bry+r,s.blx+i,s.bly+r,e)):t.quadTex(s.tlx,s.tly,s.trx,s.try_,s.brx,s.bry,s.blx,s.bly,e)},r.prototype.OnURLLoaded=function(){return!0},t.cnds=new r,s.prototype.SetEffect=function(t){this.blend_mode=t,this.compositeOp=cr.effectToCompositeOp(t),cr.setGLBlend(this,t,this.runtime.gl),this.runtime.redraw=!0},s.prototype.LoadURL=function(t,e){var i=new Image,r=this;i.onload=function(){r.texture_img=i,r.runtime.glwrap?(r.has_own_texture&&r.webGL_texture&&r.runtime.glwrap.deleteTexture(r.webGL_texture),r.webGL_texture=r.runtime.glwrap.loadTexture(i,!0,r.runtime.linearSampling)):r.pattern=r.runtime.ctx.createPattern(i,"repeat"),r.has_own_texture=!0,r.runtime.redraw=!0,r.runtime.trigger(cr.plugins_.TiledBg.prototype.cnds.OnURLLoaded,r)},"data:"!==t.substr(0,5)&&0===e&&(i.crossOrigin="anonymous"),this.runtime.setImageSrc(i,t)},t.acts=new s,n.prototype.ImageWidth=function(t){t.set_float(this.texture_img.width)},n.prototype.ImageHeight=function(t){t.set_float(this.texture_img.height)},t.exps=new n}(),cr.plugins_.shadowlight=function(t){this.runtime=t},function(){var t=cr.plugins_.shadowlight.prototype;t.Type=function(t){this.plugin=t,this.runtime=t.runtime};var e=t.Type.prototype,i=(i=document.currentScript.src).substr(0,i.lastIndexOf("/")+1),r=!1,p=null,d=null;e.onCreate=function(){var t;this.is_family||r||(r=!0,(p=new Image).cr_filesize=15e3,t=this.runtime.getLocalFileUrl("penumbra.png"),this.runtime.waitForImageLoad(p,t))},e.onLostWebGLContext=function(){var t,e,i;if(!this.is_family)for(this.webGL_texture=null,this.penumbra_texture=null,t=0,e=this.instances.length;t<e;++t)(i=this.instances[t]).webGL_texture=null,i.penumbra_texture=null},e.onRestoreWebGLContext=function(){if(!this.is_family)for(var t=0,e=this.instances.length;t<e;++t)this.instances[t].createTextures()},t.Instance=function(t){this.type=t,this.runtime=t.runtime};var s=t.Instance.prototype;s.onCreate=function(){!function(){if(d)return;var t=p.width,e=p.height,i=document.createElement("canvas");i.width=t,i.height=e;var r=i.getContext("2d");r.clearRect(0,0,t,e),r.drawImage(p,0,0,t,e),d=r.getImageData(0,0,t,e).data}(),this.lightX=this.x,this.lightY=this.y,this.lightZ=this.properties[0],this.max_extrude=1e3,this.lightRadius=this.properties[1];var t=this.properties[2];this.lightR=Math.floor(255*t[0]),this.lightG=Math.floor(255*t[1]),this.lightB=Math.floor(255*t[2]),this.castFrom=this.properties[3],this.tag=this.properties[4],this.lastKnownX=this.x,this.lastKnownY=this.y,this.webGL_texture=null,this.penumbra_texture=null,this.runtime.glwrap?this.createTextures():this.lightRadius=0,this.runtime.tick2Me(this)},s.castsFrom=function(t){return 1===this.castFrom?cr.equals_nocase(this.tag,t):2!==this.castFrom||!cr.equals_nocase(this.tag,t)},s.tick2=function(){this.lastKnownX===this.x&&this.lastKnownY===this.y||(this.lightX=this.x,this.lightY=this.y);var t=this.layer,e=(t.viewLeft+t.viewRight)/2,i=(t.viewTop+t.viewBottom)/2,r=t.viewRight-t.viewLeft+this.max_extrude,s=t.viewBottom-t.viewTop+this.max_extrude;e===this.x&&i===this.y&&r===this.width&&s===this.height||(this.x=e,this.y=i,this.width=r,this.height=s,this.set_bbox_changed()),this.lastKnownX=this.x,this.lastKnownY=this.y,this.max_extrude=15*cr.distanceTo(t.viewLeft,t.viewTop,t.viewRight,t.viewBottom)},s.onDestroy=function(){this.runtime.glwrap&&(this.webGL_texture&&(this.runtime.glwrap.deleteTexture(this.webGL_texture),this.webGL_texture=null),this.penumbra_texture&&(this.runtime.glwrap.deleteTexture(this.penumbra_texture),this.penumbra_texture=null))},s.saveToJSON=function(){return{}},s.loadFromJSON=function(t){};var y=[],m=[];s.getShadowCasterCandidates=function(){this.runtime.shadowcasterBehavior&&(this.runtime.getTypesCollisionCandidates(this.layer,this.runtime.shadowcasterBehavior.myTypes,this.bbox,y),cr.removeArrayDuplicates(y))};var N=[],D=0,w=[],u=[],L=-1,k=-1,P=-1,E=-1,j=0,B=0,R=[],z=0,F=0,U=0,Y=0,Q=0,V=0,G=0,J=0,_=new cr.CollisionPoly([]);function f(t){return(t%=w.length)<0&&(t+=w.length),t}function g(){for(var t,e,i=0,r=w.length;i<r;++i)t=w[i],(e=w[f(i-1)])&&!t&&(L=i),!e&&t&&(P=i)}s.draw=function(t){var e,i,r,s,n,o,a,h,c,l,u,p,d,g,f;for(this.getShadowCasterCandidates(),t.save(),t.fillStyle="rgba("+this.lightR+","+this.lightG+","+this.lightB+","+this.opacity+")",e=0,i=y.length;e<i;++e)if((r=y[e]).extra.shadowcasterEnabled&&this.castsFrom(r.extra.shadowcasterTag))if(r.update_bbox(),h=r.extra.shadowcasterHeight,r.tilemap_exists){for(r.getCollisionRectCandidates(this.bbox,m),l=r.x,u=r.y,s=0,n=m.length;s<n;++s){for(f=(g=m[s]).rc,c=null,d=g.poly?(c=g.poly,p=f.left,f.top):(_.set_from_rect(f,0,0),c=_,p=0),this.calcShadow(c,l+p,u+d,h,!1),t.beginPath(),t.moveTo(R[0],R[1]),o=2,a=R.length;o<a;o+=2)t.lineTo(R[o],R[o+1]);t.closePath(),t.fill(),cr.clearArray(w),cr.clearArray(R)}cr.clearArray(m)}else{for(c=null,c=r.collision_poly&&!r.collision_poly.is_empty()?(r.collision_poly.cache_poly(r.width,r.height,r.angle),r.collision_poly):(_.set_from_quad(r.bquad,r.x,r.y,r.width,r.height),_),this.calcShadow(c,r.x,r.y,h,cr.xor(r.width<0,r.height<0)),t.beginPath(),t.moveTo(R[0],R[1]),s=2,n=R.length;s<n;s+=2)t.lineTo(R[s],R[s+1]);t.closePath(),t.fill(),cr.clearArray(w),cr.clearArray(R)}t.restore(),cr.clearArray(y)},s.getPolyPoints=function(t,e,i,r){var s,n;D=t.pts_count,cr.clearArray(N);for(var o,a=t.pts_cache,h=B=j=0;h<D;++h)s=a[o=2*h]+e,n=a[1+o]+i,r?(N.unshift(n),N.unshift(s)):(N.push(s),N.push(n)),j+=s,B+=n;j/=D,B/=D},s.calcShadow=function(t,e,i,r,s){var n,o,a,h;this.getPolyPoints(t,e,i,s),cr.clearArray(w),cr.clearArray(u),cr.clearArray(R),E=k=P=L=-1;var c=this.lightX,l=this.lightY;if(0<this.lightRadius){if(this.calcBackFaces(-this.lightRadius),g(),cr.shallowAssignArray(u,w),k=L,E=P,cr.clearArray(w),P=L=-1,this.calcBackFaces(this.lightRadius),g(),-1===L||-1===P||-1===k||-1===E)return;this.calcUmbraWithRadius(r)}else for(this.calcBackFaces(0),g(),n=0;n<D;++n)a=N[o=2*n],h=N[1+o],this.calcShadowSegment(n,c,l,a,h,r)},s.calcShadowSegment=function(t,e,i,r,s,n){var o,a,h,c,l=w[t],u=w[f(t-1)],p=t===L,d=t===P,g=l||u?(o=cr.angleTo(e,i,r,s),a=cr.distanceTo(e,i,r,s),h=this.calculateExtrusion(e,i,r,s,n),c=e+Math.cos(o)*(a+h),i+Math.sin(o)*(a+h)):(c=r,s);d&&(R.push(r),R.push(s)),R.push(c),R.push(g),p&&(R.push(r),R.push(s))},s.calcBackFaces=function(t){for(var e,i,r,s,n,o,a,h,c,l,u,p,d,g,f,y=this.lightX,m=this.lightY,_=y,v=m,b=0;b<D;++b)i=(i=b+1)===D?0:2*i,r=N[e=2*b],s=N[1+e],n=N[i],o=N[i+1],0!==t&&(a=cr.angleTo(y,m,j,B)-Math.PI/2,_=y+Math.cos(a)*t,v=m+Math.sin(a)*t),w.push((h=_,c=v,l=r,u=s,p=n,d=o,0,g=cr.angleTo(l,u,p,d)-Math.PI/2,f=cr.angleTo(l,u,h,c),cr.angleDiff(f,g)>=Math.PI/2))};var X=0,W=0;function n(){}function o(){}s.calcUmbraWithRadius=function(t){for(var e,i,r=k;e=N[s=2*(r%=D)],i=N[s+1],R.push(e),R.push(i),r!==P;++r);var s,n,o,a,h,c,l,u,p,d,g,f,y=this.lightRadius,m=e,_=i,v=cr.angleTo(this.lightX,this.lightY,j,B),b=this.lightX+Math.cos(v-Math.PI/2)*y,w=this.lightY+Math.sin(v-Math.PI/2)*y,x=cr.angleTo(b,w,m,_),T=cr.distanceTo(b,w,m,_),M=b+Math.cos(x)*(T+this.max_extrude),S=w+Math.sin(x)*(T+this.max_extrude),A=N[s=2*k],C=N[s+1],v=cr.angleTo(this.lightX,this.lightY,j,B),L=this.lightX+Math.cos(v+Math.PI/2)*y,E=this.lightY+Math.sin(v+Math.PI/2)*y,x=cr.angleTo(L,E,A,C),T=cr.distanceTo(L,E,A,C),O=L+Math.cos(x)*(T+this.max_extrude),I=E+Math.sin(x)*(T+this.max_extrude);Y=0!==(f=-(d=O-(a=z=A))*(p=S-(o=V=_))+(u=M-(n=Q=m))*(g=I-(h=F=C)))&&(c=(-p*(n-a)+u*(o-h))/f,0!=(f=-d*p+u*g))&&(l=(d*(o-h)-g*(n-a))/f,0<=c&&c<=1&&0<=l&&l<=1&&(X=n+l*u,W=o+l*p,1))?(R.push(X),R.push(W),U=G=X,J=W):(R.push(M),R.push(S),R.push(O),R.push(I),G=M,J=S,U=O,I)},s.calculateExtrusion=function(t,e,i,r,s){if(s>=this.lightZ)return this.max_extrude;if(s<=0)return 0;var n=cr.distanceTo(t,e,i,r),o=Math.atan(n/(this.lightZ-s)),a=s*Math.tan(o);return a>=this.max_extrude&&(a=this.max_extrude),a<0&&(a=0),a},s.drawGL=function(t){var e,i,r,s,n,o,a,h,c,l,u,p,d;for(t.setOpacity(this.opacity),this.getShadowCasterCandidates(),e=0,i=y.length;e<i;++e)if((n=y[e]).extra.shadowcasterEnabled&&this.castsFrom(n.extra.shadowcasterTag))if(n.update_bbox(),o=n.extra.shadowcasterHeight,n.tilemap_exists){for(n.getCollisionRectCandidates(this.bbox,m),h=n.x,c=n.y,r=0,s=m.length;r<s;++r)u=(l=m[r]).rc,a=null,d=l.poly?(a=l.poly,p=u.left,u.top):(_.set_from_rect(u,0,0),a=_,p=0),this.calcShadow(a,h+p,c+d,o,!1),R.length<6||(t.setTexture(this.webGL_texture),t.convexPoly(R),-1<L&&-1<k&&(t.setTexture(this.penumbra_texture),this.drawPenumbraGL(t,!0)),-1<P&&-1<E&&(t.setTexture(this.penumbra_texture),this.drawPenumbraGL(t,!1)),cr.clearArray(w),cr.clearArray(R));cr.clearArray(m)}else{if(a=null,a=n.collision_poly&&!n.collision_poly.is_empty()?(n.collision_poly.cache_poly(n.width,n.height,n.angle),n.collision_poly):(_.set_from_quad(n.bquad,n.x,n.y,n.width,n.height),_),this.calcShadow(a,n.x,n.y,o,cr.xor(n.width<0,n.height<0)),R.length<6)continue;t.setTexture(this.webGL_texture),t.convexPoly(R),-1<L&&-1<k&&(t.setTexture(this.penumbra_texture),this.drawPenumbraGL(t,!0)),-1<P&&-1<E&&(t.setTexture(this.penumbra_texture),this.drawPenumbraGL(t,!1)),cr.clearArray(w),cr.clearArray(R)}cr.clearArray(y)},s.drawPenumbraGL=function(t,e){var i,r,s,n,o,a=this.lightX,h=this.lightY,c=e?(s=z,n=F,o=U,Y):(s=Q,n=V,o=G,J),l=this.lightRadius,u=cr.angleTo(a,h,j,B),p=Math.PI/2;e&&(p=-p),a+=Math.cos(u+p)*l,h+=Math.sin(u+p)*l;var d=!1;e?(d=L!==k)&&(i=N[2*L],r=N[2*L+1]):(d=P!==E)&&(i=N[2*E],r=N[2*E+1]),u=d?cr.angleTo(i,r,s,n):cr.angleTo(a,h,s,n);var g,f,y,m,_,v,b,w,x,T=s+Math.cos(u)*this.max_extrude,M=n+Math.sin(u)*this.max_extrude,S=0,A=0,C=1;d&&(g=cr.angleTo(a,h,i,r),f=i+Math.cos(g)*this.max_extrude,y=r+Math.sin(g)*this.max_extrude,m=u,_=cr.angleTo(s,n,o,c),S=cr.angleDiff(m,g)/cr.angleDiff(_,g),b=(v=cr.distanceTo(i,r,s,n))/(v+this.max_extrude),w=cr.angleTo(0,1,S,0),x=cr.distanceTo(0,1,S,0),A+=Math.cos(w)*b*x,C+=Math.sin(w)*b*x),t.quadTexUV(s,n,o,c,T,M,T,M,A,C,1,0,S,0,S,0),d&&t.quadTexUV(i,r,T,M,f,y,f,y,0,1,S,0,0,0,0,0)},s.createTextures=function(){this.runtime.glwrap&&(this.webGL_texture&&(this.runtime.glwrap.deleteTexture(this.webGL_texture),this.webGL_texture=null),this.penumbra_texture&&(this.runtime.glwrap.deleteTexture(this.penumbra_texture),this.penumbra_texture=null),this.createFillTexture(),this.createPenumbraTexture())},s.createFillTexture=function(){var t=document.createElement("canvas");t.width=16,t.height=16;var e=t.getContext("2d");e.fillStyle="rgb("+this.lightR+","+this.lightG+","+this.lightB+")",e.fillRect(0,0,16,16),this.webGL_texture=this.runtime.glwrap.createEmptyTexture(16,16,!1,!1,!0),this.runtime.glwrap.videoToTexture(t,this.webGL_texture)},s.createPenumbraTexture=function(){var t=p.width,e=p.height,i=this.lightR,r=this.lightG,s=this.lightB,n=d,o=document.createElement("canvas");o.width=t,o.height=e;for(var a=o.getContext("2d"),h=a.createImageData(t,e),c=h.data,l=0,u=c.length;l<u;l+=4)c[l]=i,c[l+1]=r,c[l+2]=s,c[l+3]=n[l+3];a.putImageData(h,0,0),this.penumbra_texture=this.runtime.glwrap.createEmptyTexture(t,e,this.runtime.linearSampling,!1,!1),this.runtime.glwrap.videoToTexture(o,this.penumbra_texture)},t.cnds=new function(){},n.prototype.SetLightHeight=function(t){this.lightZ!==t&&(this.lightZ=t,this.runtime.redraw=!0)},n.prototype.SetLightColor=function(t){var e=cr.clamp(Math.floor(255*cr.GetRValue(t)),0,255),i=cr.clamp(Math.floor(255*cr.GetGValue(t)),0,255),r=cr.clamp(Math.floor(255*cr.GetBValue(t)),0,255);this.lightR===e&&this.lightG===i&&this.lightB===r||(this.lightR=e,this.lightG=i,this.lightB=r,this.createTextures(),this.runtime.redraw=!0)},n.prototype.SetTag=function(t){this.tag!==t&&(this.tag=t,this.runtime.redraw=!0)},t.acts=new n,o.prototype.LightX=function(t){t.set_float(this.lightX)},o.prototype.LightY=function(t){t.set_float(this.lightY)},o.prototype.Tag=function(t){t.set_string(this.tag)},t.exps=new o}(),cr.plugins_.Particles=function(t){this.runtime=t},function(){var t=cr.plugins_.Particles.prototype;t.Type=function(t){this.plugin=t,this.runtime=t.runtime};var e=t.Type.prototype;function i(t){this.owner=t,this.active=!1,this.x=0,this.y=0,this.speed=0,this.angle=0,this.opacity=1,this.grow=0,this.size=0,this.gs=0,this.age=0,cr.seal(this)}e.onCreate=function(){this.is_family||(this.texture_img=this.runtime.findWaitingTexture(this.texture_file),this.texture_img||(this.texture_img=new Image,this.texture_img.cr_src=this.texture_file,this.texture_img.cr_filesize=this.texture_filesize,this.texture_img.c2webGL_texture=null,this.runtime.waitForImageLoad(this.texture_img,this.texture_file)),this.spriteX=this.texture_data[3],this.spriteY=this.texture_data[4],this.spriteWidth=this.texture_data[5],this.spriteHeight=this.texture_data[6])},e.onLostWebGLContext=function(){this.is_family||(this.webGL_texture=null)},e.createParticleTexture=function(){var t=document.createElement("canvas"),e=this.spriteWidth,i=this.spriteHeight;t.width=e,t.height=i,t.getContext("2d").drawImage(this.texture_img,this.spriteX,this.spriteY,e,i,0,0,e,i),this.webGL_texture=this.runtime.glwrap.loadTexture(t,!0,this.runtime.linearSampling,this.texture_pixelformat)},e.onRestoreWebGLContext=function(){!this.is_family&&this.instances.length&&(this.webGL_texture||this.createParticleTexture())},e.loadTextures=function(){this.is_family||this.webGL_texture||!this.runtime.glwrap||this.createParticleTexture()},e.unloadTextures=function(){this.is_family||this.instances.length||!this.webGL_texture||(this.runtime.glwrap.deleteTexture(this.webGL_texture),this.webGL_texture=null)},e.preloadCanvas2D=function(t){t.drawImage(this.texture_img,0,0)},i.prototype.init=function(){var t=this.owner;this.x=t.x-t.xrandom/2+Math.random()*t.xrandom,this.y=t.y-t.yrandom/2+Math.random()*t.yrandom,this.speed=t.initspeed-t.speedrandom/2+Math.random()*t.speedrandom,this.angle=t.angle-t.spraycone/2+Math.random()*t.spraycone,this.opacity=t.initopacity,this.size=t.initsize-t.sizerandom/2+Math.random()*t.sizerandom,this.grow=t.growrate-t.growrandom/2+Math.random()*t.growrandom,this.gs=0,this.age=0},i.prototype.tick=function(t){var e=this.owner;this.x+=Math.cos(this.angle)*this.speed*t,this.y+=Math.sin(this.angle)*this.speed*t,this.y+=this.gs*t,this.speed+=e.acc*t,this.size+=this.grow*t,this.gs+=e.g*t,this.age+=t,this.size<1?this.active=!1:(0!==e.lifeanglerandom&&(this.angle+=Math.random()*e.lifeanglerandom*t-e.lifeanglerandom*t/2),0!==e.lifespeedrandom&&(this.speed+=Math.random()*e.lifespeedrandom*t-e.lifespeedrandom*t/2),0!==e.lifeopacityrandom&&(this.opacity+=Math.random()*e.lifeopacityrandom*t-e.lifeopacityrandom*t/2,this.opacity<0?this.opacity=0:1<this.opacity&&(this.opacity=1)),e.destroymode<=1&&this.age>=e.timeout&&(this.active=!1),2===e.destroymode&&this.speed<=0&&(this.active=!1))},i.prototype.draw=function(t){var e,i,r,s=this.owner.opacity*this.opacity;0!==s&&(0===this.owner.destroymode&&(s*=1-this.age/this.owner.timeout),t.globalAlpha=s,e=this.x-this.size/2,i=this.y-this.size/2,this.owner.runtime.pixel_rounding&&(e=e+.5|0,i=i+.5|0),r=this.owner.type,t.drawImage(r.texture_img,r.spriteX,r.spriteY,r.spriteWidth,r.spriteHeight,e,i,this.size,this.size))},i.prototype.drawGL=function(t){var e=this.owner.opacity*this.opacity;0===this.owner.destroymode&&(e*=1-this.age/this.owner.timeout);var i=this.size,r=i*this.owner.particlescale,s=this.x-i/2,n=this.y-i/2;this.owner.runtime.pixel_rounding&&(s=s+.5|0,n=n+.5|0),r<1||0===e||(r<t.minPointSize||r>t.maxPointSize?(t.setOpacity(e),t.quad(s,n,s+i,n,s+i,n+i,s,n+i)):t.point(this.x,this.y,r,e))},i.prototype.left=function(){return this.x-this.size/2},i.prototype.right=function(){return this.x+this.size/2},i.prototype.top=function(){return this.y-this.size/2},i.prototype.bottom=function(){return this.y+this.size/2},t.Instance=function(t){this.type=t,this.runtime=t.runtime};var r=t.Instance.prototype,o=[];function s(){}function n(){}function a(){}r.onCreate=function(){var t=this.properties;if(this.rate=t[0],this.spraycone=cr.to_radians(t[1]),this.spraytype=t[2],this.spraying=!0,this.initspeed=t[4],this.initsize=t[5],this.initopacity=t[6]/100,this.growrate=t[7],this.xrandom=t[8],this.yrandom=t[9],this.speedrandom=t[10],this.sizerandom=t[11],this.growrandom=t[12],this.acc=t[13],this.g=t[14],this.lifeanglerandom=t[15],this.lifespeedrandom=t[16],this.lifeopacityrandom=t[17],this.destroymode=t[18],this.timeout=t[19],this.particleCreateCounter=0,this.particlescale=1,this.particleBoxLeft=this.x,this.particleBoxTop=this.y,this.particleBoxRight=this.x,this.particleBoxBottom=this.y,this.add_bbox_changed_callback(function(t){t.bbox.set(t.particleBoxLeft,t.particleBoxTop,t.particleBoxRight,t.particleBoxBottom),t.bquad.set_from_rect(t.bbox),t.bbox_changed=!1,t.update_collision_cell(),t.update_render_cell()}),this.recycled||(this.particles=[]),this.runtime.tickMe(this),this.type.loadTextures(),1===this.spraytype)for(var e=0;e<this.rate;e++)this.allocateParticle().opacity=0;this.first_tick=!0},r.saveToJSON=function(){for(var t,e={r:this.rate,sc:this.spraycone,st:this.spraytype,s:this.spraying,isp:this.initspeed,isz:this.initsize,io:this.initopacity,gr:this.growrate,xr:this.xrandom,yr:this.yrandom,spr:this.speedrandom,szr:this.sizerandom,grnd:this.growrandom,acc:this.acc,g:this.g,lar:this.lifeanglerandom,lsr:this.lifespeedrandom,lor:this.lifeopacityrandom,dm:this.destroymode,to:this.timeout,pcc:this.particleCreateCounter,ft:this.first_tick,p:[]},i=e.p,r=0,s=this.particles.length;r<s;r++)t=this.particles[r],i.push([t.x,t.y,t.speed,t.angle,t.opacity,t.grow,t.size,t.gs,t.age]);return e},r.loadFromJSON=function(t){var e,i;this.rate=t.r,this.spraycone=t.sc,this.spraytype=t.st,this.spraying=t.s,this.initspeed=t.isp,this.initsize=t.isz,this.initopacity=t.io,this.growrate=t.gr,this.xrandom=t.xr,this.yrandom=t.yr,this.speedrandom=t.spr,this.sizerandom=t.szr,this.growrandom=t.grnd,this.acc=t.acc,this.g=t.g,this.lifeanglerandom=t.lar,this.lifespeedrandom=t.lsr,this.lifeopacityrandom=t.lor,this.destroymode=t.dm,this.timeout=t.to,this.particleCreateCounter=t.pcc,this.first_tick=t.ft,o.push.apply(o,this.particles),cr.clearArray(this.particles);for(var r=t.p,s=0,n=r.length;s<n;s++)e=this.allocateParticle(),i=r[s],e.x=i[0],e.y=i[1],e.speed=i[2],e.angle=i[3],e.opacity=i[4],e.grow=i[5],e.size=i[6],e.gs=i[7],e.age=i[8]},r.onDestroy=function(){o.push.apply(o,this.particles),cr.clearArray(this.particles)},r.allocateParticle=function(){var t;return o.length?(t=o.pop()).owner=this:t=new i(this),this.particles.push(t),t.active=!0,t},r.tick=function(){var t,e,i,r,s,n=this.runtime.getDt(this);if(0===this.spraytype&&this.spraying)for(this.particleCreateCounter+=n*this.rate,r=cr.floor(this.particleCreateCounter),this.particleCreateCounter-=r,t=0;t<r;t++)(i=this.allocateParticle()).init();for(this.particleBoxLeft=this.x,this.particleBoxTop=this.y,this.particleBoxRight=this.x,this.particleBoxBottom=this.y,s=t=0,e=this.particles.length;t<e;t++)i=this.particles[t],this.particles[s]=i,this.runtime.redraw=!0,1===this.spraytype&&this.first_tick&&i.init(),i.tick(n),i.active?(i.left()<this.particleBoxLeft&&(this.particleBoxLeft=i.left()),i.right()>this.particleBoxRight&&(this.particleBoxRight=i.right()),i.top()<this.particleBoxTop&&(this.particleBoxTop=i.top()),i.bottom()>this.particleBoxBottom&&(this.particleBoxBottom=i.bottom()),s++):o.push(i);cr.truncateArray(this.particles,s),this.set_bbox_changed(),this.first_tick=!1,1===this.spraytype&&0===this.particles.length&&this.runtime.DestroyInstance(this)},r.draw=function(t){for(var e,i=this.layer,r=0,s=this.particles.length;r<s;r++)(e=this.particles[r]).right()>=i.viewLeft&&e.bottom()>=i.viewTop&&e.left()<=i.viewRight&&e.top()<=i.viewBottom&&e.draw(t)},r.drawGL=function(t){this.particlescale=this.layer.getScale(),t.setTexture(this.type.webGL_texture);for(var e,i=this.layer,r=0,s=this.particles.length;r<s;r++)(e=this.particles[r]).right()>=i.viewLeft&&e.bottom()>=i.viewTop&&e.left()<=i.viewRight&&e.top()<=i.viewBottom&&e.drawGL(t)},s.prototype.IsSpraying=function(){return this.spraying},t.cnds=new s,n.prototype.SetSpraying=function(t){this.spraying=0!==t},n.prototype.SetEffect=function(t){this.blend_mode=t,this.compositeOp=cr.effectToCompositeOp(t),cr.setGLBlend(this,t,this.runtime.gl),this.runtime.redraw=!0},n.prototype.SetRate=function(t){var e,i;if(this.rate=t,1===this.spraytype&&this.first_tick)if(t<this.particles.length)for(e=this.particles.length-t,i=0;i<e;i++)o.push(this.particles.pop());else if(t>this.particles.length)for(e=t-this.particles.length,i=0;i<e;i++)this.allocateParticle().opacity=0},n.prototype.SetSprayCone=function(t){this.spraycone=cr.to_radians(t)},n.prototype.SetInitSpeed=function(t){this.initspeed=t},n.prototype.SetInitSize=function(t){this.initsize=t},n.prototype.SetInitOpacity=function(t){this.initopacity=t/100},n.prototype.SetGrowRate=function(t){this.growrate=t},n.prototype.SetXRandomiser=function(t){this.xrandom=t},n.prototype.SetYRandomiser=function(t){this.yrandom=t},n.prototype.SetSpeedRandomiser=function(t){this.speedrandom=t},n.prototype.SetSizeRandomiser=function(t){this.sizerandom=t},n.prototype.SetGrowRateRandomiser=function(t){this.growrandom=t},n.prototype.SetParticleAcc=function(t){this.acc=t},n.prototype.SetGravity=function(t){this.g=t},n.prototype.SetAngleRandomiser=function(t){this.lifeanglerandom=t},n.prototype.SetLifeSpeedRandomiser=function(t){this.lifespeedrandom=t},n.prototype.SetOpacityRandomiser=function(t){this.lifeopacityrandom=t},n.prototype.SetTimeout=function(t){this.timeout=t},t.acts=new n,a.prototype.ParticleCount=function(t){t.set_int(this.particles.length)},a.prototype.Rate=function(t){t.set_float(this.rate)},a.prototype.SprayCone=function(t){t.set_float(cr.to_degrees(this.spraycone))},a.prototype.InitSpeed=function(t){t.set_float(this.initspeed)},a.prototype.InitSize=function(t){t.set_float(this.initsize)},a.prototype.InitOpacity=function(t){t.set_float(100*this.initopacity)},a.prototype.InitGrowRate=function(t){t.set_float(this.growrate)},a.prototype.XRandom=function(t){t.set_float(this.xrandom)},a.prototype.YRandom=function(t){t.set_float(this.yrandom)},a.prototype.InitSpeedRandom=function(t){t.set_float(this.speedrandom)},a.prototype.InitSizeRandom=function(t){t.set_float(this.sizerandom)},a.prototype.InitGrowRandom=function(t){t.set_float(this.growrandom)},a.prototype.ParticleAcceleration=function(t){t.set_float(this.acc)},a.prototype.Gravity=function(t){t.set_float(this.g)},a.prototype.ParticleAngleRandom=function(t){t.set_float(this.lifeanglerandom)},a.prototype.ParticleSpeedRandom=function(t){t.set_float(this.lifespeedrandom)},a.prototype.ParticleOpacityRandom=function(t){t.set_float(this.lifeopacityrandom)},a.prototype.Timeout=function(t){t.set_float(this.timeout)},t.exps=new a}(),cr.plugins_.Dictionary=function(t){this.runtime=t},function(){var t=cr.plugins_.Dictionary.prototype;t.Type=function(t){this.plugin=t,this.runtime=t.runtime},t.Type.prototype.onCreate=function(){},t.Instance=function(t){this.type=t,this.runtime=t.runtime};var e=t.Instance.prototype;function i(){}function r(){}function s(){}e.onCreate=function(){this.dictionary={},this.cur_key="",this.key_count=0},e.saveToJSON=function(){return this.dictionary},e.loadFromJSON=function(t){for(var e in this.dictionary=t,this.key_count=0,this.dictionary)this.dictionary.hasOwnProperty(e)&&this.key_count++},i.prototype.CompareValue=function(t,e,i){return cr.do_cmp(this.dictionary[t],e,i)},i.prototype.ForEachKey=function(){var t=this.runtime.getCurrentEventStack().current_event;for(var e in this.dictionary)this.dictionary.hasOwnProperty(e)&&(this.cur_key=e,this.runtime.pushCopySol(t.solModifiers),t.retrigger(),this.runtime.popSol(t.solModifiers));return this.cur_key="",!1},i.prototype.CompareCurrentValue=function(t,e){return cr.do_cmp(this.dictionary[this.cur_key],t,e)},i.prototype.HasKey=function(t){return this.dictionary.hasOwnProperty(t)},i.prototype.IsEmpty=function(){return 0===this.key_count},t.cnds=new i,r.prototype.AddKey=function(t,e){this.dictionary.hasOwnProperty(t)||this.key_count++,this.dictionary[t]=e},r.prototype.SetKey=function(t,e){this.dictionary.hasOwnProperty(t)&&(this.dictionary[t]=e)},r.prototype.DeleteKey=function(t){this.dictionary.hasOwnProperty(t)&&(delete this.dictionary[t],this.key_count--)},r.prototype.Clear=function(){cr.wipe(this.dictionary),this.key_count=0},r.prototype.JSONLoad=function(t){var e;try{e=JSON.parse(t)}catch(t){return}if(e.c2dictionary)for(var i in this.dictionary=e.data,this.key_count=0,this.dictionary)this.dictionary.hasOwnProperty(i)&&this.key_count++},r.prototype.JSONDownload=function(t){var e,i,r=document.createElement("a");void 0===r.download?(e="data:text/html,"+encodeURIComponent("<p><a download='data.json' href=\"data:application/json,"+encodeURIComponent(JSON.stringify({c2dictionary:!0,data:this.dictionary}))+'">Download link</a></p>'),window.open(e)):(i=document.getElementsByTagName("body")[0],r.textContent=t,r.href="data:application/json,"+encodeURIComponent(JSON.stringify({c2dictionary:!0,data:this.dictionary})),r.download=t,i.appendChild(r),r.click(),i.removeChild(r))},t.acts=new r,s.prototype.Get=function(t,e){this.dictionary.hasOwnProperty(e)?t.set_any(this.dictionary[e]):t.set_int(0)},s.prototype.GetDefault=function(t,e,i){this.dictionary.hasOwnProperty(e)?t.set_any(this.dictionary[e]):t.set_any(i)},s.prototype.KeyCount=function(t){t.set_int(this.key_count)},s.prototype.CurrentKey=function(t){t.set_string(this.cur_key)},s.prototype.CurrentValue=function(t){this.dictionary.hasOwnProperty(this.cur_key)?t.set_any(this.dictionary[this.cur_key]):t.set_int(0)},s.prototype.AsJSON=function(t){t.set_string(JSON.stringify({c2dictionary:!0,data:this.dictionary}))},t.exps=new s}();var localForageInitFailed=!1;try{!function(t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).localforage=t()}(function(){return function n(o,a,h){function c(i,t){if(!a[i]){if(!o[i]){var e="function"==typeof require&&require;if(!t&&e)return e(i,!0);if(l)return l(i,!0);var r=new Error("Cannot find module '"+i+"'");throw r.code="MODULE_NOT_FOUND",r}var s=a[i]={exports:{}};o[i][0].call(s.exports,function(t){var e=o[i][1][t];return c(e||t)},s,s.exports,n,o,a,h)}return a[i].exports}for(var l="function"==typeof require&&require,t=0;t<h.length;t++)c(h[t]);return c}({1:[function(t,e,i){function o(e,i){e=e||[],i=i||{};try{return new Blob(e,i)}catch(t){if("TypeError"!==t.name)throw t;for(var r=new("undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder),s=0;s<e.length;s+=1)r.append(e[s]);return r.getBlob(i.type)}}function l(t,e){e&&t.then(function(t){e(null,t)},function(t){e(t)})}function u(t,e,i){"function"==typeof e&&t.then(e),"function"==typeof i&&t.catch(i)}function a(t){return"boolean"==typeof n?b.resolve(n):(r=t,new b(function(i){var t=r.transaction(w,"readwrite"),e=o([""]);t.objectStore(w).put(e,"key"),t.onabort=function(t){t.preventDefault(),t.stopPropagation(),i(!1)},t.oncomplete=function(){var t=navigator.userAgent.match(/Chrome\/(\d+)/),e=navigator.userAgent.match(/Edge\//);i(e||!t||43<=parseInt(t[1],10))}}).catch(function(){return!1}).then(function(t){return n=t}));var r}function p(o,a){return new b(function(e,i){if(o.db){if(!a)return e(o.db);t=v[o.name],(r={}).promise=new b(function(t){r.resolve=t}),t.deferredOperations.push(r),t.dbReady?t.dbReady=t.dbReady.then(function(){return r.promise}):t.dbReady=r.promise,o.db.close()}var t,r,s=[o.name];a&&s.push(o.version);var n=_.open.apply(_,s);a&&(n.onupgradeneeded=function(e){var t=n.result;try{t.createObjectStore(o.storeName),e.oldVersion<=1&&t.createObjectStore(w)}catch(t){if("ConstraintError"!==t.name)throw t;console.warn('The database "'+o.name+'" has been upgraded from version '+e.oldVersion+" to version "+e.newVersion+', but the storage "'+o.storeName+'" already exists.')}}),n.onerror=function(t){t.preventDefault(),i(n.error)},n.onsuccess=function(){var t;e(n.result),(t=v[o.name].deferredOperations.pop())&&t.resolve()}})}function h(t){return o([function(t){for(var e=t.length,i=new ArrayBuffer(e),r=new Uint8Array(i),s=0;s<e;s++)r[s]=t.charCodeAt(s);return i}(atob(t.data))],{type:t.type})}function c(t){return t&&t.__local_forage_encoded_blob}function d(t){var e=this,i=e._initReady().then(function(){var t=v[e._dbInfo.name];return t&&t.dbReady?t.dbReady:void 0});return u(i,t,t),i}function g(t){var e,i,r,s,n=.75*t.length,o=t.length,a=0;"="===t[t.length-1]&&(n--,"="===t[t.length-2]&&n--);for(var h=new ArrayBuffer(n),c=new Uint8Array(h),l=0;l<o;l+=4)e=M.indexOf(t[l]),i=M.indexOf(t[l+1]),r=M.indexOf(t[l+2]),s=M.indexOf(t[l+3]),c[a++]=e<<2|i>>4,c[a++]=(15&i)<<4|r>>2,c[a++]=(3&r)<<6|63&s;return h}function f(t){for(var e=new Uint8Array(t),i="",r=0;r<e.length;r+=3)i+=M[e[r]>>2],i+=M[(3&e[r])<<4|e[r+1]>>4],i+=M[(15&e[r+1])<<2|e[r+2]>>6],i+=M[63&e[r+2]];return e.length%3==2?i=i.substring(0,i.length-1)+"=":e.length%3==1&&(i=i.substring(0,i.length-2)+"=="),i}function y(o,t,a,h){var c=this;"string"!=typeof o&&(console.warn(o+" used as a key, but it is not a string."),o=String(o));var e=new b(function(s,n){c.ready().then(function(){void 0===t&&(t=null);var i=t,r=c._dbInfo;r.serializer.serialize(t,function(e,t){t?n(t):r.db.transaction(function(t){t.executeSql("INSERT OR REPLACE INTO "+r.storeName+" (key, value) VALUES (?, ?)",[o,e],function(){s(i)},function(t,e){n(e)})},function(t){if(t.code===t.QUOTA_ERR){if(0<h)return void s(y.apply(c,[o,i,a,h-1]));n(t)}})})}).catch(n)});return l(e,a),e}function r(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];if(i)for(var r in i)i.hasOwnProperty(r)&&(z(i[r])?t[r]=i[r].slice():t[r]=i[r])}return t}function m(t){for(var e in k)if(k.hasOwnProperty(e)&&k[e]===t)return 1}var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol?"symbol":typeof t},_=function(){try{if("undefined"!=typeof indexedDB)return indexedDB;if("undefined"!=typeof webkitIndexedDB)return webkitIndexedDB;if("undefined"!=typeof mozIndexedDB)return mozIndexedDB;if("undefined"!=typeof OIndexedDB)return OIndexedDB;if("undefined"!=typeof msIndexedDB)return msIndexedDB}catch(t){}}();"undefined"==typeof Promise&&t("lie/polyfill");var n,v,b=Promise,w="local-forage-detect-blob-support",x=Object.prototype.toString,T={_driver:"asyncStorage",_initStorage:function(t){function e(){return b.resolve()}var r=this,s={db:null};if(t)for(var i in t)s[i]=t[i];var n=(v=v||{})[s.name];n||(n={forages:[],db:null,dbReady:null,deferredOperations:[]},v[s.name]=n),n.forages.push(r),r._initReady||(r._initReady=r.ready,r.ready=d);for(var o=[],a=0;a<n.forages.length;a++){var h=n.forages[a];h!==r&&o.push(h._initReady().catch(e))}var c=n.forages.slice(0);return b.all(o).then(function(){return s.db=n.db,p(s,!1)}).then(function(t){return s.db=t,function(t,e){if(!t.db)return 1;var i,r=!t.db.objectStoreNames.contains(t.storeName),s=t.version<t.db.version,n=t.version>t.db.version;return s&&(t.version!==e&&console.warn('The database "'+t.name+"\" can't be downgraded from version "+t.db.version+" to version "+t.version+"."),t.version=t.db.version),(n||r)&&(!r||(i=t.db.version+1)>t.version&&(t.version=i),1)}(s,r._defaultConfig.version)?p(s,!0):t}).then(function(t){s.db=n.db=t,r._dbInfo=s;for(var e=0;e<c.length;e++){var i=c[e];i!==r&&(i._dbInfo.db=s.db,i._dbInfo.version=s.version)}})},iterate:function(o,t){var i=this,e=new b(function(n,e){i.ready().then(function(){var t=i._dbInfo,r=t.db.transaction(t.storeName,"readonly").objectStore(t.storeName).openCursor(),s=1;r.onsuccess=function(){var t,e,i=r.result;i?(c(t=i.value)&&(t=h(t)),void 0!==(e=o(t,i.key,s++))?n(e):i.continue()):n()},r.onerror=function(){e(r.error)}}).catch(e)});return l(e,t),e},getItem:function(s,t){var n=this;"string"!=typeof s&&(console.warn(s+" used as a key, but it is not a string."),s=String(s));var e=new b(function(i,r){n.ready().then(function(){var t=n._dbInfo,e=t.db.transaction(t.storeName,"readonly").objectStore(t.storeName).get(s);e.onsuccess=function(){var t=e.result;void 0===t&&(t=null),c(t)&&(t=h(t)),i(t)},e.onerror=function(){r(e.error)}}).catch(r)});return l(e,t),e},setItem:function(o,e,t){var i=this;"string"!=typeof o&&(console.warn(o+" used as a key, but it is not a string."),o=String(o));var r=new b(function(r,s){var n;i.ready().then(function(){return n=i._dbInfo,"[object Blob]"===x.call(e)?a(n.db).then(function(t){return t?e:(r=e,new b(function(i,t){var e=new FileReader;e.onerror=t,e.onloadend=function(t){var e=btoa(t.target.result||"");i({__local_forage_encoded_blob:!0,data:e,type:r.type})},e.readAsBinaryString(r)}));var r}):e}).then(function(t){var e=n.db.transaction(n.storeName,"readwrite"),i=e.objectStore(n.storeName).put(t,o);null===t&&(t=void 0),e.oncomplete=function(){void 0===t&&(t=null),r(t)},e.onabort=e.onerror=function(){var t=i.error?i.error:i.transaction.error;s(t)}}).catch(s)});return l(r,t),r},removeItem:function(n,t){var o=this;"string"!=typeof n&&(console.warn(n+" used as a key, but it is not a string."),n=String(n));var e=new b(function(r,s){o.ready().then(function(){var t=o._dbInfo,e=t.db.transaction(t.storeName,"readwrite"),i=e.objectStore(t.storeName).delete(n);e.oncomplete=function(){r()},e.onerror=function(){s(i.error)},e.onabort=function(){var t=i.error?i.error:i.transaction.error;s(t)}}).catch(s)});return l(e,t),e},clear:function(t){var n=this,e=new b(function(r,s){n.ready().then(function(){var t=n._dbInfo,e=t.db.transaction(t.storeName,"readwrite"),i=e.objectStore(t.storeName).clear();e.oncomplete=function(){r()},e.onabort=e.onerror=function(){var t=i.error?i.error:i.transaction.error;s(t)}}).catch(s)});return l(e,t),e},length:function(t){var s=this,e=new b(function(i,r){s.ready().then(function(){var t=s._dbInfo,e=t.db.transaction(t.storeName,"readonly").objectStore(t.storeName).count();e.onsuccess=function(){i(e.result)},e.onerror=function(){r(e.error)}}).catch(r)});return l(e,t),e},key:function(o,t){var a=this,e=new b(function(s,n){return o<0?void s(null):void a.ready().then(function(){var t=a._dbInfo,e=t.db.transaction(t.storeName,"readonly").objectStore(t.storeName),i=!1,r=e.openCursor();r.onsuccess=function(){var t=r.result;return t?void(0===o||i?s(t.key):(i=!0,t.advance(o))):void s(null)},r.onerror=function(){n(r.error)}}).catch(n)});return l(e,t),e},keys:function(t){var n=this,e=new b(function(r,s){n.ready().then(function(){var t=n._dbInfo,e=t.db.transaction(t.storeName,"readonly").objectStore(t.storeName).openCursor(),i=[];e.onsuccess=function(){var t=e.result;return t?(i.push(t.key),void t.continue()):void r(i)},e.onerror=function(){s(e.error)}}).catch(s)});return l(e,t),e}},M="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",S=/^~~local_forage_type~([^~]+)~/,A="__lfsc__:",C=A.length,L=C+"arbf".length,E=Object.prototype.toString,O={serialize:function(e,i){var t="";if(e&&(t=E.call(e)),e&&("[object ArrayBuffer]"===t||e.buffer&&"[object ArrayBuffer]"===E.call(e.buffer))){var r,s=A;e instanceof ArrayBuffer?(r=e,s+="arbf"):(r=e.buffer,"[object Int8Array]"===t?s+="si08":"[object Uint8Array]"===t?s+="ui08":"[object Uint8ClampedArray]"===t?s+="uic8":"[object Int16Array]"===t?s+="si16":"[object Uint16Array]"===t?s+="ur16":"[object Int32Array]"===t?s+="si32":"[object Uint32Array]"===t?s+="ui32":"[object Float32Array]"===t?s+="fl32":"[object Float64Array]"===t?s+="fl64":i(new Error("Failed to get type for BinaryArray"))),i(s+f(r))}else if("[object Blob]"===t){var n=new FileReader;n.onload=function(){var t="~~local_forage_type~"+e.type+"~"+f(this.result);i(A+"blob"+t)},n.readAsArrayBuffer(e)}else try{i(JSON.stringify(e))}catch(t){console.error("Couldn't convert value into a JSON string: ",e),i(null,t)}},deserialize:function(t){if(t.substring(0,C)!==A)return JSON.parse(t);var e,i,r=t.substring(L),s=t.substring(C,L);"blob"===s&&S.test(r)&&(i=(e=r.match(S))[1],r=r.substring(e[0].length));var n=g(r);switch(s){case"arbf":return n;case"blob":return o([n],{type:i});case"si08":return new Int8Array(n);case"ui08":return new Uint8Array(n);case"uic8":return new Uint8ClampedArray(n);case"si16":return new Int16Array(n);case"ur16":return new Uint16Array(n);case"si32":return new Int32Array(n);case"ui32":return new Uint32Array(n);case"fl32":return new Float32Array(n);case"fl64":return new Float64Array(n);default:throw new Error("Unkown type: "+s)}},stringToBuffer:g,bufferToString:f},I={_driver:"webSQLStorage",_initStorage:function(t){var r=this,s={db:null};if(t)for(var e in t)s[e]="string"!=typeof t[e]?t[e].toString():t[e];var i=new b(function(e,i){try{s.db=openDatabase(s.name,String(s.version),s.description,s.size)}catch(t){return i(t)}s.db.transaction(function(t){t.executeSql("CREATE TABLE IF NOT EXISTS "+s.storeName+" (id INTEGER PRIMARY KEY, key unique, value)",[],function(){r._dbInfo=s,e()},function(t,e){i(e)})})});return s.serializer=O,i},iterate:function(c,t){var e=this,i=new b(function(h,i){e.ready().then(function(){var a=e._dbInfo;a.db.transaction(function(t){t.executeSql("SELECT * FROM "+a.storeName,[],function(t,e){for(var i=e.rows,r=i.length,s=0;s<r;s++){var n=i.item(s),o=(o=n.value)&&a.serializer.deserialize(o);if(void 0!==(o=c(o,n.key,s+1)))return void h(o)}h()},function(t,e){i(e)})})}).catch(i)});return l(i,t),i},getItem:function(e,t){var n=this;"string"!=typeof e&&(console.warn(e+" used as a key, but it is not a string."),e=String(e));var i=new b(function(s,i){n.ready().then(function(){var r=n._dbInfo;r.db.transaction(function(t){t.executeSql("SELECT * FROM "+r.storeName+" WHERE key = ? LIMIT 1",[e],function(t,e){var i=(i=e.rows.length?e.rows.item(0).value:null)&&r.serializer.deserialize(i);s(i)},function(t,e){i(e)})})}).catch(i)});return l(i,t),i},setItem:function(t,e,i){return y.apply(this,[t,e,i,1])},removeItem:function(s,t){var n=this;"string"!=typeof s&&(console.warn(s+" used as a key, but it is not a string."),s=String(s));var e=new b(function(i,r){n.ready().then(function(){var e=n._dbInfo;e.db.transaction(function(t){t.executeSql("DELETE FROM "+e.storeName+" WHERE key = ?",[s],function(){i()},function(t,e){r(e)})})}).catch(r)});return l(e,t),e},clear:function(t){var s=this,e=new b(function(i,r){s.ready().then(function(){var e=s._dbInfo;e.db.transaction(function(t){t.executeSql("DELETE FROM "+e.storeName,[],function(){i()},function(t,e){r(e)})})}).catch(r)});return l(e,t),e},length:function(t){var s=this,e=new b(function(r,i){s.ready().then(function(){var e=s._dbInfo;e.db.transaction(function(t){t.executeSql("SELECT COUNT(key) as c FROM "+e.storeName,[],function(t,e){var i=e.rows.item(0).c;r(i)},function(t,e){i(e)})})}).catch(i)});return l(e,t),e},key:function(s,t){var n=this,e=new b(function(r,i){n.ready().then(function(){var e=n._dbInfo;e.db.transaction(function(t){t.executeSql("SELECT key FROM "+e.storeName+" WHERE id = ? LIMIT 1",[s+1],function(t,e){var i=e.rows.length?e.rows.item(0).key:null;r(i)},function(t,e){i(e)})})}).catch(i)});return l(e,t),e},keys:function(t){var r=this,e=new b(function(s,i){r.ready().then(function(){var e=r._dbInfo;e.db.transaction(function(t){t.executeSql("SELECT key FROM "+e.storeName,[],function(t,e){for(var i=[],r=0;r<e.rows.length;r++)i.push(e.rows.item(r).key);s(i)},function(t,e){i(e)})})}).catch(i)});return l(e,t),e}},N={_driver:"localStorageWrapper",_initStorage:function(t){var e={};if(t)for(var i in t)e[i]=t[i];return e.keyPrefix=e.name+"/",e.storeName!==this._defaultConfig.storeName&&(e.keyPrefix+=e.storeName+"/"),(this._dbInfo=e).serializer=O,b.resolve()},iterate:function(h,t){var c=this,e=c.ready().then(function(){for(var t=c._dbInfo,e=t.keyPrefix,i=e.length,r=localStorage.length,s=1,n=0;n<r;n++){var o=localStorage.key(n);if(0===o.indexOf(e)){var a=(a=localStorage.getItem(o))&&t.serializer.deserialize(a);if(void 0!==(a=h(a,o.substring(i),s++)))return a}}});return l(e,t),e},getItem:function(i,t){var r=this;"string"!=typeof i&&(console.warn(i+" used as a key, but it is not a string."),i=String(i));var e=r.ready().then(function(){var t=r._dbInfo,e=localStorage.getItem(t.keyPrefix+i);return e=e&&t.serializer.deserialize(e)});return l(e,t),e},setItem:function(o,t,e){var a=this;"string"!=typeof o&&(console.warn(o+" used as a key, but it is not a string."),o=String(o));var i=a.ready().then(function(){void 0===t&&(t=null);var n=t;return new b(function(i,r){var s=a._dbInfo;s.serializer.serialize(t,function(t,e){if(e)r(e);else try{localStorage.setItem(s.keyPrefix+o,t),i(n)}catch(t){"QuotaExceededError"!==t.name&&"NS_ERROR_DOM_QUOTA_REACHED"!==t.name||r(t),r(t)}})})});return l(i,e),i},removeItem:function(e,t){var i=this;"string"!=typeof e&&(console.warn(e+" used as a key, but it is not a string."),e=String(e));var r=i.ready().then(function(){var t=i._dbInfo;localStorage.removeItem(t.keyPrefix+e)});return l(r,t),r},clear:function(t){var r=this,e=r.ready().then(function(){for(var t=r._dbInfo.keyPrefix,e=localStorage.length-1;0<=e;e--){var i=localStorage.key(e);0===i.indexOf(t)&&localStorage.removeItem(i)}});return l(e,t),e},length:function(t){var e=this.keys().then(function(t){return t.length});return l(e,t),e},key:function(i,t){var r=this,e=r.ready().then(function(){var e,t=r._dbInfo;try{e=localStorage.key(i)}catch(t){e=null}return e=e&&e.substring(t.keyPrefix.length)});return l(e,t),e},keys:function(t){var s=this,e=s.ready().then(function(){for(var t=s._dbInfo,e=localStorage.length,i=[],r=0;r<e;r++)0===localStorage.key(r).indexOf(t.keyPrefix)&&i.push(localStorage.key(r).substring(t.keyPrefix.length));return i});return l(e,t),e}},D={},k={INDEXEDDB:"asyncStorage",LOCALSTORAGE:"localStorageWrapper",WEBSQL:"webSQLStorage"},P=[k.INDEXEDDB,k.WEBSQL,k.LOCALSTORAGE],j=["clear","getItem","iterate","key","keys","length","removeItem","setItem"],B={description:"",driver:P.slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1},R={};R[k.INDEXEDDB]=function(){try{if(!_)return!1;var t="undefined"!=typeof openDatabase&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),e="function"==typeof fetch&&-1!==fetch.toString().indexOf("[native code");return(!t||e)&&"undefined"!=typeof indexedDB&&"undefined"!=typeof IDBKeyRange}catch(t){return!1}}(),R[k.WEBSQL]="function"==typeof openDatabase,R[k.LOCALSTORAGE]=function(){try{return"undefined"!=typeof localStorage&&"setItem"in localStorage&&localStorage.setItem}catch(t){return!1}}();var z=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)},F=new(U.prototype.config=function(t){if("object"!==(void 0===t?"undefined":s(t)))return"string"==typeof t?this._config[t]:this._config;if(this._ready)return new Error("Can't call config() after localforage has been used.");for(var e in t){if("storeName"===e&&(t[e]=t[e].replace(/\W/g,"_")),"version"===e&&"number"!=typeof t[e])return new Error("Database version must be a number.");this._config[e]=t[e]}return!("driver"in t&&t.driver)||this.setDriver(this._config.driver)},U.prototype.defineDriver=function(c,t,e){var i=new b(function(e,i){try{var r=c._driver,t=new Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver"),s=new Error("Custom driver name already in use: "+c._driver);if(!c._driver)return void i(t);if(m(c._driver))return void i(s);for(var n=j.concat("_initStorage"),o=0;o<n.length;o++){var a=n[o];if(!a||!c[a]||"function"!=typeof c[a])return void i(t)}var h=b.resolve(!0);"_support"in c&&(h=c._support&&"function"==typeof c._support?c._support():b.resolve(!!c._support)),h.then(function(t){R[r]=t,D[r]=c,e()},i)}catch(t){i(t)}});return u(i,t,e),i},U.prototype.driver=function(){return this._driver||null},U.prototype.getDriver=function(t,e,i){var r=this,s=b.resolve().then(function(){if(!m(t)){if(D[t])return D[t];throw new Error("Driver not found.")}switch(t){case r.INDEXEDDB:return T;case r.LOCALSTORAGE:return N;case r.WEBSQL:return I}});return u(s,e,i),s},U.prototype.getSerializer=function(t){var e=b.resolve(O);return u(e,t),e},U.prototype.ready=function(t){var e=this,i=e._driverSet.then(function(){return null===e._ready&&(e._ready=e._initDriver()),e._ready});return u(i,t,t),i},U.prototype.setDriver=function(t,e,i){function n(){a._config.driver=a.driver()}function o(t){return a._extend(t),n(),a._ready=a._initStorage(a._config),a._ready}function r(s){return function(){var r=0;return function t(){for(;r<s.length;){var e=s[r];return r++,a._dbInfo=null,a._ready=null,a.getDriver(e).then(o).catch(t)}n();var i=new Error("No available storage method found.");return a._driverSet=b.reject(i),a._driverSet}()}}var a=this;z(t)||(t=[t]);var s=this._getSupportedDrivers(t),h=null!==this._driverSet?this._driverSet.catch(function(){return b.resolve()}):b.resolve();return this._driverSet=h.then(function(){var t=s[0];return a._dbInfo=null,a._ready=null,a.getDriver(t).then(function(t){a._driver=t._driver,n(),a._wrapLibraryMethodsWithReady(),a._initDriver=r(s)})}).catch(function(){n();var t=new Error("No available storage method found.");return a._driverSet=b.reject(t),a._driverSet}),u(this._driverSet,e,i),this._driverSet},U.prototype.supports=function(t){return!!R[t]},U.prototype._extend=function(t){r(this,t)},U.prototype._getSupportedDrivers=function(t){for(var e=[],i=0,r=t.length;i<r;i++){var s=t[i];this.supports(s)&&e.push(s)}return e},U.prototype._wrapLibraryMethodsWithReady=function(){for(var t=0;t<j.length;t++)!function(e,i){e[i]=function(){var t=arguments;return e.ready().then(function(){return e[i].apply(e,t)})}}(this,j[t])},U.prototype.createInstance=function(t){return new U(t)},U);function U(t){(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")})(this,U),this.INDEXEDDB=k.INDEXEDDB,this.LOCALSTORAGE=k.LOCALSTORAGE,this.WEBSQL=k.WEBSQL,this._defaultConfig=r({},B),this._config=r({},this._defaultConfig,t),this._driverSet=null,this._initDriver=null,this._ready=!1,this._dbInfo=null,this._wrapLibraryMethodsWithReady(),this.setDriver(this._config.driver).catch(function(){})}e.exports=F},{undefined:void 0}]},{},[1])(1)})}catch(t){localForageInitFailed=!0}cr.plugins_.LocalStorage=function(t){this.runtime=t},function(){var s="",n="",a=[],h="";function c(t){return t?"string"==typeof t?t:"string"==typeof t.message?t.message:"string"==typeof t.name?t.name:"string"==typeof t.data?t.data:"unknown error":"unknown error"}function l(t,e){h=e,t.runtime.trigger(cr.plugins_.LocalStorage.prototype.cnds.OnError,t)}var u="",t=void 0!==window.is_scirra_arcade;function p(t){return!u||t.substr(0,u.length)===u}t&&(u="sa450"+window.scirra_arcade_id+"_");var e=cr.plugins_.LocalStorage.prototype;e.Type=function(t){this.plugin=t,this.runtime=t.runtime},e.Type.prototype.onCreate=function(){},e.Instance=function(t){this.type=t,this.runtime=t.runtime};var i=e.Instance.prototype;i.onCreate=function(){this.pendingSets=0,this.pendingGets=0},i.onDestroy=function(){},i.saveToJSON=function(){return{}},i.loadFromJSON=function(t){};function r(){}function o(){}function d(){}r.prototype.OnItemSet=function(t){return s===t},r.prototype.OnAnyItemSet=function(){return!0},r.prototype.OnItemGet=function(t){return s===t},r.prototype.OnAnyItemGet=function(){return!0},r.prototype.OnItemRemoved=function(t){return s===t},r.prototype.OnAnyItemRemoved=function(){return!0},r.prototype.OnCleared=function(){return!0},r.prototype.OnAllKeyNamesLoaded=function(){return!0},r.prototype.OnError=function(){return!0},r.prototype.OnItemExists=function(t){return s===t},r.prototype.OnItemMissing=function(t){return s===t},r.prototype.CompareKey=function(t,e){return cr.do_cmp(s,t,e)},r.prototype.CompareValue=function(t,e){return cr.do_cmp(n,t,e)},r.prototype.IsProcessingSets=function(){return 0<this.pendingSets},r.prototype.IsProcessingGets=function(){return 0<this.pendingGets},r.prototype.OnAllSetsComplete=function(){return!0},r.prototype.OnAllGetsComplete=function(){return!0},e.cnds=new r,o.prototype.SetItem=function(i,t){var e,r;localForageInitFailed?l(this,"storage failed to initialise - may be disabled in browser settings"):(e=u+i,this.pendingSets++,r=this,localforage.setItem(e,t,function(t,e){r.pendingSets--,t?(h=c(t),r.runtime.trigger(cr.plugins_.LocalStorage.prototype.cnds.OnError,r)):(s=i,n=e,r.runtime.trigger(cr.plugins_.LocalStorage.prototype.cnds.OnAnyItemSet,r),r.runtime.trigger(cr.plugins_.LocalStorage.prototype.cnds.OnItemSet,r),n=s=""),0===r.pendingSets&&r.runtime.trigger(cr.plugins_.LocalStorage.prototype.cnds.OnAllSetsComplete,r)}))},o.prototype.GetItem=function(i){var t,r;localForageInitFailed?l(this,"storage failed to initialise - may be disabled in browser settings"):(t=u+i,this.pendingGets++,r=this,localforage.getItem(t,function(t,e){r.pendingGets--,t?(h=c(t),r.runtime.trigger(cr.plugins_.LocalStorage.prototype.cnds.OnError,r)):(s=i,null==(n=e)&&(n=""),r.runtime.trigger(cr.plugins_.LocalStorage.prototype.cnds.OnAnyItemGet,r),r.runtime.trigger(cr.plugins_.LocalStorage.prototype.cnds.OnItemGet,r),n=s=""),0===r.pendingGets&&r.runtime.trigger(cr.plugins_.LocalStorage.prototype.cnds.OnAllGetsComplete,r)}))},o.prototype.CheckItemExists=function(i){var t,r;localForageInitFailed?l(this,"storage failed to initialise - may be disabled in browser settings"):(t=u+i,r=this,localforage.getItem(t,function(t,e){t?(h=c(t),r.runtime.trigger(cr.plugins_.LocalStorage.prototype.cnds.OnError,r)):(s=i,null===e?(n="",r.runtime.trigger(cr.plugins_.LocalStorage.prototype.cnds.OnItemMissing,r)):(n=e,r.runtime.trigger(cr.plugins_.LocalStorage.prototype.cnds.OnItemExists,r)),n=s="")}))},o.prototype.RemoveItem=function(e){var t,i;localForageInitFailed?l(this,"storage failed to initialise - may be disabled in browser settings"):(t=u+e,i=this,localforage.removeItem(t,function(t){t?(h=c(t),i.runtime.trigger(cr.plugins_.LocalStorage.prototype.cnds.OnError,i)):(s=e,n="",i.runtime.trigger(cr.plugins_.LocalStorage.prototype.cnds.OnAnyItemRemoved,i),i.runtime.trigger(cr.plugins_.LocalStorage.prototype.cnds.OnItemRemoved,i),s="")}))},o.prototype.ClearStorage=function(){var e;localForageInitFailed?l(this,"storage failed to initialise - may be disabled in browser settings"):t||(e=this,localforage.clear(function(t){t?(h=c(t),e.runtime.trigger(cr.plugins_.LocalStorage.prototype.cnds.OnError,e)):(n=s="",cr.clearArray(a),e.runtime.trigger(cr.plugins_.LocalStorage.prototype.cnds.OnCleared,e))}))},o.prototype.GetAllKeyNames=function(){var o;localForageInitFailed?l(this,"storage failed to initialise - may be disabled in browser settings"):(o=this,localforage.keys(function(t,e){var i,r,s,n;if(t)h=c(t),o.runtime.trigger(cr.plugins_.LocalStorage.prototype.cnds.OnError,o);else{for(cr.clearArray(a),i=0,r=e.length;i<r;++i)p(s=e[i])&&a.push((n=s,u?p(n)?n.substr(u.length):void 0:n));o.runtime.trigger(cr.plugins_.LocalStorage.prototype.cnds.OnAllKeyNamesLoaded,o)}}))},e.acts=new o,d.prototype.ItemValue=function(t){t.set_any(n)},d.prototype.Key=function(t){t.set_string(s)},d.prototype.KeyCount=function(t){t.set_int(a.length)},d.prototype.KeyAt=function(t,e){(e=Math.floor(e))<0||e>=a.length?t.set_string(""):t.set_string(a[e])},d.prototype.ErrorMessage=function(t){t.set_string(h)},e.exps=new d}(),cr.plugins_.AJAX=function(t){this.runtime=t},function(){var c=!1,i=null,l=null,u="",t=cr.plugins_.AJAX.prototype;t.Type=function(t){this.plugin=t,this.runtime=t.runtime},t.Type.prototype.onCreate=function(){},t.Instance=function(t){var e;this.type=t,this.runtime=t.runtime,this.lastData="",this.curTag="",this.progress=0,this.timeout=-1,(c=this.runtime.isNWjs)&&(i=require("path"),l=require("fs"),e=window.process||nw.process,u=i.dirname(e.execPath)+"\\")};var e=t.Instance.prototype;e.onCreate=function(){},e.saveToJSON=function(){return{lastData:this.lastData}},e.loadFromJSON=function(t){this.lastData=t.lastData,this.curTag="",this.progress=0};var p={},d="";function r(){}function s(){}function n(){}e.doRequest=function(i,e,t,r){function s(){a.curTag=i,a.runtime.trigger(cr.plugins_.AJAX.prototype.cnds.OnAnyError,a),a.runtime.trigger(cr.plugins_.AJAX.prototype.cnds.OnError,a)}function n(){var t;c?(t=u+e,l.existsSync(t)?l.readFile(t,{encoding:"utf8"},function(t,e){t?s():(a.curTag=i,a.lastData=e.replace(/\r\n/g,"\n"),a.runtime.trigger(cr.plugins_.AJAX.prototype.cnds.OnAnyComplete,a),a.runtime.trigger(cr.plugins_.AJAX.prototype.cnds.OnComplete,a))}):s()):s()}var o,a=this,h=null;try{if((h=this.runtime.isWindowsPhone8?new ActiveXObject("Microsoft.XMLHTTP"):new XMLHttpRequest).onreadystatechange=function(){4===h.readyState&&(a.curTag=i,h.responseText?a.lastData=h.responseText.replace(/\r\n/g,"\n"):a.lastData="",400<=h.status?(a.runtime.trigger(cr.plugins_.AJAX.prototype.cnds.OnAnyError,a),a.runtime.trigger(cr.plugins_.AJAX.prototype.cnds.OnError,a)):c&&!a.lastData.length||!c&&0===h.status&&!a.lastData.length||(a.runtime.trigger(cr.plugins_.AJAX.prototype.cnds.OnAnyComplete,a),a.runtime.trigger(cr.plugins_.AJAX.prototype.cnds.OnComplete,a)))},this.runtime.isWindowsPhone8||(h.onerror=n,h.ontimeout=n,h.onabort=n,h.onprogress=function(t){t.lengthComputable&&(a.progress=t.loaded/t.total,a.curTag=i,a.runtime.trigger(cr.plugins_.AJAX.prototype.cnds.OnProgress,a))}),h.open(t,e),this.runtime.isWindowsPhone8||0<=this.timeout&&void 0!==h.timeout&&(h.timeout=this.timeout),h.responseType="text",r&&h.setRequestHeader&&!p.hasOwnProperty("Content-Type")&&h.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),h.setRequestHeader){for(o in p)if(p.hasOwnProperty(o))try{h.setRequestHeader(o,p[o])}catch(t){}p={}}if(d&&h.overrideMimeType){try{h.overrideMimeType(d)}catch(t){}d=""}r?h.send(r):h.send()}catch(t){n()}},r.prototype.OnComplete=function(t){return cr.equals_nocase(t,this.curTag)},r.prototype.OnAnyComplete=function(t){return!0},r.prototype.OnError=function(t){return cr.equals_nocase(t,this.curTag)},r.prototype.OnAnyError=function(t){return!0},r.prototype.OnProgress=function(t){return cr.equals_nocase(t,this.curTag)},t.cnds=new r,s.prototype.Request=function(e,t){var i=this;this.runtime.isWKWebView&&!this.runtime.isAbsoluteUrl(t)?this.runtime.fetchLocalFileViaCordovaAsText(t,function(t){i.curTag=e,i.lastData=t.replace(/\r\n/g,"\n"),i.runtime.trigger(cr.plugins_.AJAX.prototype.cnds.OnAnyComplete,i),i.runtime.trigger(cr.plugins_.AJAX.prototype.cnds.OnComplete,i)},function(t){i.curTag=e,i.runtime.trigger(cr.plugins_.AJAX.prototype.cnds.OnAnyError,i),i.runtime.trigger(cr.plugins_.AJAX.prototype.cnds.OnError,i)}):this.runtime.isPreview&&!this.runtime.isAbsoluteUrl(t)?this.doRequest(e,this.runtime.getLocalFileUrl(t),"GET"):this.doRequest(e,t,"GET")},s.prototype.RequestFile=function(e,t){var i=this;this.runtime.isWKWebView?this.runtime.fetchLocalFileViaCordovaAsText(t,function(t){i.curTag=e,i.lastData=t.replace(/\r\n/g,"\n"),i.runtime.trigger(cr.plugins_.AJAX.prototype.cnds.OnAnyComplete,i),i.runtime.trigger(cr.plugins_.AJAX.prototype.cnds.OnComplete,i)},function(t){i.curTag=e,i.runtime.trigger(cr.plugins_.AJAX.prototype.cnds.OnAnyError,i),i.runtime.trigger(cr.plugins_.AJAX.prototype.cnds.OnError,i)}):this.doRequest(e,this.runtime.getLocalFileUrl(t),"GET")},s.prototype.Post=function(t,e,i,r){this.doRequest(t,e,r,i)},s.prototype.SetTimeout=function(t){this.timeout=1e3*t},s.prototype.SetHeader=function(t,e){p[t]=e},s.prototype.OverrideMIMEType=function(t){d=t},t.acts=new s,n.prototype.LastData=function(t){t.set_string(this.lastData)},n.prototype.Progress=function(t){t.set_float(this.progress)},n.prototype.Tag=function(t){t.set_string(this.curTag)},t.exps=new n}();var Box2D=window.Box2DFn(),b2Vec2=Box2D.b2Vec2;function createPolygonShape(t){for(var e=new Box2D.b2PolygonShape,i=Box2D._malloc(8*t.length),r=0,s=0;s<t.length;s++)Box2D.HEAPF32[i+r>>2]=t[s].get_x(),Box2D.HEAPF32[i+(r+4)>>2]=t[s].get_y(),r+=8;var n=Box2D.wrapPointer(i,Box2D.b2Vec2);return e.Set(n,t.length),Box2D._free(i),e}b2Vec2._freeCache=[],b2Vec2.Get=function(t,e){var i;return b2Vec2._freeCache.length?((i=b2Vec2._freeCache.pop()).set_x(t),i.set_y(e),i):new b2Vec2(t,e)},b2Vec2.Free=function(t){b2Vec2._freeCache.push(t)},b2Vec2.Clone=function(t){return b2Vec2.Get(t.get_x(),t.get_y())};var tmpvec2a=b2Vec2.Get(0,0),tmpvec2b=b2Vec2.Get(0,0);function getTempVec2a(t,e){return tmpvec2a.set_x(t),tmpvec2a.set_y(e),tmpvec2a}function getTempVec2b(t,e){return tmpvec2b.set_x(t),tmpvec2b.set_y(e),tmpvec2b}function SplitConvexPolysOver8Points(t){for(var e,i=[],r=0,s=t.length;r<s;++r)(e=t[r]).length<=8?i.push(e):i.push.apply(i,SplitConvexPoly(e));return i}function SplitConvexPoly(t){var e,i,r=[];r.push(t.splice(0,8));for(var s=r[0][0],n=r[0][7];t.length;)i=(e=t.splice(0,Math.min(t.length,6)))[e.length-1],e.push(b2Vec2.Clone(s)),e.push(b2Vec2.Clone(n)),r.push(e),n=i;return r}cr.b2Separator=function(){},cr.b2Separator.det=function(t,e,i,r,s,n){return t*r+i*n+s*e-e*i-r*s-n*t},cr.b2Separator.hitRay=function(t,e,i,r,s,n,o,a){var h=i-t,c=r-e,l=o-s,u=a-n,p=(l*(n-e)-u*(s-t))/(c*l-h*u),d=t+p*h,g=e+p*c,f=cr.b2Separator.isOnSegment(i,r,t,e,d,g),y=cr.b2Separator.isOnSegment(d,g,s,n,o,a);return f&&y?b2Vec2.Get(d,g):null},cr.b2Separator.isOnSegment=function(t,e,i,r,s,n){return(t<=i+.1&&s-.1<=t||i-.1<=t&&t<=s+.1)&&(e<=r+.1&&n-.1<=e||r-.1<=e&&e<=n+.1)&&cr.b2Separator.isOnLine(t,e,i,r,s,n)},cr.b2Separator.isOnLine=function(t,e,i,r,s,n){if(.1<Math.abs(s-i)){var o=(n-r)/(s-i)*(t-i)+r;return Math.abs(o-e)<.1}return Math.abs(t-i)<.1},cr.b2Separator.pointsMatch=function(t,e,i,r){return Math.abs(i-t)<.1&&Math.abs(r-e)<.1},cr.b2Separator.Separate=function(t,e){for(var i,r,s,n,o,a,h,c=cr.b2Separator.calcShapes(t),l=[],u=0,p=c.length;u<p;u++){for(r=c[u],(i=[]).length=r.length,o=h=0,a=r.length;o<a;o++)s=r[o],n=r[(o+1)%a],h+=s.get_x()*n.get_y()-s.get_y()*n.get_x(),i[o]=b2Vec2.Get(s.get_x(),s.get_y());if(.001*e<=(h=Math.abs(h/2)))l.push(i);else for(o=0,a=i.length;o<a;o++)b2Vec2.Free(i[o])}return l=SplitConvexPolysOver8Points(l)},cr.b2Separator.calcShapes=function(t){var e,i,r,s,n,o,a,h=[],c=0,l=0,u=0,p=0,d=0,g=0,f=0,y=0,m=0,_=0,v=0,b=0,w=0,x=0,T=[],M=[],S=!1,A=[],C=[],L=!1;for(C.push(t);C.length;){for(l=(h=C[0]).length,S=!0,c=0;c<l;c++)if(m=(y=c)<l-1?c+1:c+1-l,_=c<l-2?c+2:c+2-l,e=h[y],i=h[m],r=h[_],cr.b2Separator.det(e.get_x(),e.get_y(),i.get_x(),i.get_y(),r.get_x(),r.get_y())<0){for(S=!1,f=1e9,u=0;u<l;u++)u!==y&&u!==m&&(b=(v=u)<l-1?u+1:0,s=h[v],n=h[b],(o=cr.b2Separator.hitRay(e.get_x(),e.get_y(),i.get_x(),i.get_y(),s.get_x(),s.get_y(),n.get_x(),n.get_y()))&&((p=(d=i.get_x()-o.get_x())*d+(g=i.get_y()-o.get_y())*g)<f?(x=v,w=b,a=o,f=p):b2Vec2.Free(o)));if(1e9===f)return[];for(T=[],M=[],b=w,s=h[v=x],n=h[b],L=!1,cr.b2Separator.pointsMatch(a.get_x(),a.get_y(),n.get_x(),n.get_y())||(T.push(a),L=!0),cr.b2Separator.pointsMatch(a.get_x(),a.get_y(),s.get_x(),s.get_y())||(M.push(a),L=!0),L||b2Vec2.Free(a),x=-1,w=y;;){if(w===b){if(x<0||l<=x)return[];cr.b2Separator.isOnSegment(n.get_x(),n.get_y(),h[x].get_x(),h[x].get_y(),e.get_x(),e.get_y())||T.push(h[w]);break}T.push(h[w]),(x=w)-1<0?w=l-1:w--}for(T.reverse(),x=-1,w=m;;){if(w===v){if(x<0||l<=x)return[];w!==v||cr.b2Separator.isOnSegment(s.get_x(),s.get_y(),h[x].get_x(),h[x].get_y(),i.get_x(),i.get_y())||M.push(h[w]);break}M.push(h[w]),l-1<(x=w)+1?w=0:w++}C.push(T,M),C.shift();break}S&&A.push(C.shift())}return A},cr.behaviors.Physics=function(s){this.runtime=s,this.world=new Box2D.b2World(getTempVec2a(0,10),!0),this.worldG=10,this.lastUpdateTick=-1;var t=new Box2D.JSContactListener;t.BeginContact=function(t){var e=Box2D.wrapPointer(t,Box2D.b2Contact),i=e.GetFixtureA().GetBody().c2userdata,r=e.GetFixtureB().GetBody().c2userdata;s.registerCollision(i.inst,r.inst)},t.EndContact=function(){},t.PreSolve=function(){},t.PostSolve=function(){},this.world.SetContactListener(t);var e=new Box2D.JSContactFilter,a=this;e.ShouldCollide=function(t,e){if(a.allCollisionsEnabled)return!0;var i=Box2D.wrapPointer(t,Box2D.b2Fixture),r=Box2D.wrapPointer(e,Box2D.b2Fixture),s=i.GetBody().c2userdata.inst.type,n=r.GetBody().c2userdata.inst.type,o=s.extra.Physics_DisabledCollisions;return(!o||!o.contains(n))&&(!(o=n.extra.Physics_DisabledCollisions)||!o.contains(s))},this.world.SetContactFilter(e),this.steppingMode=0,this.velocityIterations=8,this.positionIterations=3,this.allCollisionsEnabled=!0},function(){var L=Box2D.b2BodyDef,E=(Box2D.b2Body,Box2D.b2FixtureDef),O=(Box2D.b2Fixture,Box2D.b2World,Box2D.b2PolygonShape),I=Box2D.b2CircleShape,d=Box2D.b2DistanceJointDef,h=Box2D.b2RevoluteJointDef,t=cr.behaviors.Physics.prototype;t.Type=function(t,e){this.behavior=t,this.objtype=e,this.runtime=t.runtime},t.Type.prototype.onCreate=function(){},t.Instance=function(t,e){this.type=t,this.behavior=t.behavior,this.inst=e,this.runtime=t.runtime,this.world=this.behavior.world};var e=t.Instance.prototype;e.onCreate=function(){this.immovable=this.properties[0],this.collisionmask=this.properties[1],this.preventRotation=this.properties[2],this.density=this.properties[3],this.friction=this.properties[4],this.restitution=this.properties[5],this.linearDamping=this.properties[6],this.angularDamping=this.properties[7],this.bullet=this.properties[8],this.enabled=this.properties[9],this.body=null,this.fixtures=[],this.inst.update_bbox(),this.lastKnownX=this.inst.x,this.lastKnownY=this.inst.y,this.lastKnownAngle=this.inst.angle,this.lastWidth=0,this.lastHeight=0,this.lastTickOverride=!1,this.recreateBody=!1,this.lastAnimation=null,this.lastAnimationFrame=-1,this.myJoints?(cr.clearArray(this.myJoints),cr.clearArray(this.myCreatedJoints),this.joiningMe.clear()):(this.myJoints=[],this.myCreatedJoints=[],this.joiningMe=new cr.ObjectSet);var e=this;this.recycled||(this.myDestroyCallback=function(t){e.onInstanceDestroyed(t)}),this.runtime.addDestroyCallback(this.myDestroyCallback)},e.postCreate=function(){this.inst.update_bbox(),this.createBody(),this.lastAnimation=this.inst.cur_animation,this.lastAnimationFrame=this.inst.cur_frame},e.onDestroy=function(){this.destroyBody(),cr.clearArray(this.myCreatedJoints),this.joiningMe.clear(),this.runtime.removeDestroyCallback(this.myDestroyCallback)},e.saveToJSON=function(){var t,e={e:this.enabled,im:this.immovable,pr:this.preventRotation,d:this.density,fr:this.friction,re:this.restitution,ld:this.linearDamping,ad:this.angularDamping,b:this.bullet,mcj:this.myCreatedJoints};return this.enabled&&(t=this.body.GetLinearVelocity(),e.vx=t.get_x(),e.vy=t.get_y(),e.om=this.body.GetAngularVelocity()),e},e.loadFromJSON=function(t){this.destroyBody(),cr.clearArray(this.myCreatedJoints),this.joiningMe.clear(),this.enabled=t.e,this.immovable=t.im,this.preventRotation=t.pr,this.density=t.d,this.friction=t.fr,this.restitution=t.re,this.linearDamping=t.ld,this.angularDamping=t.ad,this.bullet=t.b,this.lastKnownX=this.inst.x,this.lastKnownY=this.inst.y,this.lastKnownAngle=this.inst.angle,this.lastWidth=this.inst.width,this.lastHeight=this.inst.height,this.enabled&&(this.createBody(),this.body.SetLinearVelocity(getTempVec2a(t.vx,t.vy)),this.body.SetAngularVelocity(t.om),0===t.vx&&0===t.vy&&0===t.om||this.body.SetAwake(!0),this.myCreatedJoints=t.mcj)},e.afterLoad=function(){this.enabled&&this.recreateMyJoints()},e.onInstanceDestroyed=function(t){for(var e=t.uid,i=0,r=0,s=this.myCreatedJoints.length;i<s;i++)this.myCreatedJoints[r]=this.myCreatedJoints[i],r<this.myJoints.length&&(this.myJoints[r]=this.myJoints[i]),this.myCreatedJoints[i].params[1]==e?i<this.myJoints.length&&this.world.DestroyJoint(this.myJoints[i]):r++;(this.myCreatedJoints.length=r)<this.myJoints.length&&(this.myJoints.length=r),this.joiningMe.remove(t)},e.destroyMyJoints=function(){for(var t=0,e=this.myJoints.length;t<e;t++)this.world.DestroyJoint(this.myJoints[t]);cr.clearArray(this.myJoints)},e.recreateMyJoints=function(){for(var t,e=0,i=this.myCreatedJoints.length;e<i;e++)switch((t=this.myCreatedJoints[e]).type){case 0:this.doCreateDistanceJoint(t.params[0],t.params[1],t.params[2],t.params[3],t.params[4]);break;case 1:this.doCreateRevoluteJoint(t.params[0],t.params[1]);break;case 2:this.doCreateLimitedRevoluteJoint(t.params[0],t.params[1],t.params[2],t.params[3])}},e.createFixture=function(t){if(this.body){var e=this.body.CreateFixture(t);return this.fixtures.push(e),e}},e.destroyFixtures=function(){if(this.body){for(var t=0,e=this.fixtures.length;t<e;++t)this.body.DestroyFixture(this.fixtures[t]);cr.clearArray(this.fixtures)}},e.destroyBody=function(){this.body&&(this.destroyMyJoints(),this.destroyFixtures(),this.world.DestroyBody(this.body),this.body=null,this.inst.extra.box2dbody=null)};var N=[];function i(){}function r(){}function s(t,e,i){var r;i?((r=t.extra.Physics_DisabledCollisions)&&r.remove(e),(r=e.extra.Physics_DisabledCollisions)&&r.remove(t)):(t.extra.Physics_DisabledCollisions||(t.extra.Physics_DisabledCollisions=new cr.ObjectSet),t.extra.Physics_DisabledCollisions.add(e),e.extra.Physics_DisabledCollisions||(e.extra.Physics_DisabledCollisions=new cr.ObjectSet),e.extra.Physics_DisabledCollisions.add(t))}function n(){}e.createBody=function(){if(this.enabled){var t,e,i,r,s,n,o,a,h,c,l,u,p,d,g,f,y,m,_=this.inst;_.update_bbox(),this.body||((m=new L).set_type(this.immovable?0:2),m.set_position(getTempVec2b(.02*_.bquad.midX(),.02*_.bquad.midY())),m.set_angle(_.angle),m.set_fixedRotation(this.preventRotation),m.set_linearDamping(this.linearDamping),m.set_angularDamping(this.angularDamping),m.set_bullet(this.bullet),this.body=this.world.CreateBody(m),this.body.c2userdata=this,_.extra.box2dbody=this.body,Box2D.destroy(m)),this.destroyFixtures();var v=new E;v.set_density(this.density),v.set_friction(this.friction),v.set_restitution(this.restitution);var b=this.inst.collision_poly&&!this.inst.collision_poly.is_empty(),w=this.collisionmask;b||this.inst.tilemap_exists||0!==this.collisionmask||(w=1);var x,T=Math.max(Math.abs(_.width),1),M=Math.max(Math.abs(_.height),1),S=_.width<0,A=_.height<0;if(0===w)if(_.tilemap_exists)for(g=_.bquad.midX()-_.x,f=_.bquad.midY()-_.y,_.getAllCollisionRects(N),a=[],t=0,e=N.length;t<e;++t){if(c=(h=N[t]).rc,h.poly){if(!h.poly.convexpolys){for(l=h.poly.pts_cache,u=h.poly.pts_count,i=0;i<u;++i)a.push(b2Vec2.Get(l[2*i],l[2*i+1]));var C=3758096384&h.id;for((-2147483648==C||1073741824==C||536870912==C||-2147483648&C&&1073741824&C&&536870912&C)&&a.reverse(),h.poly.convexpolys=cr.b2Separator.Separate(a,(c.right-c.left)*(c.bottom-c.top)),i=0,r=a.length;i<r;++i)b2Vec2.Free(a[i]);cr.clearArray(a)}for(i=0,r=h.poly.convexpolys.length;i<r;++i){for(s=0,n=(d=h.poly.convexpolys[i]).length;s<n;++s)a.push(b2Vec2.Get(.02*(c.left+d[s].get_x()-g),.02*(c.top+d[s].get_y()-f)));for(x=createPolygonShape(a),v.set_shape(x),this.createFixture(v),Box2D.destroy(x),s=0,n=a.length;s<n;++s)b2Vec2.Free(a[s]);cr.clearArray(a)}}else a.push(b2Vec2.Get(.02*(c.left-g),.02*(c.top-f))),a.push(b2Vec2.Get(.02*(c.right-g),.02*(c.top-f))),a.push(b2Vec2.Get(.02*(c.right-g),.02*(c.bottom-f))),a.push(b2Vec2.Get(.02*(c.left-g),.02*(c.bottom-f))),x=createPolygonShape(a),v.set_shape(x),this.createFixture(v),Box2D.destroy(x);for(i=0,r=a.length;i<r;++i)b2Vec2.Free(a[i]);cr.clearArray(a)}else{for(y=_.angle,_.angle=0,_.set_bbox_changed(),_.update_bbox(),g=_.bquad.midX()-_.x,f=_.bquad.midY()-_.y,_.angle=y,_.set_bbox_changed(),_.collision_poly.cache_poly(S?-T:T,A?-M:M,0),l=_.collision_poly.pts_cache,u=_.collision_poly.pts_count,(a=[]).length=u,t=0;t<u;t++)a[t]=b2Vec2.Get(l[2*t]-g,l[2*t+1]-f);for(S!=A&&a.reverse(),p=cr.b2Separator.Separate(a,T*M),t=0;t<u;t++)b2Vec2.Free(a[t]);if(p.length)for(t=0,e=p.length;t<e;t++){for(i=0,r=(a=p[t]).length;i<r;i++)(o=a[i]).set_x(.02*o.get_x()),o.set_y(.02*o.get_y());for(x=createPolygonShape(a),v.set_shape(x),this.createFixture(v),Box2D.destroy(x),i=0,r=a.length;i<r;i++)b2Vec2.Free(a[i])}else(x=new O).SetAsBox(.02*T*.5,.02*M*.5),v.set_shape(x),this.createFixture(v),Box2D.destroy(x)}else 1===w?(x=new O).SetAsBox(.02*T*.5,.02*M*.5):(x=new I).set_m_radius(.02*Math.min(T,M)*.5),v.set_shape(x),this.createFixture(v),Box2D.destroy(x);this.lastWidth=_.width,this.lastHeight=_.height,Box2D.destroy(v),cr.clearArray(N)}},e.tick=function(){var t,e,i,r,s,n,o,a,h,c,l,u,p,d;this.enabled&&(t=this.inst,0===this.behavior.steppingMode?e=this.runtime.timescale/60:1/30<(e=this.runtime.getDt(this.inst))&&(e=1/30),this.runtime.tickcount_nosave>this.behavior.lastUpdateTick&&0<this.runtime.timescale&&(0!==e&&this.world.Step(e,this.behavior.velocityIterations,this.behavior.positionIterations),this.world.ClearForces(),this.behavior.lastUpdateTick=this.runtime.tickcount_nosave),(this.recreateBody||t.width!==this.lastWidth||t.height!==this.lastHeight||t.cur_animation!==this.lastAnimation||t.cur_frame!==this.lastAnimationFrame||t.tilemap_exists&&t.physics_changed)&&(this.createBody(),this.recreateBody=!1,this.lastAnimation=t.cur_animation,this.lastAnimationFrame=t.cur_frame,t.tilemap_exists&&t.physics_changed&&(t.physics_changed=!1)),i=t.x!==this.lastKnownX||t.y!==this.lastKnownY,r=t.angle!==this.lastKnownAngle,i?(t.update_bbox(),s=t.bquad.midX(),n=t.bquad.midY(),o=s-this.lastKnownX,a=n-this.lastKnownY,r?this.body.SetTransform(getTempVec2a(.02*s,.02*n),t.angle):this.body.SetTransform(getTempVec2a(.02*s,.02*n),this.body.GetAngle()),this.body.SetLinearVelocity(getTempVec2a(o,a)),this.lastTickOverride=!0,this.body.SetAwake(!0)):this.lastTickOverride&&(this.lastTickOverride=!1,this.body.SetLinearVelocity(getTempVec2a(0,0)),this.body.SetTransform(getTempVec2a(.02*t.bquad.midX(),.02*t.bquad.midY()),this.body.GetAngle())),!i&&r&&(this.body.SetTransform(this.body.GetPosition(),t.angle),this.body.SetAwake(!0)),c=(h=this.body.GetPosition()).get_x()/.02,l=h.get_y()/.02,u=this.body.GetAngle(),c===t.x&&l===t.y&&u===t.angle||(t.x=c,t.y=l,t.angle=u,t.set_bbox_changed(),t.update_bbox(),p=t.bquad.midX()-t.x,d=t.bquad.midY()-t.y,0==p&&0==d||(t.x-=p,t.y-=d,t.set_bbox_changed())),this.lastKnownX=t.x,this.lastKnownY=t.y,this.lastKnownAngle=t.angle)},e.getInstImgPointX=function(t){return-1!==t&&this.inst.getImagePoint?0===t&&this.body?(this.body.GetPosition().get_x()+this.body.GetLocalCenter().get_x())/.02:this.inst.getImagePoint(t,!0):this.inst.x},e.getInstImgPointY=function(t){return-1!==t&&this.inst.getImagePoint?0===t&&this.body?(this.body.GetPosition().get_y()+this.body.GetLocalCenter().get_y())/.02:this.inst.getImagePoint(t,!1):this.inst.y},i.prototype.IsSleeping=function(){return!!this.enabled&&!this.body.IsAwake()},i.prototype.CompareVelocity=function(t,e,i){if(!this.enabled)return!1;var r,s,n=this.body.GetLinearVelocity(),o=0===t?n.get_x()/.02:1===t?n.get_y()/.02:(r=n.get_x()/.02,s=n.get_y()/.02,cr.distanceTo(0,0,r,s));return cr.do_cmp(o,e,i)},i.prototype.CompareAngularVelocity=function(t,e){if(!this.enabled)return!1;var i=cr.to_degrees(this.body.GetAngularVelocity());return cr.do_cmp(i,t,e)},i.prototype.CompareMass=function(t,e){if(!this.enabled)return!1;var i=this.body.GetMass()/.02;return cr.do_cmp(i,t,e)},i.prototype.IsEnabled=function(){return this.enabled},t.cnds=new i,r.prototype.ApplyForce=function(t,e,i){var r,s;this.enabled&&(r=this.getInstImgPointX(i),s=this.getInstImgPointY(i),this.body.ApplyForce(getTempVec2a(t,e),getTempVec2b(.02*r,.02*s),!0))},r.prototype.ApplyForceToward=function(t,e,i,r){var s,n,o;this.enabled&&(s=this.getInstImgPointX(r),n=this.getInstImgPointY(r),o=cr.angleTo(s,n,e,i),this.body.ApplyForce(getTempVec2a(Math.cos(o)*t,Math.sin(o)*t),getTempVec2b(.02*s,.02*n),!0))},r.prototype.ApplyForceAtAngle=function(t,e,i){var r,s;this.enabled&&(e=cr.to_radians(e),r=this.getInstImgPointX(i),s=this.getInstImgPointY(i),this.body.ApplyForce(getTempVec2a(Math.cos(e)*t,Math.sin(e)*t),getTempVec2b(.02*r,.02*s),!0))},r.prototype.ApplyImpulse=function(t,e,i){var r,s;this.enabled&&(r=this.getInstImgPointX(i),s=this.getInstImgPointY(i),this.body.ApplyLinearImpulse(getTempVec2a(t,e),getTempVec2b(.02*r,.02*s),!0),this.lastTickOverride=!1,this.lastKnownX=this.inst.x,this.lastKnownY=this.inst.y)},r.prototype.ApplyImpulseToward=function(t,e,i,r){var s,n,o;this.enabled&&(s=this.getInstImgPointX(r),n=this.getInstImgPointY(r),o=cr.angleTo(s,n,e,i),this.body.ApplyLinearImpulse(getTempVec2a(Math.cos(o)*t,Math.sin(o)*t),getTempVec2b(.02*s,.02*n),!0),this.lastTickOverride=!1,this.lastKnownX=this.inst.x,this.lastKnownY=this.inst.y)},r.prototype.ApplyImpulseAtAngle=function(t,e,i){var r,s;this.enabled&&(e=cr.to_radians(e),r=this.getInstImgPointX(i),s=this.getInstImgPointY(i),this.body.ApplyLinearImpulse(getTempVec2a(Math.cos(e)*t,Math.sin(e)*t),getTempVec2b(.02*r,.02*s),!0),this.lastTickOverride=!1,this.lastKnownX=this.inst.x,this.lastKnownY=this.inst.y)},r.prototype.ApplyTorque=function(t){this.enabled&&this.body.ApplyTorque(cr.to_radians(t),!0)},r.prototype.ApplyTorqueToAngle=function(t,e){this.enabled&&(t=cr.to_radians(t),e=cr.to_radians(e),cr.angleClockwise(this.inst.angle,e)?this.body.ApplyTorque(-t,!0):this.body.ApplyTorque(t,!0))},r.prototype.ApplyTorqueToPosition=function(t,e,i){var r;this.enabled&&(t=cr.to_radians(t),r=cr.angleTo(this.inst.x,this.inst.y,e,i),cr.angleClockwise(this.inst.angle,r)?this.body.ApplyTorque(-t,!0):this.body.ApplyTorque(t,!0))},r.prototype.SetAngularVelocity=function(t){this.enabled&&(this.body.SetAngularVelocity(cr.to_radians(t)),this.body.SetAwake(!0))},r.prototype.CreateDistanceJoint=function(t,e,i,r,s){var n;e&&this.enabled&&((n=e.getFirstPicked(this.inst))&&n!=this.inst&&n.extra.box2dbody&&(this.myCreatedJoints.push({type:0,params:[t,n.uid,i,r,s]}),this.doCreateDistanceJoint(t,n.uid,i,r,s)))},e.doCreateDistanceJoint=function(t,e,i,r,s){var n,o,a,h,c,l,u,p;!this.enabled||(n=this.runtime.getObjectByUID(e))&&n!=this.inst&&n.extra.box2dbody&&(n.extra.box2dbody.c2userdata.joiningMe.add(this.inst),o=this.getInstImgPointX(t),a=this.getInstImgPointY(t),c=n.getImagePoint?(h=n.getImagePoint(i,!0),n.getImagePoint(i,!1)):(h=n.x,n.y),l=o-h,u=a-c,(p=new d).Initialize(this.body,n.extra.box2dbody,getTempVec2a(.02*o,.02*a),getTempVec2b(.02*h,.02*c)),p.set_length(.02*Math.sqrt(l*l+u*u)),p.set_dampingRatio(r),p.set_frequencyHz(s),this.myJoints.push(this.world.CreateJoint(p)),Box2D.destroy(p))},r.prototype.CreateRevoluteJoint=function(t,e){var i;e&&this.enabled&&((i=e.getFirstPicked(this.inst))&&i!=this.inst&&i.extra.box2dbody&&(this.myCreatedJoints.push({type:1,params:[t,i.uid]}),this.doCreateRevoluteJoint(t,i.uid)))},e.doCreateRevoluteJoint=function(t,e){var i,r,s,n;!this.enabled||(i=this.runtime.getObjectByUID(e))&&i!=this.inst&&i.extra.box2dbody&&(i.extra.box2dbody.c2userdata.joiningMe.add(this.inst),r=this.getInstImgPointX(t),s=this.getInstImgPointY(t),(n=new h).Initialize(this.body,i.extra.box2dbody,getTempVec2a(.02*r,.02*s)),this.myJoints.push(this.world.CreateJoint(n)),Box2D.destroy(n))},r.prototype.CreateLimitedRevoluteJoint=function(t,e,i,r){var s;e&&this.enabled&&((s=e.getFirstPicked(this.inst))&&s!=this.inst&&s.extra.box2dbody&&(this.myCreatedJoints.push({type:2,params:[t,s.uid,i,r]}),this.doCreateLimitedRevoluteJoint(t,s.uid,i,r)))},e.doCreateLimitedRevoluteJoint=function(t,e,i,r){var s,n,o,a;!this.enabled||(s=this.runtime.getObjectByUID(e))&&s!=this.inst&&s.extra.box2dbody&&(s.extra.box2dbody.c2userdata.joiningMe.add(this.inst),n=this.getInstImgPointX(t),o=this.getInstImgPointY(t),(a=new h).Initialize(this.body,s.extra.box2dbody,getTempVec2a(.02*n,.02*o)),a.set_enableLimit(!0),a.set_lowerAngle(cr.to_radians(i)),a.set_upperAngle(cr.to_radians(r)),this.myJoints.push(this.world.CreateJoint(a)),Box2D.destroy(a))},r.prototype.SetWorldGravity=function(t){if(t!==this.behavior.worldG){this.world.SetGravity(getTempVec2a(0,t)),this.behavior.worldG=t;for(var e=this.behavior.my_instances.valuesRef(),i=0,r=e.length;i<r;i++)e[i].extra.box2dbody&&e[i].extra.box2dbody.SetAwake(!0)}},r.prototype.SetSteppingMode=function(t){this.behavior.steppingMode=t},r.prototype.SetIterations=function(t,e){t<1&&(t=1),e<1&&(e=1),this.behavior.velocityIterations=t,this.behavior.positionIterations=e},r.prototype.SetVelocity=function(t,e){this.enabled&&(this.body.SetLinearVelocity(getTempVec2a(.02*t,.02*e)),this.body.SetAwake(!0),this.lastTickOverride=!1,this.lastKnownX=this.inst.x,this.lastKnownY=this.inst.y)},r.prototype.SetDensity=function(t){if(this.enabled&&this.density!==t){var e,i;for(this.density=t,e=0,i=this.fixtures.length;e<i;++e)this.fixtures[e].SetDensity(t);this.body.ResetMassData()}},r.prototype.SetFriction=function(t){if(this.enabled&&this.friction!==t){var e,i,r,s;for(this.friction=t,e=0,i=this.fixtures.length;e<i;++e)this.fixtures[e].SetFriction(t);for(r=this.body.GetContactList();Box2D.getPointer(r);r=r.get_next()){(s=r.get_contact())&&s.ResetFriction()}}},r.prototype.SetElasticity=function(t){var e,i;if(this.enabled&&this.restitution!==t)for(this.restitution=t,e=0,i=this.fixtures.length;e<i;++e)this.fixtures[e].SetRestitution(t)},r.prototype.SetLinearDamping=function(t){this.enabled&&this.linearDamping!==t&&(this.linearDamping=t,this.body.SetLinearDamping(t))},r.prototype.SetAngularDamping=function(t){this.enabled&&this.angularDamping!==t&&(this.angularDamping=t,this.body.SetAngularDamping(t))},r.prototype.SetImmovable=function(t){this.enabled&&this.immovable!==(0!==t)&&(this.immovable=0!==t,this.body.SetType(this.immovable?0:2),this.body.SetAwake(!0))},r.prototype.EnableCollisions=function(t,e){if(t&&this.enabled){var i,r;if(t.is_family)for(i=0,r=t.members.length;i<r;i++)s(this.inst.type,t.members[i],0!==e);else s(this.inst.type,t,0!==e);this.behavior.allCollisionsEnabled=!1}},r.prototype.SetPreventRotate=function(t){this.enabled&&this.preventRotation!==(0!==t)&&(this.preventRotation=0!==t,this.body.SetFixedRotation(this.preventRotation),this.body.SetAngularVelocity(0),this.body.SetAwake(!0))},r.prototype.SetBullet=function(t){this.enabled&&this.bullet!==(0!==t)&&(this.bullet=0!==t,this.body.SetBullet(this.bullet),this.body.SetAwake(!0))},r.prototype.RemoveJoints=function(){this.enabled&&(this.destroyMyJoints(),cr.clearArray(this.myCreatedJoints),this.joiningMe.clear())},r.prototype.SetEnabled=function(t){this.enabled&&0===t?(this.destroyBody(),this.enabled=!1):this.enabled||1!==t||(this.enabled=!0,this.createBody())},t.acts=new r,n.prototype.VelocityX=function(t){t.set_float(this.enabled?this.body.GetLinearVelocity().get_x()/.02:0)},n.prototype.VelocityY=function(t){t.set_float(this.enabled?this.body.GetLinearVelocity().get_y()/.02:0)},n.prototype.AngularVelocity=function(t){t.set_float(this.enabled?cr.to_degrees(this.body.GetAngularVelocity()):0)},n.prototype.Mass=function(t){t.set_float(this.enabled?this.body.GetMass()/.02:0)},n.prototype.CenterOfMassX=function(t){t.set_float(this.enabled?(this.body.GetPosition().get_x()+this.body.GetLocalCenter().get_x())/.02:0)},n.prototype.CenterOfMassY=function(t){t.set_float(this.enabled?(this.body.GetPosition().get_y()+this.body.GetLocalCenter().get_y())/.02:0)},n.prototype.Density=function(t){t.set_float(this.enabled?this.density:0)},n.prototype.Friction=function(t){t.set_float(this.enabled?this.friction:0)},n.prototype.Elasticity=function(t){t.set_float(this.enabled?this.restitution:0)},n.prototype.LinearDamping=function(t){t.set_float(this.enabled?this.linearDamping:0)},n.prototype.AngularDamping=function(t){t.set_float(this.enabled?this.angularDamping:0)},t.exps=new n}(),cr.behaviors.scrollto=function(t){this.runtime=t,this.shakeMag=0,this.shakeStart=0,this.shakeEnd=0,this.shakeMode=0},function(){var t=cr.behaviors.scrollto.prototype;t.Type=function(t,e){this.behavior=t,this.objtype=e,this.runtime=t.runtime},t.Type.prototype.onCreate=function(){},t.Instance=function(t,e){this.type=t,this.behavior=t.behavior,this.inst=e,this.runtime=t.runtime};var e=t.Instance.prototype;function i(){}function r(){}e.onCreate=function(){this.enabled=this.properties[0]},e.saveToJSON=function(){return{smg:this.behavior.shakeMag,ss:this.behavior.shakeStart,se:this.behavior.shakeEnd,smd:this.behavior.shakeMode}},e.loadFromJSON=function(t){this.behavior.shakeMag=t.smg,this.behavior.shakeStart=t.ss,this.behavior.shakeEnd=t.se,this.behavior.shakeMode=t.smd},e.tick=function(){},e.tick2=function(){if(this.enabled){for(var t,e=this.behavior.my_instances.valuesRef(),i=0,r=0,s=0,n=0,o=e.length;n<o;n++)(t=function(t){for(var e,i=0,r=t.behavior_insts.length;i<r;++i)if((e=t.behavior_insts[i]).behavior instanceof cr.behaviors.scrollto)return e;return null}(e[n]))&&t.enabled&&(i+=e[n].x,r+=e[n].y,++s);var a,h,c,l=this.inst.layer.layout,u=this.runtime.kahanTime.sum,p=0,d=0;u>=this.behavior.shakeStart&&u<this.behavior.shakeEnd&&(a=this.behavior.shakeMag*Math.min(this.runtime.timescale,1),0===this.behavior.shakeMode&&(a*=1-(u-this.behavior.shakeStart)/(this.behavior.shakeEnd-this.behavior.shakeStart)),h=Math.random()*Math.PI*2,c=Math.random()*a,p=Math.cos(h)*c,d=Math.sin(h)*c),l.scrollToX(i/s+p),l.scrollToY(r/s+d)}},i.prototype.IsEnabled=function(){return this.enabled},t.cnds=new i,r.prototype.Shake=function(t,e,i){this.behavior.shakeMag=t,this.behavior.shakeStart=this.runtime.kahanTime.sum,this.behavior.shakeEnd=this.behavior.shakeStart+e,this.behavior.shakeMode=i},r.prototype.SetEnabled=function(t){this.enabled=0!==t},t.acts=new r}(),cr.behaviors.shadowcaster=function(t){this.runtime=t,this.myTypes=[]},function(){var t=cr.behaviors.shadowcaster.prototype;t.Type=function(t,e){this.behavior=t,this.objtype=e,this.runtime=t.runtime,-1===this.behavior.myTypes.indexOf(e)&&this.behavior.myTypes.push(e)},t.Type.prototype.onCreate=function(){},t.Instance=function(t,e){this.type=t,this.behavior=t.behavior,this.inst=e,this.runtime=t.runtime};var e=t.Instance.prototype;function i(){}function r(){}function s(){}e.onCreate=function(){this.inst.extra.shadowcasterHeight=this.properties[0],this.inst.extra.shadowcasterTag=this.properties[1],this.inst.extra.shadowcasterEnabled=this.properties[2]},e.tick=function(){},i.prototype.IsEnabled=function(){return this.inst.extra.shadowcasterEnabled},i.prototype.CompareHeight=function(t,e){var i=this.inst.extra.shadowcasterHeight;return cr.do_cmp(i,t,e)},t.cnds=new i,r.prototype.SetEnabled=function(t){this.inst.extra.shadowcasterEnabled=!!t},r.prototype.SetHeight=function(t){this.inst.extra.shadowcasterHeight!==t&&(this.inst.extra.shadowcasterHeight=t,this.runtime.redraw=!0)},r.prototype.SetTag=function(t){this.inst.extra.shadowcasterTag!==t&&(this.inst.extra.shadowcasterTag=t,this.runtime.redraw=!0)},t.acts=new r,s.prototype.Height=function(t){t.set_float(this.inst.extra.shadowcasterHeight)},s.prototype.Tag=function(t){t.set_string(this.inst.extra.shadowcasterTag)},t.exps=new s}(),cr.behaviors.Pin=function(t){this.runtime=t},function(){var t=cr.behaviors.Pin.prototype;t.Type=function(t,e){this.behavior=t,this.objtype=e,this.runtime=t.runtime},t.Type.prototype.onCreate=function(){},t.Instance=function(t,e){this.type=t,this.behavior=t.behavior,this.inst=e,this.runtime=t.runtime};var e=t.Instance.prototype;function i(){}function r(){}function s(){}e.onCreate=function(){this.pinObject=null,this.pinObjectUid=-1,this.pinAngle=0,this.pinDist=0,this.myStartAngle=0,this.theirStartAngle=0,this.lastKnownAngle=0,this.mode=0;var e=this;this.recycled||(this.myDestroyCallback=function(t){e.onInstanceDestroyed(t)}),this.runtime.addDestroyCallback(this.myDestroyCallback)},e.saveToJSON=function(){return{uid:this.pinObject?this.pinObject.uid:-1,pa:this.pinAngle,pd:this.pinDist,msa:this.myStartAngle,tsa:this.theirStartAngle,lka:this.lastKnownAngle,m:this.mode}},e.loadFromJSON=function(t){this.pinObjectUid=t.uid,this.pinAngle=t.pa,this.pinDist=t.pd,this.myStartAngle=t.msa,this.theirStartAngle=t.tsa,this.lastKnownAngle=t.lka,this.mode=t.m},e.afterLoad=function(){-1===this.pinObjectUid?this.pinObject=null:this.pinObject=this.runtime.getObjectByUID(this.pinObjectUid),this.pinObjectUid=-1},e.onInstanceDestroyed=function(t){this.pinObject==t&&(this.pinObject=null)},e.onDestroy=function(){this.pinObject=null,this.runtime.removeDestroyCallback(this.myDestroyCallback)},e.tick=function(){},e.tick2=function(){var t,e,i,r,s;this.pinObject&&(this.lastKnownAngle!==this.inst.angle&&(this.myStartAngle=cr.clamp_angle(this.myStartAngle+(this.inst.angle-this.lastKnownAngle))),i=this.inst.x,r=this.inst.y,3===this.mode||4===this.mode?((t=cr.distanceTo(this.inst.x,this.inst.y,this.pinObject.x,this.pinObject.y))>this.pinDist||4===this.mode&&t<this.pinDist)&&(e=cr.angleTo(this.pinObject.x,this.pinObject.y,this.inst.x,this.inst.y),i=this.pinObject.x+Math.cos(e)*this.pinDist,r=this.pinObject.y+Math.sin(e)*this.pinDist):(i=this.pinObject.x+Math.cos(this.pinObject.angle+this.pinAngle)*this.pinDist,r=this.pinObject.y+Math.sin(this.pinObject.angle+this.pinAngle)*this.pinDist),s=cr.clamp_angle(this.myStartAngle+(this.pinObject.angle-this.theirStartAngle)),this.lastKnownAngle=s,0!==this.mode&&1!==this.mode&&3!==this.mode&&4!==this.mode||this.inst.x===i&&this.inst.y===r||(this.inst.x=i,this.inst.y=r,this.inst.set_bbox_changed()),0!==this.mode&&2!==this.mode||this.inst.angle===s||(this.inst.angle=s,this.inst.set_bbox_changed()))},i.prototype.IsPinned=function(){return!!this.pinObject},t.cnds=new i,r.prototype.Pin=function(t,e){var i;!t||(i=t.getFirstPicked(this.inst))&&(this.pinObject=i,this.pinAngle=cr.angleTo(i.x,i.y,this.inst.x,this.inst.y)-i.angle,this.pinDist=cr.distanceTo(i.x,i.y,this.inst.x,this.inst.y),this.myStartAngle=this.inst.angle,this.lastKnownAngle=this.inst.angle,this.theirStartAngle=i.angle,this.mode=e)},r.prototype.Unpin=function(){this.pinObject=null},t.acts=new r,s.prototype.PinnedUID=function(t){t.set_int(this.pinObject?this.pinObject.uid:-1)},t.exps=new s}(),cr.behaviors.Rotate=function(t){this.runtime=t},function(){var t=cr.behaviors.Rotate.prototype;t.Type=function(t,e){this.behavior=t,this.objtype=e,this.runtime=t.runtime},t.Type.prototype.onCreate=function(){},t.Instance=function(t,e){this.type=t,this.behavior=t.behavior,this.inst=e,this.runtime=t.runtime};var e=t.Instance.prototype;function i(){}function r(){}function s(){}e.onCreate=function(){this.speed=cr.to_radians(this.properties[0]),this.acc=cr.to_radians(this.properties[1]),this.enabled=this.properties[2]},e.saveToJSON=function(){return{speed:this.speed,acc:this.acc,e:this.enabled}},e.loadFromJSON=function(t){this.speed=t.speed,this.acc=t.acc,t.hasOwnProperty("e")?this.enabled=t.e:this.enabled=!0},e.tick=function(){var t;!this.enabled||0!==(t=this.runtime.getDt(this.inst))&&(0!==this.acc&&(this.speed+=this.acc*t),0!==this.speed&&(this.inst.angle=cr.clamp_angle(this.inst.angle+this.speed*t),this.inst.set_bbox_changed()))},i.prototype.IsEnabled=function(){return this.enabled},t.cnds=new i,r.prototype.SetSpeed=function(t){this.speed=cr.to_radians(t)},r.prototype.SetAcceleration=function(t){this.acc=cr.to_radians(t)},r.prototype.SetEnabled=function(t){this.enabled=1===t},t.acts=new r,s.prototype.Speed=function(t){t.set_float(cr.to_degrees(this.speed))},s.prototype.Acceleration=function(t){t.set_float(cr.to_degrees(this.acc))},t.exps=new s}(),cr.behaviors.Sin=function(t){this.runtime=t},function(){var t=cr.behaviors.Sin.prototype;t.Type=function(t,e){this.behavior=t,this.objtype=e,this.runtime=t.runtime},t.Type.prototype.onCreate=function(){},t.Instance=function(t,e){this.type=t,this.behavior=t.behavior,this.inst=e,this.runtime=t.runtime,this.i=0};var e=t.Instance.prototype,i=2*Math.PI,r=Math.PI/2,s=3*Math.PI/2,n=[0,1,8,3,4,2,5,6,7];function o(){}function a(){}function h(){}e.onCreate=function(){this.movement=n[this.properties[0]],this.wave=this.properties[1],this.period=this.properties[2],this.period+=Math.random()*this.properties[3],0===this.period?this.i=0:(this.i=this.properties[4]/this.period*i,this.i+=Math.random()*this.properties[5]/this.period*i),this.mag=this.properties[6],this.mag+=Math.random()*this.properties[7],this.isEnabled=this.properties[8],this.initialValue=0,this.initialValue2=0,this.ratio=0,5===this.movement&&(this.mag=cr.to_radians(this.mag)),this.init()},e.saveToJSON=function(){return{i:this.i,a:this.isEnabled,mv:this.movement,w:this.wave,p:this.period,mag:this.mag,iv:this.initialValue,iv2:this.initialValue2,r:this.ratio,lkv:this.lastKnownValue,lkv2:this.lastKnownValue2}},e.loadFromJSON=function(t){this.i=t.i,this.isEnabled=t.a,this.movement=t.mv,this.wave=t.w,this.period=t.p,this.mag=t.mag,this.initialValue=t.iv,this.initialValue2=t.iv2||0,this.ratio=t.r,this.lastKnownValue=t.lkv,this.lastKnownValue2=t.lkv2||0},e.init=function(){switch(this.movement){case 0:this.initialValue=this.inst.x;break;case 1:this.initialValue=this.inst.y;break;case 2:this.initialValue=this.inst.width,this.ratio=this.inst.height/this.inst.width;break;case 3:this.initialValue=this.inst.width;break;case 4:this.initialValue=this.inst.height;break;case 5:this.initialValue=this.inst.angle;break;case 6:this.initialValue=this.inst.opacity;break;case 7:this.initialValue=0;break;case 8:this.initialValue=this.inst.x,this.initialValue2=this.inst.y}this.lastKnownValue=this.initialValue,this.lastKnownValue2=this.initialValue2},e.waveFunc=function(t){switch(t%=i,this.wave){case 0:return Math.sin(t);case 1:return t<=r?t/r:t<=s?1-2*(t-r)/Math.PI:(t-s)/r-1;case 2:return 2*t/i-1;case 3:return-2*t/i+1;case 4:return t<Math.PI?-1:1}return 0},e.tick=function(){var t=this.runtime.getDt(this.inst);this.isEnabled&&0!==t&&(0===this.period?this.i=0:(this.i+=t/this.period*i,this.i=this.i%i),this.updateFromPhase())},e.updateFromPhase=function(){switch(this.movement){case 0:this.inst.x!==this.lastKnownValue&&(this.initialValue+=this.inst.x-this.lastKnownValue),this.inst.x=this.initialValue+this.waveFunc(this.i)*this.mag,this.lastKnownValue=this.inst.x;break;case 1:this.inst.y!==this.lastKnownValue&&(this.initialValue+=this.inst.y-this.lastKnownValue),this.inst.y=this.initialValue+this.waveFunc(this.i)*this.mag,this.lastKnownValue=this.inst.y;break;case 2:this.inst.width=this.initialValue+this.waveFunc(this.i)*this.mag,this.inst.height=this.inst.width*this.ratio;break;case 3:this.inst.width=this.initialValue+this.waveFunc(this.i)*this.mag;break;case 4:this.inst.height=this.initialValue+this.waveFunc(this.i)*this.mag;break;case 5:this.inst.angle!==this.lastKnownValue&&(this.initialValue=cr.clamp_angle(this.initialValue+(this.inst.angle-this.lastKnownValue))),this.inst.angle=cr.clamp_angle(this.initialValue+this.waveFunc(this.i)*this.mag),this.lastKnownValue=this.inst.angle;break;case 6:this.inst.opacity=this.initialValue+this.waveFunc(this.i)*this.mag/100,this.inst.opacity<0?this.inst.opacity=0:1<this.inst.opacity&&(this.inst.opacity=1);break;case 8:this.inst.x!==this.lastKnownValue&&(this.initialValue+=this.inst.x-this.lastKnownValue),this.inst.y!==this.lastKnownValue2&&(this.initialValue2+=this.inst.y-this.lastKnownValue2),this.inst.x=this.initialValue+Math.cos(this.inst.angle)*this.waveFunc(this.i)*this.mag,this.inst.y=this.initialValue2+Math.sin(this.inst.angle)*this.waveFunc(this.i)*this.mag,this.lastKnownValue=this.inst.x,this.lastKnownValue2=this.inst.y}this.inst.set_bbox_changed()},e.onSpriteFrameChanged=function(t,e){switch(this.movement){case 2:this.initialValue*=e.width/t.width,this.ratio=e.height/e.width;break;case 3:this.initialValue*=e.width/t.width;break;case 4:this.initialValue*=e.height/t.height}},o.prototype.IsEnabled=function(){return this.isEnabled},o.prototype.CompareMovement=function(t){return this.movement===t},o.prototype.ComparePeriod=function(t,e){return cr.do_cmp(this.period,t,e)},o.prototype.CompareMagnitude=function(t,e){return 5===this.movement?cr.do_cmp(this.mag,t,cr.to_radians(e)):cr.do_cmp(this.mag,t,e)},o.prototype.CompareWave=function(t){return this.wave===t},t.cnds=new o,a.prototype.SetEnabled=function(t){this.isEnabled=1===t},a.prototype.SetPeriod=function(t){this.period=t},a.prototype.SetMagnitude=function(t){this.mag=t,5===this.movement&&(this.mag=cr.to_radians(this.mag))},a.prototype.SetMovement=function(t){5===this.movement&&5!==t&&(this.mag=cr.to_degrees(this.mag)),this.movement=t,this.init()},a.prototype.SetWave=function(t){this.wave=t},a.prototype.SetPhase=function(t){this.i=t*i%i,this.updateFromPhase()},a.prototype.UpdateInitialState=function(){this.init()},t.acts=new a,h.prototype.CyclePosition=function(t){t.set_float(this.i/i)},h.prototype.Period=function(t){t.set_float(this.period)},h.prototype.Magnitude=function(t){5===this.movement?t.set_float(cr.to_degrees(this.mag)):t.set_float(this.mag)},h.prototype.Value=function(t){t.set_float(this.waveFunc(this.i)*this.mag)},t.exps=new h}(),cr.getObjectRefTable=function(){return[cr.plugins_.Sprite,cr.behaviors.Physics,cr.behaviors.scrollto,cr.behaviors.shadowcaster,cr.plugins_.Touch,cr.plugins_.Browser,cr.behaviors.Pin,cr.plugins_.TiledBg,cr.plugins_.shadowlight,cr.behaviors.Rotate,cr.behaviors.Sin,cr.plugins_.Particles,cr.plugins_.Dictionary,cr.plugins_.LocalStorage,cr.plugins_.AJAX,cr.system_object.prototype.cnds.OnLayoutStart,cr.plugins_.Sprite.prototype.acts.SetSize,cr.plugins_.Sprite.prototype.acts.SetPos,cr.system_object.prototype.exps.viewportleft,cr.system_object.prototype.exps.viewporttop,cr.plugins_.Sprite.prototype.acts.SetVisible,cr.plugins_.Sprite.prototype.acts.Spawn,cr.plugins_.TiledBg.prototype.acts.SetSize,cr.plugins_.Sprite.prototype.exps.X,cr.plugins_.Sprite.prototype.exps.Y,cr.behaviors.Physics.prototype.acts.SetEnabled,cr.behaviors.Physics.prototype.acts.EnableCollisions,cr.behaviors.Physics.prototype.acts.SetWorldGravity,cr.behaviors.Physics.prototype.acts.SetIterations,cr.plugins_.Sprite.prototype.acts.SetPosToObject,cr.plugins_.Sprite.prototype.acts.MoveToBottom,cr.plugins_.Sprite.prototype.exps.Width,cr.plugins_.Sprite.prototype.exps.Height,cr.behaviors.Pin.prototype.acts.Pin,cr.plugins_.TiledBg.prototype.acts.MoveToBottom,cr.plugins_.shadowlight.prototype.acts.MoveToBottom,cr.plugins_.shadowlight.prototype.acts.SetPosToObject,cr.plugins_.Sprite.prototype.cnds.OnCreated,cr.plugins_.Sprite.prototype.cnds.IsOverlapping,cr.behaviors.Physics.prototype.acts.CreateLimitedRevoluteJoint,cr.system_object.prototype.exps.anglediff,cr.plugins_.Sprite.prototype.exps.Angle,cr.behaviors.Physics.prototype.acts.SetImmovable,cr.plugins_.Sprite.prototype.acts.SetAnimFrame,cr.plugins_.Sprite.prototype.exps.AnimationFrame,cr.plugins_.Touch.prototype.cnds.IsInTouch,cr.behaviors.Physics.prototype.acts.SetVelocity,cr.system_object.prototype.exps.cos,cr.system_object.prototype.exps.sin,cr.behaviors.Physics.prototype.acts.SetAngularVelocity,cr.system_object.prototype.cnds.Else,cr.plugins_.Sprite.prototype.acts.SetAngle,cr.plugins_.Sprite.prototype.acts.SetWidth,cr.plugins_.Sprite.prototype.acts.RotateClockwise,cr.plugins_.Sprite.prototype.acts.SetHeight,cr.plugins_.Sprite.prototype.cnds.CompareHeight,cr.plugins_.Sprite.prototype.cnds.OnCollision,cr.system_object.prototype.cnds.Compare,cr.system_object.prototype.acts.AddVar,cr.plugins_.LocalStorage.prototype.acts.SetItem,cr.system_object.prototype.acts.Wait,cr.system_object.prototype.acts.GoToLayout,cr.plugins_.Sprite.prototype.cnds.IsVisible,cr.plugins_.Sprite.prototype.cnds.CompareY,cr.plugins_.TiledBg.prototype.exps.Y,cr.behaviors.Sin.prototype.acts.SetEnabled,cr.plugins_.Browser.prototype.cnds.OnResize,cr.plugins_.Touch.prototype.cnds.OnTapGestureObject,cr.system_object.prototype.acts.RestartLayout,cr.system_object.prototype.cnds.EveryTick,cr.plugins_.AJAX.prototype.acts.RequestFile,cr.plugins_.Sprite.prototype.acts.LoadURL,cr.plugins_.Browser.prototype.acts.GoToURL,cr.plugins_.AJAX.prototype.cnds.OnComplete,cr.system_object.prototype.acts.SetVar,cr.plugins_.AJAX.prototype.exps.LastData,cr.plugins_.Sprite.prototype.cnds.IsAnimPlaying,cr.system_object.prototype.acts.GoToLayoutByName,cr.plugins_.Sprite.prototype.cnds.CompareFrame,cr.plugins_.Sprite.prototype.acts.SetAnim,cr.plugins_.LocalStorage.prototype.acts.CheckItemExists,cr.plugins_.LocalStorage.prototype.cnds.OnItemExists,cr.plugins_.LocalStorage.prototype.acts.GetItem,cr.plugins_.LocalStorage.prototype.cnds.OnItemMissing,cr.plugins_.LocalStorage.prototype.cnds.OnItemGet,cr.system_object.prototype.exps.int,cr.plugins_.LocalStorage.prototype.exps.ItemValue]};